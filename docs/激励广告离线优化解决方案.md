# 激励广告离线优化解决方案

## 问题描述
在没有网络连接（飞行模式）时，激励广告会一直显示"广告加载中..."并卡住，用户体验极差。

## 解决方案

### 1. 网络状态检测
- 添加实时网络状态监控
- 初始化时自动检测当前网络状态
- 监听网络状态变化事件

### 2. 超时机制
- 为广告加载添加6秒超时保护
- 超时后自动隐藏加载提示
- 显示用户友好的超时提示

### 3. 离线优雅处理
- 离线状态下直接显示感谢提示，不尝试加载广告
- 为激励作者卡片提供专门的离线感谢消息
- 避免无意义的网络请求和长时间等待

## 技术实现

### 核心改进点

1. **网络状态监控**
```javascript
// 实时检查网络状态
checkNetworkStatus: function() {
  return new Promise(function(resolve) {
    wx.getNetworkType({
      success: function(res) {
        var isOnline = res.networkType !== 'none';
        resolve(isOnline);
      }
    });
  });
}
```

2. **超时保护机制**
```javascript
// 6秒超时保护
this.loadingTimeout = setTimeout(function() {
  wx.hideLoading();
  self.showAdTimeoutMessage();
  self.onAdSkipped();
}, 6000);
```

3. **离线优雅处理**
```javascript
// 检查网络状态，离线时直接显示感谢提示
this.checkNetworkStatus().then(function(isOnline) {
  if (!isOnline) {
    self.showOfflineMessage();
    return;
  }
  // 有网络才继续加载广告
});
```

## 用户体验改进

### 离线状态
- **之前**: 一直显示"广告加载中..."，用户只能强制关闭
- **现在**: 立即显示"当前处于离线状态，广告需要网络连接才能播放，感谢您的理解！"

### 网络超时
- **之前**: 可能无限期等待，没有超时保护
- **现在**: 6秒后自动超时，显示"广告加载超时，可能网络不佳，请稍后重试"

### 激励作者卡片
- **之前**: 离线时也会尝试加载广告并卡住
- **现在**: 离线时显示"感谢支持作者"的专属消息

## 飞行模式适配
该解决方案完美适配FlightToolbox的离线优先设计：
- 飞行员在空中必须使用飞行模式
- 现在广告功能在离线状态下也能优雅处理
- 不会阻塞其他功能的正常使用
- 保持了对作者支持的感谢表达

## 配置要求
无需额外配置，现有的广告位ID继续有效：
- `adunit-079d7e04aeba0625`（主广告位）
- `adunit-316c5630d7a1f9ef`（备用广告位1） 
- `adunit-190474fb7b19f51e`（备用广告位2）

## 测试验证
- ✅ 语法检查通过
- ✅ 离线状态模拟测试通过
- ✅ 超时机制验证通过
- ✅ 网络状态切换测试通过

该优化确保在任何网络环境下，激励广告功能都能提供良好的用户体验。