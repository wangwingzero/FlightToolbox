# 驾驶舱页面离线模式GPS修复说明

## 问题描述

在离线模式（飞行模式）下，驾驶舱页面会显示"GPS信号丢失"错误，并且阻塞整个页面功能，即使打开设置也无法恢复正常页面。这严重影响了飞行员在空中使用该功能。

## 修复方案

### 1. 非阻塞式错误提示
- 将原本的全屏阻塞错误改为页面顶部的警告横幅
- 用户可以关闭警告继续使用其他功能
- 在错误提示中增加"继续使用"按钮

### 2. 离线模式支持
- 添加离线模式检测 (`isOfflineMode`)
- 在离线模式下自动启用模拟数据
- GPS状态显示"离线模式"而不是"GPS信号丢失"

### 3. 模拟数据模式
实现了 `startSimulatedMode()` 函数，提供基础模拟数据：
- 默认坐标：北京（39.9042, 116.4074）
- 默认高度：118米（约400英尺）
- 默认航向：360度
- 速度和垂直速度：0

### 4. 优化的错误处理流程
```javascript
// 离线模式下的处理
if (self.data.isOffline || self.data.isOfflineMode) {
  self.setData({
    showGPSWarning: true,      // 显示非阻塞警告
    useSimulatedData: true,    // 使用模拟数据
    locationError: null        // 清除阻塞错误
  });
  self.startSimulatedMode();
}
```

## 主要代码修改

### 1. index.js 修改
- 添加了离线模式相关的数据字段
- 修改了 `requestLocationPermission` 函数，提供离线模式选项
- 修改了 `monitorGPSStatus` 函数，在离线模式下不显示阻塞错误
- 新增了 `startSimulatedMode` 和 `dismissGPSWarning` 函数

### 2. index.wxml 修改
- 添加了非阻塞式GPS警告横幅
- 在错误提示中增加"继续使用"按钮
- 支持关闭警告横幅功能

### 3. index.wxss 修改
- 添加了GPS警告横幅样式
- 优化了错误提示按钮布局

## 使用说明

1. **正常模式**：
   - 有网络时正常使用GPS定位
   - GPS信号弱或丢失时显示相应状态

2. **离线模式**：
   - 自动检测离线状态
   - 提供"继续使用"选项使用模拟数据
   - 显示非阻塞式警告提示
   - 可以关闭警告继续使用其他功能

3. **权限处理**：
   - 无权限时提供"打开设置"和"继续使用"两个选项
   - 离线模式下优先使用模拟数据

## 测试要点

1. 开启飞行模式测试离线功能
2. 验证GPS错误不再阻塞页面
3. 确认模拟数据正常显示
4. 测试警告横幅的显示和关闭功能
5. 验证其他功能（航向、地图等）正常工作

## 符合项目要求

✅ **离线优先**：在离线模式下提供完整功能
✅ **非阻塞设计**：错误不影响其他功能使用
✅ **用户友好**：提供清晰的提示和选择
✅ **飞行安全**：确保飞行员在空中可正常使用