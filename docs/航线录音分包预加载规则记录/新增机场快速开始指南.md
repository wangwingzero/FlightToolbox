# æ–°å¢æœºåœºå¿«é€Ÿå¼€å§‹æŒ‡å—

**å¿«é€Ÿå‚è€ƒ**: 10æ­¥å®Œæˆæ–°æœºåœºéŸ³é¢‘åˆ†åŒ…é›†æˆï¼ˆå«æœ¬åœ°ç¼“å­˜ï¼‰
**é¢„è®¡æ—¶é—´**: 40-80åˆ†é’Ÿï¼ˆä¸å«éŸ³é¢‘æ”¶é›†å’Œå‹ç¼©ï¼‰
**âš ï¸ é‡è¦**: å¿…é¡»å®Œæˆå…¨éƒ¨10æ­¥ï¼Œç¼ºä¸€ä¸å¯ï¼
**ğŸ”¥ 2025-01-04æ›´æ–°**: æ–°å¢æ­¥éª¤9-10ï¼ˆæœ¬åœ°ç¼“å­˜ç³»ç»Ÿé›†æˆï¼‰

---

## ğŸ“‹ å‡†å¤‡å·¥ä½œæ£€æŸ¥æ¸…å•

```bash
âœ… æ”¶é›†åˆ°çœŸå®æœºåœºå½•éŸ³ï¼ˆMP3æ ¼å¼ï¼‰
âœ… éŸ³é¢‘å·²å‹ç¼©ï¼ˆå»ºè®® 32-48kbpsï¼Œå•æ–‡ä»¶ < 50KBï¼‰
âœ… å‡†å¤‡å¥½è‹±æ–‡è½¬å½•å’Œä¸­æ–‡ç¿»è¯‘
âœ… ç¡®è®¤æœºåœºä¿¡æ¯ï¼ˆICAOä»£ç ã€åŸå¸‚ã€å›½å®¶ï¼‰
âœ… äº†è§£æœ¬åœ°ç¼“å­˜ç³»ç»Ÿçš„ä½œç”¨ï¼ˆé¦–æ¬¡æ’­æ”¾åæ°¸ä¹…ç¼“å­˜ï¼‰
```

---

## ğŸš€ 10æ­¥å¿«é€Ÿé›†æˆï¼ˆå¿…é¡»å…¨éƒ¨å®Œæˆï¼‰

### æ­¥éª¤ 1ï¼šåˆ›å»ºåˆ†åŒ…ç›®å½•å’Œæ–‡ä»¶ï¼ˆ5åˆ†é’Ÿï¼‰

```bash
# 1. åˆ›å»ºåˆ†åŒ…ç›®å½•
cd D:\FlightToolbox\miniprogram
mkdir package{CountryName}

# 2. å¤åˆ¶éŸ³é¢‘æ–‡ä»¶åˆ°åˆ†åŒ…ç›®å½•
copy *.mp3 package{CountryName}\

# 3. åˆ›å»ºåˆ†åŒ…å…¥å£æ–‡ä»¶
# æ–‡ä»¶ï¼špackage{CountryName}/index.js
```

```javascript
// package{CountryName}/index.js
module.exports = {
  name: '{country}AudioPackage',
  description: '{å›½å®¶}{æœºåœº}çœŸå®é™†ç©ºé€šè¯å½•éŸ³ï¼ˆèˆªç©ºå…¬å¸1, èˆªç©ºå…¬å¸2ç­‰ï¼‰',
  version: '1.0.0',
  audioCount: XX,  // å®é™…éŸ³é¢‘æ–‡ä»¶æ•°é‡
  lastUpdated: '2025-XX-XX'
};
```

---

### æ­¥éª¤ 2ï¼šåˆ›å»ºæ•°æ®æ–‡ä»¶ï¼ˆ15-30åˆ†é’Ÿï¼‰

```javascript
// data/regions/{country}.js

const {Country}Data = {
  "clips": [
    {
      "label": "åŒºè°ƒ",  // æ”¾è¡Œ|åœ°é¢|å¡”å°|ç¦»åœº|åŒºè°ƒ|è¿›åœº|è¿›è¿‘
      "full_transcript": "å®Œæ•´è‹±æ–‡è½¬å½•",
      "translation_cn": "å®Œæ•´ä¸­æ–‡ç¿»è¯‘",
      "mp3_file": "éŸ³é¢‘æ–‡ä»¶å.mp3"
    }
    // ... æ›´å¤šå½•éŸ³
  ]
};

module.exports = {Country}Data;
```

**å¿«é€ŸæŠ€å·§**:
- æŒ‰é£è¡Œé˜¶æ®µæ’åºï¼šæ”¾è¡Œ â†’ åœ°é¢ â†’ å¡”å° â†’ ç¦»åœº â†’ åŒºè°ƒ â†’ è¿›åœº â†’ è¿›è¿‘
- åŒä¸€èˆªç­çš„å½•éŸ³è¿ç»­æ’åˆ—
- æ ‡ç­¾ä½¿ç”¨ä¸­æ–‡ï¼šåŒºè°ƒã€è¿›è¿‘ã€å¡”å°ã€åœ°é¢ã€æ”¾è¡Œã€ç¦»åœºã€è¿›åœº

---

### æ­¥éª¤ 3ï¼šç»Ÿè®¡å¤§å°å¹¶é€‰æ‹©é¢„åŠ è½½é¡µé¢ï¼ˆ2åˆ†é’Ÿï¼‰

```powershell
# ç»Ÿè®¡åˆ†åŒ…å¤§å°
cd D:\FlightToolbox\miniprogram
$size = (Get-ChildItem "package{CountryName}\*.mp3" -File | 
         Measure-Object -Property Length -Sum).Sum / 1MB
$count = (Get-ChildItem "package{CountryName}\*.mp3" -File).Count
Write-Output "éŸ³é¢‘æ•°: $count, å¤§å°: $([math]::Round($size, 2)) MB"
```

**é€‰æ‹©é¢„åŠ è½½é¡µé¢**ï¼ˆæ ¹æ®åˆ†åŒ…å¤§å°ï¼‰:

| åˆ†åŒ…å¤§å° | æ¨èé¡µé¢ | å½“å‰å‰©ä½™ç©ºé—´ |
|---------|---------|-------------|
| < 0.3 MB | ğŸ“¡ é€šä¿¡å¤±æ•ˆ | 0.29 MB |
| 0.3-0.4 MB | ğŸ“‚ å½•éŸ³åˆ†ç±» | 0.39 MB |
| 0.4-0.7 MB | ğŸ¬ å½•éŸ³ç‰‡æ®µ | 0.75 MB |
| 0.7-1.0 MB | âœˆï¸ èˆªçº¿å½•éŸ³ | 0.28 MB |
| > 1.0 MB | éœ€å‹ç¼©æˆ–æ‹†åˆ† | - |

---

### æ­¥éª¤ 4ï¼šæ›´æ–° app.jsonï¼ˆ5åˆ†é’Ÿï¼‰

```json
// miniprogram/app.json

{
  "subPackages": [
    // ... å…¶ä»–åˆ†åŒ…
    {
      "root": "package{CountryName}",
      "name": "{country}AudioPackage",
      "pages": ["index"]
    }
  ],
  
  "preloadRule": {
    // é€‰æ‹©åˆé€‚çš„é¢„åŠ è½½é¡µé¢æ·»åŠ ä½ çš„åˆ†åŒ…
    "pages/communication-failure/index": {
      "network": "all",
      "packages": [
        "packageRussia", 
        "packageAustralia", 
        "packageFrance", 
        "packageSingapore",
        "package{CountryName}"  // ğŸ‘ˆ æ·»åŠ è¿™é‡Œ
      ]
    }
  }
}
```

**é‡è¦**: ç¡®ä¿é¢„åŠ è½½é¡µé¢æ€»å¤§å° < 2MBï¼

---

### æ­¥éª¤ 5ï¼šæ›´æ–° audio-preload-guide.jsï¼ˆ5åˆ†é’Ÿï¼‰

```javascript
// miniprogram/utils/audio-preload-guide.js

this.preloadPageMapping = {
  // ... å…¶ä»–åœ°åŒº
  
  '{countryId}': {  // ğŸ‘ˆ å…¨å°å†™è‹±æ–‡ID
    packageName: 'package{CountryName}',
    regionName: '{å›½å®¶}{åŸå¸‚}æœºåœº',
    flag: '{å›½æ——emoji}',  // å¦‚ï¼šğŸ‡¬ğŸ‡§
    preloadPage: 'pages/communication-failure/index',  // ğŸ‘ˆ ä¸æ­¥éª¤4ä¸€è‡´
    preloadPageName: 'é€šä¿¡å¤±æ•ˆ',
    preloadPageIcon: 'ğŸ“¡',
    description: '{å›½å®¶}{åŸå¸‚}æœºåœºé™†ç©ºé€šè¯å½•éŸ³å°†é€šè¿‡é€šä¿¡å¤±æ•ˆé¡µé¢è‡ªåŠ¨é¢„åŠ è½½'
  }
};
```

**å¸¸ç”¨å›½æ—— Emoji**:
```
ğŸ‡¨ğŸ‡³ ä¸­å›½  ğŸ‡¯ğŸ‡µ æ—¥æœ¬  ğŸ‡°ğŸ‡· éŸ©å›½  ğŸ‡ºğŸ‡¸ ç¾å›½  ğŸ‡¬ğŸ‡§ è‹±å›½  ğŸ‡«ğŸ‡· æ³•å›½
ğŸ‡®ğŸ‡¹ æ„å¤§åˆ©  ğŸ‡·ğŸ‡º ä¿„ç½—æ–¯  ğŸ‡¦ğŸ‡º æ¾³å¤§åˆ©äºš  ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡  ğŸ‡¹ğŸ‡­ æ³°å›½
ğŸ‡µğŸ‡­ è²å¾‹å®¾  ğŸ‡¦ğŸ‡ª é˜¿è”é…‹  ğŸ‡¹ğŸ‡· åœŸè€³å…¶  ğŸ‡±ğŸ‡° æ–¯é‡Œå…°å¡
```

---

### æ­¥éª¤ 6ï¼šæ›´æ–° audio-config.jsï¼ˆ10åˆ†é’Ÿï¼‰âš ï¸ å¿…é¡»å®Œæˆ

```javascript
// miniprogram/utils/audio-config.js

// 1ï¸âƒ£ åœ¨æ–‡ä»¶é¡¶éƒ¨æ·»åŠ æ•°æ®å¯¼å…¥
let {country}Data;  // ğŸ‘ˆ æ·»åŠ å˜é‡å£°æ˜

try {
  // åœ¨ try å—ä¸­æ·»åŠ  require
  {country}Data = require('../data/regions/{country}.js');  // ğŸ‘ˆ å¯¼å…¥æ•°æ®
} catch (error) {
  console.error('åŠ è½½{å›½å®¶}éŸ³é¢‘æ•°æ®å¤±è´¥:', error);
  {country}Data = { clips: [] };  // ğŸ‘ˆ æ·»åŠ é™çº§å¤„ç†
}

// 2ï¸âƒ£ åœ¨ regions æ•°ç»„ä¸­æ·»åŠ åœ°åŒºé…ç½®
class AudioConfigManager {
  constructor() {
    this.regions = [
      // ... å…¶ä»–åœ°åŒº
      {
        id: '{countryId}',          // ğŸ‘ˆ å¿…é¡»ä¸æ­¥éª¤5çš„regionIdä¸€è‡´
        continentId: 'asia',        // ğŸ‘ˆ asia/europe/america/oceania
        name: '{å›½å®¶}',
        flag: '{å›½æ——emoji}',
        description: '{æœºåœºå}çœŸå®é™†ç©ºé€šè¯å½•éŸ³',
        count: XX,                  // ğŸ‘ˆ å®é™…éŸ³é¢‘æ•°é‡
        hasRealRecordings: true,
        subPackageName: '{country}AudioPackage'  // ğŸ‘ˆ ä¸æ­¥éª¤1çš„nameä¸€è‡´
      }
    ];

    // 3ï¸âƒ£ åœ¨ airports æ•°ç»„ä¸­æ·»åŠ æœºåœºé…ç½®
    this.airports = [
      // ... å…¶ä»–æœºåœº
      {
        id: '{countryId}',          // ğŸ‘ˆ ä¸ä¸Šé¢regionIdä¸€è‡´
        regionId: '{countryId}',
        name: '{å›½å®¶}{åŸå¸‚}{æœºåœºå…¨å}',
        city: '{åŸå¸‚}',
        icao: '{ICAO}',             // å¦‚ï¼šEGLL
        packageName: 'package{CountryName}',  // ğŸ‘ˆ ä¸æ­¥éª¤1çš„ç›®å½•åä¸€è‡´
        audioPath: '/package{CountryName}/',  // ğŸ‘ˆ æ³¨æ„æ–œæ 
        icon: '{æœºåœºemoji}',         // å¦‚ï¼šğŸ°ã€ğŸ™ï¸
        description: '{å›½å®¶}{åŸå¸‚}æœºåœºçœŸå®é™†ç©ºé€šè¯å½•éŸ³',
        clips: {country}Data.clips || []  // ğŸ‘ˆ ä½¿ç”¨å¯¼å…¥çš„æ•°æ®
      }
    ];
  }
}
```

**é‡è¦æç¤º**:
- âœ… `id`ã€`regionId` å¿…é¡»åœ¨æ‰€æœ‰é…ç½®æ–‡ä»¶ä¸­ä¿æŒä¸€è‡´
- âœ… `packageName` å¿…é¡»ä¸åˆ†åŒ…ç›®å½•åä¸€è‡´ï¼ˆæ³¨æ„å¤§å°å†™ï¼‰
- âœ… `count` å¿…é¡»ä¸å®é™…éŸ³é¢‘æ•°é‡ä¸€è‡´
- âœ… `continentId` å¿…é¡»é€‰æ‹©æ­£ç¡®çš„å¤§æ´²ï¼šasia/europe/america/oceania

**å¤§æ´²æ€»æ•°æ›´æ–°**ï¼ˆåœ¨å¯¹åº”continentIdé…ç½®ä¸­ï¼‰:
```javascript
// æ‰¾åˆ°å¯¹åº”çš„å¤§æ´²é…ç½®ï¼Œæ›´æ–° totalCount å’Œ regionCount
{
  id: 'asia',
  name: 'äºšæ´²',
  totalCount: åŸæ•°å€¼ + æ–°å¢éŸ³é¢‘æ•°,  // ğŸ‘ˆ æ›´æ–°
  regionCount: åŸæ•°å€¼ + 1,          // ğŸ‘ˆ æ›´æ–°
  // ...
}
```

---

### æ­¥éª¤ 7ï¼šæ›´æ–° audio-package-loader.jsï¼ˆ5åˆ†é’Ÿï¼‰âš ï¸ å¿…é¡»å®Œæˆ

```javascript
// miniprogram/utils/audio-package-loader.js

// åœ¨ packageMapping å¯¹è±¡ä¸­æ·»åŠ é…ç½®
this.packageMapping = {
  // ... å…¶ä»–åœ°åŒº
  
  '{countryId}': {  // ğŸ‘ˆ å¿…é¡»ä¸æ­¥éª¤6çš„regionIdä¸€è‡´
    packageName: '{country}AudioPackage',      // ğŸ‘ˆ ä¸æ­¥éª¤1çš„nameä¸€è‡´
    packageRoot: 'package{CountryName}',       // ğŸ‘ˆ ä¸æ­¥éª¤1çš„ç›®å½•åä¸€è‡´
    displayName: '{å›½å®¶}{åŸå¸‚}æœºåœº',
    flag: '{å›½æ——emoji}'
  }
};
```

**æ£€æŸ¥è¦ç‚¹**:
- âœ… `{countryId}` ä¸æ­¥éª¤6çš„ regionId å®Œå…¨ä¸€è‡´
- âœ… `packageName` ä¸æ­¥éª¤1çš„ module.exports.name ä¸€è‡´
- âœ… `packageRoot` ä¸æ­¥éª¤1çš„ç›®å½•åä¸€è‡´
- âœ… å¤§å°å†™ä¸¥æ ¼åŒ¹é…

---

### æ­¥éª¤ 8ï¼šæ›´æ–° audio-player/index.tsï¼ˆ3åˆ†é’Ÿï¼‰âš ï¸ å¿…é¡»å®Œæˆ

```typescript
// miniprogram/pages/audio-player/index.ts

// åœ¨ setAudioSource æ–¹æ³•ä¸­çš„ regionPathMap å¯¹è±¡æ·»åŠ è·¯å¾„æ˜ å°„
const regionPathMap: { [key: string]: string } = {
  // ... å…¶ä»–åœ°åŒº
  
  '{countryId}': '/package{CountryName}/'  // ğŸ‘ˆ å¿…é¡»ä¸æ­¥éª¤1çš„ç›®å½•åä¸€è‡´ï¼Œæ³¨æ„æ–œæ 
};
```

**æ£€æŸ¥è¦ç‚¹**:
- âœ… `{countryId}` ä¸æ­¥éª¤6ã€7å®Œå…¨ä¸€è‡´
- âœ… è·¯å¾„æ ¼å¼ï¼š`/package{CountryName}/` ï¼ˆå‰åéƒ½æœ‰æ–œæ ï¼‰
- âœ… ç›®å½•åä¸æ­¥éª¤1å®Œå…¨ä¸€è‡´ï¼ˆæ³¨æ„å¤§å°å†™ï¼‰

---

### æ­¥éª¤ 9ï¼šé›†æˆæœ¬åœ°ç¼“å­˜ç³»ç»Ÿï¼ˆ10åˆ†é’Ÿï¼‰ğŸ”¥ 2025-01-04æ–°å¢

> ğŸ’¡ **æ ¸å¿ƒä»·å€¼**ï¼šç¡®ä¿éŸ³é¢‘é¦–æ¬¡æ’­æ”¾åæ°¸ä¹…ç¼“å­˜åˆ°æœ¬åœ°ï¼Œé£è¡Œæ¨¡å¼ä¸‹ç§’å¼€

#### 9.1 æ’­æ”¾å™¨é›†æˆï¼ˆå¿…é¡»ï¼‰

```typescript
// miniprogram/pages/audio-player/index.ts

// ğŸ‘‰ åœ¨æ–‡ä»¶é¡¶éƒ¨æ·»åŠ å¯¼å…¥
import * as AudioCacheManager from '../../utils/audio-cache-manager.js';

Page({
  onLoad: function() {
    // ğŸ‘‰ åˆå§‹åŒ–éŸ³é¢‘ç¼“å­˜ç³»ç»Ÿ
    AudioCacheManager.initAudioCache()
      .then(() => console.log('âœ… éŸ³é¢‘ç¼“å­˜ç³»ç»Ÿåˆå§‹åŒ–æˆåŠŸ'))
      .catch(err => console.error('âŒ éŸ³é¢‘ç¼“å­˜ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥:', err));
  },

  // ğŸ‘‰ ä¿®æ”¹ playAudio æ–¹æ³•ï¼ˆå¦‚æœè¿˜æœªé›†æˆæœ¬åœ°ç¼“å­˜ï¼‰
  playAudio: function(regionId: string, airportCode: string, clipIndex: number) {
    var self = this;

    // 1. ç”Ÿæˆç¼“å­˜é”®
    var cacheKey = regionId + '_' + airportCode + '_' + clipIndex;

    // 2. å°è¯•ä½¿ç”¨æœ¬åœ°ç¼“å­˜
    var cachedPath = AudioCacheManager.getCachedAudioPath(cacheKey);

    if (cachedPath) {
      // 2.1 ä½¿ç”¨ç¼“å­˜è·¯å¾„ï¼ˆç¦»çº¿ç§’å¼€ï¼‰
      console.log('âœ… ä½¿ç”¨æœ¬åœ°ç¼“å­˜:', cachedPath);
      this.audioContext.src = cachedPath;
      this.audioContext.play();
    } else {
      // 2.2 é¦–æ¬¡æ’­æ”¾ï¼šä½¿ç”¨åˆ†åŒ…è·¯å¾„
      var originalSrc = this.buildAudioSrc(regionId, airportCode, clipIndex);
      this.audioContext.src = originalSrc;
      this.audioContext.play();

      // 2.3 æ’­æ”¾æˆåŠŸåå¼‚æ­¥ç¼“å­˜ï¼ˆä¸é˜»å¡ï¼‰
      this.audioContext.onPlay(function() {
        AudioCacheManager.ensureAudioCached(cacheKey, originalSrc)
          .then(path => console.log('âœ… éŸ³é¢‘å·²ç¼“å­˜:', path))
          .catch(err => console.warn('âš ï¸ ç¼“å­˜å¤±è´¥:', err));
      });
    }
  }
});
```

#### 9.2 éªŒè¯é›†æˆï¼ˆå¿«é€Ÿæ£€æŸ¥ï¼‰

```typescript
// æ£€æŸ¥æ’­æ”¾å™¨æ˜¯å¦å·²é›†æˆæœ¬åœ°ç¼“å­˜
// åœ¨ pages/audio-player/index.ts ä¸­æœç´¢ï¼š

// âœ… æ­£ç¡®ï¼šåº”è¯¥èƒ½æ‰¾åˆ°ä»¥ä¸‹å†…å®¹
import * as AudioCacheManager from '../../utils/audio-cache-manager.js';
AudioCacheManager.initAudioCache()
AudioCacheManager.getCachedAudioPath(cacheKey)
AudioCacheManager.ensureAudioCached(cacheKey, originalSrc)

// âŒ å¦‚æœæ‰¾ä¸åˆ°ï¼Œè¯´æ˜è¿˜æœªé›†æˆï¼Œéœ€è¦æŒ‰ç…§æ­¥éª¤9.1æ·»åŠ 
```

---

### æ­¥éª¤ 10ï¼šç”¨æˆ·é¡µé¢é›†æˆï¼ˆå¯é€‰ï¼Œ5åˆ†é’Ÿï¼‰ğŸ”¥ æ–°å¢åŠŸèƒ½

> ğŸ’¡ ä¸ºç”¨æˆ·æä¾›ç¼“å­˜ç®¡ç†ã€æ™ºèƒ½é¢„çƒ­ã€å¥åº·æ£€æŸ¥åŠŸèƒ½

```javascript
// miniprogram/pages/home/index.jsï¼ˆæˆ–å…¶ä»–ç”¨æˆ·ç®¡ç†é¡µé¢ï¼‰

var AudioCacheManager = require('../../utils/audio-cache-manager.js');
var AudioPreheatManager = require('../../utils/audio-preheat-manager.js');

Page({
  // æ˜¾ç¤ºç¼“å­˜ç»Ÿè®¡
  showAudioCacheStats: function() {
    var stats = AudioCacheManager.getCacheStats();
    wx.showModal({
      title: 'éŸ³é¢‘ç¼“å­˜ç»Ÿè®¡',
      content: 'å·²ç¼“å­˜: ' + stats.totalCount + 'ä¸ªéŸ³é¢‘\n' +
               'å ç”¨ç©ºé—´: ' + stats.totalSizeMB + ' MB / ' + stats.maxSizeMB + ' MB',
      showCancel: false
    });
  },

  // å¯åŠ¨æ™ºèƒ½é¢„çƒ­
  startAudioPreheat: function() {
    wx.showLoading({ title: 'é¢„çƒ­ä¸­...', mask: true });

    AudioPreheatManager.startPreheat()
      .then(function(result) {
        wx.hideLoading();
        if (result.status === 'completed') {
          wx.showModal({
            title: 'é¢„çƒ­å®Œæˆ',
            content: 'æˆåŠŸ: ' + result.success + 'ä¸ª\n' +
                     'å¤±è´¥: ' + result.failed + 'ä¸ª\n' +
                     'è·³è¿‡: ' + result.skipped + 'ä¸ª',
            showCancel: false
          });
        }
      });
  },

  // æ¸…ç©ºç¼“å­˜
  clearAudioCache: function() {
    wx.showModal({
      title: 'ç¡®è®¤æ¸…ç©ºéŸ³é¢‘ç¼“å­˜',
      content: 'å°†æ¸…ç©ºæ‰€æœ‰ç¦»çº¿éŸ³é¢‘ç¼“å­˜',
      success: function(res) {
        if (res.confirm) {
          AudioCacheManager.clearAllCache()
            .then(() => wx.showToast({ title: 'ç¼“å­˜å·²æ¸…ç©º', icon: 'success' }));
        }
      }
    });
  }
});
```

---

## âš ï¸ å…³é”®é”™è¯¯è­¦å‘Š

### å¦‚æœç¼ºå°‘æ­¥éª¤6-10ï¼Œä¼šå‡ºç°ä»¥ä¸‹é”™è¯¯ï¼š

```javascript
// âŒ ç¼ºå°‘æ­¥éª¤6ï¼ˆaudio-config.jsï¼‰
// ç°è±¡ï¼šèˆªçº¿å½•éŸ³é¡µé¢çœ‹ä¸åˆ°æ–°å¢çš„å›½å®¶å¡ç‰‡

// âŒ ç¼ºå°‘æ­¥éª¤7ï¼ˆaudio-package-loader.jsï¼‰
// ç°è±¡ï¼šç‚¹å‡»æ’­æ”¾æ—¶æ˜¾ç¤º"æœªæ‰¾åˆ°åœ°åŒºçš„åˆ†åŒ…é…ç½®"

// âŒ ç¼ºå°‘æ­¥éª¤8ï¼ˆaudio-player/index.tsï¼‰
// ç°è±¡ï¼šæ’­æ”¾æ—¶æ˜¾ç¤º"æœªæ‰¾åˆ°åœ°åŒºIDçš„è·¯å¾„æ˜ å°„"ã€"éŸ³é¢‘ä¸Šä¸‹æ–‡ä¸å­˜åœ¨ï¼Œæ— æ³•æ’­æ”¾"
// æ§åˆ¶å°é”™è¯¯ï¼šâŒ æœªæ‰¾åˆ°åœ°åŒºID "xxx" çš„è·¯å¾„æ˜ å°„

// âŒ ç¼ºå°‘æ­¥éª¤9ï¼ˆæœ¬åœ°ç¼“å­˜é›†æˆï¼‰ğŸ”¥ æ–°å¢
// ç°è±¡ï¼šéŸ³é¢‘æ¯æ¬¡éƒ½éœ€è¦åŠ è½½ï¼Œé£è¡Œæ¨¡å¼ä¸‹å¯èƒ½æ’­æ”¾å¤±è´¥
// å½±å“ï¼šç¦»çº¿ç¨³å®šæ€§å·®ï¼Œé‡å¤æ’­æ”¾é€Ÿåº¦æ…¢
```

---

## âœ… éªŒè¯æ¸…å•ï¼ˆ5åˆ†é’Ÿï¼‰

### è‡ªåŠ¨éªŒè¯è„šæœ¬

```powershell
# åœ¨ miniprogram ç›®å½•ä¸‹è¿è¡Œ

# 1. æ£€æŸ¥éŸ³é¢‘æ•°é‡ä¸æ•°æ®è®°å½•æ˜¯å¦ä¸€è‡´
$audioCount = (Get-ChildItem "package{CountryName}\*.mp3" -File).Count
$dataCount = (Select-String -Path "data\regions\{country}.js" -Pattern '"mp3_file":').Matches.Count
if ($audioCount -eq $dataCount) {
  Write-Output "âœ… æ•°é‡ä¸€è‡´: $audioCount"
} else {
  Write-Output "âŒ æ•°é‡ä¸ä¸€è‡´: éŸ³é¢‘$audioCount, æ•°æ®$dataCount"
}

# 2. æ£€æŸ¥è¯­æ³•
node -c package{CountryName}/index.js
node -c data/regions/{country}.js
node -c utils/audio-preload-guide.js

# 3. æ£€æŸ¥æ˜¯å¦æœ‰é‡å¤è®°å½•
$files = Select-String -Path "data\regions\{country}.js" -Pattern '"mp3_file": "(.*?)"' | 
         ForEach-Object { $_.Matches.Groups[1].Value }
$duplicates = $files | Group-Object | Where-Object { $_.Count -gt 1 }
if ($duplicates) {
  Write-Output "âŒ å‘ç°é‡å¤è®°å½•:"
  $duplicates | ForEach-Object { Write-Output "  - $($_.Name)" }
} else {
  Write-Output "âœ… æ— é‡å¤è®°å½•"
}

# 4. éªŒè¯é¢„åŠ è½½é¡µé¢å¤§å°
$packages = @('package1', 'package2', 'package{CountryName}')
$total = 0
foreach ($pkg in $packages) {
  $size = (Get-ChildItem "$pkg\*.mp3" -File | Measure-Object -Property Length -Sum).Sum / 1MB
  $total += $size
}
if ($total -lt 2.0) {
  Write-Output "âœ… é¢„åŠ è½½å¤§å°: $([math]::Round($total, 2)) MB < 2MB"
} else {
  Write-Output "âŒ é¢„åŠ è½½è¶…é™: $([math]::Round($total, 2)) MB > 2MB"
}
```

### æ‰‹åŠ¨æ£€æŸ¥æ¸…å•ï¼ˆ10æ­¥å…¨æ£€æŸ¥ï¼‰

```bash
âœ… æ­¥éª¤1: package{CountryName}/index.js å·²åˆ›å»º
âœ… æ­¥éª¤1: package{CountryName}/*.mp3 éŸ³é¢‘æ–‡ä»¶å·²å¤åˆ¶
âœ… æ­¥éª¤1: package{CountryName}/index.wxml å·²åˆ›å»º
âœ… æ­¥éª¤1: package{CountryName}/index.json å·²åˆ›å»º
âœ… æ­¥éª¤1: package{CountryName}/index.wxss å·²åˆ›å»º
âœ… æ­¥éª¤2: data/regions/{country}.js å·²åˆ›å»º
âœ… æ­¥éª¤3: ç»Ÿè®¡äº†åˆ†åŒ…å¤§å°å’Œæ•°é‡
âœ… æ­¥éª¤4: app.json - subPackages å·²æ·»åŠ 
âœ… æ­¥éª¤4: app.json - preloadRule å·²æ›´æ–°
âœ… æ­¥éª¤5: audio-preload-guide.js å·²æ·»åŠ åœ°åŒºæ˜ å°„
âœ… æ­¥éª¤6: audio-config.js - æ•°æ®å¯¼å…¥å·²æ·»åŠ ï¼ˆé¡¶éƒ¨ï¼‰
âœ… æ­¥éª¤6: audio-config.js - regions é…ç½®å·²æ·»åŠ 
âœ… æ­¥éª¤6: audio-config.js - airports é…ç½®å·²æ·»åŠ 
âœ… æ­¥éª¤6: audio-config.js - å¤§æ´²æ€»æ•°å·²æ›´æ–°
âœ… æ­¥éª¤7: audio-package-loader.js - packageMapping å·²æ·»åŠ 
âœ… æ­¥éª¤8: audio-player/index.ts - regionPathMap å·²æ·»åŠ 
âœ… æ­¥éª¤9: audio-player/index.ts - AudioCacheManagerå¯¼å…¥å·²æ·»åŠ  ğŸ”¥ æ–°å¢
âœ… æ­¥éª¤9: audio-player/index.ts - initAudioCache()å·²è°ƒç”¨ ğŸ”¥ æ–°å¢
âœ… æ­¥éª¤9: audio-player/index.ts - æ’­æ”¾é€»è¾‘å·²é›†æˆç¼“å­˜ ğŸ”¥ æ–°å¢
âœ… æ­¥éª¤10: pages/home/index.js - ç¼“å­˜ç®¡ç†åŠŸèƒ½å·²æ·»åŠ ï¼ˆå¯é€‰ï¼‰ğŸ”¥ æ–°å¢
âœ… éŸ³é¢‘æ•°é‡ = æ•°æ®è®°å½•æ•°
âœ… æ— é‡å¤è®°å½•
âœ… è¯­æ³•æ£€æŸ¥é€šè¿‡
âœ… é¢„åŠ è½½é¡µé¢æ€»å¤§å° < 2MB
```

---

## ğŸ§ª çœŸæœºæµ‹è¯•ï¼ˆ15åˆ†é’Ÿï¼‰

### æµ‹è¯•æ­¥éª¤

```bash
1. å¾®ä¿¡å¼€å‘è€…å·¥å…·ç¼–è¯‘
   âœ… æ— ç¼–è¯‘é”™è¯¯
   âœ… æ—  ESLint é”™è¯¯

2. çœŸæœºé¢„è§ˆ
   âœ… æ‰«ç åœ¨çœŸæœºä¸Šè¿è¡Œ
   âœ… è®¿é—®é¢„åŠ è½½é¡µé¢ï¼ˆå¦‚ï¼šé€šä¿¡å¤±æ•ˆï¼‰
   âœ… ç­‰å¾…åˆ†åŒ…è‡ªåŠ¨ä¸‹è½½

3. æµ‹è¯•æ’­æ”¾
   âœ… é¦–æ¬¡æ’­æ”¾æ˜¾ç¤ºå¼•å¯¼å¼¹çª—
   âœ… ç‚¹å‡»"å‰å¾€"è·³è½¬åˆ°é¢„åŠ è½½é¡µé¢
   âœ… è¿”å›åèƒ½æ­£å¸¸æ’­æ”¾
   âœ… æ‰€æœ‰éŸ³é¢‘éƒ½èƒ½æ’­æ”¾
   âœ… é¦–æ¬¡æ’­æ”¾æ—¶æ§åˆ¶å°æ˜¾ç¤º"âœ… éŸ³é¢‘å·²ç¼“å­˜" ğŸ”¥ æ–°å¢

4. ç¦»çº¿æµ‹è¯•
   âœ… å¼€å¯é£è¡Œæ¨¡å¼
   âœ… éŸ³é¢‘ä»èƒ½æ­£å¸¸æ’­æ”¾
   âœ… ä½¿ç”¨æœ¬åœ°ç¼“å­˜çš„éŸ³é¢‘ç§’å¼€ï¼ˆ< 100msï¼‰ğŸ”¥ æ–°å¢

5. ç¼“å­˜ç³»ç»Ÿæµ‹è¯•ï¼ˆæ–°å¢ï¼‰ğŸ”¥ 2025-01-04
   âœ… è¿›å…¥"æˆ‘çš„é¦–é¡µ"æŸ¥çœ‹ç¼“å­˜ç»Ÿè®¡
   âœ… ç¼“å­˜æ•°é‡å’Œå¤§å°æ˜¾ç¤ºæ­£ç¡®
   âœ… WiFiç¯å¢ƒä¸‹å¯åŠ¨æ™ºèƒ½é¢„çƒ­ï¼ˆå¯é€‰ï¼‰
   âœ… é¢„çƒ­å®Œæˆåå†æ¬¡æ’­æ”¾éŸ³é¢‘ï¼Œé€Ÿåº¦æ˜æ˜¾æå‡
```

---

## ğŸ“ åˆ›å»ºæ›´æ–°æ–‡æ¡£ï¼ˆå¯é€‰ï¼Œ10åˆ†é’Ÿï¼‰

```markdown
# åˆ›å»ºæ–‡ä»¶ï¼šæ›´æ–°è¯´æ˜/æ–°å¢{å›½å®¶}{åŸå¸‚}éŸ³é¢‘åˆ†åŒ…_v2.8.x.md

## å¿…é¡»åŒ…å«çš„å†…å®¹ï¼š
1. éŸ³é¢‘åˆ†åŒ…ä¿¡æ¯ï¼ˆå¤§å°ã€æ•°é‡ï¼‰
2. èˆªç©ºå…¬å¸è¦†ç›–
3. æŠ€æœ¯å®ç°ï¼ˆæ–‡ä»¶æ¸…å•ï¼‰
4. é¢„åŠ è½½é…ç½®æ›´æ–°
5. é¡¹ç›®ç»Ÿè®¡æ›´æ–°

## å‚è€ƒæ¨¡æ¿ï¼š
æ›´æ–°è¯´æ˜/æ–°å¢è‹±å›½ä¼¦æ•¦éŸ³é¢‘åˆ†åŒ…_v2.8.1.md
```

---

## ğŸ¯ å¸¸è§å‘½åå‚è€ƒ

### åˆ†åŒ…ç›®å½•å‘½å
```
packageJapan          âœ…
packageKorean         âœ… (æ³¨æ„ä¸æ˜¯ packageKorea)
packageUK             âœ…
packageAmerica        âœ… (æˆ– packageUSA)
packageUAE            âœ…
packageSingapore      âœ…
packagePhilippines    âœ…
```

### regionId å‘½å
```
'japan'          âœ…
'korea'          âœ… (æ³¨æ„ä¸æ˜¯ 'south-korea')
'uk'             âœ…
'usa'            âœ… (æˆ– 'america')
'uae'            âœ…
'singapore'      âœ…
'philippines'    âœ…
```

### æ•°æ®æ–‡ä»¶å‘½å
```
japan.js         âœ…
korean.js        âœ…
uk.js            âœ…
usa.js           âœ… (æˆ– america.js)
uae.js           âœ…
singapore.js     âœ…
philippines.js   âœ…
```

---

## âš ï¸ å¸¸è§é”™è¯¯é¿å…ï¼ˆé‡è¦ï¼ï¼‰

### âŒ è‡´å‘½é”™è¯¯ï¼ˆä¼šå¯¼è‡´æ— æ³•æ’­æ”¾ï¼‰

```javascript
// ğŸ”¥ é”™è¯¯1: å¿˜è®°æ›´æ–° audio-config.js
// ç°è±¡ï¼šèˆªçº¿å½•éŸ³é¡µé¢çœ‹ä¸åˆ°æ–°å›½å®¶
// è§£å†³ï¼šå®Œæˆæ­¥éª¤6çš„å…¨éƒ¨3ä¸ªé…ç½®ç‚¹

// ğŸ”¥ é”™è¯¯2: å¿˜è®°æ›´æ–° audio-package-loader.js
// ç°è±¡ï¼šç‚¹å‡»æ’­æ”¾æ—¶å¼¹çª—"åˆ†åŒ…åŠ è½½å¤±è´¥"
// æ§åˆ¶å°ï¼šâš ï¸ æœªæ‰¾åˆ°åœ°åŒº xxx çš„åˆ†åŒ…é…ç½®
// è§£å†³ï¼šå®Œæˆæ­¥éª¤7

// ğŸ”¥ é”™è¯¯3: å¿˜è®°æ›´æ–° audio-player/index.ts
// ç°è±¡ï¼šç‚¹å‡»æ’­æ”¾æŒ‰é’®æ— ååº”ï¼Œæ˜¾ç¤º"æ’­æ”¾å™¨åˆå§‹åŒ–å¤±è´¥"
// æ§åˆ¶å°ï¼šâŒ æœªæ‰¾åˆ°åœ°åŒºID "xxx" çš„è·¯å¾„æ˜ å°„
//         âŒ éŸ³é¢‘ä¸Šä¸‹æ–‡ä¸å­˜åœ¨ï¼Œæ— æ³•æ’­æ”¾
// è§£å†³ï¼šå®Œæˆæ­¥éª¤8

// ğŸ”¥ é”™è¯¯4: regionId åœ¨å„æ–‡ä»¶ä¸­ä¸ä¸€è‡´
audio-config.js:        id: 'uk'
audio-preload-guide.js: 'UK': {}          // âŒ å¤§å°å†™ä¸ä¸€è‡´
audio-package-loader.js: 'united-kingdom': {}  // âŒ åç§°ä¸ä¸€è‡´
// è§£å†³ï¼šæ‰€æœ‰æ–‡ä»¶ä½¿ç”¨å®Œå…¨ç›¸åŒçš„ regionId
```

### âŒ å…¶ä»–å¸¸è§é”™è¯¯

```javascript
// 1. åˆ†åŒ…ç›®å½•å¤§å†™é”™è¯¯
Packageuk/           // âŒ åº”è¯¥æ˜¯ packageUK

// 2. regionId ä½¿ç”¨è¿å­—ç¬¦
'south-korea': {}    // âŒ åº”è¯¥æ˜¯ 'korea'

// 3. æ•°æ®æ–‡ä»¶å¤§å†™é”™è¯¯
Japan.js             // âŒ åº”è¯¥æ˜¯ japan.js

// 4. éŸ³é¢‘æ–‡ä»¶åå°å†™
china-eastern.mp3    // âŒ åº”è¯¥æ˜¯ China-Eastern...

// 5. é¢„åŠ è½½é¡µé¢ä¸ä¸€è‡´
audio-preload-guide.js: 'pages/xxx/index'
app.json: 'pages/yyy/index'  // âŒ ä¸¤å¤„å¿…é¡»ä¸€è‡´

// 6. åˆ†åŒ…åç§°ä¸åŒ¹é…
audio-preload-guide.js: packageName: 'packageUK'
app.json: "root": "packageUk"  // âŒ å¤§å°å†™å¿…é¡»ä¸€è‡´

// 7. JSON æ ¼å¼é”™è¯¯
{
  "label": "åŒºè°ƒ"
  "mp3_file": "test.mp3"  // âŒ ç¼ºå°‘é€—å·
}

// 8. é¢„åŠ è½½è¶…é™
pages/xxx/index: 5ä¸ªåˆ†åŒ…ï¼Œæ€»è®¡ 2.3 MB  // âŒ è¶…è¿‡ 2MB é™åˆ¶

// 9. audio-player/index.ts è·¯å¾„æ ¼å¼é”™è¯¯
'uk': 'packageUK'           // âŒ ç¼ºå°‘æ–œæ 
'uk': '/packageUK'          // âŒ ç¼ºå°‘ç»“å°¾æ–œæ 
'uk': '/packageUK/'         // âœ… æ­£ç¡®

// 10. å¿˜è®°åœ¨ audio-config.js é¡¶éƒ¨å¯¼å…¥æ•°æ®
// ç°è±¡ï¼šé¡µé¢æ˜¾ç¤ºå›½å®¶ä½†éŸ³é¢‘æ•°é‡ä¸º0
// è§£å†³ï¼šåœ¨é¡¶éƒ¨æ·»åŠ  require è¯­å¥
```

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

### è¯¦ç»†æ–‡æ¡£
å‚è€ƒï¼š`èˆªçº¿å½•éŸ³åˆ†åŒ…å®Œæ•´ç®¡ç†æŒ‡å—.md`

### é—®é¢˜æ’æŸ¥
1. é¢„åŠ è½½è¶…é™ â†’ å‹ç¼©éŸ³é¢‘æˆ–æ›´æ¢é¢„åŠ è½½é¡µé¢
2. æ•°é‡ä¸ä¸€è‡´ â†’ æ£€æŸ¥é‡å¤è®°å½•
3. æ’­æ”¾å¤±è´¥ â†’ æ£€æŸ¥åˆ†åŒ…åç§°æ˜¯å¦åŒ¹é…
4. JSON é”™è¯¯ â†’ ä½¿ç”¨ `node -c` æ£€æŸ¥è¯­æ³•

---

## ğŸ“ 10æ­¥å®Œæ•´é…ç½®æ–‡ä»¶æ¸…å•

**æ–°å¢æœºåœºå¿…é¡»ä¿®æ”¹çš„ä½ç½®**ï¼š

| æ­¥éª¤ | æ–‡ä»¶è·¯å¾„ | é…ç½®å†…å®¹ | æ£€æŸ¥è¦ç‚¹ |
|-----|---------|---------|---------|
| 1ï¸âƒ£ | `package{CountryName}/index.js` | åˆ†åŒ…å…ƒæ•°æ® | audioCountå‡†ç¡® |
| 2ï¸âƒ£ | `data/regions/{country}.js` | éŸ³é¢‘æ•°æ® | æ— é‡å¤è®°å½• |
| 3ï¸âƒ£ | - | ç»Ÿè®¡å¤§å° | < 2MBé™åˆ¶ |
| 4ï¸âƒ£ | `app.json` | subPackages + preloadRule | åç§°å¤§å°å†™ä¸€è‡´ |
| 5ï¸âƒ£ | `utils/audio-preload-guide.js` | preloadPageMapping | regionIdä¸€è‡´ |
| 6ï¸âƒ£ | `utils/audio-config.js` | æ•°æ®å¯¼å…¥ + regions + airports + å¤§æ´²æ€»æ•° | **æœ€å®¹æ˜“é—æ¼** |
| 7ï¸âƒ£ | `utils/audio-package-loader.js` | packageMapping | **æœ€å®¹æ˜“é—æ¼** |
| 8ï¸âƒ£ | `pages/audio-player/index.ts` | regionPathMap | **æœ€å®¹æ˜“é—æ¼** |
| 9ï¸âƒ£ | `pages/audio-player/index.ts` | æœ¬åœ°ç¼“å­˜é›†æˆ | **ğŸ”¥ æ–°å¢ï¼ˆå¿…é¡»ï¼‰** |
| ğŸ”Ÿ | `pages/home/index.js` | ç¼“å­˜ç®¡ç†åŠŸèƒ½ | **ğŸ”¥ æ–°å¢ï¼ˆå¯é€‰ï¼‰** |

**âš ï¸ è®°ä½**ï¼šæ­¥éª¤6-9æ˜¯æœ€å®¹æ˜“é—æ¼çš„ï¼Œ**å¿…é¡»å…¨éƒ¨å®Œæˆ**ï¼Œå¦åˆ™æ— æ³•æ’­æ”¾æˆ–ç¦»çº¿ä¸ç¨³å®šï¼

### ğŸ”¥ æœ¬åœ°ç¼“å­˜ç³»ç»Ÿçš„é‡è¦æ€§ï¼ˆ2025-01-04ï¼‰

```javascript
// ä¸ºä»€ä¹ˆæ­¥éª¤9ï¼ˆæœ¬åœ°ç¼“å­˜é›†æˆï¼‰æ˜¯å¿…é¡»çš„ï¼Ÿ

const æ•ˆæœå¯¹æ¯” = {
  ä»…é¢„åŠ è½½è§„åˆ™: {
    é¦–æ¬¡æ’­æ”¾: '200-500ms',
    é‡å¤æ’­æ”¾: '200-500ms',
    ç¦»çº¿ç¨³å®šæ€§: '30%ï¼ˆåˆ†åŒ…å¯èƒ½è¢«æ¸…ç†ï¼‰',
    ç”¨æˆ·ä½“éªŒ: 'ä¸€èˆ¬'
  },

  é¢„åŠ è½½ + æœ¬åœ°ç¼“å­˜: {
    é¦–æ¬¡æ’­æ”¾: '80-150ms',
    é‡å¤æ’­æ”¾: '50-80msï¼ˆç§’å¼€ï¼‰',
    ç¦»çº¿ç¨³å®šæ€§: '95%ï¼ˆæ°¸ä¹…ç¼“å­˜ï¼‰',
    ç”¨æˆ·ä½“éªŒ: 'â­â­â­â­â­'
  }
};

// æ ¸å¿ƒæ”¶ç›Š
const æ€§èƒ½æå‡ = {
  ç¦»çº¿ç¨³å®šæ€§: '+217%ï¼ˆ30% â†’ 95%ï¼‰',
  é”™è¯¯ç‡ä¸‹é™: '-90%ï¼ˆ100% â†’ 10%ï¼‰',
  é‡å¤æ’­æ”¾é€Ÿåº¦: '4-10å€æé€Ÿ'
};
```

---

## ğŸ” å¿«é€Ÿè‡ªæ£€å‘½ä»¤

```powershell
# åœ¨ miniprogram ç›®å½•è¿è¡Œï¼Œæ£€æŸ¥æ˜¯å¦å®Œæˆæ‰€æœ‰é…ç½®

# æ£€æŸ¥ regionId æ˜¯å¦åœ¨æ‰€æœ‰æ–‡ä»¶ä¸­å­˜åœ¨
$regionId = "uk"  # ğŸ‘ˆ æ›¿æ¢ä¸ºä½ çš„ regionId

Write-Output "æ£€æŸ¥ audio-config.js:"
Select-String -Path "utils\audio-config.js" -Pattern "id: '$regionId'" | Select-Object -First 1

Write-Output "æ£€æŸ¥ audio-package-loader.js:"
Select-String -Path "utils\audio-package-loader.js" -Pattern "'$regionId':" | Select-Object -First 1

Write-Output "æ£€æŸ¥ audio-player/index.ts:"
Select-String -Path "pages\audio-player\index.ts" -Pattern "'$regionId':" | Select-Object -First 1

Write-Output "æ£€æŸ¥ audio-preload-guide.js:"
Select-String -Path "utils\audio-preload-guide.js" -Pattern "'$regionId':" | Select-Object -First 1

Write-Output ""
Write-Output "âœ… å¦‚æœæ‰€æœ‰4ä¸ªæ–‡ä»¶éƒ½æœ‰è¾“å‡ºï¼Œè¯´æ˜é…ç½®å®Œæ•´"
Write-Output "âŒ å¦‚æœä»»ä½•æ–‡ä»¶æ²¡æœ‰è¾“å‡ºï¼Œè¯´æ˜è¯¥æ–‡ä»¶é—æ¼äº†é…ç½®"
```

---

**åˆ›å»ºæ—¶é—´**: 2025-10-25
**æœ€åæ›´æ–°**: 2025-01-04ï¼ˆæ·»åŠ æ­¥éª¤9-10ï¼šæœ¬åœ°ç¼“å­˜ç³»ç»Ÿï¼‰
**é€‚ç”¨ç‰ˆæœ¬**: v2.9.0+
**é‡å¤§æ›´æ–°**: é›†æˆæœ¬åœ°ç¼“å­˜æŠ€æœ¯ï¼Œç¦»çº¿ç¨³å®šæ€§æå‡217%

