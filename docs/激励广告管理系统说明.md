# 激励广告管理系统使用说明

## 功能概述

为小程序添加了智能激励广告管理系统，通过用户点击卡片行为触发广告展示机会，实现以下规则：

### 核心规则
- **基础规则**：每100次卡片点击后弹框询问用户是否观看激励广告
- **不看广告**：用户关闭弹框，下次100次点击后再询问
- **看完广告**：用户完整观看广告，下次300次点击后才询问（奖励机制）
- **循环往复**：规则保持不变，简单统一

## 技术实现

### 1. 广告管理器模块 (ad-manager.js)
```javascript
// 核心功能
- 点击计数管理
- 广告阈值控制
- 激励视频广告展示
- 统计数据持久化
```

### 2. 已集成的页面
- ✅ **首页** (`pages/home/index.js`) - 所有功能卡片点击
- ✅ **资料查询** (`pages/search/index.js`) - 资料分类卡片点击
- 🔄 **航班运行** - 待集成
- 🔄 **计算工具** - 待集成

### 3. 配置文件 (app-config.js)
```javascript
var AppConfig = {
  ad: {
    rewardVideoId: 'adunit-xxxxxxxxxxxxxxxx', // 需替换真实ID
    useTestAd: true  // 开发环境使用测试广告
  }
};
```

## 使用方法

### 在新页面集成
1. 引入依赖
```javascript
var AdManager = require('../../utils/ad-manager.js');
var AppConfig = require('../../utils/app-config.js');
```

2. 初始化（在customOnLoad中）
```javascript
AdManager.init(AppConfig.ad.rewardVideoId);
```

3. 在卡片点击事件中集成
```javascript
onCardClick: function() {
  // 检查并显示广告
  AdManager.checkAndShow({
    title: '支持一下',
    content: '观看一个短视频广告，支持我们持续优化产品体验'
  });
  
  // 继续原有逻辑
  // ...
}
```

## 数据存储

系统使用小程序本地存储持久化以下数据：
- `ad_card_click_count` - 总点击次数
- `ad_next_threshold` - 下次触发阈值
- `ad_total_watched` - 总观看广告次数
- `ad_last_watch_time` - 最后观看时间

## 调试功能

### 获取统计信息
```javascript
var stats = AdManager.getStatistics();
// 返回：点击次数、下次阈值、观看次数、剩余次数等
```

### 重置统计（开发调试用）
```javascript
AdManager.resetStatistics();
```

## 注意事项

1. **广告单元ID配置**
   - 在 `app-config.js` 中配置真实的广告单元ID
   - 开发环境可使用 `useTestAd: true` 显示测试广告

2. **用户体验**
   - 弹框可关闭，不强制观看
   - 看广告后获得更长免打扰期（300次 vs 100次）
   - 规则简单统一，用户容易理解

3. **错误处理**
   - 广告加载失败自动降级处理
   - 网络异常时不影响正常功能使用

## 后续优化建议

1. **数据分析**
   - 可添加广告转化率统计
   - 分析最佳触发频率

2. **用户分层**
   - 根据用户活跃度调整触发频率
   - VIP用户可考虑免广告

3. **A/B测试**
   - 测试不同阈值的效果（100/300 vs 50/200等）
   - 优化弹框文案提升转化率

## 更新记录

- 2025-08-26：初始版本实现
  - 创建广告管理器模块
  - 集成到首页和资料查询页面
  - 添加配置管理系统