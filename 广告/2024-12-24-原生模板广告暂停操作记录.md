# 2024-12-24 原生模板广告暂停操作记录

## 变更概述

为优化用户体验，暂停所有原生模板广告（横幅、竖版、全屏模板），仅保留插屏广告和激励视频广告。

## 变更内容

### 1. 配置文件更新

**文件：** `miniprogram/utils/app-config.js`

- 添加全局开关 `nativeTemplateAdEnabled: false`
- 添加配置修改时间注释

```javascript
ad: {
  // ⚠️ 原生模板广告全局开关（2024-12-24 暂停）
  nativeTemplateAdEnabled: false,
  // ...
}
```

### 2. 策略参数更新

**文件：** `miniprogram/utils/ad-strategy.js`

| 参数 | 新值 | 说明 |
|------|------|------|
| MIN_ACTION_COUNT | 5 | 操作次数阈值 |
| MAX_ADS_PER_SESSION | 5 | 会话限制 |
| MAX_ADS_PER_DAY | 50 | 每日上限 |
| NEW_USER_PROTECTION_ACTIONS | 20 | 新用户保护 |
| SHOW_DELAY | 2000 | 展示延迟(ms) |

### 3. 页面更新

所有包含原生模板广告的页面均已更新：

#### TabBar 页面（5个）
- `pages/search/index`
- `pages/flight-calculator/index`
- `pages/cockpit/index`
- `pages/operations/index`
- `pages/home/index`

#### 主包页面（9个）
- `pages/standard-phraseology/index`
- `pages/communication-rules/index`
- `pages/communication-rules-detail/index`
- `pages/airline-recordings/index`
- `pages/recording-categories/index`
- `pages/recording-clips/index`
- `pages/audio-player/index`
- `pages/emergency-altitude/index`
- `pages/offline-center/index`

#### 分包页面
- `packageWeather/index`
- `packageRadiation/pages/index/index`
- `packageQAR/index`
- `packageWalkaround/pages/index/index`
- `packageO/dangerous-goods/index`
- `packageO/personal-checklist/index`
- `packageO/twin-engine-goaround/index`
- `packageO/sunrise-sunset-only/index`
- `packageO/sunrise-sunset/index`
- `packageO/snowtam-encoder/index`
- `packageO/rodex-decoder/index`
- `packageO/qualification-manager/index`
- `packageO/long-flight-crew-rotation/index`
- `packageO/incident-investigation/index`
- `packageO/flight-time-share/index`
- 其他分包页面（packageA, packageB, packageC, packageD, packageDuty, packageIOSA, packageICAO, packageMedical, packageCompetence, packageAircraftPerformance, packageAircraftParameters, packageCommFailure, flight-calc-modules等）

### 4. 更新模式

#### JS文件更新（BasePage模式）
```javascript
// 1. 添加 AppConfig 引用
var AppConfig = require('../../utils/app-config.js');

// 2. 在 data 中添加
data: {
  nativeAdEnabled: false,
  // ...
}

// 3. 在 customOnLoad 中初始化
customOnLoad: function() {
  this.setData({
    nativeAdEnabled: AppConfig.ad.nativeTemplateAdEnabled || false
  });
}
```

#### TS文件更新（Page()直接创建）
```typescript
// 1. 添加 AppConfig 引用
const AppConfig = require('../../utils/app-config.js');

// 2. 在 data 中添加
data: {
  nativeAdEnabled: false,
}

// 3. 在 onLoad 中初始化
onLoad() {
  this.setData({
    nativeAdEnabled: AppConfig.ad.nativeTemplateAdEnabled || false
  });
}
```

#### WXML文件更新
```xml
<!-- 原来 -->
<view wx:if="{{ !isAdFree }}" class="ad-banner-container">
  <ad unit-id="adunit-xxx" ad-intervals="30"></ad>
</view>

<!-- 更新后 -->
<view wx:if="{{ !isAdFree && nativeAdEnabled }}" class="ad-banner-container">
  <ad unit-id="adunit-xxx" ad-intervals="30"></ad>
</view>
```

## 当前广告状态

| 广告类型 | 状态 | 说明 |
|----------|------|------|
| 原生模板广告（横幅） | ❌ 已暂停 | 通过 nativeAdEnabled 控制 |
| 原生模板广告（竖版） | ❌ 已暂停 | 通过 nativeAdEnabled 控制 |
| 原生模板广告（全屏） | ❌ 已暂停 | 通过 nativeAdEnabled 控制 |
| 插屏广告 | ✅ 保留 | 低频策略，5个TabBar页面 |
| 激励视频广告 | ✅ 保留 | 用户主动观看 |

## 恢复方法

如需恢复原生模板广告，只需修改 `miniprogram/utils/app-config.js`：

```javascript
nativeTemplateAdEnabled: true  // 改为 true 即可恢复
```

## 相关文档

- 任务列表：`.kiro/specs/ad-optimization/tasks.md`
- 需求文档：`.kiro/specs/ad-optimization/requirements.md`
- 设计文档：`.kiro/specs/ad-optimization/design.md`
- 广告位ID存档：`广告/广告位ID存档.md`

---

**操作人：** Kiro AI Assistant  
**操作时间：** 2024-12-24
