# é˜¶æ®µ2ï¼šä¸­ç­‰é£é™©ä¼˜åŒ–

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¥æœŸ**: 2025-11-01
**é¢„è®¡æ—¶é—´**: 3-5å¤©
**é¢„æœŸæ”¶ç›Š**: 615KB
**é£é™©ç­‰çº§**: ğŸŸ¡ ä¸­
**ä¼˜å…ˆçº§**: â­â­â­â­

---

## ğŸ“‹ ä¼˜åŒ–æ¦‚è§ˆ

é˜¶æ®µ2åŒ…å«2ä¸ªä¸»è¦ä¼˜åŒ–é¡¹ï¼Œéœ€è¦åˆ›å»ºæ–°çš„åˆ†åŒ…å¹¶éµå¾ª8æ­¥é…ç½®æµç¨‹ï¼š

| ä¼˜åŒ–é¡¹ | é¢„æœŸæ”¶ç›Š | é£é™© | éš¾åº¦ | æ˜¯å¦å¿…é¡» |
|-------|---------|------|------|---------|
| 2.1 é€šä¿¡å¤±æ•ˆåˆ†åŒ… | 490KB | ä¸­ | ä¸­ç­‰ | âœ… å¿…é¡» |
| 2.2 èˆªçº¿å½•éŸ³é¡µé¢åˆ†åŒ… | 125KB | ä¸­ | ä¸­ç­‰ | âœ… å¿…é¡» |
| **æ€»è®¡** | **615KB** | **ğŸŸ¡ ä¸­** | **ä¸­ç­‰** | - |

**å®Œæˆé˜¶æ®µ2åçš„é¢„æœŸæ•ˆæœ**ï¼š
```
ä¼˜åŒ–å‰ä¸»åŒ…ï¼ˆé˜¶æ®µ1åï¼‰ï¼š2286-2386 KB
ä¼˜åŒ–åä¸»åŒ…ï¼š          1671 KB
æ»¡è¶³2MBé™åˆ¶ï¼š         âœ… æ˜¯
å‰©ä½™æ‰©å±•ç©ºé—´ï¼š        377 KB (18.4%)
```

---

## âš ï¸ å¼€å§‹å‰çš„å‡†å¤‡å·¥ä½œ

### 1. ç¡®è®¤é˜¶æ®µ1å·²å®Œæˆ

```powershell
cd D:\FlightToolbox

# æ£€æŸ¥é˜¶æ®µ1çš„Gitæ ‡ç­¾
git tag | Select-String "phase1"

# åº”è¯¥çœ‹åˆ°: v2.8.1-phase1

# éªŒè¯ä¸»åŒ…å¤§å°å·²ä¼˜åŒ–
.\åˆ†åŒ…æ–¹æ¡ˆ\monitor-main-package-size.ps1

# ä¸»åŒ…åº”è¯¥åœ¨2286-2386KBèŒƒå›´å†…
```

### 2. åˆ›å»ºé˜¶æ®µ2åˆ†æ”¯

```powershell
# åŸºäºé˜¶æ®µ1åˆ›å»ºæ–°åˆ†æ”¯
git checkout -b feature/phase2-optimization

# éªŒè¯åˆ†æ”¯åˆ›å»ºæˆåŠŸ
git branch
```

### 3. å­¦ä¹ 8æ­¥é…ç½®æµç¨‹

âš ï¸ **é‡è¦**ï¼šåˆ›å»ºä»»ä½•æ–°åˆ†åŒ…éƒ½å¿…é¡»éµå¾ªå®Œæ•´çš„8æ­¥æµç¨‹ï¼Œå‚è€ƒæ–‡æ¡£ï¼š

`èˆªçº¿å½•éŸ³åˆ†åŒ…é¢„åŠ è½½è§„åˆ™è®°å½•/èˆªçº¿å½•éŸ³åˆ†åŒ…å®æˆ˜ç»éªŒä¸æœ€ä½³å®è·µ.md`

**8æ­¥æµç¨‹æ¦‚è§ˆ**ï¼š
```
æ­¥éª¤1: åˆ›å»ºåˆ†åŒ…ç›®å½•å’Œæ–‡ä»¶
æ­¥éª¤2: åˆ›å»ºæ•°æ®æ–‡ä»¶ï¼ˆå¦‚éœ€è¦ï¼‰
æ­¥éª¤3: ç»Ÿè®¡å¤§å°å¹¶é€‰æ‹©é¢„åŠ è½½é¡µé¢
æ­¥éª¤4: æ›´æ–° app.jsonï¼ˆsubPackages + preloadRuleï¼‰
æ­¥éª¤5: æ›´æ–° utils/audio-preload-guide.jsï¼ˆéŸ³é¢‘åˆ†åŒ…ï¼‰
æ­¥éª¤6: æ›´æ–° utils/audio-config.jsï¼ˆéŸ³é¢‘åˆ†åŒ…ï¼‰
æ­¥éª¤7: æ›´æ–° utils/audio-package-loader.jsï¼ˆéŸ³é¢‘åˆ†åŒ…ï¼‰
æ­¥éª¤8: æ›´æ–° pages/audio-player/index.tsï¼ˆéŸ³é¢‘åˆ†åŒ…ï¼‰
```

---

## ğŸ“¦ ä¼˜åŒ–é¡¹2.1ï¼šé€šä¿¡å¤±æ•ˆåˆ†åŒ…ï¼ˆ490KBï¼‰

### èƒŒæ™¯è¯´æ˜

é€šä¿¡å¤±æ•ˆæ¨¡å—åŒ…å«11ä¸ªé¡µé¢å’Œ9ä¸ªæ•°æ®æ–‡ä»¶ï¼Œæ€»è®¡çº¦490KBï¼š

**é¡µé¢æ–‡ä»¶**ï¼ˆ363.12KBï¼‰ï¼š
- `pages/communication-failure/index` - ä¸»é¡µé¢
- `pages/communication-failure/domestic/index` - å›½å†…
- `pages/communication-failure/international/index` - å›½é™…
- `pages/communication-failure/regions/pacific/index` - å¤ªå¹³æ´‹åœ°åŒº
- `pages/communication-failure/regions/eastern-europe/index` - ä¸œæ¬§åœ°åŒº
- `pages/communication-failure/regions/europe/index` - æ¬§æ´²åœ°åŒº
- `pages/communication-failure/regions/middle-east/index` - ä¸­ä¸œåœ°åŒº
- `pages/communication-failure/regions/north-america/index` - åŒ—ç¾åœ°åŒº
- `pages/communication-failure/regions/south-america/index` - å—ç¾åœ°åŒº
- `pages/communication-failure/regions/africa/index` - éæ´²åœ°åŒº
- `pages/communication-failure/regions/country-detail/index` - å›½å®¶è¯¦æƒ…

**æ•°æ®æ–‡ä»¶**ï¼ˆ~130KBï¼‰ï¼š
- `pages/communication-failure/data/*.js` - 9ä¸ªåœ°åŒºæ•°æ®æ–‡ä»¶

---

### æ­¥éª¤2.1.1ï¼šåˆ›å»ºpackageCommFailureåˆ†åŒ…ç›®å½•

```powershell
cd D:\FlightToolbox\miniprogram

# åˆ›å»ºåˆ†åŒ…æ ¹ç›®å½•
New-Item -ItemType Directory -Path packageCommFailure -Force

# åˆ›å»ºé¡µé¢ç›®å½•
New-Item -ItemType Directory -Path packageCommFailure\pages -Force
New-Item -ItemType Directory -Path packageCommFailure\pages\regions -Force

# åˆ›å»ºæ•°æ®ç›®å½•
New-Item -ItemType Directory -Path packageCommFailure\data -Force

# éªŒè¯ç›®å½•ç»“æ„
Get-ChildItem packageCommFailure -Recurse -Directory
```

é¢„æœŸç›®å½•ç»“æ„ï¼š
```
packageCommFailure/
â”œâ”€â”€ pages/
â”‚   â””â”€â”€ regions/
â””â”€â”€ data/
```

---

### æ­¥éª¤2.1.2ï¼šç§»åŠ¨é¡µé¢æ–‡ä»¶

```powershell
cd D:\FlightToolbox\miniprogram

# 1. ç§»åŠ¨ä¸»é¡µé¢å’Œä¸€çº§é¡µé¢
Move-Item pages\communication-failure\index.* packageCommFailure\pages\
Move-Item pages\communication-failure\domestic packageCommFailure\pages\
Move-Item pages\communication-failure\international packageCommFailure\pages\

# 2. ç§»åŠ¨åœ°åŒºé¡µé¢
Move-Item pages\communication-failure\regions\* packageCommFailure\pages\regions\

# 3. ç§»åŠ¨æ•°æ®æ–‡ä»¶
Move-Item pages\communication-failure\data\* packageCommFailure\data\

# 4. åˆ é™¤ç©ºçš„åŸç›®å½•
Remove-Item pages\communication-failure -Recurse -Force

# 5. éªŒè¯ç§»åŠ¨æˆåŠŸ
Test-Path pages\communication-failure  # åº”è¯¥è¿”å›False
Test-Path packageCommFailure\pages\index.wxml  # åº”è¯¥è¿”å›True
Test-Path packageCommFailure\pages\domestic\index.wxml  # åº”è¯¥è¿”å›True
Test-Path packageCommFailure\pages\regions\pacific\index.wxml  # åº”è¯¥è¿”å›True
```

---

### æ­¥éª¤2.1.3ï¼šæ›´æ–°app.jsoné…ç½®

**æ–‡ä»¶**: `miniprogram/app.json`

#### 3.1 ä»pagesåˆ—è¡¨ä¸­åˆ é™¤æ—§è·¯å¾„

æ‰¾åˆ° `"pages"` æ•°ç»„ï¼Œåˆ é™¤ä»¥ä¸‹æ¡ç›®ï¼š

```json
{
  "pages": [
    // âŒ åˆ é™¤ä»¥ä¸‹é€šä¿¡å¤±æ•ˆç›¸å…³é¡µé¢
    "pages/communication-failure/index",
    "pages/communication-failure/domestic/index",
    "pages/communication-failure/international/index",
    "pages/communication-failure/regions/pacific/index",
    "pages/communication-failure/regions/eastern-europe/index",
    "pages/communication-failure/regions/europe/index",
    "pages/communication-failure/regions/middle-east/index",
    "pages/communication-failure/regions/north-america/index",
    "pages/communication-failure/regions/south-america/index",
    "pages/communication-failure/regions/africa/index",
    "pages/communication-failure/regions/country-detail/index"
  ]
}
```

#### 3.2 æ·»åŠ åˆ°subPackagesæ•°ç»„

åœ¨ `"subPackages"` æ•°ç»„ä¸­æ·»åŠ æ–°åˆ†åŒ…é…ç½®ï¼š

```json
{
  "subPackages": [
    {
      "root": "packageCommFailure",
      "name": "communicationFailurePackage",
      "pages": [
        "pages/index",
        "pages/domestic/index",
        "pages/international/index",
        "pages/regions/pacific/index",
        "pages/regions/eastern-europe/index",
        "pages/regions/europe/index",
        "pages/regions/middle-east/index",
        "pages/regions/north-america/index",
        "pages/regions/south-america/index",
        "pages/regions/africa/index",
        "pages/regions/country-detail/index"
      ]
    }
    // ... å…¶ä»–å·²æœ‰åˆ†åŒ…
  ]
}
```

âš ï¸ **æ³¨æ„**ï¼šåˆ†åŒ…è·¯å¾„æ˜¯ç›¸å¯¹äº `root` çš„ï¼Œæ‰€ä»¥æ˜¯ `"pages/index"` è€Œä¸æ˜¯ `"packageCommFailure/pages/index"`

#### 3.3 é…ç½®é¢„åŠ è½½è§„åˆ™

åœ¨ `"preloadRule"` å¯¹è±¡ä¸­æ·»åŠ ï¼š

```json
{
  "preloadRule": {
    "pages/operations/index": {
      "network": "all",
      "packages": [
        "communicationFailurePackage",
        "packageCCAR"  // å¦‚æœå·²æœ‰ï¼Œä¿ç•™
      ]
    }
  }
}
```

**è¯´æ˜**ï¼š
- `"pages/operations/index"` - åœ¨"é€šä¿¡"TabBaré¡µé¢é¢„åŠ è½½
- `"network": "all"` - åœ¨çº¿å’Œç¦»çº¿æ¨¡å¼éƒ½é¢„åŠ è½½
- ç”¨æˆ·è¿›å…¥"é€šä¿¡"é¡µé¢æ—¶ï¼Œé€šä¿¡å¤±æ•ˆåˆ†åŒ…ä¼šè‡ªåŠ¨é¢„åŠ è½½

---

### æ­¥éª¤2.1.4ï¼šæ›´æ–°è·¯ç”±å¼•ç”¨

#### 4.1 æœç´¢æ‰€æœ‰å¼•ç”¨

```powershell
cd D:\FlightToolbox\miniprogram

# æœç´¢æ‰€æœ‰æŒ‡å‘æ—§è·¯å¾„çš„å¼•ç”¨
Get-ChildItem -Recurse -Include *.js,*.ts,*.wxml,*.json -File |
  Select-String -Pattern "/pages/communication-failure" |
  Select-Object Path, LineNumber, Line |
  Format-Table -AutoSize
```

#### 4.2 æ›´æ–°é€šä¿¡é¡µé¢çš„è·³è½¬

**æ–‡ä»¶**: `miniprogram/pages/operations/index.ts` (æˆ– index.js)

æ‰¾åˆ°é€šä¿¡å¤±æ•ˆçš„å…¥å£æŒ‰é’®ç‚¹å‡»äº‹ä»¶ï¼Œæ›´æ–°è·¯å¾„ï¼š

```javascript
// âŒ æ—§è·¯å¾„
navigateToCommFailure: function() {
  wx.navigateTo({
    url: '/pages/communication-failure/index'
  });
},

// âœ… æ–°è·¯å¾„
navigateToCommFailure: function() {
  wx.navigateTo({
    url: '/packageCommFailure/pages/index'
  });
},
```

#### 4.3 æ›´æ–°åˆ†åŒ…å†…éƒ¨çš„è·³è½¬

**æ–‡ä»¶**: `miniprogram/packageCommFailure/pages/index.js`

åˆ†åŒ…å†…éƒ¨é¡µé¢ä¹‹é—´çš„è·³è½¬ï¼Œè·¯å¾„éœ€è¦ç›¸å¯¹è°ƒæ•´ï¼š

```javascript
// âŒ æ—§è·¯å¾„ï¼ˆç»å¯¹è·¯å¾„ï¼‰
wx.navigateTo({
  url: '/pages/communication-failure/domestic/index'
});

// âœ… æ–°è·¯å¾„ï¼ˆç›¸å¯¹è·¯å¾„æˆ–ç»å¯¹è·¯å¾„éƒ½å¯ä»¥ï¼‰
wx.navigateTo({
  url: '/packageCommFailure/pages/domestic/index'
});

// æˆ–ä½¿ç”¨ç›¸å¯¹è·¯å¾„
wx.navigateTo({
  url: './domestic/index'
});
```

#### 4.4 æ›´æ–°åœ°åŒºé¡µé¢ä¹‹é—´çš„è·³è½¬

**æ–‡ä»¶**: `miniprogram/packageCommFailure/pages/regions/*/index.js`

åœ°åŒºé¡µé¢è·³è½¬åˆ°å›½å®¶è¯¦æƒ…ï¼š

```javascript
// âŒ æ—§è·¯å¾„
wx.navigateTo({
  url: '/pages/communication-failure/regions/country-detail/index?country=' + country
});

// âœ… æ–°è·¯å¾„
wx.navigateTo({
  url: '/packageCommFailure/pages/regions/country-detail/index?country=' + country
});
```

---

### æ­¥éª¤2.1.5ï¼šéªŒè¯é€šä¿¡å¤±æ•ˆåˆ†åŒ…

#### 5.1 ç¼–è¯‘æµ‹è¯•

åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­ï¼š
1. ç‚¹å‡»"ç¼–è¯‘"æŒ‰é’®
2. æ£€æŸ¥æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯
3. æ£€æŸ¥"è¯¦æƒ…" â†’ "ä»£ç å¤§å°åˆ†æ"

é¢„æœŸç»“æœï¼š
- âœ… ç¼–è¯‘æˆåŠŸï¼Œæ— é”™è¯¯
- âœ… ä¸»åŒ…å¤§å°å‡å°‘çº¦490KB
- âœ… æ–°å¢åˆ†åŒ…ï¼šcommunicationFailurePackage

#### 5.2 åŠŸèƒ½æµ‹è¯•

åœ¨æ¨¡æ‹Ÿå™¨æˆ–çœŸæœºä¸Šæµ‹è¯•ï¼š
1. è¿›å…¥"é€šä¿¡"TabBaré¡µé¢
2. ç‚¹å‡»"é€šä¿¡å¤±æ•ˆ"å…¥å£
3. éªŒè¯ä¸»é¡µé¢æ­£å¸¸æ˜¾ç¤º
4. ç‚¹å‡»"å›½å†…"ï¼ŒéªŒè¯é¡µé¢æ­£å¸¸è·³è½¬
5. ç‚¹å‡»"å›½é™…"ï¼ŒéªŒè¯é¡µé¢æ­£å¸¸è·³è½¬
6. ç‚¹å‡»ä»»æ„åœ°åŒºï¼ˆå¦‚"å¤ªå¹³æ´‹åœ°åŒº"ï¼‰
7. ç‚¹å‡»ä»»æ„å›½å®¶ï¼ŒéªŒè¯è¯¦æƒ…é¡µæ­£å¸¸æ˜¾ç¤º
8. éªŒè¯æ•°æ®æ­£å¸¸åŠ è½½

#### 5.3 ç¦»çº¿æµ‹è¯•

```powershell
# 1. åœ¨å¼€å‘è€…å·¥å…·ä¸­å¼€å¯é£è¡Œæ¨¡å¼
# å·¥å…· â†’ æ¨¡æ‹Ÿå™¨è®¾ç½® â†’ ç½‘ç»œ â†’ ç¦»çº¿

# 2. é‡æ–°è¿›å…¥å°ç¨‹åº
# 3. è¿›å…¥"é€šä¿¡" â†’ "é€šä¿¡å¤±æ•ˆ"
# 4. éªŒè¯æ‰€æœ‰é¡µé¢å’Œæ•°æ®æ­£å¸¸åŠ è½½
```

**éªŒè¯é€šè¿‡æ ‡å‡†**ï¼š
- âœ… åœ¨çº¿æ¨¡å¼æ‰€æœ‰é¡µé¢æ­£å¸¸è·³è½¬
- âœ… ç¦»çº¿æ¨¡å¼æ‰€æœ‰é¡µé¢æ­£å¸¸è·³è½¬
- âœ… æ•°æ®æ­£å¸¸åŠ è½½ï¼ˆå›½å†…ã€å›½é™…ã€å„åœ°åŒºï¼‰
- âœ… å›½å®¶è¯¦æƒ…é¡µæ­£å¸¸æ˜¾ç¤º
- âœ… æ²¡æœ‰JavaScripté”™è¯¯æˆ–è·¯å¾„é”™è¯¯

#### 5.4 é¢„åŠ è½½éªŒè¯

éªŒè¯åˆ†åŒ…åœ¨"é€šä¿¡"é¡µé¢è¿›å…¥æ—¶è‡ªåŠ¨é¢„åŠ è½½ï¼š

```javascript
// åœ¨ pages/operations/index.ts ä¸­æ·»åŠ è°ƒè¯•ä»£ç 
customOnLoad: function(options) {
  var self = this;

  // æ£€æŸ¥åˆ†åŒ…æ˜¯å¦å·²é¢„åŠ è½½
  console.log('æ£€æŸ¥communicationFailurePackageé¢„åŠ è½½çŠ¶æ€...');

  wx.loadSubpackage({
    name: 'communicationFailurePackage',
    success: function() {
      console.log('âœ… communicationFailurePackageå·²é¢„åŠ è½½');
    },
    fail: function() {
      console.log('âŒ communicationFailurePackageæœªé¢„åŠ è½½');
    }
  });
},
```

**é¢„æœŸç»“æœ**ï¼š
- âœ… è¿›å…¥"é€šä¿¡"é¡µé¢åï¼Œæ§åˆ¶å°æ˜¾ç¤º"âœ… communicationFailurePackageå·²é¢„åŠ è½½"
- âœ… ç‚¹å‡»"é€šä¿¡å¤±æ•ˆ"æŒ‰é’®ï¼Œé¡µé¢ç«‹å³æ‰“å¼€ï¼ˆæ— åŠ è½½å»¶è¿Ÿï¼‰

---

### æ­¥éª¤2.1.6ï¼šæäº¤Gitè®°å½•

```powershell
cd D:\FlightToolbox

git add miniprogram/packageCommFailure/
git add miniprogram/app.json
git add miniprogram/pages/operations/

git commit -m "é˜¶æ®µ2.1: é€šä¿¡å¤±æ•ˆåˆ†åŒ…ï¼ˆ490KBï¼‰

åˆ›å»ºåˆ†åŒ…ï¼š
- æ–°å¢ packageCommFailure åˆ†åŒ…
- åˆ†åŒ…åç§°: communicationFailurePackage

è¿ç§»å†…å®¹ï¼š
- ç§»åŠ¨ 11 ä¸ªé¡µé¢ï¼ˆ363.12KBï¼‰
- ç§»åŠ¨ 9 ä¸ªæ•°æ®æ–‡ä»¶ï¼ˆçº¦130KBï¼‰

é…ç½®æ›´æ–°ï¼š
- æ›´æ–° app.jsonï¼ˆsubPackages + preloadRuleï¼‰
- é¢„åŠ è½½é¡µé¢ï¼špages/operations/index
- æ›´æ–°æ‰€æœ‰è·¯ç”±å¼•ç”¨ä¸ºæ–°è·¯å¾„

éªŒè¯ç»“æœï¼š
- ç¼–è¯‘æˆåŠŸï¼Œæ— é”™è¯¯
- ä¸»åŒ…å‡å°‘çº¦ 490KB
- åœ¨çº¿æ¨¡å¼åŠŸèƒ½æ­£å¸¸
- ç¦»çº¿æ¨¡å¼åŠŸèƒ½æ­£å¸¸
- é¢„åŠ è½½æœºåˆ¶å·¥ä½œæ­£å¸¸
- æ‰€æœ‰é¡µé¢è·³è½¬æ­£å¸¸"
```

---

## ğŸµ ä¼˜åŒ–é¡¹2.2ï¼šèˆªçº¿å½•éŸ³é¡µé¢åˆ†åŒ…ï¼ˆ125KBï¼‰

### èƒŒæ™¯è¯´æ˜

å°†4ä¸ªèˆªçº¿å½•éŸ³UIé¡µé¢ä»ä¸»åŒ…è¿ç§»åˆ°æ–°åˆ†åŒ… `packageAudioPages`ï¼š

**è¦è¿ç§»çš„é¡µé¢**ï¼ˆ124.50KBï¼‰ï¼š
- `pages/airline-recordings/index` (31.35KB) - åœ°åŒºåˆ—è¡¨
- `pages/recording-categories/index` (11.28KB) - åˆ†ç±»é¡µé¢
- `pages/recording-clips/index` (13.62KB) - éŸ³é¢‘åˆ—è¡¨
- `pages/audio-player/index` (68.26KB) - éŸ³é¢‘æ’­æ”¾å™¨

**æ•°æ®æ–‡ä»¶å¤„ç†ç­–ç•¥**ï¼š

âš ï¸ **å…³é”®åˆ›æ–°**ï¼šä¸é‡‡ç”¨AIæ–¹æ¡ˆ1å»ºè®®çš„"å°†32ä¸ªæ•°æ®æ–‡ä»¶åˆ†æ•£åˆ°å„è‡ªéŸ³é¢‘åˆ†åŒ…"çš„æ–¹å¼ï¼ˆéœ€è¦ä¿®æ”¹32æ¬¡ï¼‰ï¼Œè€Œæ˜¯åˆ›å»ºç»Ÿä¸€çš„ `packageAudioData` é›†ä¸­ç®¡ç†ï¼Œåªéœ€1æ¬¡é…ç½®ã€‚

---

### æ­¥éª¤2.2.1ï¼šåˆ›å»ºpackageAudioPagesåˆ†åŒ…

```powershell
cd D:\FlightToolbox\miniprogram

# åˆ›å»ºåˆ†åŒ…ç›®å½•
New-Item -ItemType Directory -Path packageAudioPages -Force
New-Item -ItemType Directory -Path packageAudioPages\pages -Force

# éªŒè¯ç›®å½•åˆ›å»ºæˆåŠŸ
Test-Path packageAudioPages\pages  # åº”è¯¥è¿”å›True
```

---

### æ­¥éª¤2.2.2ï¼šç§»åŠ¨èˆªçº¿å½•éŸ³é¡µé¢

```powershell
cd D:\FlightToolbox\miniprogram

# 1. ç§»åŠ¨4ä¸ªé¡µé¢ç›®å½•
Move-Item pages\airline-recordings packageAudioPages\pages\
Move-Item pages\recording-categories packageAudioPages\pages\
Move-Item pages\recording-clips packageAudioPages\pages\
Move-Item pages\audio-player packageAudioPages\pages\

# 2. éªŒè¯ç§»åŠ¨æˆåŠŸ
Test-Path pages\airline-recordings  # åº”è¯¥è¿”å›False
Test-Path pages\audio-player  # åº”è¯¥è¿”å›False
Test-Path packageAudioPages\pages\airline-recordings\index.wxml  # åº”è¯¥è¿”å›True
Test-Path packageAudioPages\pages\audio-player\index.wxml  # åº”è¯¥è¿”å›True
```

---

### æ­¥éª¤2.2.3ï¼šåˆ›å»ºpackageAudioDataç»Ÿä¸€æ•°æ®åˆ†åŒ…

**åˆ›æ–°ç­–ç•¥è¯´æ˜**ï¼š

ä¼ ç»Ÿæ–¹å¼ï¼ˆAIæ–¹æ¡ˆ1ï¼‰ï¼š
```
âŒ å°†32ä¸ªæ•°æ®æ–‡ä»¶åˆ†æ•£åˆ°32ä¸ªéŸ³é¢‘åˆ†åŒ…
   éœ€è¦ä¿®æ”¹32ä¸ªéŸ³é¢‘åˆ†åŒ…çš„é…ç½®
   è¿åDRYåŸåˆ™
   ç»´æŠ¤å¤æ‚
```

æˆ‘ä»¬çš„æ–°ç­–ç•¥ï¼š
```
âœ… åˆ›å»ºpackageAudioDataç»Ÿä¸€ç®¡ç†æ‰€æœ‰èˆªçº¿å½•éŸ³å…ƒæ•°æ®
   åªéœ€1æ¬¡é…ç½®
   é›†ä¸­ç®¡ç†ï¼Œç¬¦åˆæœ€ä½³å®è·µ
   å€Ÿé‰´éŸ³é¢‘åˆ†åŒ…8æ­¥ç»éªŒ
```

#### 3.1 åˆ›å»ºpackageAudioDataåˆ†åŒ…

```powershell
cd D:\FlightToolbox\miniprogram

# åˆ›å»ºæ•°æ®åˆ†åŒ…ç›®å½•
New-Item -ItemType Directory -Path packageAudioData -Force
New-Item -ItemType Directory -Path packageAudioData\data -Force
New-Item -ItemType Directory -Path packageAudioData\data\regions -Force

# éªŒè¯ç›®å½•åˆ›å»ºæˆåŠŸ
Test-Path packageAudioData\data\regions  # åº”è¯¥è¿”å›True
```

#### 3.2 ç§»åŠ¨èˆªçº¿å½•éŸ³æ•°æ®æ–‡ä»¶

```powershell
cd D:\FlightToolbox\miniprogram

# ç§»åŠ¨32ä¸ªåœ°åŒºæ•°æ®æ–‡ä»¶
Move-Item data\regions\*.js packageAudioData\data\regions\

# éªŒè¯ç§»åŠ¨æˆåŠŸ
$oldCount = (Get-ChildItem data\regions -Filter *.js -File -ErrorAction SilentlyContinue).Count
$newCount = (Get-ChildItem packageAudioData\data\regions -Filter *.js -File).Count

Write-Output "ä¸»åŒ…data/regionsæ–‡ä»¶æ•°: $oldCountï¼ˆåº”è¯¥ä¸º0ï¼‰"
Write-Output "packageAudioDataæ–‡ä»¶æ•°: $newCountï¼ˆåº”è¯¥ä¸º32ï¼‰"
```

#### 3.3 åˆ›å»ºæ•°æ®ç´¢å¼•æ–‡ä»¶

**æ–°å»ºæ–‡ä»¶**: `miniprogram/packageAudioData/data/index.js`

```javascript
/**
 * èˆªçº¿å½•éŸ³æ•°æ®ç´¢å¼•
 * ç»Ÿä¸€ç®¡ç†32ä¸ªå›½å®¶/åœ°åŒºçš„æ•°æ®æ–‡ä»¶
 */

module.exports = {
  /**
   * åœ°åŒºæ•°æ®æ–‡ä»¶æ˜ å°„
   */
  regionDataMapping: {
    'japan': './regions/japan.js',
    'korea': './regions/korean.js',
    'singapore': './regions/singapore.js',
    'thailand': './regions/thailand.js',
    'hongkong': './regions/hongkong.js',
    'chinese-taipei': './regions/chinese-taipei.js',
    'macau': './regions/macau.js',
    'philippines': './regions/philippines.js',
    'vietnam': './regions/vietnam.js',
    'malaysia': './regions/malaysia.js',
    'indonesia': './regions/indonesia.js',
    'india': './regions/india.js',
    'srilanka': './regions/srilanka.js',
    'maldive': './regions/maldive.js',
    'cambodia': './regions/cambodia.js',
    'myanmar': './regions/myanmar.js',
    'uzbekistan': './regions/uzbekistan.js',
    'russia': './regions/russia.js',
    'turkey': './regions/turkey.js',
    'france': './regions/france.js',
    'italy': './regions/italy.js',
    'uk': './regions/uk.js',
    'spain': './regions/spain.js',
    'germany': './regions/germany.js',
    'holland': './regions/holland.js',
    'america': './regions/america.js',
    'canada': './regions/canada.js',
    'australia': './regions/australia.js',
    'new-zealand': './regions/new-zealand.js',
    'egypt': './regions/egypt.js',
    'uae': './regions/uae.js'
  },

  /**
   * åŠ è½½æŒ‡å®šåœ°åŒºçš„æ•°æ®
   */
  loadRegionData: function(regionId, successCallback, failCallback) {
    var dataPath = this.regionDataMapping[regionId];
    if (!dataPath) {
      var error = new Error('æœªæ‰¾åˆ°åœ°åŒºæ•°æ®: ' + regionId);
      console.error(error);
      failCallback && failCallback(error);
      return;
    }

    require(dataPath, function(regionData) {
      successCallback && successCallback(regionData);
    }, function(error) {
      console.error('åŠ è½½åœ°åŒºæ•°æ®å¤±è´¥:', regionId, error);
      failCallback && failCallback(error);
    });
  }
};
```

---

### æ­¥éª¤2.2.4ï¼šæ›´æ–°app.jsoné…ç½®ï¼ˆéµå¾ª8æ­¥æµç¨‹çš„æ­¥éª¤4ï¼‰

**æ–‡ä»¶**: `miniprogram/app.json`

#### 4.1 ä»pagesåˆ—è¡¨ä¸­åˆ é™¤æ—§è·¯å¾„

```json
{
  "pages": [
    // âŒ åˆ é™¤ä»¥ä¸‹èˆªçº¿å½•éŸ³é¡µé¢
    "pages/airline-recordings/index",
    "pages/recording-categories/index",
    "pages/recording-clips/index",
    "pages/audio-player/index"
  ]
}
```

#### 4.2 æ·»åŠ packageAudioPagesåˆ°subPackages

```json
{
  "subPackages": [
    {
      "root": "packageAudioPages",
      "name": "audioNavigationPackage",
      "pages": [
        "pages/airline-recordings/index",
        "pages/recording-categories/index",
        "pages/recording-clips/index",
        "pages/audio-player/index"
      ]
    }
    // ... å…¶ä»–å·²æœ‰åˆ†åŒ…
  ]
}
```

#### 4.3 æ·»åŠ packageAudioDataåˆ°subPackages

```json
{
  "subPackages": [
    {
      "root": "packageAudioData",
      "name": "audioDataPackage",
      "pages": []
    }
    // ... å…¶ä»–å·²æœ‰åˆ†åŒ…
  ]
}
```

âš ï¸ **æ³¨æ„**ï¼špackageAudioDataæ²¡æœ‰é¡µé¢ï¼Œ`"pages": []` ä¸ºç©ºæ•°ç»„ï¼Œè¿™æ˜¯åˆæ³•çš„é…ç½®ã€‚

#### 4.4 é…ç½®é¢„åŠ è½½è§„åˆ™

```json
{
  "preloadRule": {
    "pages/operations/index": {
      "network": "all",
      "packages": [
        "communicationFailurePackage",
        "packageCCAR",
        "audioNavigationPackage",
        "audioDataPackage"  // é¢„åŠ è½½æ•°æ®åˆ†åŒ…
      ]
    }
  }
}
```

**é¢„åŠ è½½ç­–ç•¥è¯´æ˜**ï¼š
- åœ¨"é€šä¿¡"TabBaré¡µé¢é¢„åŠ è½½èˆªçº¿å½•éŸ³ç›¸å…³åˆ†åŒ…
- åŒ…æ‹¬UIåˆ†åŒ…ï¼ˆaudioNavigationPackageï¼‰å’Œæ•°æ®åˆ†åŒ…ï¼ˆaudioDataPackageï¼‰
- ç¡®ä¿ç”¨æˆ·ç‚¹å‡»"èˆªçº¿å½•éŸ³"æ—¶ï¼Œé¡µé¢å’Œæ•°æ®éƒ½å·²ç¼“å­˜

---

### æ­¥éª¤2.2.5ï¼šæ›´æ–°audio-config.jsï¼ˆéµå¾ª8æ­¥æµç¨‹çš„æ­¥éª¤6ï¼‰

**æ–‡ä»¶**: `miniprogram/utils/audio-config.js`

å°†æ•°æ®åŠ è½½æ”¹ä¸ºä» packageAudioData åŠ è½½ï¼š

```javascript
/**
 * éŸ³é¢‘é…ç½® - ç²¾ç®€ç‰ˆï¼ˆå·²åœ¨é˜¶æ®µ1.3ä¼˜åŒ–ï¼‰
 * ç°åœ¨æ•°æ®ä»packageAudioDataåˆ†åŒ…åŠ è½½
 */

module.exports = {
  regions: [
    // ... åœ°åŒºå…ƒæ•°æ®åˆ—è¡¨ï¼ˆé˜¶æ®µ1.3å·²ç²¾ç®€ï¼‰
  ],

  /**
   * æ‡’åŠ è½½åœ°åŒºè¯¦ç»†æ•°æ®ï¼ˆæ›´æ–°ä¸ºä»packageAudioDataåŠ è½½ï¼‰
   */
  loadRegionData: function(regionId, successCallback, failCallback) {
    // âœ… æ–°æ–¹å¼ï¼šä»packageAudioDataç»Ÿä¸€æ•°æ®åˆ†åŒ…åŠ è½½
    require('../../packageAudioData/data/index.js', function(audioDataIndex) {
      audioDataIndex.loadRegionData(regionId, successCallback, failCallback);
    }, function(error) {
      console.error('åŠ è½½packageAudioDataå¤±è´¥:', error);
      failCallback && failCallback(error);
    });
  }
};
```

---

### æ­¥éª¤2.2.6ï¼šæ›´æ–°audio-package-loader.jsï¼ˆéµå¾ª8æ­¥æµç¨‹çš„æ­¥éª¤7ï¼‰

**æ–‡ä»¶**: `miniprogram/utils/audio-package-loader.js`

æ›´æ–°åˆ†åŒ…åŠ è½½é€»è¾‘ï¼š

```javascript
/**
 * éŸ³é¢‘åˆ†åŒ…åŠ è½½å™¨
 * å¤„ç†31ä¸ªéŸ³é¢‘åˆ†åŒ…çš„åŠ è½½é€»è¾‘
 */

module.exports = {
  packageMapping: {
    'japan': { packageName: 'japanAudioPackage', packageRoot: 'packageJapan' },
    'korea': { packageName: 'koreanAudioPackage', packageRoot: 'packageKorean' },
    // ... å…¶ä»–31ä¸ªéŸ³é¢‘åˆ†åŒ…æ˜ å°„
  },

  /**
   * åŠ è½½éŸ³é¢‘åˆ†åŒ…
   */
  loadAudioPackage: function(regionId, successCallback, failCallback) {
    var packageInfo = this.packageMapping[regionId];
    if (!packageInfo) {
      var error = new Error('æœªæ‰¾åˆ°éŸ³é¢‘åˆ†åŒ…: ' + regionId);
      failCallback && failCallback(error);
      return;
    }

    wx.loadSubpackage({
      name: packageInfo.packageName,
      success: function() {
        console.log('âœ… éŸ³é¢‘åˆ†åŒ…åŠ è½½æˆåŠŸ:', packageInfo.packageName);

        // âœ… åŠ è½½åœ°åŒºæ•°æ®ï¼ˆä»packageAudioDataï¼‰
        require('../../packageAudioData/data/index.js', function(audioDataIndex) {
          audioDataIndex.loadRegionData(regionId, successCallback, failCallback);
        }, function(error) {
          console.error('åŠ è½½åœ°åŒºæ•°æ®å¤±è´¥:', error);
          failCallback && failCallback(error);
        });
      },
      fail: function(error) {
        console.error('âŒ éŸ³é¢‘åˆ†åŒ…åŠ è½½å¤±è´¥:', packageInfo.packageName, error);
        failCallback && failCallback(error);
      }
    });
  }
};
```

---

### æ­¥éª¤2.2.7ï¼šæ›´æ–°audio-playeré¡µé¢ï¼ˆéµå¾ª8æ­¥æµç¨‹çš„æ­¥éª¤8ï¼‰

**æ–‡ä»¶**: `miniprogram/packageAudioPages/pages/audio-player/index.ts`

æ›´æ–°éŸ³é¢‘æ’­æ”¾å™¨çš„æ•°æ®åŠ è½½å’Œè·¯å¾„æ˜ å°„ï¼š

```typescript
var BasePage = require('../../../../utils/base-page.js');
var audioPackageLoader = require('../../../../utils/audio-package-loader.js');

interface AudioPlayerData {
  currentClip: any;
  isPlaying: boolean;
  currentTime: number;
  duration: number;
}

const pageConfig = {
  data: {
    currentClip: null,
    isPlaying: false,
    currentTime: 0,
    duration: 0
  } as AudioPlayerData,

  // åœ°åŒºéŸ³é¢‘è·¯å¾„æ˜ å°„
  regionPathMap: {
    'japan': '/packageJapan/',
    'korea': '/packageKorean/',
    'singapore': '/packageSingapore/',
    'thailand': '/packageThailand/',
    'hongkong': '/packageHongKong/',
    'chinese-taipei': '/packageTaipei/',
    'macau': '/packageMacau/',
    'philippines': '/packagePhilippines/',
    'vietnam': '/packageVietnam/',
    'malaysia': '/packageMalaysia/',
    'indonesia': '/packageIndonesia/',
    'india': '/packageIndia/',
    'srilanka': '/packageSrilanka/',
    'maldive': '/packageMaldive/',
    'cambodia': '/packageCambodia/',
    'myanmar': '/packageMyanmar/',
    'uzbekistan': '/packageUzbekistan/',
    'russia': '/packageRussia/',
    'turkey': '/packageTurkey/',
    'france': '/packageFrance/',
    'italy': '/packageItaly/',
    'uk': '/packageUK/',
    'spain': '/packageSpain/',
    'germany': '/packageGermany/',
    'holland': '/packageHolland/',
    'america': '/packageAmerica/',
    'canada': '/packageCanada/',
    'australia': '/packageAustralia/',
    'new-zealand': '/packageNewZealand/',
    'egypt': '/packageEgypt/',
    'uae': '/packageUAE/'
  },

  customOnLoad: function(options: any) {
    const self = this;
    const regionId = options.regionId;
    const clipId = options.clipId;

    // åŠ è½½éŸ³é¢‘åˆ†åŒ…å’Œæ•°æ®
    audioPackageLoader.loadAudioPackage(regionId, function(regionData: any) {
      // æŸ¥æ‰¾æŒ‡å®šéŸ³é¢‘ç‰‡æ®µ
      const clip = regionData.clips.find((c: any) => c.id === clipId);
      if (!clip) {
        self.handleError(new Error('æœªæ‰¾åˆ°éŸ³é¢‘ç‰‡æ®µ'), 'éŸ³é¢‘åŠ è½½å¤±è´¥');
        return;
      }

      // æ„å»ºéŸ³é¢‘æ–‡ä»¶å®Œæ•´è·¯å¾„
      const packagePath = self.regionPathMap[regionId];
      const audioPath = packagePath + clip.mp3_file;

      // åˆå§‹åŒ–éŸ³é¢‘æ’­æ”¾å™¨
      self.initPlayer(clip, audioPath);
    }, function(error: Error) {
      self.handleError(error, 'åŠ è½½éŸ³é¢‘æ•°æ®å¤±è´¥');
    });
  },

  initPlayer: function(clip: any, audioPath: string) {
    const self = this;

    // åˆ›å»ºéŸ³é¢‘ä¸Šä¸‹æ–‡
    const audioContext = wx.createInnerAudioContext();
    audioContext.src = audioPath;

    audioContext.onPlay(function() {
      self.setData({ isPlaying: true });
    });

    audioContext.onPause(function() {
      self.setData({ isPlaying: false });
    });

    audioContext.onTimeUpdate(function() {
      self.setData({
        currentTime: audioContext.currentTime,
        duration: audioContext.duration
      });
    });

    audioContext.onError(function(error: any) {
      console.error('éŸ³é¢‘æ’­æ”¾é”™è¯¯:', error);
      self.handleError(error, 'éŸ³é¢‘æ’­æ”¾å¤±è´¥');
    });

    self.setData({
      currentClip: clip,
      audioContext: audioContext
    });
  },

  onPlay: function() {
    const audioContext = this.data.audioContext;
    if (audioContext) {
      audioContext.play();
    }
  },

  onPause: function() {
    const audioContext = this.data.audioContext;
    if (audioContext) {
      audioContext.pause();
    }
  },

  customOnUnload: function() {
    // é¡µé¢å¸è½½æ—¶é”€æ¯éŸ³é¢‘ä¸Šä¸‹æ–‡
    const audioContext = this.data.audioContext;
    if (audioContext) {
      audioContext.destroy();
    }
  }
};

Page(BasePage.createPage(pageConfig));
```

âš ï¸ **å…³é”®æ³¨æ„äº‹é¡¹**ï¼š
- `regionPathMap` ä¸­çš„è·¯å¾„å‰åéƒ½è¦æœ‰æ–œæ ï¼š`'/packageJapan/'`
- éŸ³é¢‘æ–‡ä»¶è·¯å¾„ = packagePath + mp3_file
- é¡µé¢å¸è½½æ—¶å¿…é¡»è°ƒç”¨ `audioContext.destroy()`

---

### æ­¥éª¤2.2.8ï¼šæ›´æ–°è·¯ç”±å¼•ç”¨

#### 8.1 æœç´¢æ‰€æœ‰å¼•ç”¨

```powershell
cd D:\FlightToolbox\miniprogram

# æœç´¢èˆªçº¿å½•éŸ³é¡µé¢å¼•ç”¨
Get-ChildItem -Recurse -Include *.js,*.ts,*.wxml -File |
  Select-String -Pattern "/pages/airline-recordings|/pages/audio-player" |
  Select-Object Path, LineNumber, Line
```

#### 8.2 æ›´æ–°é€šä¿¡é¡µé¢çš„è·³è½¬

**æ–‡ä»¶**: `miniprogram/pages/operations/index.ts`

```javascript
// âŒ æ—§è·¯å¾„
navigateToAirlineRecordings: function() {
  wx.navigateTo({
    url: '/pages/airline-recordings/index'
  });
},

// âœ… æ–°è·¯å¾„
navigateToAirlineRecordings: function() {
  wx.navigateTo({
    url: '/packageAudioPages/pages/airline-recordings/index'
  });
},
```

#### 8.3 æ›´æ–°åˆ†åŒ…å†…éƒ¨çš„è·³è½¬

**æ–‡ä»¶**: `miniprogram/packageAudioPages/pages/airline-recordings/index.js`

```javascript
// è·³è½¬åˆ°éŸ³é¢‘åˆ—è¡¨
onRegionTap: function(e) {
  var regionId = e.currentTarget.dataset.regionId;

  // âŒ æ—§è·¯å¾„
  // wx.navigateTo({ url: '/pages/recording-clips/index?regionId=' + regionId });

  // âœ… æ–°è·¯å¾„ï¼ˆç›¸å¯¹è·¯å¾„ï¼‰
  wx.navigateTo({
    url: '../recording-clips/index?regionId=' + regionId
  });
},
```

**æ–‡ä»¶**: `miniprogram/packageAudioPages/pages/recording-clips/index.js`

```javascript
// è·³è½¬åˆ°éŸ³é¢‘æ’­æ”¾å™¨
onClipTap: function(e) {
  var regionId = this.data.regionId;
  var clipId = e.currentTarget.dataset.clipId;

  // âŒ æ—§è·¯å¾„
  // wx.navigateTo({ url: '/pages/audio-player/index?regionId=' + regionId + '&clipId=' + clipId });

  // âœ… æ–°è·¯å¾„ï¼ˆç›¸å¯¹è·¯å¾„ï¼‰
  wx.navigateTo({
    url: '../audio-player/index?regionId=' + regionId + '&clipId=' + clipId
  });
},
```

---

### æ­¥éª¤2.2.9ï¼šéªŒè¯èˆªçº¿å½•éŸ³åˆ†åŒ…

#### 9.1 ç¼–è¯‘æµ‹è¯•

åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­ï¼š
1. ç‚¹å‡»"ç¼–è¯‘"æŒ‰é’®
2. æ£€æŸ¥æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯
3. æ£€æŸ¥"è¯¦æƒ…" â†’ "ä»£ç å¤§å°åˆ†æ"

é¢„æœŸç»“æœï¼š
- âœ… ç¼–è¯‘æˆåŠŸï¼Œæ— é”™è¯¯
- âœ… ä¸»åŒ…å¤§å°å‡å°‘çº¦125KB
- âœ… æ–°å¢åˆ†åŒ…ï¼šaudioNavigationPackage
- âœ… æ–°å¢åˆ†åŒ…ï¼šaudioDataPackage

#### 9.2 åŠŸèƒ½æµ‹è¯•

å®Œæ•´æµ‹è¯•æµç¨‹ï¼š

```
1. è¿›å…¥"é€šä¿¡"TabBaré¡µé¢
   âœ… é¡µé¢æ­£å¸¸æ˜¾ç¤º

2. ç‚¹å‡»"èˆªçº¿å½•éŸ³"
   âœ… åœ°åŒºåˆ—è¡¨é¡µé¢æ­£å¸¸æ˜¾ç¤º
   âœ… æ˜¾ç¤º32ä¸ªå›½å®¶/åœ°åŒºå¡ç‰‡

3. ç‚¹å‡»ä»»æ„åœ°åŒºï¼ˆå¦‚"æ—¥æœ¬"ï¼‰
   âœ… éŸ³é¢‘åˆ—è¡¨é¡µé¢æ­£å¸¸æ˜¾ç¤º
   âœ… æ˜¾ç¤ºè¯¥åœ°åŒºæ‰€æœ‰éŸ³é¢‘ç‰‡æ®µ

4. ç‚¹å‡»ä»»æ„éŸ³é¢‘ç‰‡æ®µ
   âœ… éŸ³é¢‘æ’­æ”¾å™¨é¡µé¢æ­£å¸¸æ‰“å¼€
   âœ… æ˜¾ç¤ºéŸ³é¢‘æ ‡é¢˜ã€æ–‡æœ¬ã€ç¿»è¯‘
   âœ… æ’­æ”¾æŒ‰é’®æ­£å¸¸æ˜¾ç¤º

5. ç‚¹å‡»æ’­æ”¾æŒ‰é’®
   âœ… éŸ³é¢‘æ­£å¸¸æ’­æ”¾
   âœ… è¿›åº¦æ¡æ­£å¸¸æ›´æ–°
   âœ… æ’­æ”¾/æš‚åœåˆ‡æ¢æ­£å¸¸
```

#### 9.3 ç¦»çº¿æµ‹è¯•

```powershell
# 1. åœ¨å¼€å‘è€…å·¥å…·ä¸­å¼€å¯é£è¡Œæ¨¡å¼
# 2. é‡æ–°è¿›å…¥å°ç¨‹åº
# 3. è¿›å…¥"é€šä¿¡" â†’ "èˆªçº¿å½•éŸ³"
# 4. é€‰æ‹©åœ°åŒº â†’ é€‰æ‹©éŸ³é¢‘ â†’ æ’­æ”¾
# 5. éªŒè¯æ‰€æœ‰åŠŸèƒ½æ­£å¸¸
```

**éªŒè¯é€šè¿‡æ ‡å‡†**ï¼š
- âœ… ç¦»çº¿æ¨¡å¼ä¸‹åœ°åŒºåˆ—è¡¨æ­£å¸¸æ˜¾ç¤º
- âœ… ç¦»çº¿æ¨¡å¼ä¸‹éŸ³é¢‘åˆ—è¡¨æ­£å¸¸åŠ è½½
- âœ… ç¦»çº¿æ¨¡å¼ä¸‹éŸ³é¢‘æ­£å¸¸æ’­æ”¾
- âœ… æ²¡æœ‰ç½‘ç»œè¯·æ±‚é”™è¯¯

#### 9.4 çœŸæœºæµ‹è¯•

**AndroidçœŸæœºæµ‹è¯•**ï¼š
1. ä½¿ç”¨"çœŸæœºè°ƒè¯•"è¿æ¥Androidè®¾å¤‡
2. é‡å¤ä¸Šè¿°åŠŸèƒ½æµ‹è¯•æµç¨‹
3. ç‰¹åˆ«æ³¨æ„éŸ³é¢‘æ’­æ”¾å…¼å®¹æ€§

**iOSçœŸæœºæµ‹è¯•**ï¼š
1. ä½¿ç”¨"çœŸæœºè°ƒè¯•"è¿æ¥iOSè®¾å¤‡
2. é‡å¤ä¸Šè¿°åŠŸèƒ½æµ‹è¯•æµç¨‹
3. éªŒè¯iOSéŸ³é¢‘å…¼å®¹æ€§åŠŸèƒ½ï¼ˆ`utils/ios-audio-compatibility.js`ï¼‰

**éªŒè¯é€šè¿‡æ ‡å‡†**ï¼š
- âœ… AndroidçœŸæœºæ‰€æœ‰åŠŸèƒ½æ­£å¸¸
- âœ… iOSçœŸæœºæ‰€æœ‰åŠŸèƒ½æ­£å¸¸
- âœ… éŸ³é¢‘æ’­æ”¾æµç•…ï¼Œæ— å¡é¡¿
- âœ… è¿›åº¦æ¡æ›´æ–°å‡†ç¡®

---

### æ­¥éª¤2.2.10ï¼šæäº¤Gitè®°å½•

```powershell
cd D:\FlightToolbox

git add miniprogram/packageAudioPages/
git add miniprogram/packageAudioData/
git add miniprogram/app.json
git add miniprogram/utils/audio-config.js
git add miniprogram/utils/audio-package-loader.js
git add miniprogram/pages/operations/

git commit -m "é˜¶æ®µ2.2: èˆªçº¿å½•éŸ³é¡µé¢åˆ†åŒ…ï¼ˆ125KBï¼‰

åˆ›å»ºåˆ†åŒ…ï¼š
- æ–°å¢ packageAudioPagesï¼ˆUIé¡µé¢åˆ†åŒ…ï¼‰
- æ–°å¢ packageAudioDataï¼ˆæ•°æ®åˆ†åŒ…ï¼‰
- åˆ†åŒ…åç§°: audioNavigationPackage, audioDataPackage

è¿ç§»å†…å®¹ï¼š
- ç§»åŠ¨ 4 ä¸ªé¡µé¢ï¼ˆ124.50KBï¼‰
  - airline-recordings
  - recording-categories
  - recording-clips
  - audio-player
- ç§»åŠ¨ 32 ä¸ªæ•°æ®æ–‡ä»¶åˆ°packageAudioDataï¼ˆç»Ÿä¸€ç®¡ç†ï¼‰

åˆ›æ–°ç­–ç•¥ï¼š
- é‡‡ç”¨ç»Ÿä¸€æ•°æ®åˆ†åŒ…è€Œéåˆ†æ•£åˆ°32ä¸ªéŸ³é¢‘åˆ†åŒ…
- éµå¾ªDRYåŸåˆ™ï¼Œå‡å°‘é…ç½®å¤æ‚åº¦
- å€Ÿé‰´éŸ³é¢‘åˆ†åŒ…8æ­¥é…ç½®ç»éªŒ

é…ç½®æ›´æ–°ï¼š
- æ›´æ–° app.jsonï¼ˆsubPackages + preloadRuleï¼‰
- æ›´æ–° audio-config.js æ•°æ®åŠ è½½é€»è¾‘
- æ›´æ–° audio-package-loader.js åˆ†åŒ…åŠ è½½é€»è¾‘
- æ›´æ–° audio-player/index.ts éŸ³é¢‘æ’­æ”¾é€»è¾‘
- æ›´æ–°æ‰€æœ‰è·¯ç”±å¼•ç”¨ä¸ºæ–°è·¯å¾„

éªŒè¯ç»“æœï¼š
- ç¼–è¯‘æˆåŠŸï¼Œæ— é”™è¯¯
- ä¸»åŒ…å‡å°‘çº¦ 125KB
- åœ¨çº¿æ¨¡å¼åŠŸèƒ½æ­£å¸¸
- ç¦»çº¿æ¨¡å¼åŠŸèƒ½æ­£å¸¸
- Android + iOS çœŸæœºæµ‹è¯•é€šè¿‡
- éŸ³é¢‘æ’­æ”¾åŠŸèƒ½å®Œå…¨æ­£å¸¸"
```

---

## âœ… é˜¶æ®µ2æ€»ç»“éªŒè¯

å®Œæˆæ‰€æœ‰ä¼˜åŒ–é¡¹åï¼Œè¿›è¡Œæœ€ç»ˆéªŒè¯ï¼š

### 1. ä¸»åŒ…å¤§å°éªŒè¯

```powershell
cd D:\FlightToolbox
.\åˆ†åŒ…æ–¹æ¡ˆ\monitor-main-package-size.ps1

# é¢„æœŸç»“æœï¼š
# é˜¶æ®µ1åï¼š2286-2386 KB
# é˜¶æ®µ2åï¼š1671 KBï¼ˆèŠ‚çœ615KBï¼‰
# æ»¡è¶³2MBé™åˆ¶ï¼šâœ…
```

### 2. åŠŸèƒ½å®Œæ•´æ€§éªŒè¯

```
æ ¸å¿ƒåŠŸèƒ½æ¸…å•ï¼š
âœ… GPSåœ°é€Ÿã€é«˜åº¦ã€åæ ‡æ­£å¸¸æ˜¾ç¤º
âœ… æŒ‡å—é’ˆèˆªå‘æ­£å¸¸å·¥ä½œ
âœ… å§¿æ€ä»ªå®Œå…¨æ­£å¸¸
âœ… ä¼ æ„Ÿå™¨èåˆæ­£å¸¸è¿è¡Œ
âœ… é€šä¿¡è§„åˆ™æ•°æ®æ­£å¸¸åŠ è½½
âœ… æ ‡å‡†ç”¨è¯­æ•°æ®æ­£å¸¸åŠ è½½
âœ… é€šä¿¡å¤±æ•ˆæ¨¡å—å®Œå…¨æ­£å¸¸
  - å›½å†…/å›½é™…é¡µé¢æ­£å¸¸
  - 8ä¸ªåœ°åŒºé¡µé¢æ­£å¸¸
  - å›½å®¶è¯¦æƒ…é¡µæ­£å¸¸
âœ… èˆªçº¿å½•éŸ³æ¨¡å—å®Œå…¨æ­£å¸¸
  - åœ°åŒºåˆ—è¡¨æ­£å¸¸æ˜¾ç¤º
  - éŸ³é¢‘åˆ—è¡¨æ­£å¸¸åŠ è½½
  - éŸ³é¢‘æ’­æ”¾æ­£å¸¸å·¥ä½œ
âœ… æ‰€æœ‰TabBarå¯¼èˆªæ­£å¸¸
âœ… æ‰€æœ‰é¡µé¢æ ·å¼æ­£å¸¸
```

### 3. ç¦»çº¿æ¨¡å¼éªŒè¯

```
ç¦»çº¿æµ‹è¯•æ¸…å•ï¼š
âœ… å¼€å¯é£è¡Œæ¨¡å¼
âœ… é‡å¯å°ç¨‹åº
âœ… è®¿é—®é©¾é©¶èˆ±é¡µé¢ - GPS/å§¿æ€ä»ª/èˆªå‘æ­£å¸¸
âœ… è®¿é—®é€šä¿¡é¡µé¢ - æ•°æ®åŠ è½½æ­£å¸¸
âœ… è®¿é—®é€šä¿¡å¤±æ•ˆ - æ‰€æœ‰é¡µé¢æ­£å¸¸
âœ… è®¿é—®èˆªçº¿å½•éŸ³ - éŸ³é¢‘æ’­æ”¾æ­£å¸¸
âœ… æ‰€æœ‰åŠŸèƒ½åœ¨ç¦»çº¿æ¨¡å¼ä¸‹å¯ç”¨
```

### 4. åˆ†åŒ…é¢„åŠ è½½éªŒè¯

```
é¢„åŠ è½½éªŒè¯æ¸…å•ï¼š
âœ… è¿›å…¥"é€šä¿¡"é¡µé¢åï¼Œæ£€æŸ¥æ§åˆ¶å°
âœ… communicationFailurePackage å·²é¢„åŠ è½½
âœ… audioNavigationPackage å·²é¢„åŠ è½½
âœ… audioDataPackage å·²é¢„åŠ è½½
âœ… packageCCAR å·²é¢„åŠ è½½
âœ… ç‚¹å‡»å„åŠŸèƒ½å…¥å£æ— åŠ è½½å»¶è¿Ÿ
```

### 5. çœŸæœºæµ‹è¯•éªŒè¯

```
AndroidçœŸæœºæµ‹è¯•ï¼š
âœ… åä¸ºè®¾å¤‡ - æ‰€æœ‰åŠŸèƒ½æ­£å¸¸
âœ… å°ç±³è®¾å¤‡ - æ‰€æœ‰åŠŸèƒ½æ­£å¸¸
âœ… OPPOè®¾å¤‡ - æ‰€æœ‰åŠŸèƒ½æ­£å¸¸
âœ… vivoè®¾å¤‡ - æ‰€æœ‰åŠŸèƒ½æ­£å¸¸
âœ… éŸ³é¢‘æ’­æ”¾æµç•…æ— å¡é¡¿

iOSçœŸæœºæµ‹è¯•ï¼š
âœ… iPhone 11åŠä»¥ä¸Š - æ‰€æœ‰åŠŸèƒ½æ­£å¸¸
âœ… iOS 14åŠä»¥ä¸Š - æ‰€æœ‰åŠŸèƒ½æ­£å¸¸
âœ… iOSéŸ³é¢‘å…¼å®¹æ€§æ­£å¸¸
âœ… éŸ³é¢‘æ’­æ”¾æµç•…æ— å¡é¡¿

å¼±ç½‘ç¯å¢ƒæµ‹è¯•ï¼š
âœ… WiFiå¼±ç½‘ - åŠŸèƒ½æ­£å¸¸
âœ… 4Gå¼±ç½‘ - åŠŸèƒ½æ­£å¸¸
âœ… ç¦»çº¿æ¨¡å¼ - åŠŸèƒ½å®Œå…¨æ­£å¸¸

å†·å¯åŠ¨æµ‹è¯•ï¼š
âœ… é¦–æ¬¡å®‰è£… - å¯åŠ¨æ­£å¸¸
âœ… æ¸…é™¤ç¼“å­˜å - å¯åŠ¨æ­£å¸¸
âœ… é¢„åŠ è½½æœºåˆ¶ - å·¥ä½œæ­£å¸¸
```

### 6. Gitæäº¤æœ€ç»ˆè®°å½•

```powershell
cd D:\FlightToolbox

# æŸ¥çœ‹é˜¶æ®µ2æ‰€æœ‰ä¿®æ”¹
git log --oneline feature/phase2-optimization

# åˆå¹¶åˆ°ä¸»åˆ†æ”¯ï¼ˆå¦‚æœæ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼‰
git checkout main
git merge feature/phase2-optimization

# æ‰“æ ‡ç­¾
git tag -a v2.8.1-phase2 -m "é˜¶æ®µ2ä¼˜åŒ–å®Œæˆ: ä¸»åŒ…å‡å°‘615KBï¼Œæ»¡è¶³2MBé™åˆ¶

ä¼˜åŒ–å†…å®¹ï¼š
1. é€šä¿¡å¤±æ•ˆåˆ†åŒ…ï¼ˆ490KBï¼‰
   - åˆ›å»º packageCommFailure
   - è¿ç§» 11 ä¸ªé¡µé¢ + 9 ä¸ªæ•°æ®æ–‡ä»¶

2. èˆªçº¿å½•éŸ³é¡µé¢åˆ†åŒ…ï¼ˆ125KBï¼‰
   - åˆ›å»º packageAudioPagesï¼ˆUIé¡µé¢ï¼‰
   - åˆ›å»º packageAudioDataï¼ˆç»Ÿä¸€æ•°æ®ç®¡ç†ï¼‰
   - è¿ç§» 4 ä¸ªé¡µé¢ + 32 ä¸ªæ•°æ®æ–‡ä»¶

éªŒè¯ç»“æœï¼š
- ä¸»åŒ…ä»2286-2386KBé™è‡³1671KB
- æ»¡è¶³å¾®ä¿¡2MBé™åˆ¶ âœ…
- å‰©ä½™æ‰©å±•ç©ºé—´377KBï¼ˆ18.4%ï¼‰
- æ‰€æœ‰åŠŸèƒ½åœ¨çº¿/ç¦»çº¿æ¨¡å¼æ­£å¸¸
- Android + iOS çœŸæœºæµ‹è¯•é€šè¿‡
- é¢„åŠ è½½æœºåˆ¶å·¥ä½œæ­£å¸¸"

# æ¨é€åˆ°è¿œç¨‹ä»“åº“
git push origin main --tags
```

---

## ğŸ”„ å›æ»šæ–¹æ¡ˆ

å¦‚æœé‡åˆ°é—®é¢˜éœ€è¦å›æ»šï¼š

### å¿«é€Ÿå›æ»šåˆ°é˜¶æ®µ1

```powershell
cd D:\FlightToolbox
git checkout main
git reset --hard v2.8.1-phase1
```

### åˆ†æ­¥å›æ»š

```powershell
# ä»…å›æ»šé€šä¿¡å¤±æ•ˆåˆ†åŒ…
git revert <é˜¶æ®µ2.1çš„commit-hash>

# ä»…å›æ»šèˆªçº¿å½•éŸ³åˆ†åŒ…
git revert <é˜¶æ®µ2.2çš„commit-hash>
```

---

## ğŸ“ é—®é¢˜æ’æŸ¥

### é—®é¢˜1ï¼šé€šä¿¡å¤±æ•ˆé¡µé¢404æˆ–æ— æ³•è®¿é—®

**ç—‡çŠ¶**ï¼š
- ç‚¹å‡»"é€šä¿¡å¤±æ•ˆ"åé¡µé¢ç©ºç™½æˆ–404é”™è¯¯

**æ’æŸ¥æ­¥éª¤**ï¼š

```powershell
# 1. æ£€æŸ¥åˆ†åŒ…æ–‡ä»¶æ˜¯å¦å­˜åœ¨
cd D:\FlightToolbox\miniprogram
Test-Path packageCommFailure\pages\index.wxml  # å¿…é¡»True

# 2. æ£€æŸ¥app.jsoné…ç½®
Select-String -Path app.json -Pattern "packageCommFailure" -Context 5,5

# 3. æ£€æŸ¥è·¯ç”±å¼•ç”¨
Select-String -Path pages\operations\index.ts -Pattern "packageCommFailure"
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. éªŒè¯ app.json ä¸­ subPackages é…ç½®æ­£ç¡®
2. éªŒè¯è·¯ç”±è·¯å¾„ä½¿ç”¨ `/packageCommFailure/pages/index`
3. é‡æ–°ç¼–è¯‘å°ç¨‹åº

### é—®é¢˜2ï¼šèˆªçº¿å½•éŸ³éŸ³é¢‘æ— æ³•æ’­æ”¾

**ç—‡çŠ¶**ï¼š
- åœ°åŒºåˆ—è¡¨æ˜¾ç¤ºæ­£å¸¸
- éŸ³é¢‘åˆ—è¡¨æ˜¾ç¤ºæ­£å¸¸
- ç‚¹å‡»æ’­æ”¾æ— ååº”æˆ–æŠ¥é”™

**æ’æŸ¥æ­¥éª¤**ï¼š

å‚è€ƒè¯¦ç»†æ–‡æ¡£ï¼š`èˆªçº¿å½•éŸ³åˆ†åŒ…é¢„åŠ è½½è§„åˆ™è®°å½•/æ•…éšœæ’æŸ¥-éŸ³é¢‘æ— æ³•æ’­æ”¾.md`

```powershell
# æ£€æŸ¥3ä¸ªæ ¸å¿ƒé…ç½®æ–‡ä»¶
Select-String -Path utils\audio-config.js -Pattern "packageAudioData"
Select-String -Path utils\audio-package-loader.js -Pattern "audioDataIndex"
Select-String -Path packageAudioPages\pages\audio-player\index.ts -Pattern "regionPathMap"

# æ£€æŸ¥æ•°æ®æ–‡ä»¶æ˜¯å¦å­˜åœ¨
Get-ChildItem packageAudioData\data\regions -Filter *.js | Measure-Object
# åº”è¯¥æ˜¾ç¤º32ä¸ªæ–‡ä»¶
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®è®¤ packageAudioData/data/index.js æ–‡ä»¶å­˜åœ¨
2. ç¡®è®¤ audio-player/index.ts ä¸­çš„ regionPathMap å®Œæ•´
3. ç¡®è®¤éŸ³é¢‘æ–‡ä»¶è·¯å¾„æ ¼å¼ï¼š`/packageJapan/` + `file.mp3`

### é—®é¢˜3ï¼šé¢„åŠ è½½å¤±è´¥æˆ–åˆ†åŒ…æœªç¼“å­˜

**ç—‡çŠ¶**ï¼š
- ç¦»çº¿æ¨¡å¼ä¸‹é¡µé¢æ— æ³•è®¿é—®
- ç‚¹å‡»åŠŸèƒ½å…¥å£æœ‰æ˜æ˜¾åŠ è½½å»¶è¿Ÿ

**æ’æŸ¥æ­¥éª¤**ï¼š

```powershell
# æ£€æŸ¥preloadRuleé…ç½®
Select-String -Path app.json -Pattern "preloadRule" -Context 10,10

# éªŒè¯é¢„åŠ è½½é¡µé¢é…ç½®
# åº”è¯¥åœ¨ pages/operations/index é¢„åŠ è½½ï¼š
# - communicationFailurePackage
# - audioNavigationPackage
# - audioDataPackage
# - packageCCAR
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. éªŒè¯ preloadRule é…ç½®æ­£ç¡®
2. æ£€æŸ¥é¢„åŠ è½½æ€»å¤§å°ä¸è¶…è¿‡2MB
3. æ¸…é™¤ç¼“å­˜é‡æ–°æµ‹è¯•
4. çœŸæœºæµ‹è¯•éªŒè¯é¢„åŠ è½½æœºåˆ¶

---

## ğŸ“ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

é˜¶æ®µ2å®Œæˆåï¼Œæ ¹æ®ä¸»åŒ…å¤§å°å’Œé¡¹ç›®éœ€æ±‚å†³å®šæ˜¯å¦æ‰§è¡Œé˜¶æ®µ3ï¼š

### æƒ…å†µ1ï¼šä¸»åŒ…å·²æ»¡è¶³éœ€æ±‚ï¼ˆæ¨èï¼‰

```
å½“å‰ä¸»åŒ…ï¼š1671 KB
æ»¡è¶³2MBé™åˆ¶ï¼šâœ… æ˜¯
å‰©ä½™æ‰©å±•ç©ºé—´ï¼š377 KB (18.4%)

å»ºè®®è¡ŒåŠ¨ï¼š
1. æš‚ä¸æ‰§è¡Œé˜¶æ®µ3
2. è§‚å¯Ÿ1-2å‘¨ï¼Œç¡®ä¿ç³»ç»Ÿç¨³å®š
3. æ ¹æ®åç»­åŠŸèƒ½æ‰©å±•éœ€æ±‚å†å†³å®š
4. å½“å‰ç©ºé—´è¶³å¤Ÿåº”å¯¹ä¸€èˆ¬æ‰©å±•éœ€æ±‚
```

âœ… **å»ºè®®ï¼šæš‚åœä¼˜åŒ–ï¼Œè¿›å…¥ç¨³å®šæœŸ**

### æƒ…å†µ2ï¼šå¸Œæœ›é¢„ç•™æ›´å¤šæ‰©å±•ç©ºé—´ï¼ˆå¯é€‰ï¼‰

```
å½“å‰ä¸»åŒ…ï¼š1671 KB
é¢„æœŸä¼˜åŒ–åï¼š1121 KBï¼ˆé˜¶æ®µ3æ‰§è¡Œåï¼‰
æ‰©å±•ç©ºé—´ï¼š927 KB (45.3%)

å»ºè®®è¡ŒåŠ¨ï¼š
1. å¯é€‰æ‹©æ‰§è¡Œé˜¶æ®µ3ï¼ˆé©¾é©¶èˆ±åˆ†åŒ…ï¼‰
2. æ³¨æ„ï¼šé˜¶æ®µ3é£é™©è¾ƒé«˜ï¼Œéœ€è¦å……åˆ†æµ‹è¯•
3. é©¾é©¶èˆ±åˆ é™¤NDåå·²ä»720KBé™è‡³550KB
4. è€ƒè™‘æ”¶ç›Šé£é™©æ¯”ï¼Œå¯èƒ½ä¸å€¼å¾—
```

ğŸ‘‰ **ç»§ç»­é˜…è¯»**ï¼š`é˜¶æ®µ3-é©¾é©¶èˆ±åˆ†åŒ…(å¯é€‰).md`

### æƒ…å†µ3ï¼šé‡åˆ°é—®é¢˜éœ€è¦å›æ»š

```
å»ºè®®è¡ŒåŠ¨ï¼š
1. ç«‹å³åœæ­¢ä¼˜åŒ–
2. æŸ¥é˜…"é—®é¢˜æ’æŸ¥"ç« èŠ‚
3. å¦‚æ— æ³•è§£å†³ï¼Œå›æ»šåˆ°é˜¶æ®µ1
4. æäº¤Issueæˆ–å¯»æ±‚æŠ€æœ¯æ”¯æŒ
```

ğŸ‘‰ **å‚è€ƒæ–‡æ¡£**ï¼š`éªŒè¯å’Œå›æ»šæŒ‡å—.md`

---

**æ–‡æ¡£åˆ›å»ºæ—¶é—´**: 2025-11-01
**ç»´æŠ¤è€…**: FlightToolbox AI Assistant
**ç‰ˆæœ¬**: v1.0
**å‰ç½®æ–‡æ¡£**: é˜¶æ®µ1-ä½é£é™©å¿«é€Ÿä¼˜åŒ–.md
**ä¸‹ä¸€æ­¥**: é˜…è¯» `é˜¶æ®µ3-é©¾é©¶èˆ±åˆ†åŒ…(å¯é€‰).md` æˆ– `éªŒè¯å’Œå›æ»šæŒ‡å—.md`
