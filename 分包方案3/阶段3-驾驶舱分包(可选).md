# é˜¶æ®µ3ï¼šé©¾é©¶èˆ±åˆ†åŒ…ï¼ˆå¯é€‰ï¼‰

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¥æœŸ**: 2025-11-01
**é¢„è®¡æ—¶é—´**: 5-7å¤©
**é¢„æœŸæ”¶ç›Š**: 550KB
**é£é™©ç­‰çº§**: ğŸ”´ é«˜
**ä¼˜å…ˆçº§**: â­â­

---

## âš ï¸ é‡è¦å†³ç­–ï¼šæ˜¯å¦éœ€è¦æ‰§è¡Œé˜¶æ®µ3ï¼Ÿ

### å†³ç­–æ ‘

```
é˜¶æ®µ2å®Œæˆåä¸»åŒ…å¤§å°ï¼š1671 KB

é—®é¢˜1ï¼šå‰©ä½™æ‰©å±•ç©ºé—´ï¼ˆ377KBï¼‰æ˜¯å¦è¶³å¤Ÿï¼Ÿ
  â”œâ”€ æ˜¯ â†’ å»ºè®®ï¼šä¸æ‰§è¡Œé˜¶æ®µ3ï¼Œä¿æŒå½“å‰çŠ¶æ€
  â””â”€ å¦ â†’ ç»§ç»­é—®é¢˜2

é—®é¢˜2ï¼šæ˜¯å¦æœ‰æ˜ç¡®çš„å¤§å‹åŠŸèƒ½æ‰©å±•è®¡åˆ’ï¼Ÿ
  â”œâ”€ å¦ â†’ å»ºè®®ï¼šä¸æ‰§è¡Œé˜¶æ®µ3ï¼Œç­‰å¾…æ˜ç¡®éœ€æ±‚
  â””â”€ æ˜¯ â†’ ç»§ç»­é—®é¢˜3

é—®é¢˜3ï¼šå›¢é˜Ÿæ˜¯å¦æœ‰å……è¶³çš„æµ‹è¯•èµ„æºå’Œæ—¶é—´ï¼Ÿ
  â”œâ”€ å¦ â†’ å»ºè®®ï¼šæš‚ç¼“é˜¶æ®µ3ï¼Œé£é™©è¿‡é«˜
  â””â”€ æ˜¯ â†’ ç»§ç»­é—®é¢˜4

é—®é¢˜4ï¼šæ˜¯å¦èƒ½æ¥å—é©¾é©¶èˆ±å¯åŠ¨å»¶è¿Ÿ0.5-1ç§’ï¼Ÿ
  â”œâ”€ å¦ â†’ ä¸èƒ½æ‰§è¡Œé˜¶æ®µ3
  â””â”€ æ˜¯ â†’ å¯ä»¥è€ƒè™‘æ‰§è¡Œé˜¶æ®µ3
```

### æ”¶ç›Šé£é™©åˆ†æ

| æ–¹é¢ | é˜¶æ®µ3æ‰§è¡Œå‰ | é˜¶æ®µ3æ‰§è¡Œå | å¢ç›Š |
|------|-----------|-----------|------|
| ä¸»åŒ…å¤§å° | 1671 KB | 1121 KB | -550 KB |
| æ‰©å±•ç©ºé—´ | 377 KB (18.4%) | 927 KB (45.3%) | +550 KB |
| é©¾é©¶èˆ±å¯åŠ¨ | ç«‹å³ | 0.5-1ç§’ | å»¶è¿Ÿ |
| ç»´æŠ¤å¤æ‚åº¦ | ä½ | é«˜ | å‡é«˜ |
| æµ‹è¯•å·¥ä½œé‡ | - | å¤§ | å¢åŠ  |
| å›æ»šéš¾åº¦ | - | ä¸­ | å¢åŠ  |

### æ¨èå»ºè®®

âœ… **æ¨èï¼šæš‚ä¸æ‰§è¡Œé˜¶æ®µ3**

**ç†ç”±**ï¼š
1. é˜¶æ®µ2å·²æ»¡è¶³2MBé™åˆ¶ï¼Œç•™æœ‰377KBæ‰©å±•ç©ºé—´
2. NDåˆ é™¤åé©¾é©¶èˆ±å·²ä»720KBé™è‡³550KBï¼Œç›¸å¯¹åˆç†
3. é©¾é©¶èˆ±æ˜¯æ ¸å¿ƒåŠŸèƒ½æ¨¡å—ï¼Œåˆ†åŒ…é£é™©è¾ƒé«˜
4. å¼‚æ­¥åŠ è½½ä¼šå¯¼è‡´å¯åŠ¨å»¶è¿Ÿï¼Œå½±å“ç”¨æˆ·ä½“éªŒ
5. å¯ä»¥ç­‰å¾…æ˜ç¡®çš„æ‰©å±•éœ€æ±‚å†å†³å®š

âš ï¸ **å¦‚æœä»å†³å®šæ‰§è¡Œé˜¶æ®µ3ï¼Œè¯·ç¡®ä¿**ï¼š
- å›¢é˜Ÿæœ‰å……è¶³çš„æµ‹è¯•èµ„æº
- é¢„ç•™5-7å¤©å®Œæ•´çš„å®æ–½å’Œæµ‹è¯•æ—¶é—´
- Android + iOS çœŸæœºæµ‹è¯•è¦†ç›–å…¨é¢
- å‡†å¤‡å¥½å®Œæ•´çš„å›æ»šæ–¹æ¡ˆ

---

## ğŸ“‹ ä¼˜åŒ–æ¦‚è§ˆ

å¦‚æœå†³å®šæ‰§è¡Œé˜¶æ®µ3ï¼Œéœ€è¦å°†é©¾é©¶èˆ±çš„15ä¸ªæ¨¡å—æ–‡ä»¶ä»ä¸»åŒ…è¿ç§»åˆ°åˆ†åŒ…ï¼š

| ä¼˜åŒ–é¡¹ | é¢„æœŸæ”¶ç›Š | é£é™© | éš¾åº¦ | æ‰§è¡Œæ¡ä»¶ |
|-------|---------|------|------|---------|
| 3.1 é©¾é©¶èˆ±æ¨¡å—åˆ†åŒ… | 550KB | é«˜ | é«˜ | æ…é‡è¯„ä¼° |

**å®Œæˆé˜¶æ®µ3åçš„é¢„æœŸæ•ˆæœ**ï¼š
```
ä¼˜åŒ–å‰ä¸»åŒ…ï¼ˆé˜¶æ®µ2åï¼‰ï¼š1671 KB
ä¼˜åŒ–åä¸»åŒ…ï¼š          1121 KB
æ»¡è¶³2MBé™åˆ¶ï¼š         âœ… æ˜¯
å‰©ä½™æ‰©å±•ç©ºé—´ï¼š        927 KB (45.3%)
```

---

## ğŸ“¦ ä¼˜åŒ–é¡¹3.1ï¼šé©¾é©¶èˆ±æ¨¡å—åˆ†åŒ…ï¼ˆ550KBï¼‰

### èƒŒæ™¯è¯´æ˜

é©¾é©¶èˆ±åŒ…å«18ä¸ªæ¨¡å—æ–‡ä»¶ï¼Œåˆ é™¤NDåå‰©ä½™15ä¸ªæ ¸å¿ƒæ¨¡å—ï¼š

**å¯ä»¥ç§»åŠ¨çš„æ¨¡å—**ï¼ˆ15ä¸ªï¼Œçº¦550KBï¼‰ï¼š

æ ¸å¿ƒåŠŸèƒ½æ¨¡å—ï¼š
- `config.js` (40KB) - æ ¸å¿ƒé…ç½®ç®¡ç†
- `flight-calculator.js` (35KB) - é£è¡Œè®¡ç®—
- `gps-manager.js` (30KB) - GPSç®¡ç†
- `compass-manager-simple.js` (25KB) - æŒ‡å—é’ˆç®¡ç†
- `sensor-fusion-core.js` (25KB) - ä¼ æ„Ÿå™¨èåˆæ ¸å¿ƒ
- `attitude-indicator.js` (24KB) - å§¿æ€ä»ªè¡¨
- `gps-spoofing-detector.js` (22KB) - GPSæ¬ºéª—æ£€æµ‹
- `accelerometer-manager.js` (20KB) - åŠ é€Ÿåº¦è®¡ç®¡ç†
- `gyroscope-manager.js` (20KB) - é™€èºä»ªç®¡ç†

å·¥å…·å’Œè¾…åŠ©æ¨¡å—ï¼š
- `logger.js` (18KB) - æ—¥å¿—ç®¡ç†
- `toast-manager.js` (15KB) - æç¤ºç®¡ç†
- `audio-manager.js` (12KB) - éŸ³é¢‘ç®¡ç†
- `lifecycle-manager.js` (10KB) - ç”Ÿå‘½å‘¨æœŸç®¡ç†
- `smart-filter.js` (8KB) - æ™ºèƒ½æ»¤æ³¢ï¼ˆå·²ç¦ç”¨ï¼‰

å…¶ä»–æ¨¡å—ï¼š
- `compass-manager.js` (å¦‚æœå­˜åœ¨)

**å·²åˆ é™¤çš„æ¨¡å—**ï¼ˆé˜¶æ®µ1.1å·²åˆ é™¤ï¼‰ï¼š
- âŒ `airport-manager.js` - NDæ¨¡å—
- âŒ `map-renderer.js` - NDæ¨¡å—
- âŒ `gesture-handler.js` - NDæ¨¡å—

---

### âš ï¸ å…³é”®çº¦æŸå’Œé£é™©

**æ ¸å¿ƒçº¦æŸ**ï¼š
1. ğŸš¨ **ç»å¯¹ä¸èƒ½ç ´åGPSåŠŸèƒ½**ï¼ˆåœ°é€Ÿã€é«˜åº¦ã€åæ ‡ï¼‰
2. ğŸš¨ **ç»å¯¹ä¸èƒ½ç ´åå§¿æ€ä»ªåŠŸèƒ½**ï¼ˆä¿¯ä»°ã€æ»šè½¬ã€æ ¡å‡†ï¼‰
3. ğŸš¨ **ç»å¯¹ä¸èƒ½ç ´åæŒ‡å—é’ˆåŠŸèƒ½**ï¼ˆèˆªå‘æ˜¾ç¤ºï¼‰
4. ğŸš¨ **å¿…é¡»ä¿è¯ä¼ æ„Ÿå™¨èåˆæ­£å¸¸è¿è¡Œ**
5. ğŸš¨ **å¿…é¡»ä¿è¯ç¦»çº¿æ¨¡å¼å®Œå…¨å¯ç”¨**

**ä¸»è¦é£é™©**ï¼š
- âŒ æ¨¡å—ä¹‹é—´å­˜åœ¨å¤æ‚ä¾èµ–å…³ç³»
- âŒ å¼‚æ­¥åŠ è½½é¡ºåºä¸å½“ä¼šå¯¼è‡´åˆå§‹åŒ–å¤±è´¥
- âŒ é©¾é©¶èˆ±å¯åŠ¨æ—¶é—´ä¼šå»¶è¿Ÿ0.5-1ç§’
- âŒ é”™è¯¯å¤„ç†ä¸å½“ä¼šå½±å“æ ¸å¿ƒåŠŸèƒ½
- âŒ ç¦»çº¿æ¨¡å¼ä¸‹åŠ è½½å¤±è´¥ä¼šå¯¼è‡´åŠŸèƒ½ä¸å¯ç”¨

---

### æ­¥éª¤3.1.1ï¼šåˆ›å»ºpackageCockpitåˆ†åŒ…

```powershell
cd D:\FlightToolbox\miniprogram

# åˆ›å»ºåˆ†åŒ…æ ¹ç›®å½•
New-Item -ItemType Directory -Path packageCockpit -Force

# åˆ›å»ºmodulesç›®å½•
New-Item -ItemType Directory -Path packageCockpit\modules -Force

# åˆ›å»ºå ä½é¡µé¢ï¼ˆåˆ†åŒ…å¿…é¡»æœ‰è‡³å°‘ä¸€ä¸ªé¡µé¢ï¼‰
New-Item -ItemType Directory -Path packageCockpit\pages\loader -Force
New-Item -ItemType File -Path packageCockpit\pages\loader\index.wxml
New-Item -ItemType File -Path packageCockpit\pages\loader\index.wxss
New-Item -ItemType File -Path packageCockpit\pages\loader\index.js
New-Item -ItemType File -Path packageCockpit\pages\loader\index.json

# éªŒè¯ç›®å½•ç»“æ„
Get-ChildItem packageCockpit -Recurse -Directory
```

**å ä½é¡µé¢å†…å®¹**ï¼ˆæœ€å°åŒ–å®ç°ï¼‰ï¼š

**index.json**ï¼š
```json
{
  "usingComponents": {}
}
```

**index.wxml**ï¼š
```xml
<view>é©¾é©¶èˆ±æ¨¡å—åŠ è½½ä¸­...</view>
```

**index.wxss**ï¼š
```css
/* ç©ºæ–‡ä»¶ */
```

**index.js**ï¼š
```javascript
Page({
  data: {}
});
```

---

### æ­¥éª¤3.1.2ï¼šç§»åŠ¨æ¨¡å—æ–‡ä»¶

```powershell
cd D:\FlightToolbox\miniprogram

# ç§»åŠ¨15ä¸ªæ¨¡å—æ–‡ä»¶åˆ°packageCockpit
Move-Item pages\cockpit\modules\config.js packageCockpit\modules\
Move-Item pages\cockpit\modules\flight-calculator.js packageCockpit\modules\
Move-Item pages\cockpit\modules\gps-manager.js packageCockpit\modules\
Move-Item pages\cockpit\modules\compass-manager-simple.js packageCockpit\modules\
Move-Item pages\cockpit\modules\sensor-fusion-core.js packageCockpit\modules\
Move-Item pages\cockpit\modules\attitude-indicator.js packageCockpit\modules\
Move-Item pages\cockpit\modules\gps-spoofing-detector.js packageCockpit\modules\
Move-Item pages\cockpit\modules\accelerometer-manager.js packageCockpit\modules\
Move-Item pages\cockpit\modules\gyroscope-manager.js packageCockpit\modules\
Move-Item pages\cockpit\modules\logger.js packageCockpit\modules\
Move-Item pages\cockpit\modules\toast-manager.js packageCockpit\modules\
Move-Item pages\cockpit\modules\audio-manager.js packageCockpit\modules\
Move-Item pages\cockpit\modules\lifecycle-manager.js packageCockpit\modules\
Move-Item pages\cockpit\modules\smart-filter.js packageCockpit\modules\

# å¦‚æœcompass-manager.jså­˜åœ¨ï¼Œä¹Ÿç§»åŠ¨
if (Test-Path pages\cockpit\modules\compass-manager.js) {
    Move-Item pages\cockpit\modules\compass-manager.js packageCockpit\modules\
}

# éªŒè¯ç§»åŠ¨æˆåŠŸ
$oldCount = (Get-ChildItem pages\cockpit\modules -Filter *.js -File -ErrorAction SilentlyContinue).Count
$newCount = (Get-ChildItem packageCockpit\modules -Filter *.js -File).Count

Write-Output "ä¸»åŒ…æ¨¡å—å‰©ä½™: $oldCountï¼ˆåº”è¯¥ä¸º0ï¼‰"
Write-Output "åˆ†åŒ…æ¨¡å—æ•°é‡: $newCountï¼ˆåº”è¯¥ä¸º15ï¼‰"
```

---

### æ­¥éª¤3.1.3ï¼šåˆ†ææ¨¡å—ä¾èµ–å…³ç³»

**ä¾èµ–å…³ç³»å›¾**ï¼š

```
ç¬¬ä¸€å±‚ï¼ˆæ ¸å¿ƒé…ç½®ï¼‰ï¼š
  config.js
    â†“
ç¬¬äºŒå±‚ï¼ˆæ•°æ®ç®¡ç†æ¨¡å—ï¼Œå¯å¹¶è¡ŒåŠ è½½ï¼‰ï¼š
  â”œâ”€ gps-manager.js
  â”œâ”€ compass-manager-simple.js
  â”œâ”€ flight-calculator.js
  â”œâ”€ gps-spoofing-detector.js
  â””â”€ logger.js
    â†“
ç¬¬ä¸‰å±‚ï¼ˆä¼ æ„Ÿå™¨æ¨¡å—ï¼Œä¾èµ–loggerï¼‰ï¼š
  â”œâ”€ accelerometer-manager.js
  â”œâ”€ gyroscope-manager.js
  â””â”€ sensor-fusion-core.js
    â†“
ç¬¬å››å±‚ï¼ˆUIå’Œè¾…åŠ©æ¨¡å—ï¼Œä¾èµ–æ ¸å¿ƒæ¨¡å—ï¼‰ï¼š
  â”œâ”€ attitude-indicator.jsï¼ˆä¾èµ–sensor-fusion-coreï¼‰
  â”œâ”€ toast-manager.jsï¼ˆç‹¬ç«‹ï¼‰
  â”œâ”€ audio-manager.jsï¼ˆç‹¬ç«‹ï¼‰
  â””â”€ lifecycle-manager.jsï¼ˆç‹¬ç«‹ï¼‰
```

**åŠ è½½é¡ºåºè§„åˆ™**ï¼š
1. **ç¬¬ä¸€æ­¥**ï¼šåŠ è½½ `config.js`ï¼Œè·å–æ‰€æœ‰é…ç½®
2. **ç¬¬äºŒæ­¥**ï¼šå¹¶è¡ŒåŠ è½½ç¬¬äºŒå±‚æ¨¡å—ï¼ˆGPSã€æŒ‡å—é’ˆã€é£è¡Œè®¡ç®—ç­‰ï¼‰
3. **ç¬¬ä¸‰æ­¥**ï¼šå¹¶è¡ŒåŠ è½½ç¬¬ä¸‰å±‚æ¨¡å—ï¼ˆä¼ æ„Ÿå™¨èåˆç›¸å…³ï¼‰
4. **ç¬¬å››æ­¥**ï¼šå¹¶è¡ŒåŠ è½½ç¬¬å››å±‚æ¨¡å—ï¼ˆUIæ¨¡å—ï¼‰

---

### æ­¥éª¤3.1.4ï¼šæ›´æ–°app.jsoné…ç½®

**æ–‡ä»¶**: `miniprogram/app.json`

#### 4.1 æ·»åŠ åˆ°subPackages

```json
{
  "subPackages": [
    {
      "root": "packageCockpit",
      "name": "cockpitModulesPackage",
      "pages": [
        "pages/loader/index"
      ]
    }
    // ... å…¶ä»–å·²æœ‰åˆ†åŒ…
  ]
}
```

#### 4.2 é…ç½®é¢„åŠ è½½è§„åˆ™

```json
{
  "preloadRule": {
    "pages/cockpit/index": {
      "network": "all",
      "packages": [
        "cockpitModulesPackage",
        "packageC"  // æœºåœºæ•°æ®åˆ†åŒ…ï¼ˆå¦‚æœé©¾é©¶èˆ±éœ€è¦ï¼‰
      ]
    }
  }
}
```

**è¯´æ˜**ï¼š
- åœ¨é©¾é©¶èˆ±TabBaré¡µé¢é¢„åŠ è½½æ¨¡å—åˆ†åŒ…
- ç¡®ä¿é¦–æ¬¡è¿›å…¥æ—¶æ¨¡å—å·²ç¼“å­˜
- ç¦»çº¿æ¨¡å¼ä¸‹ä»ç„¶å¯ç”¨

---

### æ­¥éª¤3.1.5ï¼šæ”¹é€ é©¾é©¶èˆ±é¡µé¢çš„æ¨¡å—åŠ è½½é€»è¾‘

**æ–‡ä»¶**: `miniprogram/pages/cockpit/index.js`

è¿™æ˜¯**æœ€å…³é”®çš„ä¸€æ­¥**ï¼Œéœ€è¦å°†åŒæ­¥åŠ è½½æ”¹ä¸ºå¼‚æ­¥åŠ è½½ã€‚

#### 5.1 åˆ é™¤æ—§çš„åŒæ­¥require

```javascript
// âŒ åˆ é™¤æ‰€æœ‰æ—§çš„åŒæ­¥require
// var Config = require('./modules/config.js');
// var FlightCalculator = require('./modules/flight-calculator.js');
// var GPSManager = require('./modules/gps-manager.js');
// ... åˆ é™¤æ‰€æœ‰æ¨¡å—çš„åŒæ­¥require
```

#### 5.2 å®ç°å¼‚æ­¥æ¨¡å—åŠ è½½å™¨

åœ¨é¡µé¢é¡¶éƒ¨æ·»åŠ æ¨¡å—åŠ è½½å™¨ï¼š

```javascript
/**
 * é©¾é©¶èˆ±é¡µé¢ - å¼‚æ­¥æ¨¡å—åŠ è½½ç‰ˆæœ¬
 */
var BasePage = require('../../utils/base-page.js');

// æ¨¡å—åŠ è½½å™¨
var ModuleLoader = {
  /**
   * åŠ è½½æ‰€æœ‰é©¾é©¶èˆ±æ¨¡å—
   */
  loadAllModules: function(successCallback, failCallback) {
    var self = this;
    var modules = {};

    // ç¬¬ä¸€æ­¥ï¼šåŠ è½½æ ¸å¿ƒé…ç½®
    self.loadConfig(function(config) {
      modules.config = config;

      // ç¬¬äºŒæ­¥ï¼šå¹¶è¡ŒåŠ è½½æ•°æ®ç®¡ç†æ¨¡å—
      self.loadDataModules(config, function(dataModules) {
        Object.assign(modules, dataModules);

        // ç¬¬ä¸‰æ­¥ï¼šå¹¶è¡ŒåŠ è½½ä¼ æ„Ÿå™¨æ¨¡å—
        self.loadSensorModules(config, function(sensorModules) {
          Object.assign(modules, sensorModules);

          // ç¬¬å››æ­¥ï¼šå¹¶è¡ŒåŠ è½½UIæ¨¡å—
          self.loadUIModules(config, function(uiModules) {
            Object.assign(modules, uiModules);

            // æ‰€æœ‰æ¨¡å—åŠ è½½å®Œæˆ
            console.log('âœ… é©¾é©¶èˆ±æ‰€æœ‰æ¨¡å—åŠ è½½å®Œæˆ', Object.keys(modules));
            successCallback && successCallback(modules);
          }, failCallback);
        }, failCallback);
      }, failCallback);
    }, failCallback);
  },

  /**
   * ç¬¬ä¸€æ­¥ï¼šåŠ è½½æ ¸å¿ƒé…ç½®
   */
  loadConfig: function(successCallback, failCallback) {
    require('../../packageCockpit/modules/config.js', function(Config) {
      console.log('âœ… é…ç½®æ¨¡å—åŠ è½½æˆåŠŸ');
      successCallback && successCallback(Config);
    }, function(error) {
      console.error('âŒ é…ç½®æ¨¡å—åŠ è½½å¤±è´¥:', error);
      failCallback && failCallback(error);
    });
  },

  /**
   * ç¬¬äºŒæ­¥ï¼šå¹¶è¡ŒåŠ è½½æ•°æ®ç®¡ç†æ¨¡å—
   */
  loadDataModules: function(config, successCallback, failCallback) {
    var modulePaths = {
      gpsManager: '../../packageCockpit/modules/gps-manager.js',
      compassManager: '../../packageCockpit/modules/compass-manager-simple.js',
      flightCalculator: '../../packageCockpit/modules/flight-calculator.js',
      gpsSpoofingDetector: '../../packageCockpit/modules/gps-spoofing-detector.js',
      logger: '../../packageCockpit/modules/logger.js'
    };

    this.loadModulesInParallel(modulePaths, successCallback, failCallback);
  },

  /**
   * ç¬¬ä¸‰æ­¥ï¼šå¹¶è¡ŒåŠ è½½ä¼ æ„Ÿå™¨æ¨¡å—
   */
  loadSensorModules: function(config, successCallback, failCallback) {
    var modulePaths = {
      accelerometerManager: '../../packageCockpit/modules/accelerometer-manager.js',
      gyroscopeManager: '../../packageCockpit/modules/gyroscope-manager.js',
      sensorFusionCore: '../../packageCockpit/modules/sensor-fusion-core.js',
      smartFilter: '../../packageCockpit/modules/smart-filter.js'
    };

    this.loadModulesInParallel(modulePaths, successCallback, failCallback);
  },

  /**
   * ç¬¬å››æ­¥ï¼šå¹¶è¡ŒåŠ è½½UIæ¨¡å—
   */
  loadUIModules: function(config, successCallback, failCallback) {
    var modulePaths = {
      attitudeIndicator: '../../packageCockpit/modules/attitude-indicator.js',
      toastManager: '../../packageCockpit/modules/toast-manager.js',
      audioManager: '../../packageCockpit/modules/audio-manager.js',
      lifecycleManager: '../../packageCockpit/modules/lifecycle-manager.js'
    };

    this.loadModulesInParallel(modulePaths, successCallback, failCallback);
  },

  /**
   * å¹¶è¡ŒåŠ è½½å¤šä¸ªæ¨¡å—
   */
  loadModulesInParallel: function(modulePaths, successCallback, failCallback) {
    var modules = {};
    var moduleNames = Object.keys(modulePaths);
    var loadedCount = 0;
    var hasError = false;

    moduleNames.forEach(function(moduleName) {
      var modulePath = modulePaths[moduleName];

      require(modulePath, function(module) {
        if (hasError) return;

        modules[moduleName] = module;
        loadedCount++;

        console.log('âœ… æ¨¡å—åŠ è½½æˆåŠŸ:', moduleName, '(' + loadedCount + '/' + moduleNames.length + ')');

        if (loadedCount === moduleNames.length) {
          successCallback && successCallback(modules);
        }
      }, function(error) {
        if (hasError) return;
        hasError = true;

        console.error('âŒ æ¨¡å—åŠ è½½å¤±è´¥:', moduleName, error);
        failCallback && failCallback(error);
      });
    });
  }
};
```

#### 5.3 æ›´æ–°é¡µé¢é…ç½®å¯¹è±¡

```javascript
var pageConfig = {
  data: {
    modulesLoaded: false,
    gpsData: {
      latitude: 0,
      longitude: 0,
      altitude: 0,
      speed: 0
    },
    heading: 0,
    pitch: 0,
    roll: 0
  },

  customOnLoad: function(options) {
    var self = this;

    // æ˜¾ç¤ºåŠ è½½æç¤º
    wx.showLoading({
      title: 'æ­£åœ¨åˆå§‹åŒ–é©¾é©¶èˆ±...',
      mask: true
    });

    // è®°å½•å¼€å§‹æ—¶é—´ï¼ˆæ€§èƒ½ç›‘æ§ï¼‰
    var startTime = Date.now();

    // åŠ è½½æ‰€æœ‰æ¨¡å—
    ModuleLoader.loadAllModules(function(modules) {
      // è®°å½•åŠ è½½æ—¶é—´
      var loadTime = Date.now() - startTime;
      console.log('âœ… æ¨¡å—åŠ è½½è€—æ—¶:', loadTime + 'ms');

      // éšè—åŠ è½½æç¤º
      wx.hideLoading();

      // ä¿å­˜æ¨¡å—å¼•ç”¨
      self.modules = modules;

      // åˆå§‹åŒ–é©¾é©¶èˆ±
      self.initCockpit(modules);

      // æ ‡è®°æ¨¡å—å·²åŠ è½½
      self.setData({ modulesLoaded: true });
    }, function(error) {
      // éšè—åŠ è½½æç¤º
      wx.hideLoading();

      // æ˜¾ç¤ºé”™è¯¯æç¤º
      self.handleError(error, 'é©¾é©¶èˆ±åˆå§‹åŒ–å¤±è´¥');

      // å¦‚æœæ˜¯ç¦»çº¿æ¨¡å¼åŠ è½½å¤±è´¥ï¼Œæä¾›é‡è¯•æŒ‰é’®
      wx.showModal({
        title: 'æ¨¡å—åŠ è½½å¤±è´¥',
        content: 'é©¾é©¶èˆ±æ¨¡å—åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–é‡è¯•',
        confirmText: 'é‡è¯•',
        success: function(res) {
          if (res.confirm) {
            // é‡æ–°åŠ è½½é¡µé¢
            wx.reLaunch({ url: '/pages/cockpit/index' });
          }
        }
      });
    });
  },

  /**
   * åˆå§‹åŒ–é©¾é©¶èˆ±ï¼ˆæ¨¡å—åŠ è½½å®Œæˆåè°ƒç”¨ï¼‰
   */
  initCockpit: function(modules) {
    var self = this;

    // ä½¿ç”¨åŠ è½½çš„æ¨¡å—åˆå§‹åŒ–å„åŠŸèƒ½
    this.config = modules.config;
    this.gpsManager = modules.gpsManager;
    this.compassManager = modules.compassManager;
    this.sensorFusionCore = modules.sensorFusionCore;
    this.attitudeIndicator = modules.attitudeIndicator;
    // ... å…¶ä»–æ¨¡å—

    // åˆå§‹åŒ–GPS
    this.initGPS();

    // åˆå§‹åŒ–æŒ‡å—é’ˆ
    this.initCompass();

    // åˆå§‹åŒ–å§¿æ€ä»ª
    this.initAttitudeIndicator();

    console.log('âœ… é©¾é©¶èˆ±åˆå§‹åŒ–å®Œæˆ');
  },

  /**
   * åˆå§‹åŒ–GPSï¼ˆä½¿ç”¨gpsManageræ¨¡å—ï¼‰
   */
  initGPS: function() {
    var self = this;

    // ä½¿ç”¨gpsManageråˆå§‹åŒ–GPS
    this.gpsManager.init({
      onUpdate: function(gpsData) {
        self.setData({ gpsData: gpsData });
      },
      onError: function(error) {
        console.error('GPSé”™è¯¯:', error);
      }
    });
  },

  /**
   * åˆå§‹åŒ–æŒ‡å—é’ˆï¼ˆä½¿ç”¨compassManageræ¨¡å—ï¼‰
   */
  initCompass: function() {
    var self = this;

    this.compassManager.init({
      onUpdate: function(heading) {
        self.setData({ heading: heading });
      },
      onError: function(error) {
        console.error('æŒ‡å—é’ˆé”™è¯¯:', error);
      }
    });
  },

  /**
   * åˆå§‹åŒ–å§¿æ€ä»ªï¼ˆä½¿ç”¨attitudeIndicatoræ¨¡å—ï¼‰
   */
  initAttitudeIndicator: function() {
    var self = this;

    this.attitudeIndicator.init({
      canvasId: 'attitudeCanvas',
      onUpdate: function(attitude) {
        self.setData({
          pitch: attitude.pitch,
          roll: attitude.roll
        });
      },
      onError: function(error) {
        console.error('å§¿æ€ä»ªé”™è¯¯:', error);
      }
    });
  },

  customOnUnload: function() {
    // é¡µé¢å¸è½½æ—¶æ¸…ç†èµ„æº
    if (this.gpsManager) {
      this.gpsManager.destroy();
    }
    if (this.compassManager) {
      this.compassManager.destroy();
    }
    if (this.attitudeIndicator) {
      this.attitudeIndicator.destroy();
    }
  }
};

Page(BasePage.createPage(pageConfig));
```

---

### æ­¥éª¤3.1.6ï¼šæ·»åŠ åŠ è½½çŠ¶æ€UI

**æ–‡ä»¶**: `miniprogram/pages/cockpit/index.wxml`

åœ¨é¡µé¢é¡¶éƒ¨æ·»åŠ åŠ è½½çŠ¶æ€æ˜¾ç¤ºï¼š

```xml
<!-- æ¨¡å—åŠ è½½ä¸­æç¤º -->
<view class="loading-overlay" wx:if="{{!modulesLoaded}}">
  <view class="loading-content">
    <view class="loading-icon">
      <van-loading size="48rpx" color="#1989fa" />
    </view>
    <text class="loading-text">æ­£åœ¨åˆå§‹åŒ–é©¾é©¶èˆ±...</text>
  </view>
</view>

<!-- é©¾é©¶èˆ±ä¸»è¦å†…å®¹ï¼ˆæ¨¡å—åŠ è½½åæ˜¾ç¤ºï¼‰ -->
<view class="cockpit-container" wx:if="{{modulesLoaded}}">
  <!-- GPSä¿¡æ¯æ˜¾ç¤º -->
  <view class="gps-info">
    <!-- ... GPSæ˜¾ç¤ºå†…å®¹ -->
  </view>

  <!-- æŒ‡å—é’ˆæ˜¾ç¤º -->
  <view class="compass-container">
    <!-- ... æŒ‡å—é’ˆCanvas -->
  </view>

  <!-- å§¿æ€ä»ªæ˜¾ç¤º -->
  <view class="attitude-indicator">
    <!-- ... å§¿æ€ä»ªCanvas -->
  </view>
</view>
```

**æ–‡ä»¶**: `miniprogram/pages/cockpit/index.wxss`

æ·»åŠ åŠ è½½çŠ¶æ€æ ·å¼ï¼š

```css
/* åŠ è½½é®ç½©å±‚ */
.loading-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
}

.loading-content {
  background: #fff;
  border-radius: 20rpx;
  padding: 60rpx 80rpx;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 30rpx;
}

.loading-text {
  font-size: 28rpx;
  color: #333;
}
```

---

### æ­¥éª¤3.1.7ï¼šæ€§èƒ½ä¼˜åŒ–å’Œé”™è¯¯å¤„ç†

#### 7.1 æ·»åŠ æ¨¡å—ç¼“å­˜æœºåˆ¶

åˆ›å»ºæ¨¡å—ç¼“å­˜ç®¡ç†å™¨ï¼š

**æ–°å»ºæ–‡ä»¶**: `miniprogram/utils/module-cache.js`

```javascript
/**
 * æ¨¡å—ç¼“å­˜ç®¡ç†å™¨
 * ç¼“å­˜å·²åŠ è½½çš„æ¨¡å—ï¼Œé¿å…é‡å¤åŠ è½½
 */

var moduleCache = {};

module.exports = {
  /**
   * è·å–ç¼“å­˜çš„æ¨¡å—
   */
  get: function(moduleName) {
    return moduleCache[moduleName];
  },

  /**
   * è®¾ç½®æ¨¡å—ç¼“å­˜
   */
  set: function(moduleName, module) {
    moduleCache[moduleName] = module;
    console.log('ğŸ“¦ æ¨¡å—å·²ç¼“å­˜:', moduleName);
  },

  /**
   * æ£€æŸ¥æ¨¡å—æ˜¯å¦å·²ç¼“å­˜
   */
  has: function(moduleName) {
    return !!moduleCache[moduleName];
  },

  /**
   * æ¸…é™¤æ‰€æœ‰ç¼“å­˜
   */
  clear: function() {
    moduleCache = {};
    console.log('ğŸ—‘ï¸ æ¨¡å—ç¼“å­˜å·²æ¸…é™¤');
  }
};
```

#### 7.2 æ›´æ–°æ¨¡å—åŠ è½½å™¨ä½¿ç”¨ç¼“å­˜

åœ¨ `ModuleLoader` ä¸­æ·»åŠ ç¼“å­˜æ£€æŸ¥ï¼š

```javascript
var moduleCache = require('../../utils/module-cache.js');

var ModuleLoader = {
  loadAllModules: function(successCallback, failCallback) {
    // æ£€æŸ¥æ˜¯å¦å·²æœ‰å®Œæ•´ç¼“å­˜
    if (moduleCache.has('__all_modules__')) {
      console.log('âœ… ä½¿ç”¨ç¼“å­˜çš„æ¨¡å—');
      var cachedModules = moduleCache.get('__all_modules__');
      successCallback && successCallback(cachedModules);
      return;
    }

    // ... åŸæœ‰çš„åŠ è½½é€»è¾‘

    // åŠ è½½å®Œæˆåç¼“å­˜
    successCallback && successCallback(modules);
    moduleCache.set('__all_modules__', modules);
  }
};
```

#### 7.3 æ·»åŠ é‡è¯•æœºåˆ¶

```javascript
var ModuleLoader = {
  loadAllModules: function(successCallback, failCallback, retryCount) {
    retryCount = retryCount || 0;
    var maxRetries = 3;

    // ... åŠ è½½é€»è¾‘

    // å¤±è´¥æ—¶é‡è¯•
    failCallback && failCallback(error);

    if (retryCount < maxRetries) {
      console.log('âš ï¸ æ¨¡å—åŠ è½½å¤±è´¥ï¼Œé‡è¯•ä¸­...', retryCount + 1);
      setTimeout(function() {
        this.loadAllModules(successCallback, failCallback, retryCount + 1);
      }.bind(this), 1000);
    } else {
      console.error('âŒ æ¨¡å—åŠ è½½å¤±è´¥ï¼Œå·²è¾¾æœ€å¤§é‡è¯•æ¬¡æ•°');
    }
  }
};
```

---

### æ­¥éª¤3.1.8ï¼šéªŒè¯é©¾é©¶èˆ±åˆ†åŒ…

#### 8.1 ç¼–è¯‘æµ‹è¯•

åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­ï¼š
1. ç‚¹å‡»"ç¼–è¯‘"æŒ‰é’®
2. æ£€æŸ¥æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯
3. æ£€æŸ¥"è¯¦æƒ…" â†’ "ä»£ç å¤§å°åˆ†æ"

é¢„æœŸç»“æœï¼š
- âœ… ç¼–è¯‘æˆåŠŸï¼Œæ— é”™è¯¯
- âœ… ä¸»åŒ…å¤§å°å‡å°‘çº¦550KB
- âœ… æ–°å¢åˆ†åŒ…ï¼šcockpitModulesPackage

#### 8.2 åŠŸèƒ½æµ‹è¯•ï¼ˆæœ€å…³é”®ï¼‰

**GPSåŠŸèƒ½æµ‹è¯•**ï¼š
```
âœ… GPSåœ°é€Ÿæ­£å¸¸æ˜¾ç¤ºï¼ˆæ•´æ•°ï¼Œæ— å¹³æ»‘ï¼‰
âœ… GPSé«˜åº¦æ­£å¸¸æ˜¾ç¤ºï¼ˆè‹±å°ºï¼Œæ— å¹³æ»‘ï¼‰
âœ… GPSåæ ‡æ­£å¸¸æ˜¾ç¤º
âœ… GPSæ•°æ®å®æ—¶æ›´æ–°ï¼ˆæ¯ç§’ï¼‰
âœ… GPSæ¬ºéª—æ£€æµ‹æ­£å¸¸å·¥ä½œ
```

**æŒ‡å—é’ˆåŠŸèƒ½æµ‹è¯•**ï¼š
```
âœ… æŒ‡å—é’ˆèˆªå‘æ­£å¸¸æ˜¾ç¤º
âœ… æŒ‡å—é’ˆå®æ—¶å“åº”è®¾å¤‡æ—‹è½¬
âœ… èˆªå‘è§’åº¦å‡†ç¡®
```

**å§¿æ€ä»ªåŠŸèƒ½æµ‹è¯•**ï¼š
```
âœ… ä¿¯ä»°è§’æ­£å¸¸æ˜¾ç¤º
âœ… æ»šè½¬è§’æ­£å¸¸æ˜¾ç¤º
âœ… å§¿æ€ä»ªå®æ—¶å“åº”è®¾å¤‡å€¾æ–œ
âœ… æ ¡å‡†åŠŸèƒ½æ­£å¸¸å·¥ä½œ
âœ… Canvasæ¸²æŸ“æ­£å¸¸
```

**ä¼ æ„Ÿå™¨èåˆæµ‹è¯•**ï¼š
```
âœ… åŠ é€Ÿåº¦è®¡æ•°æ®æ­£å¸¸
âœ… é™€èºä»ªæ•°æ®æ­£å¸¸
âœ… ä¼ æ„Ÿå™¨èåˆç®—æ³•æ­£å¸¸è¿è¡Œ
âœ… æ•°æ®èåˆæ— å»¶è¿Ÿ
```

#### 8.3 æ€§èƒ½æµ‹è¯•

**å¯åŠ¨æ—¶é—´æµ‹è¯•**ï¼š

åœ¨ `customOnLoad` ä¸­æ·»åŠ æ€§èƒ½ç›‘æ§ï¼š

```javascript
customOnLoad: function(options) {
  var startTime = Date.now();

  ModuleLoader.loadAllModules(function(modules) {
    var loadTime = Date.now() - startTime;
    console.log('â±ï¸ æ¨¡å—åŠ è½½è€—æ—¶:', loadTime + 'ms');

    // âš ï¸ éªŒè¯ï¼šåº”è¯¥ < 1000msï¼ˆ1ç§’ï¼‰
    if (loadTime > 1000) {
      console.warn('âš ï¸ æ¨¡å—åŠ è½½è¶…æ—¶:', loadTime + 'ms');
    } else {
      console.log('âœ… æ¨¡å—åŠ è½½æ€§èƒ½è‰¯å¥½');
    }

    // ... åˆå§‹åŒ–é©¾é©¶èˆ±
  }, function(error) {
    // ... é”™è¯¯å¤„ç†
  });
},
```

**æ€§èƒ½æ ‡å‡†**ï¼š
- âœ… é¦–æ¬¡åŠ è½½ï¼š< 1ç§’
- âœ… äºŒæ¬¡åŠ è½½ï¼ˆæœ‰ç¼“å­˜ï¼‰ï¼š< 200ms
- âœ… GPSæ›´æ–°é¢‘ç‡ï¼šâ‰¥ 1Hz
- âœ… å§¿æ€ä»ªæ›´æ–°é¢‘ç‡ï¼šâ‰¥ 30Hz

#### 8.4 ç¦»çº¿æµ‹è¯•

```powershell
# 1. åœ¨çº¿æ¨¡å¼é¦–æ¬¡è¿›å…¥é©¾é©¶èˆ±ï¼ˆé¢„åŠ è½½åˆ†åŒ…ï¼‰
# 2. é€€å‡ºå°ç¨‹åº
# 3. å¼€å¯é£è¡Œæ¨¡å¼
# 4. é‡æ–°è¿›å…¥å°ç¨‹åº
# 5. è¿›å…¥é©¾é©¶èˆ±é¡µé¢
```

**éªŒè¯æ¸…å•**ï¼š
```
âœ… ç¦»çº¿æ¨¡å¼ä¸‹é©¾é©¶èˆ±èƒ½æ­£å¸¸æ‰“å¼€
âœ… æ¨¡å—åŠ è½½æˆåŠŸï¼ˆä½¿ç”¨ç¼“å­˜ï¼‰
âœ… GPSåŠŸèƒ½æ­£å¸¸ï¼ˆä½¿ç”¨è®¾å¤‡å®šä½ï¼‰
âœ… æŒ‡å—é’ˆåŠŸèƒ½æ­£å¸¸
âœ… å§¿æ€ä»ªåŠŸèƒ½æ­£å¸¸
âœ… æ²¡æœ‰ç½‘ç»œè¯·æ±‚é”™è¯¯
âœ… å¯åŠ¨æ—¶é—´ < 1ç§’
```

#### 8.5 çœŸæœºæµ‹è¯•ï¼ˆæœ€é‡è¦ï¼‰

**AndroidçœŸæœºæµ‹è¯•**ï¼š

æµ‹è¯•è®¾å¤‡ï¼šåä¸ºã€å°ç±³ã€OPPOã€vivo

```
æµ‹è¯•æµç¨‹ï¼š
1. çœŸæœºè°ƒè¯•è¿æ¥
2. é¦–æ¬¡è¿›å…¥é©¾é©¶èˆ±
   - è®°å½•åŠ è½½æ—¶é—´
   - éªŒè¯æ‰€æœ‰åŠŸèƒ½æ­£å¸¸
3. é€€å‡ºå¹¶é‡æ–°è¿›å…¥
   - éªŒè¯ç¼“å­˜æœºåˆ¶å·¥ä½œ
   - éªŒè¯åŠ è½½æ—¶é—´æ›´çŸ­
4. å¼€å¯é£è¡Œæ¨¡å¼
   - éªŒè¯ç¦»çº¿æ¨¡å¼æ‰€æœ‰åŠŸèƒ½æ­£å¸¸
5. é•¿æ—¶é—´è¿è¡Œæµ‹è¯•ï¼ˆ30åˆ†é’Ÿï¼‰
   - éªŒè¯GPSæŒç»­æ›´æ–°
   - éªŒè¯å§¿æ€ä»ªæŒç»­æ›´æ–°
   - éªŒè¯æ— å†…å­˜æ³„æ¼
```

**iOSçœŸæœºæµ‹è¯•**ï¼š

æµ‹è¯•è®¾å¤‡ï¼šiPhone 11åŠä»¥ä¸Šï¼ŒiOS 14åŠä»¥ä¸Š

```
æµ‹è¯•æµç¨‹ï¼š
1. çœŸæœºè°ƒè¯•è¿æ¥
2. é‡å¤Androidæµ‹è¯•æµç¨‹
3. ç‰¹åˆ«æ³¨æ„iOSä¼ æ„Ÿå™¨å…¼å®¹æ€§
4. éªŒè¯iOSéŸ³é¢‘å…¼å®¹æ€§ï¼ˆå¦‚æœ‰éŸ³é¢‘æç¤ºï¼‰
```

**éªŒè¯é€šè¿‡æ ‡å‡†**ï¼š
- âœ… Androidæ‰€æœ‰è®¾å¤‡åŠŸèƒ½æ­£å¸¸
- âœ… iOSæ‰€æœ‰è®¾å¤‡åŠŸèƒ½æ­£å¸¸
- âœ… å¯åŠ¨æ—¶é—´ç¬¦åˆé¢„æœŸ
- âœ… GPSã€æŒ‡å—é’ˆã€å§¿æ€ä»ªå®Œå…¨æ­£å¸¸
- âœ… ç¦»çº¿æ¨¡å¼å®Œå…¨å¯ç”¨
- âœ… æ— å´©æºƒã€æ— å¡é¡¿
- âœ… é•¿æ—¶é—´è¿è¡Œç¨³å®š

---

### æ­¥éª¤3.1.9ï¼šæäº¤Gitè®°å½•

```powershell
cd D:\FlightToolbox

git add miniprogram/packageCockpit/
git add miniprogram/pages/cockpit/
git add miniprogram/app.json
git add miniprogram/utils/module-cache.js

git commit -m "é˜¶æ®µ3.1: é©¾é©¶èˆ±æ¨¡å—åˆ†åŒ…ï¼ˆ550KBï¼‰

åˆ›å»ºåˆ†åŒ…ï¼š
- æ–°å¢ packageCockpit åˆ†åŒ…
- åˆ†åŒ…åç§°: cockpitModulesPackage

è¿ç§»å†…å®¹ï¼š
- ç§»åŠ¨ 15 ä¸ªæ ¸å¿ƒæ¨¡å—ï¼ˆçº¦550KBï¼‰
  - config.js, gps-manager.js, compass-manager-simple.js
  - sensor-fusion-core.js, attitude-indicator.js
  - gps-spoofing-detector.js, accelerometer-manager.js
  - gyroscope-manager.js, logger.js, toast-manager.js
  - audio-manager.js, lifecycle-manager.js, smart-filter.js
  - flight-calculator.js
  - åŠå…¶ä»–æ¨¡å—

æ ¸å¿ƒæ”¹é€ ï¼š
- å®ç°å¼‚æ­¥æ¨¡å—åŠ è½½å™¨ï¼ˆ4å±‚åŠ è½½é¡ºåºï¼‰
- å®ç°æ¨¡å—ç¼“å­˜æœºåˆ¶ï¼ˆé¿å…é‡å¤åŠ è½½ï¼‰
- å®ç°é‡è¯•æœºåˆ¶ï¼ˆæœ€å¤š3æ¬¡ï¼‰
- æ·»åŠ åŠ è½½çŠ¶æ€UI
- ä¼˜åŒ–é”™è¯¯å¤„ç†

æ€§èƒ½ä¼˜åŒ–ï¼š
- é¦–æ¬¡åŠ è½½: XXX msï¼ˆå¡«å†™å®é™…å€¼ï¼‰
- äºŒæ¬¡åŠ è½½: XXX msï¼ˆå¡«å†™å®é™…å€¼ï¼‰
- ç¬¦åˆ1ç§’å¯åŠ¨è¦æ±‚: âœ…/âŒ

åŠŸèƒ½éªŒè¯ï¼š
- GPSåŠŸèƒ½: âœ… å®Œå…¨æ­£å¸¸
- æŒ‡å—é’ˆåŠŸèƒ½: âœ… å®Œå…¨æ­£å¸¸
- å§¿æ€ä»ªåŠŸèƒ½: âœ… å®Œå…¨æ­£å¸¸
- ä¼ æ„Ÿå™¨èåˆ: âœ… å®Œå…¨æ­£å¸¸
- ç¦»çº¿æ¨¡å¼: âœ… å®Œå…¨æ­£å¸¸

çœŸæœºæµ‹è¯•ï¼š
- AndroidçœŸæœº: âœ… é€šè¿‡ï¼ˆåä¸ºã€å°ç±³ã€OPPOã€vivoï¼‰
- iOSçœŸæœº: âœ… é€šè¿‡ï¼ˆiPhone 11+, iOS 14+ï¼‰
- æ€§èƒ½æµ‹è¯•: âœ… é€šè¿‡
- é•¿æ—¶é—´è¿è¡Œ: âœ… é€šè¿‡ï¼ˆ30åˆ†é’Ÿæ— é—®é¢˜ï¼‰"
```

---

## âœ… é˜¶æ®µ3æ€»ç»“éªŒè¯

å®Œæˆé©¾é©¶èˆ±åˆ†åŒ…åï¼Œè¿›è¡Œæœ€ç»ˆéªŒè¯ï¼š

### 1. ä¸»åŒ…å¤§å°éªŒè¯

```powershell
cd D:\FlightToolbox
.\åˆ†åŒ…æ–¹æ¡ˆ\monitor-main-package-size.ps1

# é¢„æœŸç»“æœï¼š
# é˜¶æ®µ2åï¼š1671 KB
# é˜¶æ®µ3åï¼š1121 KBï¼ˆèŠ‚çœ550KBï¼‰
# å‰©ä½™æ‰©å±•ç©ºé—´ï¼š927 KB (45.3%)
```

### 2. åŠŸèƒ½å®Œæ•´æ€§éªŒè¯

```
é©¾é©¶èˆ±æ ¸å¿ƒåŠŸèƒ½ï¼š
âœ… GPSåœ°é€Ÿã€é«˜åº¦ã€åæ ‡æ­£å¸¸æ˜¾ç¤ºï¼ˆåŸå§‹æ•°æ®ï¼Œæ— å¹³æ»‘ï¼‰
âœ… æŒ‡å—é’ˆèˆªå‘æ­£å¸¸å·¥ä½œ
âœ… å§¿æ€ä»ªä¿¯ä»°ã€æ»šè½¬æ­£å¸¸
âœ… å§¿æ€ä»ªæ ¡å‡†åŠŸèƒ½æ­£å¸¸
âœ… ä¼ æ„Ÿå™¨èåˆæ­£å¸¸è¿è¡Œ
âœ… GPSæ¬ºéª—æ£€æµ‹æ­£å¸¸
âœ… æ‰€æœ‰Canvasæ¸²æŸ“æ­£å¸¸

å…¶ä»–åŠŸèƒ½ï¼š
âœ… é€šä¿¡å¤±æ•ˆæ¨¡å—æ­£å¸¸
âœ… èˆªçº¿å½•éŸ³æ¨¡å—æ­£å¸¸
âœ… æ‰€æœ‰TabBarå¯¼èˆªæ­£å¸¸
âœ… æ‰€æœ‰é¡µé¢æ ·å¼æ­£å¸¸
```

### 3. æ€§èƒ½éªŒè¯

```
å¯åŠ¨æ€§èƒ½ï¼š
âœ… é©¾é©¶èˆ±é¦–æ¬¡å¯åŠ¨ < 1ç§’
âœ… é©¾é©¶èˆ±äºŒæ¬¡å¯åŠ¨ < 200ms
âœ… å…¶ä»–é¡µé¢å¯åŠ¨æ— å»¶è¿Ÿ

è¿è¡Œæ€§èƒ½ï¼š
âœ… GPSæ›´æ–°é¢‘ç‡ â‰¥ 1Hz
âœ… å§¿æ€ä»ªæ›´æ–°é¢‘ç‡ â‰¥ 30Hz
âœ… Canvasæ¸²æŸ“æµç•…ï¼Œæ— å¡é¡¿
âœ… å†…å­˜å ç”¨æ­£å¸¸ï¼Œæ— æ³„æ¼
```

### 4. ç¦»çº¿æ¨¡å¼éªŒè¯

```
ç¦»çº¿æµ‹è¯•ï¼š
âœ… å¼€å¯é£è¡Œæ¨¡å¼
âœ… é‡å¯å°ç¨‹åº
âœ… è®¿é—®é©¾é©¶èˆ± - æ¨¡å—æ­£å¸¸åŠ è½½
âœ… GPSåŠŸèƒ½æ­£å¸¸ï¼ˆä½¿ç”¨è®¾å¤‡å®šä½ï¼‰
âœ… æŒ‡å—é’ˆåŠŸèƒ½æ­£å¸¸
âœ… å§¿æ€ä»ªåŠŸèƒ½æ­£å¸¸
âœ… æ‰€æœ‰å…¶ä»–åŠŸèƒ½æ­£å¸¸
âœ… æ— ç½‘ç»œè¯·æ±‚é”™è¯¯
```

### 5. çœŸæœºé•¿æœŸè¿è¡Œæµ‹è¯•

```
é•¿æœŸè¿è¡Œæµ‹è¯•ï¼ˆ30åˆ†é’Ÿä»¥ä¸Šï¼‰ï¼š
âœ… Androidè®¾å¤‡ - ç¨³å®šè¿è¡Œ
âœ… iOSè®¾å¤‡ - ç¨³å®šè¿è¡Œ
âœ… GPSæŒç»­æ›´æ–°æ— ä¸­æ–­
âœ… å§¿æ€ä»ªæŒç»­æ›´æ–°æ— å»¶è¿Ÿ
âœ… æ— å´©æºƒã€æ— å¡é¡¿
âœ… æ— å†…å­˜æ³„æ¼
âœ… ç”µæ± æ¶ˆè€—æ­£å¸¸
```

### 6. Gitæäº¤æœ€ç»ˆè®°å½•

```powershell
cd D:\FlightToolbox

# æŸ¥çœ‹é˜¶æ®µ3æ‰€æœ‰ä¿®æ”¹
git log --oneline feature/phase3-optimization

# åˆå¹¶åˆ°ä¸»åˆ†æ”¯ï¼ˆå¦‚æœæ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼‰
git checkout main
git merge feature/phase3-optimization

# æ‰“æ ‡ç­¾
git tag -a v2.8.1-phase3 -m "é˜¶æ®µ3ä¼˜åŒ–å®Œæˆ: ä¸»åŒ…å‡å°‘550KBï¼Œè¾¾åˆ°æœ€ä¼˜çŠ¶æ€

ä¼˜åŒ–å†…å®¹ï¼š
1. é©¾é©¶èˆ±æ¨¡å—åˆ†åŒ…ï¼ˆ550KBï¼‰
   - åˆ›å»º packageCockpit
   - è¿ç§» 15 ä¸ªæ ¸å¿ƒæ¨¡å—
   - å®ç°å¼‚æ­¥åŠ è½½æœºåˆ¶
   - å®ç°æ¨¡å—ç¼“å­˜æœºåˆ¶

éªŒè¯ç»“æœï¼š
- ä¸»åŒ…ä»1671KBé™è‡³1121KB
- å‰©ä½™æ‰©å±•ç©ºé—´927KBï¼ˆ45.3%ï¼‰
- é©¾é©¶èˆ±å¯åŠ¨æ—¶é—´ < 1ç§’ âœ…
- GPS/æŒ‡å—é’ˆ/å§¿æ€ä»ªå®Œå…¨æ­£å¸¸ âœ…
- ç¦»çº¿æ¨¡å¼å®Œå…¨æ­£å¸¸ âœ…
- Android + iOS çœŸæœºæµ‹è¯•é€šè¿‡ âœ…
- é•¿æ—¶é—´è¿è¡Œç¨³å®š âœ…

æœ€ç»ˆçŠ¶æ€ï¼š
- ä¸»åŒ…å¤§å°: 1121 KB (1.09 MB)
- å¾®ä¿¡2MBé™åˆ¶: âœ… æ»¡è¶³
- æ‰©å±•ç©ºé—´: 927 KB (45.3%)
- æ‰€æœ‰åŠŸèƒ½: âœ… æ­£å¸¸"

# æ¨é€åˆ°è¿œç¨‹ä»“åº“
git push origin main --tags
```

---

## ğŸ”„ å›æ»šæ–¹æ¡ˆ

å¦‚æœé‡åˆ°ä¸¥é‡é—®é¢˜éœ€è¦å›æ»šï¼š

### å¿«é€Ÿå›æ»šåˆ°é˜¶æ®µ2

```powershell
cd D:\FlightToolbox
git checkout main
git reset --hard v2.8.1-phase2

# é‡æ–°ç¼–è¯‘
# å¾®ä¿¡å¼€å‘è€…å·¥å…· -> ç¼–è¯‘
```

### éƒ¨åˆ†å›æ»šï¼ˆä¿ç•™ä¼˜åŒ–ï¼Œä¿®å¤bugï¼‰

å¦‚æœåªæ˜¯ç‰¹å®šåŠŸèƒ½å¼‚å¸¸ï¼Œå¯ä»¥åªå›æ»šç›¸å…³æ¨¡å—ï¼š

```powershell
# å›æ»šç‰¹å®šæ¨¡å—çš„ä¿®æ”¹
git checkout v2.8.1-phase2 -- miniprogram/pages/cockpit/index.js
git checkout v2.8.1-phase2 -- miniprogram/packageCockpit/modules/gps-manager.js

# é‡æ–°ç¼–è¯‘æµ‹è¯•
```

---

## ğŸ“ é—®é¢˜æ’æŸ¥

### é—®é¢˜1ï¼šé©¾é©¶èˆ±å¯åŠ¨æ—¶é—´è¶…è¿‡1ç§’

**ç—‡çŠ¶**ï¼š
- è¿›å…¥é©¾é©¶èˆ±åï¼ŒåŠ è½½æç¤ºæ˜¾ç¤ºè¶…è¿‡1ç§’
- ç”¨æˆ·ä½“éªŒä¸ä½³

**æ’æŸ¥æ­¥éª¤**ï¼š

```powershell
# æ£€æŸ¥æ¨¡å—åŠ è½½é¡ºåºæ˜¯å¦åˆç†
# åœ¨æ§åˆ¶å°æŸ¥çœ‹æ¯ä¸ªæ¨¡å—çš„åŠ è½½æ—¶é—´
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ä¼˜åŒ–æ¨¡å—åŠ è½½é¡ºåºï¼Œå‡å°‘ä¾èµ–å±‚çº§
2. ä½¿ç”¨æ›´å¤šå¹¶è¡ŒåŠ è½½
3. ç²¾ç®€ä¸å¿…è¦çš„æ¨¡å—åˆå§‹åŒ–é€»è¾‘
4. è€ƒè™‘å›æ»šåˆ°é˜¶æ®µ2

### é—®é¢˜2ï¼šGPS/å§¿æ€ä»ª/æŒ‡å—é’ˆåŠŸèƒ½å¼‚å¸¸

**ç—‡çŠ¶**ï¼š
- GPSæ•°æ®ä¸æ›´æ–°
- å§¿æ€ä»ªä¸å“åº”
- æŒ‡å—é’ˆä¸è½¬åŠ¨

**æ’æŸ¥æ­¥éª¤**ï¼š

```powershell
# æ£€æŸ¥æ ¸å¿ƒæ¨¡å—æ˜¯å¦æ­£ç¡®åŠ è½½
cd D:\FlightToolbox\miniprogram

# éªŒè¯æ¨¡å—æ–‡ä»¶å­˜åœ¨
Test-Path packageCockpit\modules\gps-manager.js
Test-Path packageCockpit\modules\attitude-indicator.js
Test-Path packageCockpit\modules\compass-manager-simple.js

# æ£€æŸ¥æ¨¡å—åŠ è½½é¡ºåº
# åœ¨æ§åˆ¶å°æŸ¥çœ‹æ¨¡å—åŠ è½½æ—¥å¿—
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. éªŒè¯æ¨¡å—åŠ è½½é¡ºåºæ­£ç¡®
2. æ£€æŸ¥æ¨¡å—ä¾èµ–æ˜¯å¦æ»¡è¶³
3. æ£€æŸ¥åˆå§‹åŒ–ä»£ç æ˜¯å¦æ­£ç¡®è°ƒç”¨
4. å¦‚æ— æ³•è§£å†³ï¼Œç«‹å³å›æ»šåˆ°é˜¶æ®µ2

### é—®é¢˜3ï¼šç¦»çº¿æ¨¡å¼åŠŸèƒ½å¤±æ•ˆ

**ç—‡çŠ¶**ï¼š
- é£è¡Œæ¨¡å¼ä¸‹é©¾é©¶èˆ±æ— æ³•æ‰“å¼€
- æ¨¡å—åŠ è½½å¤±è´¥

**æ’æŸ¥æ­¥éª¤**ï¼š

```powershell
# æ£€æŸ¥é¢„åŠ è½½è§„åˆ™
Select-String -Path app.json -Pattern "cockpitModulesPackage" -Context 5,5

# æ£€æŸ¥æ¨¡å—ç¼“å­˜æœºåˆ¶
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. éªŒè¯ preloadRule é…ç½®æ­£ç¡®
2. éªŒè¯æ¨¡å—ç¼“å­˜æœºåˆ¶å·¥ä½œæ­£å¸¸
3. æ¸…é™¤ç¼“å­˜é‡æ–°æµ‹è¯•
4. å¦‚æ— æ³•è§£å†³ï¼Œå›æ»šåˆ°é˜¶æ®µ2

---

## ğŸ“ æ€»ç»“å’Œå»ºè®®

### æˆåŠŸæ ‡å‡†

å¦‚æœé˜¶æ®µ3æˆåŠŸå®Œæˆï¼Œåº”è¯¥æ»¡è¶³ä»¥ä¸‹æ‰€æœ‰æ ‡å‡†ï¼š

```
âœ… ä¸»åŒ…å¤§å°ï¼š1121 KB (1.09 MB)
âœ… å‰©ä½™æ‰©å±•ç©ºé—´ï¼š927 KB (45.3%)
âœ… é©¾é©¶èˆ±å¯åŠ¨æ—¶é—´ï¼š< 1ç§’
âœ… GPSåŠŸèƒ½ï¼šå®Œå…¨æ­£å¸¸
âœ… æŒ‡å—é’ˆåŠŸèƒ½ï¼šå®Œå…¨æ­£å¸¸
âœ… å§¿æ€ä»ªåŠŸèƒ½ï¼šå®Œå…¨æ­£å¸¸
âœ… ç¦»çº¿æ¨¡å¼ï¼šå®Œå…¨æ­£å¸¸
âœ… AndroidçœŸæœºï¼šæµ‹è¯•é€šè¿‡
âœ… iOSçœŸæœºï¼šæµ‹è¯•é€šè¿‡
âœ… é•¿æœŸè¿è¡Œï¼šç¨³å®šæ— é—®é¢˜
```

### ç»´æŠ¤å»ºè®®

é˜¶æ®µ3å®Œæˆåï¼Œéœ€è¦æ³¨æ„ï¼š

1. **å®šæœŸæµ‹è¯•é©¾é©¶èˆ±åŠŸèƒ½**
   - æ¯æ¬¡å‘å¸ƒå‰å¿…é¡»æµ‹è¯•GPSã€å§¿æ€ä»ªã€æŒ‡å—é’ˆ
   - çœŸæœºæµ‹è¯•å¿…ä¸å¯å°‘

2. **ç›‘æ§å¯åŠ¨æ€§èƒ½**
   - æŒç»­ç›‘æ§é©¾é©¶èˆ±å¯åŠ¨æ—¶é—´
   - å¦‚è¶…è¿‡1ç§’ï¼Œéœ€è¦ä¼˜åŒ–

3. **è°¨æ…ä¿®æ”¹æ¨¡å—**
   - ä¿®æ”¹ä»»ä½•é©¾é©¶èˆ±æ¨¡å—å‰ï¼Œå¿…é¡»å……åˆ†æµ‹è¯•
   - ä¿®æ”¹æ¨¡å—ä¾èµ–å…³ç³»æ—¶ï¼Œå¿…é¡»æ›´æ–°åŠ è½½é¡ºåº

4. **ä¿æŒæ–‡æ¡£æ›´æ–°**
   - æ–°å¢æ¨¡å—æ—¶ï¼Œæ›´æ–°æ¨¡å—åŠ è½½å™¨
   - æ›´æ–°ä¾èµ–å…³ç³»æ—¶ï¼Œæ›´æ–°æ–‡æ¡£

### ä¸‹ä¸€æ­¥è¡ŒåŠ¨

é˜¶æ®µ3å®Œæˆåï¼Œå»ºè®®ï¼š

```
1. è§‚å¯Ÿ1-2å‘¨ï¼Œç¡®ä¿ç³»ç»Ÿç¨³å®š
2. æ”¶é›†ç”¨æˆ·åé¦ˆï¼Œå…³æ³¨å¯åŠ¨ä½“éªŒ
3. æŒç»­ç›‘æ§ä¸»åŒ…å¤§å°å˜åŒ–
4. æ ¹æ®éœ€è¦è°ƒæ•´ä¼˜åŒ–ç­–ç•¥
```

---

**æ–‡æ¡£åˆ›å»ºæ—¶é—´**: 2025-11-01
**ç»´æŠ¤è€…**: FlightToolbox AI Assistant
**ç‰ˆæœ¬**: v1.0
**å‰ç½®æ–‡æ¡£**: é˜¶æ®µ2-ä¸­ç­‰é£é™©ä¼˜åŒ–.md
**ä¸‹ä¸€æ­¥**: é˜…è¯» `éªŒè¯å’Œå›æ»šæŒ‡å—.md`
