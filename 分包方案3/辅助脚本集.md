# è¾…åŠ©è„šæœ¬é›†

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¥æœŸ**: 2025-11-01
**è„šæœ¬è¯­è¨€**: PowerShell
**é€‚ç”¨ç³»ç»Ÿ**: Windows 10/11
**é‡è¦ç­‰çº§**: â­â­â­

---

## ğŸ“‹ æ–‡æ¡£æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›7ä¸ªPowerShellè¾…åŠ©è„šæœ¬ï¼Œç”¨äºç›‘æ§ä¸»åŒ…å¤§å°ã€éªŒè¯é…ç½®ã€æ£€æŸ¥å¼•ç”¨ç­‰ã€‚

**è„šæœ¬åˆ—è¡¨**ï¼š
1. monitor-main-package-size.ps1 - ä¸»åŒ…å¤§å°ç›‘æ§
2. analyze-pages.ps1 - é¡µé¢å¤§å°åˆ†æ
3. analyze-data-files.ps1 - æ•°æ®æ–‡ä»¶åˆ†æ
4. stats-subpackages.ps1 - åˆ†åŒ…å¤§å°ç»Ÿè®¡
5. check-page-references.ps1 - é¡µé¢å¼•ç”¨æ£€æŸ¥
6. verify-audio-config.ps1 - éŸ³é¢‘é…ç½®éªŒè¯
7. generate-optimization-report.ps1 - ä¼˜åŒ–æŠ¥å‘Šç”Ÿæˆ

**ä½¿ç”¨å‰æ**ï¼š
- âœ… å®‰è£…PowerShell 5.0æˆ–æ›´é«˜ç‰ˆæœ¬
- âœ… åœ¨é¡¹ç›®æ ¹ç›®å½•ï¼ˆD:\FlightToolboxï¼‰è¿è¡Œ
- âœ… æ‰§è¡Œç­–ç•¥å…è®¸è¿è¡Œè„šæœ¬

**æ£€æŸ¥PowerShellç‰ˆæœ¬**ï¼š
```powershell
$PSVersionTable.PSVersion
# åº”è¯¥æ˜¾ç¤º 5.x æˆ–æ›´é«˜
```

---

## ğŸ”§ è„šæœ¬1ï¼šä¸»åŒ…å¤§å°ç›‘æ§

**æ–‡ä»¶å**: `monitor-main-package-size.ps1`

**åŠŸèƒ½**ï¼šç›‘æ§ä¸»åŒ…å„ç›®å½•çš„å¤§å°ï¼Œå¸®åŠ©äº†è§£ä¸»åŒ…ç©ºé—´å ç”¨æƒ…å†µ

### è„šæœ¬ä»£ç 

```powershell
<#
.SYNOPSIS
    FlightToolbox ä¸»åŒ…å¤§å°ç›‘æ§è„šæœ¬

.DESCRIPTION
    ç›‘æ§ä¸»åŒ…å„ç›®å½•çš„å¤§å°ï¼Œæ£€æŸ¥æ˜¯å¦æ¥è¿‘æˆ–è¶…å‡º2MBé™åˆ¶

.EXAMPLE
    .\monitor-main-package-size.ps1
#>

# è®¾ç½®é”™è¯¯å¤„ç†
$ErrorActionPreference = "Stop"

# ä¸»åŒ…ç›®å½•åˆ—è¡¨
$mainPackageDirs = @('pages', 'data', 'utils', 'images', 'audio', 'components', 'assets', 'styles')

# å¾®ä¿¡å°ç¨‹åºä¸»åŒ…å¤§å°é™åˆ¶ï¼ˆKBï¼‰
$maxMainSizeKB = 2048

Write-Host "`n========================================" -ForegroundColor Cyan
Write-Host "FlightToolbox ä¸»åŒ…å¤§å°ç›‘æ§" -ForegroundColor Cyan
Write-Host "========================================`n" -ForegroundColor Cyan

# æ£€æŸ¥æ˜¯å¦åœ¨é¡¹ç›®æ ¹ç›®å½•
if (-not (Test-Path "miniprogram")) {
    Write-Host "âŒ é”™è¯¯ï¼šè¯·åœ¨é¡¹ç›®æ ¹ç›®å½•ï¼ˆD:\FlightToolboxï¼‰è¿è¡Œæ­¤è„šæœ¬" -ForegroundColor Red
    exit 1
}

$totalSize = 0
$results = @()

# ç»Ÿè®¡å„ç›®å½•å¤§å°
foreach ($dir in $mainPackageDirs) {
    $path = Join-Path "miniprogram" $dir

    if (Test-Path $path) {
        try {
            $size = (Get-ChildItem $path -Recurse -File -ErrorAction SilentlyContinue |
                Measure-Object -Property Length -Sum -ErrorAction SilentlyContinue).Sum

            if ($null -eq $size) { $size = 0 }

            $sizeKB = [math]::Round($size / 1KB, 2)
            $totalSize += $size

            $results += [PSCustomObject]@{
                Directory = $dir
                SizeKB    = $sizeKB
                SizeMB    = [math]::Round($size / 1MB, 2)
                Percentage = 0  # ç¨åè®¡ç®—
            }
        }
        catch {
            Write-Host "âš ï¸  è­¦å‘Šï¼šæ— æ³•è¯»å–ç›®å½• $dir - $_" -ForegroundColor Yellow
        }
    }
    else {
        Write-Host "âš ï¸  ç›®å½•ä¸å­˜åœ¨ï¼š$dir" -ForegroundColor Yellow
    }
}

# è®¡ç®—ç™¾åˆ†æ¯”
$totalKB = [math]::Round($totalSize / 1KB, 2)
$totalMB = [math]::Round($totalSize / 1MB, 2)

foreach ($result in $results) {
    $result.Percentage = [math]::Round(($result.SizeKB / $totalKB) * 100, 1)
}

# æ˜¾ç¤ºç»“æœ
Write-Host "ä¸»åŒ…å„ç›®å½•å¤§å°ï¼š" -ForegroundColor Green
Write-Host ("=" * 70) -ForegroundColor Gray

$results | Sort-Object SizeKB -Descending | Format-Table -AutoSize @{
    Label = "ç›®å½•"; Expression = {$_.Directory}; Width = 15
},
@{
    Label = "å¤§å°(KB)"; Expression = {$_.SizeKB}; Width = 12; Alignment = 'Right'
},
@{
    Label = "å¤§å°(MB)"; Expression = {$_.SizeMB}; Width = 12; Alignment = 'Right'
},
@{
    Label = "å æ¯”(%)"; Expression = {$_.Percentage}; Width = 12; Alignment = 'Right'
}

Write-Host ("=" * 70) -ForegroundColor Gray
Write-Host "ä¸»åŒ…æ€»è®¡ï¼š$totalKB KB ($totalMB MB)" -ForegroundColor Cyan

# å‰©ä½™ç©ºé—´
$remainingKB = $maxMainSizeKB - $totalKB
$remainingPercent = [math]::Round(($remainingKB / $maxMainSizeKB) * 100, 1)

Write-Host "`nå¾®ä¿¡é™åˆ¶ï¼š$maxMainSizeKB KB (2.00 MB)" -ForegroundColor Gray

if ($totalKB -gt $maxMainSizeKB) {
    $overKB = $totalKB - $maxMainSizeKB
    $overPercent = [math]::Round(($overKB / $maxMainSizeKB) * 100, 1)
    Write-Host "âŒ è¶…å‡ºé™åˆ¶ï¼š$overKB KB ($overPercent%)" -ForegroundColor Red
    Write-Host "`nğŸš¨ ç´§æ€¥ä¼˜åŒ–ï¼šä¸»åŒ…å·²è¶…å‡º2MBé™åˆ¶ï¼" -ForegroundColor Red
}
elseif ($totalKB -gt ($maxMainSizeKB * 0.9)) {
    Write-Host "âš ï¸  å‰©ä½™ç©ºé—´ï¼š$remainingKB KB ($remainingPercent%)" -ForegroundColor Yellow
    Write-Host "`nâš ï¸  è­¦å‘Šï¼šä¸»åŒ…æ¥è¿‘2MBé™åˆ¶ï¼Œå»ºè®®ç«‹å³ä¼˜åŒ–ï¼" -ForegroundColor Yellow
}
elseif ($totalKB -gt ($maxMainSizeKB * 0.75)) {
    Write-Host "âš ï¸  å‰©ä½™ç©ºé—´ï¼š$remainingKB KB ($remainingPercent%)" -ForegroundColor Yellow
    Write-Host "`nğŸ’¡ å»ºè®®ï¼šä¸»åŒ…è¶…è¿‡75%ï¼Œå¯ä»¥è€ƒè™‘ä¼˜åŒ–" -ForegroundColor Yellow
}
else {
    Write-Host "âœ… å‰©ä½™ç©ºé—´ï¼š$remainingKB KB ($remainingPercent%)" -ForegroundColor Green
    Write-Host "`nâœ… æ­£å¸¸ï¼šä¸»åŒ…å¤§å°åœ¨åˆç†èŒƒå›´å†…" -ForegroundColor Green
}

Write-Host "`n========================================`n" -ForegroundColor Cyan
```

### ä½¿ç”¨æ–¹æ³•

```powershell
# åˆ‡æ¢åˆ°é¡¹ç›®æ ¹ç›®å½•
cd D:\FlightToolbox

# è¿è¡Œè„šæœ¬
.\åˆ†åŒ…æ–¹æ¡ˆ3\monitor-main-package-size.ps1

# æˆ–è€…ç›´æ¥è¿è¡Œï¼ˆå¦‚æœè„šæœ¬åœ¨å½“å‰ç›®å½•ï¼‰
powershell -ExecutionPolicy Bypass -File monitor-main-package-size.ps1
```

### è¾“å‡ºç¤ºä¾‹

```
========================================
FlightToolbox ä¸»åŒ…å¤§å°ç›‘æ§
========================================

ä¸»åŒ…å„ç›®å½•å¤§å°ï¼š
======================================================================
ç›®å½•            å¤§å°(KB)     å¤§å°(MB)      å æ¯”(%)
----            --------     --------      --------
pages           1770.71         1.73          65.6
data             440.93         0.43          16.3
utils            383.25         0.37          14.2
images            98.45         0.10           3.6
audio              3.07         0.00           0.1
components         2.24         0.00           0.1
======================================================================
ä¸»åŒ…æ€»è®¡ï¼š2698.65 KB (2.63 MB)

å¾®ä¿¡é™åˆ¶ï¼š2048 KB (2.00 MB)
âŒ è¶…å‡ºé™åˆ¶ï¼š650.65 KB (31.8%)

ğŸš¨ ç´§æ€¥ä¼˜åŒ–ï¼šä¸»åŒ…å·²è¶…å‡º2MBé™åˆ¶ï¼

========================================
```

---

## ğŸ“„ è„šæœ¬2ï¼šé¡µé¢å¤§å°åˆ†æ

**æ–‡ä»¶å**: `analyze-pages.ps1`

**åŠŸèƒ½**ï¼šåˆ†æpagesç›®å½•ä¸‹çš„é¡µé¢å¤§å°ï¼Œè¯†åˆ«å¯ç§»è‡³åˆ†åŒ…çš„é¡µé¢

### è„šæœ¬ä»£ç 

```powershell
<#
.SYNOPSIS
    FlightToolbox é¡µé¢å¤§å°åˆ†æè„šæœ¬

.DESCRIPTION
    åˆ†æpagesç›®å½•ä¸‹æ¯ä¸ªé¡µé¢çš„å¤§å°ï¼Œè¯†åˆ«å¤§é¡µé¢å¹¶å»ºè®®ç§»è‡³åˆ†åŒ…

.EXAMPLE
    .\analyze-pages.ps1
#>

$ErrorActionPreference = "Stop"

Write-Host "`n========================================" -ForegroundColor Cyan
Write-Host "FlightToolbox é¡µé¢å¤§å°åˆ†æ" -ForegroundColor Cyan
Write-Host "========================================`n" -ForegroundColor Cyan

# æ£€æŸ¥pagesç›®å½•
$pagesPath = "miniprogram\pages"
if (-not (Test-Path $pagesPath)) {
    Write-Host "âŒ é”™è¯¯ï¼šæœªæ‰¾åˆ°pagesç›®å½•" -ForegroundColor Red
    exit 1
}

# è·å–æ‰€æœ‰é¡µé¢ç›®å½•
$pageDirectories = Get-ChildItem $pagesPath -Directory

$results = @()
$totalSize = 0

foreach ($pageDir in $pageDirectories) {
    # ç»Ÿè®¡é¡µé¢æ–‡ä»¶æ•°é‡å’Œå¤§å°
    $files = Get-ChildItem $pageDir.FullName -Recurse -File -ErrorAction SilentlyContinue
    $fileCount = $files.Count
    $size = ($files | Measure-Object -Property Length -Sum -ErrorAction SilentlyContinue).Sum

    if ($null -eq $size) { $size = 0 }

    $sizeKB = [math]::Round($size / 1KB, 2)
    $totalSize += $size

    $results += [PSCustomObject]@{
        PageName  = $pageDir.Name
        SizeKB    = $sizeKB
        FileCount = $fileCount
    }
}

# æŒ‰å¤§å°æ’åºå¹¶æ˜¾ç¤º
Write-Host "é¡µé¢å¤§å°æ’åï¼ˆæŒ‰å¤§å°é™åºï¼‰ï¼š" -ForegroundColor Green
Write-Host ("=" * 70) -ForegroundColor Gray

$results | Sort-Object SizeKB -Descending | Format-Table -AutoSize @{
    Label = "é¡µé¢åç§°"; Expression = {$_.PageName}; Width = 30
},
@{
    Label = "å¤§å°(KB)"; Expression = {$_.SizeKB}; Width = 15; Alignment = 'Right'
},
@{
    Label = "æ–‡ä»¶æ•°"; Expression = {$_.FileCount}; Width = 10; Alignment = 'Right'
},
@{
    Label = "å»ºè®®"; Expression = {
        if ($_.SizeKB -gt 300) {
            "â­â­â­â­â­ å¼ºçƒˆå»ºè®®ç§»è‡³åˆ†åŒ…"
        }
        elseif ($_.SizeKB -gt 100) {
            "â­â­â­â­ å»ºè®®ç§»è‡³åˆ†åŒ…"
        }
        elseif ($_.SizeKB -gt 50) {
            "â­â­â­ å¯è€ƒè™‘ç§»è‡³åˆ†åŒ…"
        }
        else {
            "ä¿ç•™ä¸»åŒ…"
        }
    }; Width = 25
}

Write-Host ("=" * 70) -ForegroundColor Gray

$totalKB = [math]::Round($totalSize / 1KB, 2)
$totalMB = [math]::Round($totalSize / 1MB, 2)

Write-Host "pagesç›®å½•æ€»è®¡ï¼š$totalKB KB ($totalMB MB)" -ForegroundColor Cyan

# è¯†åˆ«TabBaré¡µé¢ï¼ˆéœ€è¦ä¿ç•™åœ¨ä¸»åŒ…ï¼‰
Write-Host "`nâš ï¸  æ³¨æ„äº‹é¡¹ï¼š" -ForegroundColor Yellow
Write-Host "ä»¥ä¸‹é¡µé¢æ˜¯TabBaré¡µé¢ï¼Œå¿…é¡»ä¿ç•™åœ¨ä¸»åŒ…ï¼š" -ForegroundColor Yellow
Write-Host "  - search (èµ„æ–™æŸ¥è¯¢)" -ForegroundColor Gray
Write-Host "  - flight-calculator (è®¡ç®—å·¥å…·)" -ForegroundColor Gray
Write-Host "  - cockpit (é©¾é©¶èˆ±)" -ForegroundColor Gray
Write-Host "  - operations (é€šä¿¡)" -ForegroundColor Gray
Write-Host "  - home (æˆ‘çš„é¦–é¡µ)" -ForegroundColor Gray

# æ¨èä¼˜åŒ–å»ºè®®
Write-Host "`nğŸ’¡ ä¼˜åŒ–å»ºè®®ï¼š" -ForegroundColor Green

$largPages = $results | Where-Object { $_.SizeKB -gt 100 } | Sort-Object SizeKB -Descending

if ($largePages.Count -gt 0) {
    Write-Host "`nå»ºè®®ç§»è‡³åˆ†åŒ…çš„é¡µé¢ï¼ˆ>100KBï¼‰ï¼š" -ForegroundColor Green

    foreach ($page in $largePages) {
        $suggestion = ""

        switch ($page.PageName) {
            "communication-failure" { $suggestion = "ç§»è‡³ packageCommFailure" }
            "audio-player" { $suggestion = "ç§»è‡³ packageAudioPages" }
            "airline-recordings" { $suggestion = "ç§»è‡³ packageAudioPages" }
            "recording-categories" { $suggestion = "ç§»è‡³ packageAudioPages" }
            "recording-clips" { $suggestion = "ç§»è‡³ packageAudioPages" }
            "communication-rules" { $suggestion = "ç§»è‡³ packageCommRules" }
            "communication-rules-detail" { $suggestion = "ç§»è‡³ packageCommRules" }
            "standard-phraseology" { $suggestion = "ç§»è‡³ packageCommRules" }
            "emergency-altitude" { $suggestion = "ç§»è‡³ packageCommRules" }
            "cockpit" { $suggestion = "TabBaré¡µé¢ï¼Œä¿ç•™ä¸»åŒ…ï¼›ä½†å¯åˆ†åŒ…modules/" }
            default { $suggestion = "åˆ›å»ºæ–°åˆ†åŒ…" }
        }

        Write-Host "  - $($page.PageName) ($($page.SizeKB) KB) â†’ $suggestion" -ForegroundColor Gray
    }
}
else {
    Write-Host "âœ… æ‰€æœ‰é¡µé¢å¤§å°åˆç†ï¼Œæ— éœ€ç«‹å³ä¼˜åŒ–" -ForegroundColor Green
}

Write-Host "`n========================================`n" -ForegroundColor Cyan
```

---

## ğŸ“Š è„šæœ¬3ï¼šæ•°æ®æ–‡ä»¶åˆ†æ

**æ–‡ä»¶å**: `analyze-data-files.ps1`

**åŠŸèƒ½**ï¼šåˆ†ædataç›®å½•ä¸‹çš„æ•°æ®æ–‡ä»¶ï¼Œè¯†åˆ«å¯ç§»è‡³åˆ†åŒ…çš„æ•°æ®

### è„šæœ¬ä»£ç 

```powershell
<#
.SYNOPSIS
    FlightToolbox æ•°æ®æ–‡ä»¶åˆ†æè„šæœ¬

.DESCRIPTION
    åˆ†ædataç›®å½•ä¸‹çš„æ•°æ®æ–‡ä»¶å¤§å°ï¼Œè¯†åˆ«å¯ç§»è‡³åˆ†åŒ…çš„æ•°æ®æ–‡ä»¶

.EXAMPLE
    .\analyze-data-files.ps1
#>

$ErrorActionPreference = "Stop"

Write-Host "`n========================================" -ForegroundColor Cyan
Write-Host "FlightToolbox æ•°æ®æ–‡ä»¶åˆ†æ" -ForegroundColor Cyan
Write-Host "========================================`n" -ForegroundColor Cyan

# æ£€æŸ¥dataç›®å½•
$dataPath = "miniprogram\data"
if (-not (Test-Path $dataPath)) {
    Write-Host "âŒ é”™è¯¯ï¼šæœªæ‰¾åˆ°dataç›®å½•" -ForegroundColor Red
    exit 1
}

# åˆ†æä¸»dataç›®å½•æ–‡ä»¶
Write-Host "ä¸»dataç›®å½•æ–‡ä»¶ï¼š" -ForegroundColor Green
Write-Host ("=" * 70) -ForegroundColor Gray

$mainDataFiles = Get-ChildItem $dataPath -Filter *.js -File -ErrorAction SilentlyContinue
$mainResults = @()

foreach ($file in $mainDataFiles) {
    $sizeKB = [math]::Round($file.Length / 1KB, 2)

    $mainResults += [PSCustomObject]@{
        FileName = $file.Name
        SizeKB   = $sizeKB
    }
}

$mainResults | Sort-Object SizeKB -Descending | Format-Table -AutoSize @{
    Label = "æ–‡ä»¶å"; Expression = {$_.FileName}; Width = 35
},
@{
    Label = "å¤§å°(KB)"; Expression = {$_.SizeKB}; Width = 15; Alignment = 'Right'
},
@{
    Label = "å»ºè®®"; Expression = {
        switch -Wildcard ($_.FileName) {
            "*CommunicationRules*" { "ç§»è‡³ packageCommRules æˆ– packageCCAR" }
            "*phraseology*" { "ç§»è‡³ packageCommRules æˆ– packageCCAR" }
            "*emergency-altitude*" { "ç§»è‡³ packageCommRules" }
            "*rodex*" { "ç§»è‡³ packageO/rodex-decoder" }
            "*snowtam*" { "ç§»è‡³ packageO/snowtam-encoder" }
            default {
                if ($_.SizeKB -gt 20) { "è€ƒè™‘ç§»è‡³åˆ†åŒ…" }
                else { "ä¿ç•™ä¸»åŒ…" }
            }
        }
    }; Width = 35
}

# åˆ†ædata/regionsç›®å½•ï¼ˆèˆªçº¿å½•éŸ³æ•°æ®ï¼‰
$regionsPath = Join-Path $dataPath "regions"
if (Test-Path $regionsPath) {
    Write-Host "`ndata/regionsç›®å½•ï¼ˆèˆªçº¿å½•éŸ³æ•°æ®ï¼‰ï¼š" -ForegroundColor Green
    Write-Host ("=" * 70) -ForegroundColor Gray

    $regionFiles = Get-ChildItem $regionsPath -Filter *.js -File
    $regionResults = @()

    foreach ($file in $regionFiles) {
        $sizeKB = [math]::Round($file.Length / 1KB, 2)

        $regionResults += [PSCustomObject]@{
            FileName = $file.Name
            SizeKB   = $sizeKB
        }
    }

    # æ˜¾ç¤ºå‰10ä¸ªæœ€å¤§çš„æ–‡ä»¶
    $regionResults | Sort-Object SizeKB -Descending | Select-Object -First 10 | Format-Table -AutoSize @{
        Label = "æ–‡ä»¶å"; Expression = {$_.FileName}; Width = 25
    },
    @{
        Label = "å¤§å°(KB)"; Expression = {$_.SizeKB}; Width = 15; Alignment = 'Right'
    }

    $regionsTotalKB = [math]::Round(($regionFiles | Measure-Object -Property Length -Sum).Sum / 1KB, 2)
    Write-Host "... å…± $($regionFiles.Count) ä¸ªæ–‡ä»¶" -ForegroundColor Gray
    Write-Host ("=" * 70) -ForegroundColor Gray
    Write-Host "regionså­ç›®å½•æ€»è®¡ï¼š$regionsTotalKB KB" -ForegroundColor Cyan

    Write-Host "`nğŸ’¡ å»ºè®®ï¼š" -ForegroundColor Green
    Write-Host "  - åˆ›å»º packageAudioData ç»Ÿä¸€ç®¡ç†æ‰€æœ‰èˆªçº¿å½•éŸ³æ•°æ®" -ForegroundColor Gray
    Write-Host "  - å°† $($regionFiles.Count) ä¸ªæ•°æ®æ–‡ä»¶ç§»è‡³ packageAudioData/data/regions/" -ForegroundColor Gray
    Write-Host "  - é¢„è®¡èŠ‚çœä¸»åŒ…ç©ºé—´ï¼š$regionsTotalKB KB" -ForegroundColor Gray
}

# æ€»è®¡
$totalDataSize = ($mainDataFiles | Measure-Object -Property Length -Sum).Sum

if (Test-Path $regionsPath) {
    $totalDataSize += ($regionFiles | Measure-Object -Property Length -Sum).Sum
}

$totalDataKB = [math]::Round($totalDataSize / 1KB, 2)
$totalDataMB = [math]::Round($totalDataSize / 1MB, 2)

Write-Host "`n========================================" -ForegroundColor Gray
Write-Host "dataç›®å½•æ€»è®¡ï¼š$totalDataKB KB ($totalDataMB MB)" -ForegroundColor Cyan

# ä¼˜åŒ–å»ºè®®
Write-Host "`nğŸ’¡ ä¼˜åŒ–å»ºè®®ï¼š" -ForegroundColor Green

$largeFiles = $mainResults | Where-Object { $_.SizeKB -gt 20 }
if ($largeFiles.Count -gt 0) {
    Write-Host "`nä»¥ä¸‹æ–‡ä»¶è¾ƒå¤§ï¼ˆ>20KBï¼‰ï¼Œå»ºè®®ç§»è‡³åˆ†åŒ…ï¼š" -ForegroundColor Yellow
    foreach ($file in $largeFiles) {
        Write-Host "  - $($file.FileName) ($($file.SizeKB) KB)" -ForegroundColor Gray
    }
}

Write-Host "`n========================================`n" -ForegroundColor Cyan
```

---

## ğŸ“¦ è„šæœ¬4ï¼šåˆ†åŒ…å¤§å°ç»Ÿè®¡

**æ–‡ä»¶å**: `stats-subpackages.ps1`

**åŠŸèƒ½**ï¼šç»Ÿè®¡æ‰€æœ‰åˆ†åŒ…çš„å¤§å°ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰åˆ†åŒ…æ¥è¿‘2MBé™åˆ¶

### è„šæœ¬ä»£ç 

```powershell
<#
.SYNOPSIS
    FlightToolbox åˆ†åŒ…å¤§å°ç»Ÿè®¡è„šæœ¬

.DESCRIPTION
    ç»Ÿè®¡æ‰€æœ‰åˆ†åŒ…çš„å¤§å°ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰åˆ†åŒ…æ¥è¿‘æˆ–è¶…è¿‡2MBé™åˆ¶

.EXAMPLE
    .\stats-subpackages.ps1
#>

$ErrorActionPreference = "Stop"

Write-Host "`n========================================" -ForegroundColor Cyan
Write-Host "FlightToolbox åˆ†åŒ…å¤§å°ç»Ÿè®¡" -ForegroundColor Cyan
Write-Host "========================================`n" -ForegroundColor Cyan

# æ£€æŸ¥miniprogramç›®å½•
if (-not (Test-Path "miniprogram")) {
    Write-Host "âŒ é”™è¯¯ï¼šè¯·åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œæ­¤è„šæœ¬" -ForegroundColor Red
    exit 1
}

# è·å–æ‰€æœ‰åˆ†åŒ…ç›®å½•
$subPackages = Get-ChildItem "miniprogram" -Directory |
    Where-Object { $_.Name -like 'package*' }

if ($subPackages.Count -eq 0) {
    Write-Host "âš ï¸  æœªæ‰¾åˆ°ä»»ä½•åˆ†åŒ…ç›®å½•" -ForegroundColor Yellow
    exit 0
}

# åˆ†ç±»ç»Ÿè®¡
$audioPackages = @()
$functionPackages = @()

foreach ($package in $subPackages) {
    $size = (Get-ChildItem $package.FullName -Recurse -File -ErrorAction SilentlyContinue |
        Measure-Object -Property Length -Sum -ErrorAction SilentlyContinue).Sum

    if ($null -eq $size) { $size = 0 }

    $sizeKB = [math]::Round($size / 1KB, 2)
    $sizeMB = [math]::Round($size / 1MB, 2)

    $packageInfo = [PSCustomObject]@{
        Name     = $package.Name
        SizeKB   = $sizeKB
        SizeMB   = $sizeMB
        Warning  = if ($sizeMB -gt 1.8) { "âš ï¸  æ¥è¿‘2MBé™åˆ¶" }
                   elseif ($sizeMB -gt 1.5) { "ğŸ’¡ åå¤§" }
                   else { "" }
    }

    # åˆ†ç±»ï¼šéŸ³é¢‘åˆ†åŒ…é€šå¸¸åŒ…å«å›½å®¶/åœ°åŒºåç§°
    if ($package.Name -match "Japan|Korea|Singapore|Thailand|Vietnam|Malaysia|Indonesia|India|Philippines|" +
        "HongKong|Taipei|Macau|Russia|Turkey|France|Italy|UK|Spain|Germany|Holland|" +
        "America|Canada|Australia|NewZealand|Egypt|UAE|Srilanka|Maldive|Cambodia|Myanmar|Uzbekistan") {
        $audioPackages += $packageInfo
    }
    else {
        $functionPackages += $packageInfo
    }
}

# æ˜¾ç¤ºåŠŸèƒ½åˆ†åŒ…
if ($functionPackages.Count -gt 0) {
    Write-Host "åŠŸèƒ½åˆ†åŒ…ï¼š" -ForegroundColor Green
    Write-Host ("=" * 70) -ForegroundColor Gray

    $functionPackages | Sort-Object SizeMB -Descending | Format-Table -AutoSize @{
        Label = "åˆ†åŒ…åç§°"; Expression = {$_.Name}; Width = 25
    },
    @{
        Label = "å¤§å°(KB)"; Expression = {$_.SizeKB}; Width = 12; Alignment = 'Right'
    },
    @{
        Label = "å¤§å°(MB)"; Expression = {$_.SizeMB}; Width = 12; Alignment = 'Right'
    },
    @{
        Label = "è­¦å‘Š"; Expression = {$_.Warning}; Width = 20
    }
}

# æ˜¾ç¤ºéŸ³é¢‘åˆ†åŒ…
if ($audioPackages.Count -gt 0) {
    Write-Host "`néŸ³é¢‘åˆ†åŒ…ï¼š" -ForegroundColor Green
    Write-Host ("=" * 70) -ForegroundColor Gray

    # åªæ˜¾ç¤ºå‰15ä¸ªæœ€å¤§çš„éŸ³é¢‘åˆ†åŒ…
    $audioPackages | Sort-Object SizeMB -Descending | Select-Object -First 15 | Format-Table -AutoSize @{
        Label = "åˆ†åŒ…åç§°"; Expression = {$_.Name}; Width = 25
    },
    @{
        Label = "å¤§å°(KB)"; Expression = {$_.SizeKB}; Width = 12; Alignment = 'Right'
    },
    @{
        Label = "å¤§å°(MB)"; Expression = {$_.SizeMB}; Width = 12; Alignment = 'Right'
    },
    @{
        Label = "è­¦å‘Š"; Expression = {$_.Warning}; Width = 20
    }

    if ($audioPackages.Count -gt 15) {
        Write-Host "... åŠå…¶ä»– $($audioPackages.Count - 15) ä¸ªéŸ³é¢‘åˆ†åŒ…" -ForegroundColor Gray
    }
}

# æ€»è®¡
$totalSize = ($subPackages | ForEach-Object {
    (Get-ChildItem $_.FullName -Recurse -File -ErrorAction SilentlyContinue |
        Measure-Object -Property Length -Sum -ErrorAction SilentlyContinue).Sum
} | Measure-Object -Sum).Sum

$totalMB = [math]::Round($totalSize / 1MB, 2)

Write-Host "`n========================================" -ForegroundColor Gray
Write-Host "æ‰€æœ‰åˆ†åŒ…æ€»è®¡ï¼š$totalMB MB" -ForegroundColor Cyan
Write-Host "åˆ†åŒ…æ•°é‡ï¼šåŠŸèƒ½åˆ†åŒ… $($functionPackages.Count) ä¸ªï¼ŒéŸ³é¢‘åˆ†åŒ… $($audioPackages.Count) ä¸ª" -ForegroundColor Cyan

# æ£€æŸ¥è­¦å‘Š
$warningPackages = $functionPackages + $audioPackages | Where-Object { $_.Warning -ne "" }

if ($warningPackages.Count -gt 0) {
    Write-Host "`nâš ï¸  ä»¥ä¸‹åˆ†åŒ…éœ€è¦æ³¨æ„ï¼š" -ForegroundColor Yellow
    foreach ($package in $warningPackages) {
        Write-Host "  - $($package.Name): $($package.SizeMB) MB $($package.Warning)" -ForegroundColor Yellow
    }
}
else {
    Write-Host "`nâœ… æ‰€æœ‰åˆ†åŒ…å¤§å°æ­£å¸¸" -ForegroundColor Green
}

Write-Host "`n========================================`n" -ForegroundColor Cyan
```

---

## ğŸ” è„šæœ¬5ï¼šé¡µé¢å¼•ç”¨æ£€æŸ¥

**æ–‡ä»¶å**: `check-page-references.ps1`

**åŠŸèƒ½**ï¼šæ£€æŸ¥æŸä¸ªé¡µé¢åœ¨ä»£ç ä¸­çš„æ‰€æœ‰å¼•ç”¨ï¼Œç”¨äºè¿ç§»é¡µé¢åéªŒè¯è·¯ç”±æ›´æ–°

### è„šæœ¬ä»£ç 

```powershell
<#
.SYNOPSIS
    FlightToolbox é¡µé¢å¼•ç”¨æ£€æŸ¥è„šæœ¬

.DESCRIPTION
    æ£€æŸ¥æŸä¸ªé¡µé¢åœ¨ä»£ç ä¸­çš„æ‰€æœ‰å¼•ç”¨ï¼Œç”¨äºè¿ç§»é¡µé¢åéªŒè¯è·¯ç”±æ›´æ–°æ˜¯å¦å®Œæ•´

.PARAMETER PageName
    è¦æ£€æŸ¥çš„é¡µé¢åç§°ï¼ˆå¦‚ï¼šcommunication-failureã€audio-playerï¼‰

.EXAMPLE
    .\check-page-references.ps1 -PageName "communication-failure"

.EXAMPLE
    .\check-page-references.ps1 "audio-player"
#>

param(
    [Parameter(Mandatory = $true, Position = 0)]
    [string]$PageName
)

$ErrorActionPreference = "Stop"

Write-Host "`n========================================" -ForegroundColor Cyan
Write-Host "é¡µé¢å¼•ç”¨æ£€æŸ¥ï¼š$PageName" -ForegroundColor Cyan
Write-Host "========================================`n" -ForegroundColor Cyan

# æ£€æŸ¥miniprogramç›®å½•
if (-not (Test-Path "miniprogram")) {
    Write-Host "âŒ é”™è¯¯ï¼šè¯·åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œæ­¤è„šæœ¬" -ForegroundColor Red
    exit 1
}

# æœç´¢æ¨¡å¼
$patterns = @(
    "/pages/$PageName",
    "pages/$PageName",
    "'pages/$PageName",
    "`"pages/$PageName",
    "pages\\$PageName",
    "package.*/$PageName"
)

$totalReferences = 0

foreach ($pattern in $patterns) {
    Write-Host "æœç´¢æ¨¡å¼ï¼š$pattern" -ForegroundColor Gray

    try {
        $results = Get-ChildItem "miniprogram" -Recurse -Include *.js,*.ts,*.wxml,*.json -File -ErrorAction SilentlyContinue |
            Select-String -Pattern $pattern -ErrorAction SilentlyContinue

        if ($results) {
            $totalReferences += $results.Count

            Write-Host "æ‰¾åˆ° $($results.Count) å¤„å¼•ç”¨ï¼š" -ForegroundColor Yellow

            $results | ForEach-Object {
                $relativePath = $_.Path.Replace((Get-Location).Path + "\miniprogram\", "")
                Write-Host "  ğŸ“„ $relativePath : è¡Œ$($_.LineNumber)" -ForegroundColor Gray
                Write-Host "     $($_.Line.Trim())" -ForegroundColor DarkGray
            }

            Write-Host ""
        }
    }
    catch {
        Write-Host "âš ï¸  æœç´¢æ¨¡å¼ $pattern æ—¶å‡ºé”™ï¼š$_" -ForegroundColor Yellow
    }
}

Write-Host ("=" * 70) -ForegroundColor Gray

if ($totalReferences -eq 0) {
    Write-Host "âœ… æœªæ‰¾åˆ°ä»»ä½•å¼•ç”¨ï¼Œè·¯ç”±æ›´æ–°å·²å®Œæˆ" -ForegroundColor Green
}
else {
    Write-Host "âš ï¸  å…±æ‰¾åˆ° $totalReferences å¤„å¼•ç”¨ï¼Œéœ€è¦æ›´æ–°" -ForegroundColor Yellow
    Write-Host "`nğŸ’¡ å»ºè®®ï¼š" -ForegroundColor Green
    Write-Host "  1. æ‰‹åŠ¨æ£€æŸ¥æ¯å¤„å¼•ç”¨" -ForegroundColor Gray
    Write-Host "  2. æ›´æ–°ä¸ºæ–°çš„åˆ†åŒ…è·¯å¾„" -ForegroundColor Gray
    Write-Host "  3. é‡æ–°è¿è¡Œæ­¤è„šæœ¬éªŒè¯" -ForegroundColor Gray
}

Write-Host "`n========================================`n" -ForegroundColor Cyan
```

---

## ğŸµ è„šæœ¬6ï¼šéŸ³é¢‘é…ç½®éªŒè¯

**æ–‡ä»¶å**: `verify-audio-config.ps1`

**åŠŸèƒ½**ï¼šéªŒè¯éŸ³é¢‘åˆ†åŒ…çš„8æ­¥é…ç½®æ˜¯å¦å®Œæ•´

### è„šæœ¬ä»£ç 

```powershell
<#
.SYNOPSIS
    FlightToolbox éŸ³é¢‘é…ç½®éªŒè¯è„šæœ¬

.DESCRIPTION
    éªŒè¯éŸ³é¢‘åˆ†åŒ…çš„8æ­¥é…ç½®æ˜¯å¦å®Œæ•´ï¼Œé¿å…é—æ¼é…ç½®å¯¼è‡´éŸ³é¢‘æ— æ³•æ’­æ”¾

.PARAMETER RegionId
    è¦éªŒè¯çš„åœ°åŒºIDï¼ˆå¦‚ï¼šjapanã€koreaã€ukï¼‰

.EXAMPLE
    .\verify-audio-config.ps1 -RegionId "japan"

.EXAMPLE
    .\verify-audio-config.ps1 "uk"
#>

param(
    [Parameter(Mandatory = $true, Position = 0)]
    [string]$RegionId
)

$ErrorActionPreference = "Stop"

Write-Host "`n========================================" -ForegroundColor Cyan
Write-Host "éŸ³é¢‘é…ç½®éªŒè¯ï¼š$RegionId" -ForegroundColor Cyan
Write-Host "========================================`n" -ForegroundColor Cyan

$allPassed = $true

# æ­¥éª¤1ï¼šæ£€æŸ¥åˆ†åŒ…ç›®å½•å’ŒéŸ³é¢‘æ–‡ä»¶
Write-Host "æ­¥éª¤1ï¼šæ£€æŸ¥åˆ†åŒ…ç›®å½•å’ŒéŸ³é¢‘æ–‡ä»¶..." -ForegroundColor Cyan

# æ¨æµ‹åˆ†åŒ…ç›®å½•åï¼ˆé¦–å­—æ¯å¤§å†™ï¼‰
$packageName = "package" + (Get-Culture).TextInfo.ToTitleCase($RegionId.ToLower())
$packagePath = "miniprogram\$packageName"

if (Test-Path $packagePath) {
    $audioFiles = Get-ChildItem $packagePath -Filter *.mp3 -File
    if ($audioFiles.Count -gt 0) {
        Write-Host "  âœ… åˆ†åŒ…ç›®å½•å­˜åœ¨ï¼š$packagePath" -ForegroundColor Green
        Write-Host "  âœ… æ‰¾åˆ° $($audioFiles.Count) ä¸ªéŸ³é¢‘æ–‡ä»¶" -ForegroundColor Green
    }
    else {
        Write-Host "  âŒ åˆ†åŒ…ç›®å½•å­˜åœ¨ä½†æ²¡æœ‰éŸ³é¢‘æ–‡ä»¶" -ForegroundColor Red
        $allPassed = $false
    }
}
else {
    Write-Host "  âŒ åˆ†åŒ…ç›®å½•ä¸å­˜åœ¨ï¼š$packagePath" -ForegroundColor Red
    $allPassed = $false
}

# æ­¥éª¤2ï¼šæ£€æŸ¥æ•°æ®æ–‡ä»¶
Write-Host "`næ­¥éª¤2ï¼šæ£€æŸ¥æ•°æ®æ–‡ä»¶..." -ForegroundColor Cyan

$dataFile = "miniprogram\data\regions\$RegionId.js"
if (Test-Path $dataFile) {
    Write-Host "  âœ… æ•°æ®æ–‡ä»¶å­˜åœ¨ï¼š$dataFile" -ForegroundColor Green

    # æ£€æŸ¥æ•°æ®æ–‡ä»¶ä¸­çš„éŸ³é¢‘æ•°é‡
    $dataContent = Get-Content $dataFile -Raw
    $clipMatches = [regex]::Matches($dataContent, 'mp3_file:')

    Write-Host "  âœ… æ•°æ®æ–‡ä»¶åŒ…å« $($clipMatches.Count) ä¸ªéŸ³é¢‘è®°å½•" -ForegroundColor Green

    # å¯¹æ¯”éŸ³é¢‘æ–‡ä»¶æ•°é‡å’Œæ•°æ®è®°å½•æ•°é‡
    if ($audioFiles -and $audioFiles.Count -eq $clipMatches.Count) {
        Write-Host "  âœ… éŸ³é¢‘æ–‡ä»¶æ•°é‡ä¸æ•°æ®è®°å½•ä¸€è‡´" -ForegroundColor Green
    }
    elseif ($audioFiles) {
        Write-Host "  âš ï¸  è­¦å‘Šï¼šéŸ³é¢‘æ–‡ä»¶($($audioFiles.Count))ä¸æ•°æ®è®°å½•($($clipMatches.Count))æ•°é‡ä¸ä¸€è‡´" -ForegroundColor Yellow
    }
}
else {
    Write-Host "  âŒ æ•°æ®æ–‡ä»¶ä¸å­˜åœ¨ï¼š$dataFile" -ForegroundColor Red
    $allPassed = $false
}

# æ­¥éª¤4ï¼šæ£€æŸ¥app.jsoné…ç½®
Write-Host "`næ­¥éª¤4ï¼šæ£€æŸ¥app.jsoné…ç½®..." -ForegroundColor Cyan

$appJson = "miniprogram\app.json"
if (Test-Path $appJson) {
    $appJsonContent = Get-Content $appJson -Raw

    # æ£€æŸ¥subPackages
    if ($appJsonContent -match "`"root`":\s*`"$packageName`"") {
        Write-Host "  âœ… app.jsonä¸­å·²é…ç½®subPackages" -ForegroundColor Green
    }
    else {
        Write-Host "  âŒ app.jsonä¸­æœªæ‰¾åˆ°subPackagesé…ç½®" -ForegroundColor Red
        $allPassed = $false
    }

    # æ£€æŸ¥preloadRule
    if ($appJsonContent -match "preloadRule") {
        Write-Host "  âœ… app.jsonä¸­å·²é…ç½®preloadRule" -ForegroundColor Green
    }
    else {
        Write-Host "  âš ï¸  app.jsonä¸­æœªæ‰¾åˆ°preloadRuleé…ç½®" -ForegroundColor Yellow
    }
}

# æ­¥éª¤6ï¼šæ£€æŸ¥audio-config.js
Write-Host "`næ­¥éª¤6ï¼šæ£€æŸ¥audio-config.js..." -ForegroundColor Cyan

$audioConfig = "miniprogram\utils\audio-config.js"
if (Test-Path $audioConfig) {
    $audioConfigContent = Get-Content $audioConfig -Raw

    if ($audioConfigContent -match "id:\s*[`"']$RegionId[`"']") {
        Write-Host "  âœ… audio-config.jsä¸­å·²æ·»åŠ åœ°åŒºé…ç½®" -ForegroundColor Green
    }
    else {
        Write-Host "  âŒ audio-config.jsä¸­æœªæ‰¾åˆ°åœ°åŒºé…ç½®ï¼ˆid: '$RegionId'ï¼‰" -ForegroundColor Red
        $allPassed = $false
    }
}
else {
    Write-Host "  âŒ audio-config.jsæ–‡ä»¶ä¸å­˜åœ¨" -ForegroundColor Red
    $allPassed = $false
}

# æ­¥éª¤7ï¼šæ£€æŸ¥audio-package-loader.js
Write-Host "`næ­¥éª¤7ï¼šæ£€æŸ¥audio-package-loader.js..." -ForegroundColor Cyan

$audioLoader = "miniprogram\utils\audio-package-loader.js"
if (Test-Path $audioLoader) {
    $audioLoaderContent = Get-Content $audioLoader -Raw

    if ($audioLoaderContent -match "[`"']$RegionId[`"']:\s*\{") {
        Write-Host "  âœ… audio-package-loader.jsä¸­å·²æ·»åŠ åˆ†åŒ…æ˜ å°„" -ForegroundColor Green
    }
    else {
        Write-Host "  âŒ audio-package-loader.jsä¸­æœªæ‰¾åˆ°åˆ†åŒ…æ˜ å°„ï¼ˆ'$RegionId': {...}ï¼‰" -ForegroundColor Red
        $allPassed = $false
    }
}
else {
    Write-Host "  âŒ audio-package-loader.jsæ–‡ä»¶ä¸å­˜åœ¨" -ForegroundColor Red
    $allPassed = $false
}

# æ­¥éª¤8ï¼šæ£€æŸ¥audio-player
Write-Host "`næ­¥éª¤8ï¼šæ£€æŸ¥audio-player..." -ForegroundColor Cyan

$audioPlayerFiles = @(
    "miniprogram\pages\audio-player\index.ts",
    "miniprogram\pages\audio-player\index.js",
    "miniprogram\packageAudioPages\pages\audio-player\index.ts",
    "miniprogram\packageAudioPages\pages\audio-player\index.js"
)

$audioPlayerFound = $false
foreach ($audioPlayerFile in $audioPlayerFiles) {
    if (Test-Path $audioPlayerFile) {
        $audioPlayerContent = Get-Content $audioPlayerFile -Raw

        if ($audioPlayerContent -match "[`"']$RegionId[`"']:\s*[`"']/package") {
            Write-Host "  âœ… $audioPlayerFile ä¸­å·²æ·»åŠ è·¯å¾„æ˜ å°„" -ForegroundColor Green
            $audioPlayerFound = $true
            break
        }
    }
}

if (-not $audioPlayerFound) {
    Write-Host "  âŒ audio-playerä¸­æœªæ‰¾åˆ°è·¯å¾„æ˜ å°„ï¼ˆ'$RegionId': '/package...'ï¼‰" -ForegroundColor Red
    $allPassed = $false
}

# æ€»ç»“
Write-Host "`n========================================" -ForegroundColor Gray

if ($allPassed) {
    Write-Host "âœ… æ‰€æœ‰é…ç½®æ£€æŸ¥é€šè¿‡ï¼" -ForegroundColor Green
    Write-Host "`nå»ºè®®è¿›è¡ŒåŠŸèƒ½æµ‹è¯•ï¼š" -ForegroundColor Cyan
    Write-Host "  1. ç¼–è¯‘å°ç¨‹åº" -ForegroundColor Gray
    Write-Host "  2. æ£€æŸ¥åœ°åŒºåˆ—è¡¨èƒ½å¦çœ‹åˆ°è¯¥å›½å®¶" -ForegroundColor Gray
    Write-Host "  3. ç‚¹å‡»åœ°åŒºåéŸ³é¢‘åˆ—è¡¨æ˜¯å¦æ­£å¸¸æ˜¾ç¤º" -ForegroundColor Gray
    Write-Host "  4. ç‚¹å‡»éŸ³é¢‘åèƒ½å¦æ­£å¸¸æ’­æ”¾" -ForegroundColor Gray
    Write-Host "  5. ç¦»çº¿æ¨¡å¼ä¸‹æ‰€æœ‰åŠŸèƒ½æ˜¯å¦æ­£å¸¸" -ForegroundColor Gray
}
else {
    Write-Host "âŒ é…ç½®æ£€æŸ¥å¤±è´¥ï¼" -ForegroundColor Red
    Write-Host "`nè¯·å‚è€ƒã€ŠæŠ€æœ¯å‚è€ƒå’Œæœ€ä½³å®è·µ.mdã€‹å®Œæˆ8æ­¥é…ç½®" -ForegroundColor Yellow
}

Write-Host "`n========================================`n" -ForegroundColor Cyan
```

---

## ğŸ“ˆ è„šæœ¬7ï¼šä¼˜åŒ–æŠ¥å‘Šç”Ÿæˆ

**æ–‡ä»¶å**: `generate-optimization-report.ps1`

**åŠŸèƒ½**ï¼šç”Ÿæˆä¼˜åŒ–å‰åå¯¹æ¯”æŠ¥å‘Š

### è„šæœ¬ä»£ç 

```powershell
<#
.SYNOPSIS
    FlightToolbox ä¼˜åŒ–æŠ¥å‘Šç”Ÿæˆè„šæœ¬

.DESCRIPTION
    ç”Ÿæˆä¼˜åŒ–å‰åå¯¹æ¯”æŠ¥å‘Šï¼ŒåŒ…å«ä¸»åŒ…å¤§å°ã€åˆ†åŒ…æ•°é‡ã€ä¼˜åŒ–å»ºè®®ç­‰

.EXAMPLE
    .\generate-optimization-report.ps1
#>

$ErrorActionPreference = "Stop"

$reportFile = "optimization-report-$(Get-Date -Format 'yyyyMMdd-HHmmss').txt"

Write-Host "`n========================================" -ForegroundColor Cyan
Write-Host "FlightToolbox ä¼˜åŒ–æŠ¥å‘Šç”Ÿæˆ" -ForegroundColor Cyan
Write-Host "========================================`n" -ForegroundColor Cyan

# å¼€å§‹ç”ŸæˆæŠ¥å‘Š
$report = @()
$report += "FlightToolbox ä¸»åŒ…ä¼˜åŒ–æŠ¥å‘Š"
$report += "=" * 70
$report += "ç”Ÿæˆæ—¶é—´ï¼š$(Get-Date -Format 'yyyy-MM-dd HH:mm:ss')"
$report += ""

# 1. ä¸»åŒ…å¤§å°åˆ†æ
$report += "ä¸€ã€ä¸»åŒ…å¤§å°åˆ†æ"
$report += "-" * 70

$mainPackageDirs = @('pages', 'data', 'utils', 'images', 'audio', 'components')
$totalSize = 0

foreach ($dir in $mainPackageDirs) {
    $path = "miniprogram\$dir"
    if (Test-Path $path) {
        $size = (Get-ChildItem $path -Recurse -File -ErrorAction SilentlyContinue |
            Measure-Object -Property Length -Sum -ErrorAction SilentlyContinue).Sum
        if ($null -ne $size) {
            $sizeKB = [math]::Round($size / 1KB, 2)
            $totalSize += $size
            $report += "$dir : $sizeKB KB"
        }
    }
}

$totalKB = [math]::Round($totalSize / 1KB, 2)
$totalMB = [math]::Round($totalSize / 1MB, 2)
$report += "-" * 70
$report += "ä¸»åŒ…æ€»è®¡ï¼š$totalKB KB ($totalMB MB)"

$maxMainSizeKB = 2048
$remainingKB = $maxMainSizeKB - $totalKB

if ($totalKB -gt $maxMainSizeKB) {
    $overKB = $totalKB - $maxMainSizeKB
    $report += "çŠ¶æ€ï¼šâŒ è¶…å‡ºé™åˆ¶ $overKB KB"
}
else {
    $report += "çŠ¶æ€ï¼šâœ… æ­£å¸¸ï¼ˆå‰©ä½™ç©ºé—´ $remainingKB KBï¼‰"
}

$report += ""

# 2. åˆ†åŒ…ç»Ÿè®¡
$report += "äºŒã€åˆ†åŒ…ç»Ÿè®¡"
$report += "-" * 70

$subPackages = Get-ChildItem "miniprogram" -Directory -ErrorAction SilentlyContinue |
    Where-Object { $_.Name -like 'package*' }

$report += "åˆ†åŒ…æ•°é‡ï¼š$($subPackages.Count)"

$functionCount = 0
$audioCount = 0

foreach ($package in $subPackages) {
    if ($package.Name -match "Japan|Korea|Singapore|Thailand|Vietnam|Malaysia|Indonesia|India|Philippines|" +
        "HongKong|Taipei|Macau|Russia|Turkey|France|Italy|UK|Spain|Germany|Holland|" +
        "America|Canada|Australia|NewZealand|Egypt|UAE|Srilanka|Maldive|Cambodia|Myanmar|Uzbekistan") {
        $audioCount++
    }
    else {
        $functionCount++
    }
}

$report += "  - åŠŸèƒ½åˆ†åŒ…ï¼š$functionCount ä¸ª"
$report += "  - éŸ³é¢‘åˆ†åŒ…ï¼š$audioCount ä¸ª"
$report += ""

# 3. ä¼˜åŒ–å»ºè®®
$report += "ä¸‰ã€ä¼˜åŒ–å»ºè®®"
$report += "-" * 70

if ($totalKB -gt 2048) {
    $report += "ğŸš¨ ç´§æ€¥ä¼˜åŒ–å»ºè®®ï¼š"
    $report += "  ä¸»åŒ…å·²è¶…å‡º2MBé™åˆ¶ï¼Œå¿…é¡»ç«‹å³ä¼˜åŒ–ï¼"
    $report += ""
    $report += "æ¨èæ–¹æ¡ˆï¼š"
    $report += "  1. æ‰§è¡Œé˜¶æ®µ1ï¼ˆä½é£é™©å¿«é€Ÿä¼˜åŒ–ï¼‰- é¢„è®¡èŠ‚çœ312-412KB"
    $report += "  2. æ‰§è¡Œé˜¶æ®µ2ï¼ˆä¸­ç­‰é£é™©ä¼˜åŒ–ï¼‰- é¢„è®¡èŠ‚çœ615KB"
    $report += "  å®Œæˆåä¸»åŒ…çº¦1671KBï¼Œæ»¡è¶³2MBé™åˆ¶"
}
elseif ($totalKB -gt 1800) {
    $report += "âš ï¸  è­¦å‘Šï¼šä¸»åŒ…æ¥è¿‘2MBé™åˆ¶"
    $report += ""
    $report += "å»ºè®®æ–¹æ¡ˆï¼š"
    $report += "  1. æ‰§è¡Œé˜¶æ®µ1ï¼ˆä½é£é™©å¿«é€Ÿä¼˜åŒ–ï¼‰"
    $report += "  2. è§†æƒ…å†µæ‰§è¡Œé˜¶æ®µ2"
}
else {
    $report += "âœ… ä¸»åŒ…å¤§å°æ­£å¸¸"
    $report += "  å½“å‰ä¸»åŒ…åœ¨åˆç†èŒƒå›´å†…ï¼Œå¯æš‚ä¸ä¼˜åŒ–"
}

$report += ""
$report += "=" * 70
$report += "æŠ¥å‘Šç»“æŸ"

# è¾“å‡ºåˆ°æ–‡ä»¶
$report | Out-File $reportFile -Encoding UTF8

Write-Host "âœ… æŠ¥å‘Šå·²ç”Ÿæˆï¼š$reportFile" -ForegroundColor Green

# åŒæ—¶æ˜¾ç¤ºåœ¨æ§åˆ¶å°
Write-Host "`næŠ¥å‘Šå†…å®¹ï¼š" -ForegroundColor Cyan
Write-Host ("=" * 70) -ForegroundColor Gray
$report | ForEach-Object { Write-Host $_ }
Write-Host ("=" * 70) -ForegroundColor Gray

Write-Host "`n========================================`n" -ForegroundColor Cyan
```

---

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### å®Œæ•´éªŒè¯æµç¨‹ç¤ºä¾‹

```powershell
# åˆ‡æ¢åˆ°é¡¹ç›®æ ¹ç›®å½•
cd D:\FlightToolbox

# 1. æ£€æŸ¥ä¸»åŒ…å¤§å°
.\åˆ†åŒ…æ–¹æ¡ˆ3\monitor-main-package-size.ps1

# 2. åˆ†æé¡µé¢
.\åˆ†åŒ…æ–¹æ¡ˆ3\analyze-pages.ps1

# 3. åˆ†ææ•°æ®æ–‡ä»¶
.\åˆ†åŒ…æ–¹æ¡ˆ3\analyze-data-files.ps1

# 4. ç»Ÿè®¡åˆ†åŒ…
.\åˆ†åŒ…æ–¹æ¡ˆ3\stats-subpackages.ps1

# 5. æ£€æŸ¥é¡µé¢å¼•ç”¨ï¼ˆä¼˜åŒ–åéªŒè¯ï¼‰
.\åˆ†åŒ…æ–¹æ¡ˆ3\check-page-references.ps1 "communication-failure"

# 6. éªŒè¯éŸ³é¢‘é…ç½®ï¼ˆæ–°å¢éŸ³é¢‘åˆ†åŒ…åï¼‰
.\åˆ†åŒ…æ–¹æ¡ˆ3\verify-audio-config.ps1 "japan"

# 7. ç”Ÿæˆä¼˜åŒ–æŠ¥å‘Š
.\åˆ†åŒ…æ–¹æ¡ˆ3\generate-optimization-report.ps1
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### PowerShellæ‰§è¡Œç­–ç•¥

å¦‚æœé‡åˆ°"æ— æ³•è¿è¡Œè„šæœ¬"é”™è¯¯ï¼Œéœ€è¦è®¾ç½®æ‰§è¡Œç­–ç•¥ï¼š

```powershell
# æŸ¥çœ‹å½“å‰æ‰§è¡Œç­–ç•¥
Get-ExecutionPolicy

# ä¸´æ—¶å…è®¸è¿è¡Œè„šæœ¬ï¼ˆå½“å‰ä¼šè¯ï¼‰
Set-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass

# æˆ–è€…ç›´æ¥è¿è¡Œè„šæœ¬æ—¶ç»•è¿‡ç­–ç•¥
powershell -ExecutionPolicy Bypass -File .\script.ps1
```

### å­—ç¬¦ç¼–ç é—®é¢˜

å¦‚æœè„šæœ¬è¾“å‡ºä¹±ç ï¼Œå°è¯•ï¼š

```powershell
# è®¾ç½®æ§åˆ¶å°ç¼–ç ä¸ºUTF-8
[Console]::OutputEncoding = [System.Text.Encoding]::UTF8
chcp 65001
```

### æƒé™é—®é¢˜

æŸäº›è„šæœ¬å¯èƒ½éœ€è¦ç®¡ç†å‘˜æƒé™ï¼š

```powershell
# ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡ŒPowerShell
# å³é”®ç‚¹å‡»PowerShellå›¾æ ‡ -> "ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ"
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **å®æ–½æ–‡æ¡£**ï¼š
  - é˜¶æ®µ1-ä½é£é™©å¿«é€Ÿä¼˜åŒ–.md
  - é˜¶æ®µ2-ä¸­ç­‰é£é™©ä¼˜åŒ–.md
  - é˜¶æ®µ3-é©¾é©¶èˆ±åˆ†åŒ…(å¯é€‰).md

- **æ”¯æŒæ–‡æ¡£**ï¼š
  - éªŒè¯å’Œå›æ»šæŒ‡å—.md
  - æŠ€æœ¯å‚è€ƒå’Œæœ€ä½³å®è·µ.md

---

**æ–‡æ¡£åˆ›å»ºæ—¶é—´**: 2025-11-01
**ç»´æŠ¤è€…**: FlightToolbox AI Assistant
**ç‰ˆæœ¬**: v1.0
