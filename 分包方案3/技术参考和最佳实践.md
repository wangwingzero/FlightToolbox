# æŠ€æœ¯å‚è€ƒå’Œæœ€ä½³å®è·µ

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¥æœŸ**: 2025-11-01
**é€‚ç”¨èŒƒå›´**: æ‰€æœ‰åˆ†åŒ…å¼€å‘
**é‡è¦ç­‰çº§**: â­â­â­â­

---

## ğŸ“‹ æ–‡æ¡£æ¦‚è¿°

æœ¬æ–‡æ¡£æ€»ç»“FlightToolboxé¡¹ç›®çš„æŠ€æœ¯ç»éªŒå’Œæœ€ä½³å®è·µï¼Œç‰¹åˆ«æ˜¯éŸ³é¢‘åˆ†åŒ…çš„8æ­¥é…ç½®æµç¨‹å’Œç¦»çº¿ä¼˜å…ˆè®¾è®¡åŸåˆ™ã€‚

---

## ğŸµ éŸ³é¢‘åˆ†åŒ…8æ­¥é…ç½®ç»éªŒï¼ˆæ ¸å¿ƒï¼‰

### å†å²æ•™è®­

åœ¨å®æ–½UKå’ŒChinese TaipeiéŸ³é¢‘åˆ†åŒ…æ—¶ï¼Œæœ€åˆåªå®Œæˆäº†5æ­¥é…ç½®ï¼Œå¯¼è‡´éŸ³é¢‘æ— æ³•æ’­æ”¾ã€‚ç»è¿‡æ’æŸ¥å‘ç°ï¼Œ**å¿…é¡»å®Œæˆå…¨éƒ¨8æ­¥é…ç½®**ï¼Œç¼ºå°‘ä»»ä½•ä¸€æ­¥éƒ½ä¼šå¯¼è‡´åŠŸèƒ½å¤±æ•ˆã€‚

### å®Œæ•´8æ­¥æµç¨‹

```
æ­¥éª¤1: åˆ›å»ºåˆ†åŒ…ç›®å½•å’ŒéŸ³é¢‘æ–‡ä»¶
æ­¥éª¤2: åˆ›å»ºæ•°æ®æ–‡ä»¶ï¼ˆdata/regions/{country}.jsï¼‰
æ­¥éª¤3: ç»Ÿè®¡å¤§å°å¹¶é€‰æ‹©é¢„åŠ è½½é¡µé¢
æ­¥éª¤4: æ›´æ–° app.jsonï¼ˆsubPackages + preloadRuleï¼‰
æ­¥éª¤5: æ›´æ–° utils/audio-preload-guide.js
æ­¥éª¤6: æ›´æ–° utils/audio-config.js         â† ğŸ”¥ å…³é”®ï¼ˆé¡µé¢æ˜¾ç¤ºï¼‰
æ­¥éª¤7: æ›´æ–° utils/audio-package-loader.js  â† ğŸ”¥ å…³é”®ï¼ˆåˆ†åŒ…åŠ è½½ï¼‰
æ­¥éª¤8: æ›´æ–° pages/audio-player/index.ts   â† ğŸ”¥ å…³é”®ï¼ˆéŸ³é¢‘æ’­æ”¾ï¼‰
```

**æ­¥éª¤6-8ç»å¸¸è¢«é—æ¼**ï¼Œæ˜¯å¯¼è‡´éŸ³é¢‘æ— æ³•æ’­æ”¾çš„ä¸»è¦åŸå› ï¼

---

### æ­¥éª¤1ï¼šåˆ›å»ºåˆ†åŒ…ç›®å½•å’ŒéŸ³é¢‘æ–‡ä»¶

**ç›®å½•ç»“æ„**ï¼š

```
miniprogram/
â””â”€â”€ packageJapan/            # åˆ†åŒ…æ ¹ç›®å½•
    â”œâ”€â”€ China-Eastern-7551_Contact-Tokyo-Tower.mp3
    â”œâ”€â”€ JAL456_Descend-FL250.mp3
    â”œâ”€â”€ ANA789_Request-Direct.mp3
    â””â”€â”€ ...ï¼ˆæ›´å¤šéŸ³é¢‘æ–‡ä»¶ï¼‰
```

**PowerShellå‘½ä»¤**ï¼š

```powershell
# åˆ›å»ºåˆ†åŒ…ç›®å½•
New-Item -ItemType Directory -Path miniprogram\packageJapan -Force

# å¤åˆ¶éŸ³é¢‘æ–‡ä»¶åˆ°åˆ†åŒ…
Copy-Item source\japan\*.mp3 miniprogram\packageJapan\
```

**éŸ³é¢‘æ–‡ä»¶å‘½åè§„èŒƒ**ï¼š

```
æ ¼å¼ï¼š{èˆªç­å·}_{åœºæ™¯æè¿°}.mp3
ç¤ºä¾‹ï¼šChina-Eastern-7551_Contact-Tokyo-Tower.mp3

è§„åˆ™ï¼š
âœ… ä½¿ç”¨è¿å­—ç¬¦ï¼ˆ-ï¼‰åˆ†éš”å•è¯
âœ… ä½¿ç”¨ä¸‹åˆ’çº¿ï¼ˆ_ï¼‰åˆ†éš”èˆªç­å·å’Œåœºæ™¯
âœ… åœºæ™¯æè¿°é¦–å­—æ¯å¤§å†™
âŒ ä¸ä½¿ç”¨ç©ºæ ¼
âŒ ä¸ä½¿ç”¨ä¸­æ–‡
```

---

### æ­¥éª¤2ï¼šåˆ›å»ºæ•°æ®æ–‡ä»¶

**æ–‡ä»¶ä½ç½®**ï¼š`miniprogram/data/regions/{regionId}.js`

**æ•°æ®ç»“æ„ç¤ºä¾‹**ï¼š

```javascript
// data/regions/japan.js
module.exports = {
  regionId: 'japan',
  regionName: 'æ—¥æœ¬',
  airports: [
    {
      airportId: 'RJTT',
      airportName: 'ä¸œäº¬æˆç”°',
      icaoCode: 'RJTT',
      iataCode: 'NRT',
      clips: [
        {
          id: 'rjtt_001',
          mp3_file: 'China-Eastern-7551_Contact-Tokyo-Tower.mp3',
          callsign: 'China Eastern 7551',
          scenario: 'Contact Tokyo Tower',
          transcript: 'Tokyo Tower, China Eastern Seven Five Five One, passing three thousand feet for two thousand...',
          translation: 'ä¸œäº¬å¡”å°ï¼Œä¸œæ–¹èˆªç©º7551ï¼Œé€šè¿‡3000è‹±å°ºä¸‹é™åˆ°2000...',
          altitude: '3000',
          phase: 'approach'
        },
        {
          id: 'rjtt_002',
          mp3_file: 'JAL456_Descend-FL250.mp3',
          callsign: 'JAL 456',
          scenario: 'Descend to FL250',
          transcript: 'JAL Four Five Six, descend and maintain flight level two five zero...',
          translation: 'JAL456ï¼Œä¸‹é™ä¿æŒé«˜åº¦å±‚250...',
          altitude: 'FL250',
          phase: 'cruise'
        }
        // ... æ›´å¤šéŸ³é¢‘ç‰‡æ®µ
      ]
    }
  ]
};
```

**å…³é”®å­—æ®µè¯´æ˜**ï¼š

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| `regionId` | String | âœ… | åœ°åŒºå”¯ä¸€æ ‡è¯†ï¼Œå¿…é¡»ä¸æ–‡ä»¶åå’Œåˆ†åŒ…é…ç½®ä¸€è‡´ |
| `regionName` | String | âœ… | åœ°åŒºä¸­æ–‡åç§° |
| `airports` | Array | âœ… | æœºåœºåˆ—è¡¨ |
| `airportId` | String | âœ… | æœºåœºå”¯ä¸€æ ‡è¯† |
| `clips` | Array | âœ… | éŸ³é¢‘ç‰‡æ®µåˆ—è¡¨ |
| `id` | String | âœ… | éŸ³é¢‘ç‰‡æ®µå”¯ä¸€ID |
| `mp3_file` | String | âœ… | éŸ³é¢‘æ–‡ä»¶åï¼ˆå¿…é¡»ä¸åˆ†åŒ…ä¸­çš„æ–‡ä»¶åå®Œå…¨ä¸€è‡´ï¼‰ |
| `transcript` | String | âœ… | è‹±æ–‡åŸæ–‡ |
| `translation` | String | âœ… | ä¸­æ–‡ç¿»è¯‘ |

---

### æ­¥éª¤3ï¼šç»Ÿè®¡å¤§å°å¹¶é€‰æ‹©é¢„åŠ è½½é¡µé¢

**ç»Ÿè®¡åˆ†åŒ…å¤§å°**ï¼š

```powershell
# ç»Ÿè®¡å•ä¸ªåˆ†åŒ…å¤§å°
$size = (Get-ChildItem packageJapan -Recurse -File |
  Measure-Object -Property Length -Sum).Sum
$sizeMB = [math]::Round($size / 1MB, 2)
Write-Output "packageJapan: $sizeMB MB"
```

**é€‰æ‹©é¢„åŠ è½½é¡µé¢çš„åŸåˆ™**ï¼š

```
è§„åˆ™1ï¼šå•é¡µé¢é¢„åŠ è½½æ€»å¤§å°å¿…é¡» < 2MB

è§„åˆ™2ï¼šä¸èƒ½åœ¨TabBaré¡µé¢é¢„åŠ è½½éŸ³é¢‘åˆ†åŒ…
âŒ pages/home/index - TabBaré¡µé¢ï¼Œç¦æ­¢
âŒ pages/operations/index - TabBaré¡µé¢ï¼Œç¦æ­¢ï¼ˆé™¤éåˆ†åŒ…å¾ˆå°ï¼‰
âœ… pages/airline-recordings/index - éTabBarï¼Œå¯ä»¥é¢„åŠ è½½

è§„åˆ™3ï¼šé€‰æ‹©ç”¨æˆ·è®¿é—®è·¯å¾„ä¸Šçš„é¡µé¢
æœ€ä½³ï¼šèˆªçº¿å½•éŸ³ç›¸å…³é¡µé¢
æ¬¡ä½³ï¼šé€šä¿¡ç›¸å…³é¡µé¢

è§„åˆ™4ï¼šåˆ†æ•£é¢„åŠ è½½ï¼Œé¿å…å•é¡µé¢è´Ÿæ‹…è¿‡é‡
å¦‚æœæœ‰å¤šä¸ªéŸ³é¢‘åˆ†åŒ…ï¼Œåˆ†æ•£åˆ°ä¸åŒé¡µé¢é¢„åŠ è½½
```

**é¢„åŠ è½½é¡µé¢åˆ†é…ç¤ºä¾‹**ï¼š

```javascript
// å‡è®¾æœ‰32ä¸ªéŸ³é¢‘åˆ†åŒ…ï¼Œéœ€è¦åˆ†æ•£é¢„åŠ è½½

// é¡µé¢Aï¼šé¢„åŠ è½½äºšæ´²åœ°åŒºï¼ˆçº¦1.8MBï¼‰
"pages/airline-recordings/index": {
  "network": "all",
  "packages": ["japanAudioPackage", "koreanAudioPackage", "singaporeAudioPackage"]
}

// é¡µé¢Bï¼šé¢„åŠ è½½æ¬§æ´²åœ°åŒºï¼ˆçº¦1.7MBï¼‰
"pages/recording-categories/index": {
  "network": "all",
  "packages": ["ukAudioPackage", "franceAudioPackage", "germanyAudioPackage"]
}

// é¡µé¢Cï¼šé¢„åŠ è½½ç¾æ´²åœ°åŒºï¼ˆçº¦1.9MBï¼‰
"pages/recording-clips/index": {
  "network": "all",
  "packages": ["americaAudioPackage", "canadaAudioPackage"]
}
```

---

### æ­¥éª¤4ï¼šæ›´æ–°app.json

**æ·»åŠ subPackagesé…ç½®**ï¼š

```json
{
  "subPackages": [
    {
      "root": "packageJapan",
      "name": "japanAudioPackage",
      "pages": []
    }
  ]
}
```

âš ï¸ **æ³¨æ„**ï¼š
- `root`: åˆ†åŒ…æ ¹ç›®å½•ï¼Œç›¸å¯¹äºminiprogram
- `name`: åˆ†åŒ…åç§°ï¼Œç”¨äºé¢„åŠ è½½å’Œwx.loadSubpackage
- `pages`: éŸ³é¢‘åˆ†åŒ…é€šå¸¸ä¸ºç©ºæ•°ç»„ï¼ˆä»…åŒ…å«éŸ³é¢‘æ–‡ä»¶ï¼Œæ— é¡µé¢ï¼‰

**æ·»åŠ preloadRuleé…ç½®**ï¼š

```json
{
  "preloadRule": {
    "pages/airline-recordings/index": {
      "network": "all",
      "packages": ["japanAudioPackage"]
    }
  }
}
```

---

### æ­¥éª¤5ï¼šæ›´æ–°audio-preload-guide.js

**æ–‡ä»¶ä½ç½®**ï¼š`miniprogram/utils/audio-preload-guide.js`

**æ·»åŠ æ–°åœ°åŒºé…ç½®**ï¼š

```javascript
module.exports = {
  // åœ°åŒºåˆ†ç»„å’Œé¢„åŠ è½½å¼•å¯¼
  regionGroups: [
    {
      groupName: 'äºšæ´²åœ°åŒº',
      regions: [
        {
          regionId: 'japan',
          regionName: 'æ—¥æœ¬',
          packageName: 'japanAudioPackage',
          clipCount: 45,
          preloadPage: 'pages/airline-recordings/index',
          estimatedSize: '1.2 MB'
        }
        // ... å…¶ä»–äºšæ´²åœ°åŒº
      ]
    }
  ]
};
```

---

### æ­¥éª¤6ï¼šæ›´æ–°audio-config.jsï¼ˆğŸ”¥å…³é”®ï¼‰

**æ–‡ä»¶ä½ç½®**ï¼š`miniprogram/utils/audio-config.js`

è¿™ä¸€æ­¥æ§åˆ¶**é¡µé¢æ˜¾ç¤º**ï¼Œç¼ºå°‘ä¼šå¯¼è‡´åœ°åŒºåˆ—è¡¨çœ‹ä¸åˆ°è¯¥å›½å®¶ã€‚

**æ·»åŠ åœ°åŒºå…ƒæ•°æ®**ï¼š

```javascript
module.exports = {
  regions: [
    {
      id: 'japan',
      name: 'æ—¥æœ¬',
      packageRoot: 'packageJapan',
      clipCount: 45,
      icon: '/images/flags/japan.png'
    }
    // ... å…¶ä»–åœ°åŒº
  ],

  // æœºåœºæ•°æ®ï¼ˆå…³è”åˆ°åœ°åŒºï¼‰
  airports: [
    {
      regionId: 'japan',
      airportId: 'RJTT',
      airportName: 'ä¸œäº¬æˆç”°',
      clips: require('../data/regions/japan.js').airports[0].clips
    }
    // ... å…¶ä»–æœºåœº
  ]
};
```

âš ï¸ **å¸¸è§é”™è¯¯**ï¼š
- âŒ `id` å­—æ®µæ‹¼å†™é”™è¯¯æˆ–ä¸æ•°æ®æ–‡ä»¶ä¸ä¸€è‡´
- âŒ `packageRoot` è·¯å¾„é”™è¯¯
- âŒ `clips` å¼•ç”¨è·¯å¾„é”™è¯¯

---

### æ­¥éª¤7ï¼šæ›´æ–°audio-package-loader.jsï¼ˆğŸ”¥å…³é”®ï¼‰

**æ–‡ä»¶ä½ç½®**ï¼š`miniprogram/utils/audio-package-loader.js`

è¿™ä¸€æ­¥æ§åˆ¶**åˆ†åŒ…åŠ è½½**ï¼Œç¼ºå°‘ä¼šå¯¼è‡´ç‚¹å‡»æ’­æ”¾æ—¶æç¤º"åˆ†åŒ…åŠ è½½å¤±è´¥"ã€‚

**æ·»åŠ åˆ†åŒ…æ˜ å°„**ï¼š

```javascript
module.exports = {
  packageMapping: {
    'japan': {
      packageName: 'japanAudioPackage',
      packageRoot: 'packageJapan'
    }
    // ... å…¶ä»–åœ°åŒº
  },

  loadAudioPackage: function(regionId, successCallback, failCallback) {
    var packageInfo = this.packageMapping[regionId];
    if (!packageInfo) {
      var error = new Error('æœªæ‰¾åˆ°éŸ³é¢‘åˆ†åŒ…: ' + regionId);
      failCallback && failCallback(error);
      return;
    }

    wx.loadSubpackage({
      name: packageInfo.packageName,
      success: function() {
        console.log('âœ… éŸ³é¢‘åˆ†åŒ…åŠ è½½æˆåŠŸ:', packageInfo.packageName);
        successCallback && successCallback(packageInfo);
      },
      fail: function(error) {
        console.error('âŒ éŸ³é¢‘åˆ†åŒ…åŠ è½½å¤±è´¥:', packageInfo.packageName, error);
        failCallback && failCallback(error);
      }
    });
  }
};
```

âš ï¸ **å¸¸è§é”™è¯¯**ï¼š
- âŒ `regionId` é”®åä¸æ•°æ®æ–‡ä»¶ä¸ä¸€è‡´
- âŒ `packageName` ä¸app.jsonä¸­çš„nameä¸ä¸€è‡´

---

### æ­¥éª¤8ï¼šæ›´æ–°audio-player/index.tsï¼ˆğŸ”¥å…³é”®ï¼‰

**æ–‡ä»¶ä½ç½®**ï¼š`miniprogram/pages/audio-player/index.ts`

è¿™ä¸€æ­¥æ§åˆ¶**éŸ³é¢‘æ’­æ”¾**ï¼Œç¼ºå°‘ä¼šå¯¼è‡´æ’­æ”¾å™¨åˆå§‹åŒ–å¤±è´¥ã€‚

**æ·»åŠ åœ°åŒºè·¯å¾„æ˜ å°„**ï¼š

```javascript
const pageConfig = {
  // åœ°åŒºéŸ³é¢‘è·¯å¾„æ˜ å°„
  regionPathMap: {
    'japan': '/packageJapan/',
    'korea': '/packageKorean/',
    'singapore': '/packageSingapore/'
    // ... å…¶ä»–åœ°åŒº
  },

  customOnLoad: function(options) {
    const regionId = options.regionId;
    const clipId = options.clipId;

    // è·å–éŸ³é¢‘æ–‡ä»¶è·¯å¾„
    const packagePath = this.regionPathMap[regionId];
    const audioPath = packagePath + clip.mp3_file;

    // åˆå§‹åŒ–éŸ³é¢‘æ’­æ”¾å™¨
    this.initPlayer(clip, audioPath);
  }
};
```

âš ï¸ **å…³é”®æ³¨æ„äº‹é¡¹**ï¼š
- âœ… è·¯å¾„å‰åéƒ½è¦æœ‰æ–œæ ï¼š`'/packageJapan/'`
- âœ… éŸ³é¢‘æ–‡ä»¶è·¯å¾„ = packagePath + mp3_file
- âŒ ä¸èƒ½ç¼ºå°‘å‰å¯¼æ–œæ ï¼š`'packageJapan/'`ï¼ˆé”™è¯¯ï¼‰
- âŒ ä¸èƒ½ç¼ºå°‘å°¾éƒ¨æ–œæ ï¼š`'/packageJapan'`ï¼ˆé”™è¯¯ï¼‰

---

### 8æ­¥éªŒè¯æ¸…å•

æ¯æ¬¡æ–°å¢éŸ³é¢‘åˆ†åŒ…ï¼Œå¿…é¡»éªŒè¯ä»¥ä¸‹8æ­¥éƒ½å·²å®Œæˆï¼š

```
éªŒè¯æ¸…å•ï¼š
âœ… æ­¥éª¤1ï¼šåˆ†åŒ…ç›®å½•å­˜åœ¨ï¼ŒéŸ³é¢‘æ–‡ä»¶å·²å¤åˆ¶
âœ… æ­¥éª¤2ï¼šdata/regions/{regionId}.js æ–‡ä»¶å­˜åœ¨ä¸”æ•°æ®æ­£ç¡®
âœ… æ­¥éª¤3ï¼šåˆ†åŒ…å¤§å°å·²ç»Ÿè®¡ï¼Œé¢„åŠ è½½é¡µé¢å·²é€‰æ‹©
âœ… æ­¥éª¤4ï¼šapp.json ä¸­ subPackages å’Œ preloadRule å·²é…ç½®
âœ… æ­¥éª¤5ï¼šaudio-preload-guide.js å·²æ·»åŠ åœ°åŒºé…ç½®
âœ… æ­¥éª¤6ï¼šaudio-config.js ä¸­ regions å’Œ airports å·²æ·»åŠ 
âœ… æ­¥éª¤7ï¼šaudio-package-loader.js ä¸­ packageMapping å·²æ·»åŠ 
âœ… æ­¥éª¤8ï¼šaudio-player/index.ts ä¸­ regionPathMap å·²æ·»åŠ 

éªŒè¯æ–¹æ³•ï¼š
1. ç¼–è¯‘æˆåŠŸ
2. åœ°åŒºåˆ—è¡¨èƒ½çœ‹åˆ°è¯¥å›½å®¶
3. ç‚¹å‡»åœ°åŒºåéŸ³é¢‘åˆ—è¡¨æ­£å¸¸æ˜¾ç¤º
4. ç‚¹å‡»éŸ³é¢‘åèƒ½æ­£å¸¸æ’­æ”¾
5. ç¦»çº¿æ¨¡å¼ä¸‹æ‰€æœ‰åŠŸèƒ½æ­£å¸¸
```

---

## ğŸ“¦ åˆ†åŒ…å‘½åè§„èŒƒ

### åˆ†åŒ…ç›®å½•å‘½å

```
æ ¼å¼ï¼špackage{Name}

è§„åˆ™ï¼š
âœ… ä»¥ package å¼€å¤´
âœ… åç§°ä½¿ç”¨PascalCaseï¼ˆé¦–å­—æ¯å¤§å†™ï¼‰
âœ… åç§°ç®€æ´ã€æè¿°æ€§å¼º

ç¤ºä¾‹ï¼š
âœ… packageJapan         - æ—¥æœ¬éŸ³é¢‘åˆ†åŒ…
âœ… packageCommFailure   - é€šä¿¡å¤±æ•ˆåˆ†åŒ…
âœ… packageAudioPages    - èˆªçº¿å½•éŸ³é¡µé¢åˆ†åŒ…
âœ… packageCockpit       - é©¾é©¶èˆ±æ¨¡å—åˆ†åŒ…

âŒ package_japan        - ä¸ä½¿ç”¨ä¸‹åˆ’çº¿
âŒ Packagejapan         - ä¸å…¨å°å†™
âŒ package-japan        - ä¸ä½¿ç”¨è¿å­—ç¬¦
```

### åˆ†åŒ…nameå‘½å

```
æ ¼å¼ï¼š{purpose}Package

è§„åˆ™ï¼š
âœ… ä»¥ Package ç»“å°¾
âœ… ç”¨é€”æè¿°ä½¿ç”¨camelCase
âœ… åç§°æ¸…æ™°è¡¨è¾¾åˆ†åŒ…ç”¨é€”

ç¤ºä¾‹ï¼š
âœ… japanAudioPackage              - æ—¥æœ¬éŸ³é¢‘åˆ†åŒ…
âœ… communicationFailurePackage    - é€šä¿¡å¤±æ•ˆåˆ†åŒ…
âœ… audioNavigationPackage         - èˆªçº¿å½•éŸ³å¯¼èˆªåˆ†åŒ…
âœ… cockpitModulesPackage          - é©¾é©¶èˆ±æ¨¡å—åˆ†åŒ…

âŒ japan_audio_package            - ä¸ä½¿ç”¨ä¸‹åˆ’çº¿
âŒ JapanAudioPackage              - ä¸ä½¿ç”¨PascalCase
âŒ package-japan-audio            - ä¸ä½¿ç”¨è¿å­—ç¬¦
```

### regionIdå‘½å

```
æ ¼å¼ï¼š{country-name}ï¼ˆå…¨å°å†™ï¼Œè¿å­—ç¬¦åˆ†éš”ï¼‰

è§„åˆ™ï¼š
âœ… å…¨å°å†™
âœ… å¤šä¸ªå•è¯ç”¨è¿å­—ç¬¦ï¼ˆ-ï¼‰è¿æ¥
âœ… ä½¿ç”¨è‹±æ–‡å›½å®¶/åœ°åŒºå
âœ… åœ¨æ‰€æœ‰æ–‡ä»¶ä¸­ä¿æŒå®Œå…¨ä¸€è‡´

ç¤ºä¾‹ï¼š
âœ… 'japan'              - æ—¥æœ¬
âœ… 'korea'              - éŸ©å›½
âœ… 'chinese-taipei'     - ä¸­å›½å°åŒ—
âœ… 'new-zealand'        - æ–°è¥¿å…°

âŒ 'Japan'              - ä¸èƒ½é¦–å­—æ¯å¤§å†™
âŒ 'south-korea'        - åº”è¯¥ç”¨ 'korea'
âŒ 'chinese_taipei'     - ä¸èƒ½ç”¨ä¸‹åˆ’çº¿
âŒ 'å°åŒ—'               - ä¸èƒ½ç”¨ä¸­æ–‡
```

**regionIdä¸€è‡´æ€§æ£€æŸ¥**ï¼š

```powershell
# æ£€æŸ¥regionIdæ˜¯å¦åœ¨æ‰€æœ‰æ–‡ä»¶ä¸­ä¸€è‡´
$regionId = "japan"

# 1. æ£€æŸ¥æ•°æ®æ–‡ä»¶
Test-Path data\regions\$regionId.js

# 2. æ£€æŸ¥audio-config.js
Select-String -Path utils\audio-config.js -Pattern "id: '$regionId'"

# 3. æ£€æŸ¥audio-package-loader.js
Select-String -Path utils\audio-package-loader.js -Pattern "'$regionId':"

# 4. æ£€æŸ¥audio-player
Select-String -Path pages\audio-player\index.ts -Pattern "'$regionId':"

# å¦‚æœä»»ä½•ä¸€ä¸ªæ£€æŸ¥å¤±è´¥ï¼Œè¯´æ˜regionIdä¸ä¸€è‡´ï¼Œéœ€è¦ä¿®å¤
```

---

## ğŸŒ ç¦»çº¿ä¼˜å…ˆè®¾è®¡åŸåˆ™

### æ ¸å¿ƒåŸåˆ™

FlightToolbox **å¿…é¡»èƒ½å¤Ÿåœ¨å®Œå…¨ç¦»çº¿ç¯å¢ƒä¸‹æ­£å¸¸è¿è¡Œ**ï¼Œå› ä¸ºé£è¡Œå‘˜åœ¨ç©ºä¸­å¿…é¡»å¼€å¯é£è¡Œæ¨¡å¼ã€‚

### ç¦»çº¿ä¼˜å…ˆè®¾è®¡ç­–ç•¥

#### 1. æ‰€æœ‰æ•°æ®æœ¬åœ°å­˜å‚¨

```javascript
// âŒ é”™è¯¯ï¼šä¾èµ–ç½‘ç»œè¯·æ±‚
wx.request({
  url: 'https://api.example.com/data',
  success: function(res) {
    // å¤„ç†æ•°æ®
  }
});

// âœ… æ­£ç¡®ï¼šæœ¬åœ°æ•°æ®æ–‡ä»¶
var localData = require('../../data/regions/japan.js');
```

#### 2. åˆ†åŒ…é¢„åŠ è½½

```json
// app.json é…ç½®é¢„åŠ è½½è§„åˆ™
{
  "preloadRule": {
    "pages/operations/index": {
      "network": "all",          // å…³é”®ï¼šåœ¨çº¿å’Œç¦»çº¿éƒ½é¢„åŠ è½½
      "packages": ["audioNavigationPackage"]
    }
  }
}
```

**é¢„åŠ è½½æ—¶æœº**ï¼š
- âœ… ç”¨æˆ·è¿›å…¥ç›¸å…³é¡µé¢æ—¶è‡ªåŠ¨é¢„åŠ è½½
- âœ… `network: "all"` ç¡®ä¿ç¦»çº¿æ¨¡å¼ä¹Ÿé¢„åŠ è½½
- âœ… é¢„åŠ è½½ååˆ†åŒ…ä¼šç¼“å­˜åˆ°æœ¬åœ°

#### 3. å¼‚æ­¥requireè·¨åˆ†åŒ…å¼•ç”¨

```javascript
// âŒ é”™è¯¯ï¼šåŒæ­¥requireè·¨åˆ†åŒ…ï¼ˆç”Ÿäº§ç¯å¢ƒä¼šå¤±è´¥ï¼‰
var data = require('../../packageJapan/data.js');

// âœ… æ­£ç¡®ï¼šå¼‚æ­¥require
require('../../packageJapan/data.js', function(data) {
  // å¤„ç†æ•°æ®
}, function(error) {
  self.handleError(error, 'åŠ è½½æ•°æ®å¤±è´¥');
});
```

#### 4. æœ¬åœ°éŸ³é¢‘æ–‡ä»¶

```javascript
// âœ… éŸ³é¢‘æ–‡ä»¶æœ¬åœ°å­˜å‚¨åœ¨åˆ†åŒ…ä¸­
const audioContext = wx.createInnerAudioContext();
audioContext.src = '/packageJapan/audio.mp3';  // æœ¬åœ°è·¯å¾„
```

#### 5. ç¦»çº¿é”™è¯¯å¤„ç†

```javascript
// æä¾›ç¦»çº¿å‹å¥½çš„é”™è¯¯æç¤º
handleError: function(error, context) {
  var message = context || 'æ“ä½œå¤±è´¥';

  // æ£€æµ‹ç¦»çº¿çŠ¶æ€
  wx.getNetworkType({
    success: function(res) {
      if (res.networkType === 'none') {
        // ç¦»çº¿çŠ¶æ€ï¼Œæä¾›ç‰¹å®šæç¤º
        message += 'ï¼ˆå½“å‰ä¸ºç¦»çº¿æ¨¡å¼ï¼Œè¯·ç¡®ä¿æ•°æ®å·²é¢„åŠ è½½ï¼‰';
      }
    },
    complete: function() {
      wx.showToast({
        title: message,
        icon: 'none'
      });
    }
  });
}
```

---

## ğŸ”§ BasePageå¼‚æ­¥åŠ è½½æœºåˆ¶

### BasePageè®¾è®¡ç›®çš„

FlightToolboxä½¿ç”¨ç»Ÿä¸€çš„BasePageåŸºç±»ï¼Œæä¾›ï¼š
1. ç»Ÿä¸€çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†
2. å¼‚æ­¥åŠ è½½è¾…åŠ©æ–¹æ³•
3. é”™è¯¯å¤„ç†æœºåˆ¶
4. æ•°æ®åŠ è½½çŠ¶æ€ç®¡ç†

### åŸºæœ¬ä½¿ç”¨

```javascript
var BasePage = require('../../utils/base-page.js');

var pageConfig = {
  data: {
    loading: false
  },

  // ä½¿ç”¨customOnLoadä»£æ›¿onLoad
  customOnLoad: function(options) {
    // é¡µé¢åˆå§‹åŒ–é€»è¾‘
  },

  customOnShow: function() {
    // é¡µé¢æ˜¾ç¤ºé€»è¾‘
  }
};

Page(BasePage.createPage(pageConfig));
```

### å¼‚æ­¥åŠ è½½æ•°æ®

```javascript
var pageConfig = {
  customOnLoad: function(options) {
    var self = this;

    // ä½¿ç”¨BasePageæä¾›çš„å¼‚æ­¥åŠ è½½æ–¹æ³•
    this.loadDataWithLoading(function() {
      return new Promise(function(resolve, reject) {
        // å¼‚æ­¥åŠ è½½é€»è¾‘
        require('../../packageJapan/data.js', function(data) {
          resolve(data);
        }, function(error) {
          reject(error);
        });
      });
    }, {
      context: 'åŠ è½½éŸ³é¢‘æ•°æ®',
      dataKey: 'audioData'
    }).then(function(data) {
      self.setData({ audioData: data });
    });
  }
};
```

### é”™è¯¯å¤„ç†

```javascript
var pageConfig = {
  onAudioPlay: function() {
    var self = this;

    // ä½¿ç”¨BasePageçš„ç»Ÿä¸€é”™è¯¯å¤„ç†
    this.handleError(new Error('éŸ³é¢‘æ’­æ”¾å¤±è´¥'), 'éŸ³é¢‘æ’­æ”¾');
  }
};
```

---

## ğŸ“± é¢„åŠ è½½è§„åˆ™æœ€ä½³å®è·µ

### é¢„åŠ è½½è§„åˆ™é…ç½®åŸåˆ™

#### 1. å•é¡µé¢é¢„åŠ è½½é™åˆ¶

```
è§„åˆ™ï¼šå•é¡µé¢preloadRuleæ€»å¤§å°å¿…é¡» < 2MB

è®¡ç®—æ–¹æ³•ï¼š
1. ç»Ÿè®¡è¯¥é¡µé¢preloadRuleä¸­æ‰€æœ‰packagesçš„å¤§å°æ€»å’Œ
2. ç¡®ä¿æ€»å’Œ < 2MB

ç¤ºä¾‹ï¼š
âœ… æ­£ç¡®é…ç½®ï¼š
"pages/operations/index": {
  "packages": ["packageA", "packageB"]  // æ€»è®¡1.8MB
}

âŒ é”™è¯¯é…ç½®ï¼š
"pages/operations/index": {
  "packages": ["package1", "package2", "package3"]  // æ€»è®¡2.3MBï¼ˆè¶…é™ï¼‰
}
```

#### 2. TabBaré¡µé¢é¿å…é¢„åŠ è½½å¤§åˆ†åŒ…

```
è§„åˆ™ï¼šTabBaré¡µé¢é¢„åŠ è½½ä¼šå½±å“é¦–å±åŠ è½½é€Ÿåº¦

å»ºè®®ï¼š
âœ… TabBaré¡µé¢é¢„åŠ è½½åŠŸèƒ½åˆ†åŒ…ï¼ˆ<500KBï¼‰
âš ï¸ TabBaré¡µé¢è°¨æ…é¢„åŠ è½½ä¸­ç­‰åˆ†åŒ…ï¼ˆ500KB-1MBï¼‰
âŒ TabBaré¡µé¢é¿å…é¢„åŠ è½½å¤§åˆ†åŒ…ï¼ˆ>1MBï¼Œç‰¹åˆ«æ˜¯éŸ³é¢‘åˆ†åŒ…ï¼‰

ç¤ºä¾‹ï¼š
âœ… æ­£ç¡®ï¼š
"pages/operations/index": {  // TabBaré¡µé¢
  "packages": ["packageCCAR"]  // 710KBï¼Œå¯ä»¥æ¥å—
}

âŒ é”™è¯¯ï¼š
"pages/home/index": {  // TabBaré¦–é¡µ
  "packages": ["japanAudioPackage"]  // 1.2MBï¼Œå½±å“é¦–å±
}
```

#### 3. networkå‚æ•°ä½¿ç”¨

```json
{
  "preloadRule": {
    "pages/example/index": {
      "network": "all",     // æ¨èï¼šåœ¨çº¿å’Œç¦»çº¿éƒ½é¢„åŠ è½½
      "packages": ["examplePackage"]
    }
  }
}
```

**networkå‚æ•°è¯´æ˜**ï¼š

| å€¼ | è¯´æ˜ | æ¨èä½¿ç”¨åœºæ™¯ |
|----|------|------------|
| `"all"` | åœ¨çº¿å’Œç¦»çº¿éƒ½é¢„åŠ è½½ | âœ… æ¨èï¼šç¡®ä¿ç¦»çº¿å¯ç”¨ |
| `"wifi"` | ä»…Wi-Fiä¸‹é¢„åŠ è½½ | âš ï¸ è°¨æ…ï¼šç¦»çº¿å¯èƒ½æ— æ³•ä½¿ç”¨ |

### é¢„åŠ è½½è§„åˆ™éªŒè¯

```javascript
// åœ¨é¡µé¢customOnLoadä¸­éªŒè¯é¢„åŠ è½½
customOnLoad: function(options) {
  var self = this;

  // æ£€æŸ¥åˆ†åŒ…æ˜¯å¦å·²é¢„åŠ è½½
  wx.loadSubpackage({
    name: 'examplePackage',
    success: function() {
      console.log('âœ… åˆ†åŒ…å·²é¢„åŠ è½½');
    },
    fail: function() {
      console.log('âŒ åˆ†åŒ…æœªé¢„åŠ è½½');
      // å¦‚æœæœªé¢„åŠ è½½ï¼Œæ‰‹åŠ¨åŠ è½½
      wx.loadSubpackage({
        name: 'examplePackage',
        success: function() {
          console.log('âœ… åˆ†åŒ…æ‰‹åŠ¨åŠ è½½æˆåŠŸ');
        }
      });
    }
  });
},
```

---

## ğŸš¨ é”™è¯¯å¤„ç†æœ€ä½³å®è·µ

### ç»Ÿä¸€é”™è¯¯å¤„ç†

```javascript
// BasePageæä¾›çš„ç»Ÿä¸€é”™è¯¯å¤„ç†
handleError: function(error, context) {
  var errorMessage = context || 'æ“ä½œå¤±è´¥';

  // è®°å½•é”™è¯¯æ—¥å¿—
  console.error('[é”™è¯¯]', context, error);

  // æ˜¾ç¤ºç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º
  wx.showToast({
    title: errorMessage,
    icon: 'none',
    duration: 3000
  });

  // å¯é€‰ï¼šä¸ŠæŠ¥é”™è¯¯åˆ°ç›‘æ§ç³»ç»Ÿï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
  if (typeof wx.reportEvent === 'function') {
    wx.reportEvent('error', {
      context: context,
      message: error.message,
      stack: error.stack
    });
  }
}
```

### åˆ†åŒ…åŠ è½½é”™è¯¯å¤„ç†

```javascript
loadPackageWithRetry: function(packageName, maxRetries, callback) {
  var retryCount = 0;

  function load() {
    wx.loadSubpackage({
      name: packageName,
      success: function() {
        console.log('âœ… åˆ†åŒ…åŠ è½½æˆåŠŸ:', packageName);
        callback && callback(null);
      },
      fail: function(error) {
        console.error('âŒ åˆ†åŒ…åŠ è½½å¤±è´¥:', packageName, error);

        if (retryCount < maxRetries) {
          retryCount++;
          console.log('âš ï¸ é‡è¯•åŠ è½½åˆ†åŒ…...', retryCount, '/', maxRetries);
          setTimeout(load, 1000);  // 1ç§’åé‡è¯•
        } else {
          console.error('âŒ åˆ†åŒ…åŠ è½½å¤±è´¥ï¼Œå·²è¾¾æœ€å¤§é‡è¯•æ¬¡æ•°');
          callback && callback(error);
        }
      }
    });
  }

  load();
}
```

### ç¦»çº¿æ¨¡å¼é”™è¯¯æç¤º

```javascript
showOfflineTip: function() {
  wx.getNetworkType({
    success: function(res) {
      if (res.networkType === 'none') {
        wx.showModal({
          title: 'ç¦»çº¿æ¨¡å¼æç¤º',
          content: 'å½“å‰ä¸ºç¦»çº¿æ¨¡å¼ï¼Œéƒ¨åˆ†åŠŸèƒ½éœ€è¦é¢„å…ˆåŠ è½½ã€‚å»ºè®®é¦–æ¬¡ä½¿ç”¨æ—¶è¿æ¥ç½‘ç»œã€‚',
          showCancel: false
        });
      }
    }
  });
}
```

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ

### 1. æ¨¡å—æ‡’åŠ è½½

```javascript
// âŒ ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰æ¨¡å—
var module1 = require('./module1.js');
var module2 = require('./module2.js');
var module3 = require('./module3.js');

// âœ… æŒ‰éœ€æ‡’åŠ è½½
customOnLoad: function() {
  // åªåŠ è½½å¿…éœ€çš„æ ¸å¿ƒæ¨¡å—
  require('./core-module.js', function(coreModule) {
    self.coreModule = coreModule;
  });
},

onUserAction: function() {
  // ç”¨æˆ·è§¦å‘æ“ä½œæ—¶å†åŠ è½½ç›¸å…³æ¨¡å—
  if (!this.featureModule) {
    require('./feature-module.js', function(featureModule) {
      self.featureModule = featureModule;
      self.executeFeature();
    });
  }
}
```

### 2. æ•°æ®åˆ†é¡µåŠ è½½

```javascript
// å¤§æ•°æ®é›†åˆ†é¡µåŠ è½½
loadDataByPage: function(page, pageSize) {
  var self = this;
  var start = page * pageSize;
  var end = start + pageSize;

  require('../../packageData/data.js', function(data) {
    var pageData = data.clips.slice(start, end);
    self.setData({
      clips: self.data.clips.concat(pageData),
      hasMore: end < data.clips.length
    });
  });
}
```

### 3. Canvasæ¸²æŸ“ä¼˜åŒ–

```javascript
// é©¾é©¶èˆ±Canvasæ¸²æŸ“ä¼˜åŒ–
renderAttitudeIndicator: function() {
  var self = this;

  // ä½¿ç”¨requestAnimationFrameæ§åˆ¶æ¸²æŸ“é¢‘ç‡
  if (!this.renderPending) {
    this.renderPending = true;

    this.createSelectorQuery()
      .select('#attitudeCanvas')
      .fields({ node: true, size: true })
      .exec(function(res) {
        if (res[0]) {
          const canvas = res[0].node;
          const ctx = canvas.getContext('2d');

          // æ¸²æŸ“é€»è¾‘
          self.drawAttitude(ctx);

          self.renderPending = false;
        }
      });
  }
}
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£ç´¢å¼•

**æ ¸å¿ƒæ–‡æ¡£**ï¼š
- CLAUDE.md - é¡¹ç›®å¼€å‘è§„èŒƒ
- èˆªçº¿å½•éŸ³åˆ†åŒ…é¢„åŠ è½½è§„åˆ™è®°å½•/ - éŸ³é¢‘åˆ†åŒ…å®Œæ•´ç»éªŒ

**å®æ–½æ–‡æ¡£**ï¼š
- é˜¶æ®µ1-ä½é£é™©å¿«é€Ÿä¼˜åŒ–.md
- é˜¶æ®µ2-ä¸­ç­‰é£é™©ä¼˜åŒ–.md
- é˜¶æ®µ3-é©¾é©¶èˆ±åˆ†åŒ…(å¯é€‰).md

**æ”¯æŒæ–‡æ¡£**ï¼š
- éªŒè¯å’Œå›æ»šæŒ‡å—.md
- è¾…åŠ©è„šæœ¬é›†.md

---

**æ–‡æ¡£åˆ›å»ºæ—¶é—´**: 2025-11-01
**ç»´æŠ¤è€…**: FlightToolbox AI Assistant
**ç‰ˆæœ¬**: v1.0
