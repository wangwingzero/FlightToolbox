# èˆªçº¿å½•éŸ³åˆ†åŒ…å®Œæ•´ç®¡ç†æŒ‡å—

**æ–‡æ¡£ç‰ˆæœ¬**: v2.0.0
**æœ€åæ›´æ–°**: 2025-01-04
**ç”¨é€”**: æ–°å¢æœºåœºèˆªçº¿å½•éŸ³çš„å®Œæ•´æ“ä½œè§„èŒƒï¼ˆå«æœ¬åœ°ç¼“å­˜æŠ€æœ¯ï¼‰

---

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¶æ„æ¦‚è¿°](#é¡¹ç›®æ¶æ„æ¦‚è¿°)
2. [æœ¬åœ°ç¼“å­˜ç³»ç»Ÿï¼ˆ2025-01-04é‡å¤§çªç ´ï¼‰](#æœ¬åœ°ç¼“å­˜ç³»ç»Ÿ2025-01-04é‡å¤§çªç ´)
3. [èˆªçº¿å½•éŸ³åˆ†åŒ…ç»“æ„](#èˆªçº¿å½•éŸ³åˆ†åŒ…ç»“æ„)
4. [é¢„åŠ è½½è§„åˆ™ç³»ç»Ÿ](#é¢„åŠ è½½è§„åˆ™ç³»ç»Ÿ)
5. [æ–°å¢æœºåœºå®Œæ•´æµç¨‹](#æ–°å¢æœºåœºå®Œæ•´æµç¨‹)
6. [é…ç½®æ–‡ä»¶è¯¦è§£](#é…ç½®æ–‡ä»¶è¯¦è§£)
7. [æ•°æ®éªŒè¯æ¸…å•](#æ•°æ®éªŒè¯æ¸…å•)
8. [å¸¸è§é—®é¢˜è§£å†³](#å¸¸è§é—®é¢˜è§£å†³)
9. [æœ€ä½³å®è·µå»ºè®®](#æœ€ä½³å®è·µå»ºè®®)

---

## é¡¹ç›®æ¶æ„æ¦‚è¿°

### æ ¸å¿ƒçº¦æŸ

#### 1. å¾®ä¿¡å°ç¨‹åºé™åˆ¶
```
âš ï¸ é‡è¦é™åˆ¶ï¼š
- å•ä¸ªé¡µé¢ preloadRule æœ€å¤§é¢„åŠ è½½: 2MB
- æ€»åˆ†åŒ…å¤§å°å»ºè®®: < 20MBï¼ˆæ€§èƒ½è€ƒè™‘ï¼‰
- éŸ³é¢‘æ–‡ä»¶æ ¼å¼: MP3ï¼ˆæ¨è 32-48kbps å‹ç¼©ï¼‰
```

#### 2. ç¦»çº¿ä¼˜å…ˆè®¾è®¡ + æœ¬åœ°ç¼“å­˜ï¼ˆæ ¸å¿ƒçªç ´ï¼‰
```
âœ… å¿…é¡»æ»¡è¶³ï¼š
- æ‰€æœ‰éŸ³é¢‘åˆ†åŒ…å¿…é¡»æ”¯æŒç¦»çº¿æ’­æ”¾
- ğŸ”¥ ä½¿ç”¨ wx.env.USER_DATA_PATH æœ¬åœ°ç¼“å­˜éŸ³é¢‘æ–‡ä»¶
- ğŸ”¥ é¦–æ¬¡æ’­æ”¾åè‡ªåŠ¨ç¼“å­˜ï¼Œåç»­ç¦»çº¿ç§’å¼€
- ğŸ”¥ æ™ºèƒ½é¢„çƒ­ç³»ç»Ÿï¼ˆWiFiç¯å¢ƒè‡ªåŠ¨ç¼“å­˜å¸¸ç”¨èˆªçº¿ï¼‰
- æ•°æ®æ–‡ä»¶æœ¬åœ°å­˜å‚¨ï¼ˆminiprogram/data/regions/ï¼‰

ğŸ“Š æ€§èƒ½æå‡æ•°æ®ï¼š
- ç¦»çº¿ç¨³å®šæ€§ï¼š30% â†’ 95%ï¼ˆ+217%ï¼‰
- "play audio fail"é”™è¯¯ç‡ï¼š100% â†’ 10%ï¼ˆ-90%ï¼‰
- é‡å¤æ’­æ”¾é€Ÿåº¦ï¼š200-500ms â†’ 50-80msï¼ˆ4-10å€æé€Ÿï¼‰
```

#### 3. TabBar ä¸»é¡µç¦æ­¢åŠ è½½éŸ³é¢‘
```
âŒ ç¦æ­¢åœ¨ä»¥ä¸‹é¡µé¢é¢„åŠ è½½éŸ³é¢‘ï¼š
- pages/search/indexï¼ˆèµ„æ–™æŸ¥è¯¢ï¼‰
- pages/flight-calculator/indexï¼ˆè®¡ç®—å·¥å…·ï¼‰
- pages/cockpit/indexï¼ˆé©¾é©¶èˆ±ï¼‰
- pages/operations/indexï¼ˆé€šä¿¡ï¼‰
- pages/home/indexï¼ˆæˆ‘çš„é¦–é¡µï¼‰
```

---

## æœ¬åœ°ç¼“å­˜ç³»ç»Ÿï¼ˆ2025-01-04é‡å¤§çªç ´ï¼‰

### ğŸ”¥ æ ¸å¿ƒæŠ€æœ¯æ¶æ„

```javascript
// å››å¤§ç¼“å­˜ç®¡ç†å™¨ï¼ˆå®Œæ•´å®ç°ï¼‰
éŸ³é¢‘ç¼“å­˜ç³»ç»Ÿ = {
  // 1. éŸ³é¢‘ç¼“å­˜ç®¡ç†å™¨ï¼ˆæ ¸å¿ƒï¼‰
  audioCacheManager: {
    file: 'miniprogram/utils/audio-cache-manager.js',
    åŠŸèƒ½: [
      'æœ¬åœ°ç¼“å­˜ï¼ˆwx.env.USER_DATA_PATHï¼‰',
      'LRUæ¸…ç†ç­–ç•¥',
      'ç©ºé—´ç®¡ç†ï¼ˆ300MBä¸Šé™ï¼‰',
      'å¹¶å‘ä¼˜åŒ–ï¼ˆPromiseç®¡ç†ï¼‰'
    ],
    å…³é”®æ–¹æ³•: {
      initAudioCache: 'åˆå§‹åŒ–ç¼“å­˜ç³»ç»Ÿï¼ˆå¼‚æ­¥ï¼‰',
      ensureAudioCached: 'ç¡®ä¿éŸ³é¢‘å·²ç¼“å­˜åˆ°æœ¬åœ°',
      getCachedAudioPath: 'è·å–ç¼“å­˜è·¯å¾„ï¼ˆåŒæ­¥ï¼‰',
      cleanOldCache: 'LRUæ¸…ç†ï¼ˆ5-10å€æé€Ÿï¼‰'
    }
  },

  // 2. æ™ºèƒ½é¢„çƒ­ç®¡ç†å™¨
  audioPreheatManager: {
    file: 'miniprogram/utils/audio-preheat-manager.js',
    åŠŸèƒ½: [
      'WiFiç¯å¢ƒè‡ªåŠ¨é¢„çƒ­',
      'åŸºäºæ’­æ”¾å†å²æ¨è',
      'æ”¶è—èˆªçº¿ä¼˜å…ˆç¼“å­˜',
      'åå°ä»»åŠ¡ï¼ˆä¸é˜»å¡ï¼‰'
    ],
    æ¨èç­–ç•¥: [
      'æ”¶è—èˆªçº¿ï¼ˆä¼˜å…ˆçº§ï¼šhighï¼‰',
      'æ’­æ”¾é¢‘ç‡Top 10ï¼ˆä¼˜å…ˆçº§ï¼šnormalï¼‰',
      'æœ€è¿‘7å¤©æ’­æ”¾ï¼ˆä¼˜å…ˆçº§ï¼šnormalï¼‰'
    ]
  },

  // 3. å¥åº·æ£€æŸ¥ç®¡ç†å™¨
  cacheHealthManager: {
    file: 'miniprogram/utils/cache-health-manager.js',
    åŠŸèƒ½: [
      'å®Œæ•´æ€§è‡ªåŠ¨æ£€æŸ¥',
      'æŸåæ–‡ä»¶è‡ªåŠ¨ä¿®å¤',
      'ç»Ÿè®¡æŠ¥å‘Šç”Ÿæˆ',
      'å®šæœŸå¥åº·æ£€æŸ¥'
    ]
  },

  // 4. æ•°æ®ç´¢å¼•ç®¡ç†å™¨
  dataIndexCacheManager: {
    file: 'miniprogram/utils/data-index-cache-manager.js',
    åŠŸèƒ½: [
      'å…³é”®è¯ç´¢å¼•æ„å»º',
      '20å€æœç´¢åŠ é€Ÿï¼ˆ100msâ†’5msï¼‰',
      'å†…å­˜èŠ‚çœ50å€ï¼ˆ3.7MBâ†’70KBï¼‰',
      'ç¦»çº¿ç´¢å¼•æŒä¹…åŒ–'
    ]
  }
};
```

### ğŸ¯ ä½¿ç”¨æ–¹å¼ï¼ˆé›†æˆåˆ°é¡µé¢ï¼‰

#### 1. åˆå§‹åŒ–ç¼“å­˜ç³»ç»Ÿ

```javascript
// pages/home/index.js ç¤ºä¾‹

var AudioCacheManager = require('../../utils/audio-cache-manager.js');
var AudioPreheatManager = require('../../utils/audio-preheat-manager.js');

Page({
  onLoad: function() {
    // 1. åˆå§‹åŒ–éŸ³é¢‘ç¼“å­˜ç³»ç»Ÿ
    AudioCacheManager.initAudioCache()
      .then(function() {
        console.log('âœ… éŸ³é¢‘ç¼“å­˜ç³»ç»Ÿåˆå§‹åŒ–æˆåŠŸ');
      })
      .catch(function(error) {
        console.error('âŒ éŸ³é¢‘ç¼“å­˜ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥:', error);
      });
  },

  // 2. æ˜¾ç¤ºç¼“å­˜ç»Ÿè®¡
  showAudioCacheStats: function() {
    var stats = AudioCacheManager.getCacheStats();
    wx.showModal({
      title: 'éŸ³é¢‘ç¼“å­˜ç»Ÿè®¡',
      content: 'å·²ç¼“å­˜: ' + stats.totalCount + 'ä¸ªéŸ³é¢‘\n' +
               'å ç”¨ç©ºé—´: ' + stats.totalSizeMB + ' MB / ' + stats.maxSizeMB + ' MB',
      showCancel: false
    });
  },

  // 3. å¯åŠ¨æ™ºèƒ½é¢„çƒ­
  startAudioPreheat: function() {
    AudioPreheatManager.startPreheat()
      .then(function(result) {
        if (result.status === 'completed') {
          wx.showToast({
            title: 'é¢„çƒ­å®Œæˆï¼š' + result.success + 'ä¸ªéŸ³é¢‘',
            icon: 'success'
          });
        }
      });
  },

  // 4. æ¸…ç©ºç¼“å­˜
  clearAudioCache: function() {
    wx.showModal({
      title: 'ç¡®è®¤æ¸…ç©ºéŸ³é¢‘ç¼“å­˜',
      content: 'å°†æ¸…ç©ºæ‰€æœ‰ç¦»çº¿éŸ³é¢‘ç¼“å­˜',
      success: function(res) {
        if (res.confirm) {
          AudioCacheManager.clearAllCache()
            .then(function() {
              wx.showToast({ title: 'ç¼“å­˜å·²æ¸…ç©º', icon: 'success' });
            });
        }
      }
    });
  }
});
```

#### 2. æ’­æ”¾å™¨é›†æˆæœ¬åœ°ç¼“å­˜

```javascript
// pages/audio-player/index.ts ç¤ºä¾‹

import * as AudioCacheManager from '../../utils/audio-cache-manager.js';

Page({
  playAudio: function(regionId: string, airportCode: string, clipIndex: number) {
    var self = this;

    // 1. ç”Ÿæˆç¼“å­˜é”®
    var cacheKey = regionId + '_' + airportCode + '_' + clipIndex;

    // 2. å°è¯•ä½¿ç”¨ç¼“å­˜
    var cachedPath = AudioCacheManager.getCachedAudioPath(cacheKey);

    if (cachedPath) {
      // 2.1 ä½¿ç”¨ç¼“å­˜è·¯å¾„ï¼ˆç§’å¼€ï¼‰
      console.log('âœ… ä½¿ç”¨æœ¬åœ°ç¼“å­˜:', cachedPath);
      this.audioContext.src = cachedPath;
      this.audioContext.play();
    } else {
      // 2.2 é¦–æ¬¡æ’­æ”¾ï¼šä½¿ç”¨åˆ†åŒ…è·¯å¾„å¹¶ç¼“å­˜
      var originalSrc = this.buildAudioSrc(regionId, airportCode, clipIndex);
      this.audioContext.src = originalSrc;
      this.audioContext.play();

      // 2.3 æ’­æ”¾æˆåŠŸåå¼‚æ­¥ç¼“å­˜ï¼ˆä¸é˜»å¡ï¼‰
      this.audioContext.onPlay(function() {
        AudioCacheManager.ensureAudioCached(cacheKey, originalSrc)
          .then(function(cachedPath) {
            console.log('âœ… éŸ³é¢‘å·²ç¼“å­˜åˆ°æœ¬åœ°:', cachedPath);
          })
          .catch(function(error) {
            console.warn('âš ï¸ ç¼“å­˜å¤±è´¥ï¼ˆä¸å½±å“æ’­æ”¾ï¼‰:', error);
          });
      });
    }
  },

  buildAudioSrc: function(regionId: string, airportCode: string, clipIndex: number): string {
    const regionPathMap = {
      'japan': '/packageJapan/',
      'korea': '/packageKorean/',
      'uk': '/packageUK/',
      'usa': '/packageAmerica/'
      // ... å…¶ä»–åœ°åŒº
    };

    var packageRoot = regionPathMap[regionId] || '/package/';
    return packageRoot + this.audioData[clipIndex].mp3_file;
  }
});
```

### ğŸ“Š æœ¬åœ°ç¼“å­˜ä¸é¢„åŠ è½½çš„å…³ç³»

```javascript
// ä¸‰å±‚é˜²æŠ¤æœºåˆ¶

é˜²æŠ¤å±‚çº§ = {
  // ç¬¬ä¸€å±‚ï¼šé¢„åŠ è½½è§„åˆ™ï¼ˆapp.jsonï¼‰
  layer1_preloadRule: {
    ç›®çš„: 'é¡µé¢è®¿é—®æ—¶è‡ªåŠ¨åŠ è½½åˆ†åŒ…',
    é™åˆ¶: 'å•é¡µé¢<2MB',
    ä¼˜ç‚¹: 'ç”¨æˆ·æ— æ„ŸçŸ¥',
    ç¼ºç‚¹: 'åˆ†åŒ…å¯èƒ½è¢«å¾®ä¿¡æ¸…ç†ï¼ˆæ¦‚ç‡æ€§ï¼‰'
  },

  // ç¬¬äºŒå±‚ï¼šæœ¬åœ°ç¼“å­˜ï¼ˆæ ¸å¿ƒçªç ´ï¼‰â­â­â­
  layer2_localCache: {
    ç›®çš„: 'éŸ³é¢‘æ–‡ä»¶å†™å…¥ wx.env.USER_DATA_PATH',
    ä¼˜ç‚¹: [
      'æ°¸ä¹…æŒä¹…åŒ–ï¼ˆä¸ä¼šè¢«æ¸…ç†ï¼‰',
      'é‡å¯å°ç¨‹åºåä¾ç„¶å¯ç”¨',
      'é¦–æ¬¡æ’­æ”¾åç¦»çº¿ç§’å¼€',
      'ä¸å ç”¨Storage 10MBé…é¢'
    ],
    å®ç°: 'audio-cache-manager.js',
    å…³é”®æŠ€æœ¯: 'wx.getFileSystemManager().copyFile()'
  },

  // ç¬¬ä¸‰å±‚ï¼šæ™ºèƒ½å…œåº•
  layer3_fallback: {
    ç›®çš„: 'åˆ†åŒ…åŠ è½½å¤±è´¥æ—¶çš„ç”¨æˆ·å¼•å¯¼',
    å®ç°: 'audio-preload-guide.js',
    ç­–ç•¥: [
      'å¼€å‘è€…å·¥å…·ç¯å¢ƒæ£€æµ‹ï¼ˆé¿å…è¯¯åˆ¤ï¼‰',
      'å·²é¢„åŠ è½½èµ„æºè‡ªåŠ¨é‡è¯•3æ¬¡',
      'æœªé¢„åŠ è½½æ˜¾ç¤ºå¼•å¯¼å¼¹çª—',
      'é˜²æŠ–æœºåˆ¶é¿å…é‡å¤å¼¹çª—'
    ]
  }
};

// ğŸ”¥ æ ¸å¿ƒç»“è®ºï¼š
// é¢„åŠ è½½è§„åˆ™ + æœ¬åœ°ç¼“å­˜ = æœ€ä½³ç¦»çº¿ä½“éªŒ
// é¢„åŠ è½½ç¡®ä¿é¦–æ¬¡è®¿é—®ï¼Œæœ¬åœ°ç¼“å­˜ç¡®ä¿åç»­ç¦»çº¿
```

### ğŸ¯ å®Œæ•´æŠ€æœ¯æ–‡æ¡£

è¯¦è§ï¼š`èˆªçº¿å½•éŸ³åˆ†åŒ…é¢„åŠ è½½è§„åˆ™è®°å½•/ä¿®å¤è¯´æ˜/å¾®ä¿¡å°ç¨‹åºåˆ†åŒ…èµ„æºæœ¬åœ°ç¼“å­˜å®Œæ•´å®ç°æŒ‡å—.md`

å†…å®¹åŒ…æ‹¬ï¼š
- âœ… å®Œæ•´å®ç°æ­¥éª¤ï¼ˆ8ä¸ªæ­¥éª¤ï¼‰
- âœ… å¯å¤åˆ¶ä»£ç æ¨¡æ¿ï¼ˆCacheManagerç±»ï¼‰
- âœ… æ€§èƒ½ä¼˜åŒ–è¦ç‚¹ï¼ˆå¼‚æ­¥ã€å¹¶å‘ã€è¾“å…¥éªŒè¯ï¼‰
- âœ… å¸¸è§é™·é˜±ä¸é¿å‘æŒ‡å—ï¼ˆ5å¤§é™·é˜±ï¼‰
- âœ… æµ‹è¯•éªŒè¯æ–¹æ³•ï¼ˆçœŸæœºè°ƒè¯•ã€ä»£ç éªŒè¯ã€ç¦»çº¿æµ‹è¯•ï¼‰
- âœ… æ•…éšœæ’æŸ¥æµç¨‹ï¼ˆ4ç±»é—®é¢˜+è§£å†³æ–¹æ¡ˆï¼‰

---

## èˆªçº¿å½•éŸ³åˆ†åŒ…ç»“æ„

### ç›®å½•ç»“æ„è§„èŒƒ

```
miniprogram/
â”œâ”€â”€ package{CountryCode}/          # éŸ³é¢‘åˆ†åŒ…ç›®å½•
â”‚   â”œâ”€â”€ index.js                   # åˆ†åŒ…å…¥å£æ–‡ä»¶ï¼ˆå¿…éœ€ï¼‰
â”‚   â””â”€â”€ *.mp3                      # éŸ³é¢‘æ–‡ä»¶ï¼ˆå»ºè®®å‹ç¼©ï¼‰
â”œâ”€â”€ data/
â”‚   â””â”€â”€ regions/
â”‚       â””â”€â”€ {country}.js           # æ•°æ®æ–‡ä»¶ï¼ˆå¿…éœ€ï¼‰
```

### å‘½åè§„èŒƒ

#### 1. åˆ†åŒ…ç›®å½•å‘½å
```javascript
// æ ¼å¼ï¼špackage + å›½å®¶/åœ°åŒºè‹±æ–‡åï¼ˆé¦–å­—æ¯å¤§å†™ï¼‰
packageJapan          // âœ… æ—¥æœ¬
packageKorean         // âœ… éŸ©å›½ï¼ˆæ³¨æ„ï¼šKoreaçš„å½¢å®¹è¯å½¢å¼ï¼‰
packageUK             // âœ… è‹±å›½ï¼ˆä½¿ç”¨ç¼©å†™ï¼‰
packageAmerica        // âœ… ç¾å›½
packageUAE            // âœ… é˜¿è”é…‹ï¼ˆä½¿ç”¨ç¼©å†™ï¼‰

// å¤šå•è¯å›½å®¶/åœ°åŒº
packageSrilanka       // âœ… æ–¯é‡Œå…°å¡ï¼ˆè¿å†™ï¼Œé¦–å­—æ¯å¤§å†™ï¼‰
packageAustralia      // âœ… æ¾³å¤§åˆ©äºš
```

#### 2. éŸ³é¢‘æ–‡ä»¶å‘½å
```javascript
// æ ¼å¼ï¼šèˆªç­å·_é™†ç©ºé€šè¯å†…å®¹ç®€è¿°.mp3
// è§„åˆ™ï¼š
// - èˆªç©ºå…¬å¸+èˆªç­å·ï¼Œç”¨è¿å­—ç¬¦è¿æ¥
// - å†…å®¹ç”¨è¿å­—ç¬¦åˆ†éš”å•è¯
// - é¦–å­—æ¯å¤§å†™ï¼ˆæ¯ä¸ªå•è¯ï¼‰
// - æ•°å­—ç›´æ¥ä½¿ç”¨ï¼ˆä¸ç”¨ decimalï¼‰

China-Eastern-7551_Descend-FL250-level-by-LOGAN.mp3           // âœ…
Hainan-439_Cleared-to-Land-RWY27L.mp3                         // âœ…
Korean-Air-925_Line-up-and-wait-runway-16-left.mp3            // âœ…
China-Southern-3089_Contact-Incheon-Control-124-decimal-52.mp3 // âœ…

// âŒ é”™è¯¯ç¤ºä¾‹
china_eastern_7551_descend.mp3                                 // å°å†™
ChinaEastern7551-Descend-FL250.mp3                            // æ— è¿å­—ç¬¦
China-Eastern-7551_Descend FL250.mp3                          // æœ‰ç©ºæ ¼
```

#### 3. æ•°æ®æ–‡ä»¶å‘½å
```javascript
// æ ¼å¼ï¼š{country}.jsï¼ˆå…¨å°å†™ï¼Œè‹±æ–‡åç§°ï¼‰
japan.js              // âœ… æ—¥æœ¬
korean.js             // âœ… éŸ©å›½
uk.js                 // âœ… è‹±å›½
usa.js æˆ– america.js  // âœ… ç¾å›½ï¼ˆäºŒé€‰ä¸€ï¼Œä¿æŒä¸€è‡´ï¼‰
philippines.js        // âœ… è²å¾‹å®¾

// âŒ é”™è¯¯ç¤ºä¾‹
Japan.js              // é¦–å­—æ¯ä¸èƒ½å¤§å†™
south-korea.js        // æ•°æ®æ–‡ä»¶ä¸ç”¨è¿å­—ç¬¦
éŸ©å›½.js               // ä¸èƒ½ç”¨ä¸­æ–‡
```

---

## é¢„åŠ è½½è§„åˆ™ç³»ç»Ÿ

### å¯ç”¨é¢„åŠ è½½é¡µé¢ï¼ˆé TabBarï¼‰

```javascript
// å½“å‰å·²åˆ†é…çš„é¢„åŠ è½½é¡µé¢åŠå…¶å®¹é‡
const PRELOAD_PAGES = {
  // 1. å½•éŸ³æ’­æ”¾é¡µï¼ˆå®¹é‡ï¼š1.74 MB å·²æ»¡ï¼‰
  'pages/audio-player/index': {
    allocated: ['packageKorean'],
    currentSize: '1.74 MB',
    remaining: '0.26 MB',
    icon: 'ğŸµ'
  },

  // 2. èˆªçº¿å½•éŸ³é¡µï¼ˆå®¹é‡ï¼š1.72 MB å·²æ»¡ï¼‰
  'pages/airline-recordings/index': {
    allocated: ['packageJapan', 'packageAmerica'],
    currentSize: '1.72 MB',
    remaining: '0.28 MB',
    icon: 'âœˆï¸'
  },

  // 3. å½•éŸ³åˆ†ç±»é¡µï¼ˆå®¹é‡ï¼š1.61 MBï¼‰
  'pages/recording-categories/index': {
    allocated: ['packageUAE', 'packageItaly', 'packagePhilippines'],
    currentSize: '1.61 MB',
    remaining: '0.39 MB',
    icon: 'ğŸ“‚'
  },

  // 4. å½•éŸ³ç‰‡æ®µé¡µï¼ˆå®¹é‡ï¼š1.25 MBï¼‰
  'pages/recording-clips/index': {
    allocated: ['packageThailand', 'packageSrilanka', 'packageTurkey'],
    currentSize: '1.25 MB',
    remaining: '0.75 MB',
    icon: 'ğŸ¬'
  },

  // 5. é€šä¿¡å¤±æ•ˆé¡µï¼ˆå®¹é‡ï¼š1.71 MBï¼‰â­ æœ€ä½³é€‰æ‹©
  'pages/communication-failure/index': {
    allocated: ['packageRussia', 'packageAustralia', 'packageFrance', 'packageSingapore', 'packageUK'],
    currentSize: '1.71 MB',
    remaining: '0.29 MB',
    icon: 'ğŸ“¡'
  }
};
```

### é¢„åŠ è½½é¡µé¢åˆ†é…ç­–ç•¥

#### åˆ†é…åŸåˆ™
```
1. âš–ï¸ è´Ÿè½½å‡è¡¡ï¼šå°½é‡å¹³å‡åˆ†é…å„é¡µé¢çš„é¢„åŠ è½½é‡
2. ğŸ“ å¤§å°é™åˆ¶ï¼šå•é¡µæ€»é¢„åŠ è½½é‡ < 2MBï¼ˆä¸¥æ ¼ï¼‰
3. ğŸ¯ è¯­ä¹‰å…³è”ï¼šç›¸ä¼¼åœ°åŒº/åŠŸèƒ½çš„éŸ³é¢‘åˆ†é…åˆ°åŒä¸€é¡µé¢
4. ğŸ”„ çµæ´»è°ƒæ•´ï¼šå°åˆ†åŒ…å¯ç»„åˆï¼Œå¤§åˆ†åŒ…å•ç‹¬åˆ†é…
```

#### åˆ†é…ç®—æ³•
```javascript
/**
 * æ–°å¢éŸ³é¢‘åˆ†åŒ…é¢„åŠ è½½é¡µé¢åˆ†é…ç®—æ³•
 * @param {number} packageSize - æ–°åˆ†åŒ…å¤§å°ï¼ˆMBï¼‰
 * @returns {string} æ¨èçš„é¢„åŠ è½½é¡µé¢
 */
function selectPreloadPage(packageSize) {
  // 1. ç­›é€‰å‰©ä½™ç©ºé—´è¶³å¤Ÿçš„é¡µé¢
  const availablePages = Object.entries(PRELOAD_PAGES)
    .filter(([page, info]) => parseFloat(info.remaining) >= packageSize)
    .sort((a, b) => parseFloat(b[1].remaining) - parseFloat(a[1].remaining));
  
  // 2. ä¼˜å…ˆé€‰æ‹©å‰©ä½™ç©ºé—´æœ€å¤§çš„é¡µé¢
  if (availablePages.length > 0) {
    return availablePages[0][0];
  }
  
  // 3. å¦‚æœæ‰€æœ‰é¡µé¢ç©ºé—´éƒ½ä¸å¤Ÿï¼Œéœ€è¦é‡æ–°ç»„ç»‡
  console.error('æ‰€æœ‰é¢„åŠ è½½é¡µé¢ç©ºé—´ä¸è¶³ï¼Œéœ€è¦é‡æ–°è§„åˆ’ï¼');
  return null;
}

// ä½¿ç”¨ç¤ºä¾‹
const newPackageSize = 0.6; // æ–°åˆ†åŒ… 0.6 MB
const recommendedPage = selectPreloadPage(newPackageSize);
// æ¨è: pages/recording-clips/index (å‰©ä½™ 0.75 MB)
```

---

## æ–°å¢æœºåœºå®Œæ•´æµç¨‹

> ğŸ”¥ **2025-01-04æ›´æ–°**ï¼šæ–°å¢æ­¥éª¤7-8ï¼Œé…ç½®æœ¬åœ°ç¼“å­˜ç³»ç»Ÿ

### ğŸš€ æ­¥éª¤ 1ï¼šå‡†å¤‡éŸ³é¢‘æ–‡ä»¶

#### 1.1 æ”¶é›†éŸ³é¢‘
```bash
# éŸ³é¢‘æ¥æºï¼š
- LiveATC.net çœŸå®å½•éŸ³
- æœºåœºå®˜æ–¹å‘å¸ƒçš„è®­ç»ƒææ–™
- èˆªç©ºå…¬å¸å†…éƒ¨å½•éŸ³ï¼ˆéœ€æˆæƒï¼‰

# éŸ³é¢‘è¦æ±‚ï¼š
âœ… çœŸå®é™†ç©ºé€šè¯å½•éŸ³
âœ… éŸ³è´¨æ¸…æ™°å¯è¾¨
âœ… åŒ…å«å®Œæ•´çš„é€šè¯å†…å®¹
âŒ é¿å…èƒŒæ™¯å™ªéŸ³è¿‡å¤§
âŒ é¿å…é‡å¤å½•éŸ³
```

#### 1.2 éŸ³é¢‘å‹ç¼©
```bash
# ä½¿ç”¨ FFmpeg å‹ç¼©éŸ³é¢‘
# ç›®æ ‡ï¼š32-48kbpsï¼Œå•ä¸ªæ–‡ä»¶ < 100KB

# å‹ç¼©å‘½ä»¤ï¼ˆæ¨èï¼‰
ffmpeg -i input.mp3 -b:a 32k -ar 22050 -ac 1 output.mp3

# æ‰¹é‡å‹ç¼©è„šæœ¬
for file in *.mp3; do
  ffmpeg -i "$file" -b:a 32k -ar 22050 -ac 1 "compressed_$file"
done

# å‹ç¼©æ•ˆæœå‚è€ƒï¼š
åŸæ–‡ä»¶: 500KB â†’ å‹ç¼©å: 15-20KB (å‹ç¼©ç‡ 95%+)
```

#### 1.3 æ–‡ä»¶å‘½åä¸æ•´ç†
```bash
# åˆ›å»ºåˆ†åŒ…ç›®å½•
mkdir miniprogram/package{CountryName}

# å¤åˆ¶å‹ç¼©åçš„éŸ³é¢‘æ–‡ä»¶
cp compressed_*.mp3 miniprogram/package{CountryName}/

# é‡å‘½åä¸ºè§„èŒƒæ ¼å¼
# ç¤ºä¾‹ï¼š
mv "compressed_china_eastern_7551.mp3" \
   "China-Eastern-7551_Descend-FL250-level-by-LOGAN.mp3"
```

---

### ğŸš€ æ­¥éª¤ 2ï¼šåˆ›å»ºåˆ†åŒ…å…¥å£æ–‡ä»¶

#### 2.1 åˆ›å»º index.js
```javascript
// miniprogram/package{CountryName}/index.js

// å¯¼å‡ºåˆ†åŒ…ä¿¡æ¯
module.exports = {
  name: '{country}AudioPackage',              // åˆ†åŒ…å†…éƒ¨åç§°
  description: '{å›½å®¶}{æœºåœº}çœŸå®é™†ç©ºé€šè¯å½•éŸ³ï¼ˆèˆªç©ºå…¬å¸åˆ—è¡¨ï¼‰',
  version: '1.0.0',                           // ç‰ˆæœ¬å·
  audioCount: XX,                             // éŸ³é¢‘æ–‡ä»¶æ•°é‡
  lastUpdated: '2025-XX-XX'                   // æœ€åæ›´æ–°æ—¥æœŸ
};
```

#### 2.2 å®é™…ç¤ºä¾‹
```javascript
// miniprogram/packageUK/index.js

module.exports = {
  name: 'ukAudioPackage',
  description: 'è‹±å›½ä¼¦æ•¦å¸Œæ–¯ç½—æœºåœºçœŸå®é™†ç©ºé€šè¯å½•éŸ³ï¼ˆChina Eastern, Hainan, Qantasç­‰ï¼‰',
  version: '1.0.0',
  audioCount: 36,
  lastUpdated: '2025-10-25'
};
```

---

### ğŸš€ æ­¥éª¤ 3ï¼šåˆ›å»ºæ•°æ®æ–‡ä»¶

#### 3.1 æ•°æ®æ–‡ä»¶ç»“æ„
```javascript
// miniprogram/data/regions/{country}.js

const {Country}Data = {
  "clips": [
    {
      "label": "åŒºè°ƒ|è¿›è¿‘|å¡”å°|åœ°é¢|æ”¾è¡Œ",  // ç®¡åˆ¶é˜¶æ®µæ ‡ç­¾
      "full_transcript": "å®Œæ•´è‹±æ–‡è½¬å½•",
      "translation_cn": "ä¸­æ–‡ç¿»è¯‘",
      "mp3_file": "éŸ³é¢‘æ–‡ä»¶å.mp3"
    }
  ]
};

module.exports = {Country}Data;
```

#### 3.2 æ ‡ç­¾åˆ†ç±»è§„èŒƒ
```javascript
// ç®¡åˆ¶é˜¶æ®µæ ‡ç­¾ï¼ˆlabelï¼‰
const VALID_LABELS = [
  'æ”¾è¡Œ',        // Clearance Delivery
  'åœ°é¢',        // Ground Control
  'å¡”å°',        // Tower
  'ç¦»åœº',        // Departure
  'åŒºè°ƒ',        // Area Control / Center
  'è¿›åœº',        // Arrival
  'è¿›è¿‘',        // Approach
  'å…¶ä»–'         // Others
];

// æ ‡ç­¾é€‰æ‹©åŸåˆ™ï¼š
// - ä»¥ç®¡åˆ¶å‘˜è§†è§’ä¸ºå‡†ï¼ˆä¸æ˜¯é£è¡Œå‘˜ï¼‰
// - ä¼˜å…ˆä½¿ç”¨ä¸»è¦ç®¡åˆ¶é˜¶æ®µ
// - é¿å…è‡ªåˆ›æ ‡ç­¾
```

#### 3.3 å®Œæ•´ç¤ºä¾‹
```javascript
// miniprogram/data/regions/uk.js

const UKData = {
  "clips": [
    {
      "label": "åŒºè°ƒ",
      "full_transcript": "China Eastern 7551, descend flight level 250, level by LOGAN.",
      "translation_cn": "ä¸œæ–¹èˆªç©º7551ï¼Œä¸‹é™åˆ°é«˜åº¦å±‚250ï¼Œåœ¨LOGANæ”¹å¹³ã€‚",
      "mp3_file": "China-Eastern-7551_Descend-FL250-level-by-LOGAN.mp3"
    },
    {
      "label": "è¿›è¿‘",
      "full_transcript": "China Eastern 7551, turn right heading 240 degrees to establish localizer 27 Right.",
      "translation_cn": "ä¸œæ–¹èˆªç©º7551ï¼Œå³è½¬èˆªå‘240åº¦ï¼Œæˆªè·27å³è·‘é“èˆªå‘é“ã€‚",
      "mp3_file": "China-Eastern-7551_Turn-right-heading-240-establish-localizer-27R.mp3"
    },
    {
      "label": "å¡”å°",
      "full_transcript": "China Eastern 7551, runway 27 Right, cleared to land. Surface wind 140 degrees, 8 knots.",
      "translation_cn": "ä¸œæ–¹èˆªç©º7551ï¼Œè·‘é“27å³ï¼Œå¯ä»¥è½åœ°ã€‚åœ°é¢é£140åº¦8èŠ‚ã€‚",
      "mp3_file": "China-Eastern-7551_Cleared-to-land-runway-27R.mp3"
    },
    {
      "label": "åœ°é¢",
      "full_transcript": "China Eastern 7551, good day. Taxi south on Echo, hold at Echo 1, stand 440.",
      "translation_cn": "ä¸œæ–¹èˆªç©º7551ï¼Œæ—¥å®‰ã€‚æ²¿Echoæ»‘è¡Œé“å‘å—æ»‘è¡Œï¼Œåœ¨Echo 1ç­‰å¾…ï¼Œæœºä½440ã€‚",
      "mp3_file": "China-Eastern-7551_Taxi-south-on-Echo-hold-Echo1.mp3"
    }
  ]
};

module.exports = UKData;
```

#### 3.4 ç¿»è¯‘è§„èŒƒ
```javascript
// è‹±æ–‡è½¬å½•è§„èŒƒï¼š
âœ… ä¿ç•™åŸå§‹ç”¨è¯å’Œè¯­åº
âœ… åŒ…å«æ‰€æœ‰å…³é”®ä¿¡æ¯ï¼ˆé«˜åº¦ã€èˆªå‘ã€é¢‘ç‡ç­‰ï¼‰
âœ… ä½¿ç”¨æ ‡å‡†èˆªç©ºè‹±è¯­æœ¯è¯­
âœ… æ•°å­—ä½¿ç”¨é˜¿æ‹‰ä¼¯æ•°å­—æˆ–å®Œæ•´æ‹¼å†™

// ä¸­æ–‡ç¿»è¯‘è§„èŒƒï¼š
âœ… å‡†ç¡®ä¼ è¾¾è‹±æ–‡åŸæ„
âœ… ä½¿ç”¨ä¸­å›½æ°‘èˆªæ ‡å‡†æœ¯è¯­
âœ… ä¿ç•™å…³é”®æ•°æ®ï¼ˆä¸è½¬æ¢å•ä½ï¼‰
âœ… è¯­åºå¯è°ƒæ•´ä»¥ç¬¦åˆä¸­æ–‡ä¹ æƒ¯

// æœ¯è¯­å¯¹ç…§è¡¨ï¼š
descend             â†’ ä¸‹é™
climb               â†’ çˆ¬å‡
turn left/right     â†’ å·¦è½¬/å³è½¬
cleared to land     â†’ å¯ä»¥è½åœ°
hold short          â†’ åœ¨...å¤–ç­‰å¾…
contact             â†’ è”ç³»
flight level        â†’ é«˜åº¦å±‚
runway              â†’ è·‘é“
taxiway             â†’ æ»‘è¡Œé“
```

---

### ğŸš€ æ­¥éª¤ 4ï¼šç»Ÿè®¡åˆ†åŒ…å¤§å°

#### 4.1 PowerShell å‘½ä»¤
```powershell
# ç»Ÿè®¡éŸ³é¢‘æ–‡ä»¶æ•°é‡
cd D:\FlightToolbox\miniprogram
(Get-ChildItem "package{CountryName}\*.mp3" -File).Count

# ç»Ÿè®¡åˆ†åŒ…æ€»å¤§å°ï¼ˆMBï¼‰
$size = (Get-ChildItem "package{CountryName}\*.mp3" -File | 
         Measure-Object -Property Length -Sum).Sum / 1MB
[math]::Round($size, 2)

# å®Œæ•´ç»Ÿè®¡è„šæœ¬
$packageName = "packageUK"
$count = (Get-ChildItem "$packageName\*.mp3" -File).Count
$size = (Get-ChildItem "$packageName\*.mp3" -File | 
         Measure-Object -Property Length -Sum).Sum / 1MB
Write-Output "$packageName ç»Ÿè®¡ä¿¡æ¯:"
Write-Output "éŸ³é¢‘æ–‡ä»¶æ•°: $count"
Write-Output "æ€»å¤§å°: $([math]::Round($size, 2)) MB"
```

#### 4.2 é€‰æ‹©é¢„åŠ è½½é¡µé¢
```javascript
// æ ¹æ®åˆ†åŒ…å¤§å°é€‰æ‹©é¢„åŠ è½½é¡µé¢
if (packageSize < 0.3) {
  // å°åˆ†åŒ…ï¼šå¯ä¸å…¶ä»–åˆ†åŒ…ç»„åˆ
  recommendedPage = 'æ‰¾å‰©ä½™ç©ºé—´æœ€å¤§çš„é¡µé¢';
} else if (packageSize < 1.0) {
  // ä¸­ç­‰åˆ†åŒ…ï¼šå»ºè®®ç»„åˆæˆ–å•ç‹¬
  recommendedPage = 'æ‰¾å‰©ä½™ç©ºé—´ > 1MB çš„é¡µé¢';
} else if (packageSize < 1.8) {
  // å¤§åˆ†åŒ…ï¼šå»ºè®®å•ç‹¬åˆ†é…
  recommendedPage = 'æ‰¾ç©ºé—²æˆ–å‰©ä½™ç©ºé—´å……è¶³çš„é¡µé¢';
} else {
  // è¶…å¤§åˆ†åŒ…ï¼šå¿…é¡»å‹ç¼©æˆ–æ‹†åˆ†
  console.error('åˆ†åŒ…è¿‡å¤§ï¼Œå»ºè®®å‹ç¼©éŸ³é¢‘æˆ–æ‹†åˆ†ä¸ºä¸¤ä¸ªåˆ†åŒ…');
}
```

---

### ğŸš€ æ­¥éª¤ 5ï¼šé…ç½® app.json

#### 5.1 æ·»åŠ  subPackages
```json
// åœ¨ miniprogram/app.json çš„ subPackages æ•°ç»„ä¸­æ·»åŠ 

{
  "subPackages": [
    // ... å…¶ä»–åˆ†åŒ…
    {
      "root": "package{CountryName}",
      "name": "{country}AudioPackage",
      "pages": ["index"]
    }
  ]
}
```

#### 5.2 æ›´æ–° preloadRule
```json
// åœ¨ miniprogram/app.json çš„ preloadRule ä¸­æ›´æ–°å¯¹åº”é¡µé¢

{
  "preloadRule": {
    // ... å…¶ä»–è§„åˆ™
    "pages/communication-failure/index": {
      "network": "all",
      "packages": [
        "packageRussia", 
        "packageAustralia", 
        "packageFrance", 
        "packageSingapore",
        "package{CountryName}"  // æ–°å¢
      ]
    }
  }
}
```

#### 5.3 å®Œæ•´é…ç½®ç¤ºä¾‹
```json
// miniprogram/app.json ç‰‡æ®µ

{
  "subPackages": [
    // éŸ³é¢‘åˆ†åŒ…ç¤ºä¾‹
    {
      "root": "packageJapan",
      "name": "japanAudioPackage",
      "pages": ["index"]
    },
    {
      "root": "packageKorean",
      "name": "koreaAudioPackage",
      "pages": ["index"]
    },
    {
      "root": "packageUK",
      "name": "ukAudioPackage",
      "pages": ["index"]
    }
  ],
  
  "preloadRule": {
    "pages/audio-player/index": {
      "network": "all",
      "packages": ["packageKorean"]
    },
    "pages/airline-recordings/index": {
      "network": "all",
      "packages": ["packageJapan", "packageAmerica"]
    },
    "pages/communication-failure/index": {
      "network": "all",
      "packages": [
        "packageRussia", 
        "packageAustralia", 
        "packageFrance", 
        "packageSingapore",
        "packageUK"
      ]
    }
  }
}
```

---

### ğŸš€ æ­¥éª¤ 6ï¼šé…ç½® audio-preload-guide.js

#### 6.1 æ·»åŠ åœ°åŒºæ˜ å°„
```javascript
// miniprogram/utils/audio-preload-guide.js

this.preloadPageMapping = {
  // ... å…¶ä»–åœ°åŒº

  '{countryId}': {
    packageName: 'package{CountryName}',
    regionName: '{å›½å®¶}{åŸå¸‚}æœºåœº',
    flag: '{å›½æ——emoji}',
    preloadPage: '{é€‰æ‹©çš„é¢„åŠ è½½é¡µé¢è·¯å¾„}',
    preloadPageName: '{é¢„åŠ è½½é¡µé¢ä¸­æ–‡å}',
    preloadPageIcon: '{é¡µé¢å›¾æ ‡emoji}',
    description: '{å›½å®¶}{åŸå¸‚}æœºåœºé™†ç©ºé€šè¯å½•éŸ³å°†é€šè¿‡{é¡µé¢å}é¡µé¢è‡ªåŠ¨é¢„åŠ è½½'
  }
};
```

#### 6.2 regionId å‘½åè§„èŒƒ
```javascript
// regionId å‘½åè§„åˆ™ï¼šå…¨å°å†™è‹±æ–‡ï¼Œå›½å®¶/åœ°åŒºåç§°
const REGION_IDS = {
  'japan': 'packageJapan',          // âœ…
  'korea': 'packageKorean',         // âœ…ï¼ˆä¸æ˜¯ south-koreaï¼‰
  'usa': 'packageAmerica',          // âœ…ï¼ˆæˆ– americaï¼‰
  'uk': 'packageUK',                // âœ…
  'uae': 'packageUAE',              // âœ…
  'singapore': 'packageSingapore',  // âœ…
  'philippines': 'packagePhilippines', // âœ…

  // âŒ é”™è¯¯ç¤ºä¾‹
  'south-korea': '...',  // ä¸è¦ç”¨è¿å­—ç¬¦
  'USA': '...',          // ä¸è¦å¤§å†™
  'éŸ©å›½': '...',          // ä¸è¦ä¸­æ–‡
};
```

#### 6.3 å›½æ—— Emoji å¯¹ç…§è¡¨
```javascript
const FLAG_EMOJIS = {
  'ä¸­å›½': 'ğŸ‡¨ğŸ‡³',
  'æ—¥æœ¬': 'ğŸ‡¯ğŸ‡µ',
  'éŸ©å›½': 'ğŸ‡°ğŸ‡·',
  'ç¾å›½': 'ğŸ‡ºğŸ‡¸',
  'è‹±å›½': 'ğŸ‡¬ğŸ‡§',
  'æ³•å›½': 'ğŸ‡«ğŸ‡·',
  'æ„å¤§åˆ©': 'ğŸ‡®ğŸ‡¹',
  'ä¿„ç½—æ–¯': 'ğŸ‡·ğŸ‡º',
  'æ¾³å¤§åˆ©äºš': 'ğŸ‡¦ğŸ‡º',
  'æ–°åŠ å¡': 'ğŸ‡¸ğŸ‡¬',
  'æ³°å›½': 'ğŸ‡¹ğŸ‡­',
  'è²å¾‹å®¾': 'ğŸ‡µğŸ‡­',
  'é˜¿è”é…‹': 'ğŸ‡¦ğŸ‡ª',
  'åœŸè€³å…¶': 'ğŸ‡¹ğŸ‡·',
  'æ–¯é‡Œå…°å¡': 'ğŸ‡±ğŸ‡°'
};
```

#### 6.4 å®Œæ•´é…ç½®ç¤ºä¾‹
```javascript
// miniprogram/utils/audio-preload-guide.js

this.preloadPageMapping = {
  'uk': {
    packageName: 'packageUK',
    regionName: 'è‹±å›½ä¼¦æ•¦å¸Œæ–¯ç½—æœºåœº',
    flag: 'ğŸ‡¬ğŸ‡§',
    preloadPage: 'pages/communication-failure/index',
    preloadPageName: 'é€šä¿¡å¤±æ•ˆ',
    preloadPageIcon: 'ğŸ“¡',
    description: 'è‹±å›½ä¼¦æ•¦å¸Œæ–¯ç½—æœºåœºé™†ç©ºé€šè¯å½•éŸ³å°†é€šè¿‡é€šä¿¡å¤±æ•ˆé¡µé¢è‡ªåŠ¨é¢„åŠ è½½'
  },

  'japan': {
    packageName: 'packageJapan',
    regionName: 'æ—¥æœ¬æˆç”°æœºåœº',
    flag: 'ğŸ‡¯ğŸ‡µ',
    preloadPage: 'pages/airline-recordings/index',
    preloadPageName: 'èˆªçº¿å½•éŸ³',
    preloadPageIcon: 'âœˆï¸',
    description: 'æ—¥æœ¬æˆç”°æœºåœºé™†ç©ºé€šè¯å½•éŸ³å°†é€šè¿‡èˆªçº¿å½•éŸ³é¡µé¢è‡ªåŠ¨é¢„åŠ è½½'
  }
};
```

---

### ğŸš€ æ­¥éª¤ 7ï¼šé…ç½® audio-config.jsï¼ˆğŸ”¥ é‡è¦ï¼‰

> ğŸ’¡ **å†å²æ•™è®­**ï¼šUKå’ŒChinese TaipeiéŸ³é¢‘åˆ†åŒ…æœ€åˆé…ç½®åæ— æ³•æ’­æ”¾ï¼Œå°±æ˜¯å› ä¸ºé—æ¼äº†è¿™ä¸€æ­¥ï¼

#### 7.1 æ·»åŠ åœ°åŒºå®šä¹‰
```javascript
// miniprogram/utils/audio-config.js

AudioConfig.prototype.initRegions = function() {
  this.regions = [
    // ... å…¶ä»–åœ°åŒº
    {
      id: '{countryId}',                    // å¿…é¡»ä¸æ­¥éª¤6çš„regionIdä¸€è‡´
      name: '{å›½å®¶}{åŸå¸‚}',
      flag: '{å›½æ——emoji}',
      description: '{ç®€çŸ­æè¿°}',
      airports: []                          // ç¨ååœ¨æ­¥éª¤7.2å¡«å……
    }
  ];
};
```

#### 7.2 æ·»åŠ æœºåœºæ•°æ®
```javascript
// miniprogram/utils/audio-config.js

AudioConfig.prototype.initAirports = function() {
  // å¼•å…¥æ•°æ®æ–‡ä»¶
  var {Country}Data = require('../data/regions/{country}.js');

  this.airports = [
    // ... å…¶ä»–æœºåœº
    {
      regionId: '{countryId}',              // å¿…é¡»ä¸æ­¥éª¤7.1çš„idä¸€è‡´
      code: '{ICAO}',                       // æœºåœºICAOä»£ç ï¼ˆå¤§å†™ï¼‰
      name: '{æœºåœºä¸­æ–‡å}',
      name_en: '{Airport English Name}',
      clips: {Country}Data.clips            // å¼•ç”¨æ•°æ®æ–‡ä»¶
    }
  ];
};
```

#### 7.3 å®Œæ•´é…ç½®ç¤ºä¾‹
```javascript
// miniprogram/utils/audio-config.js

// æ­¥éª¤7.1ï¼šåœ°åŒºå®šä¹‰
this.regions = [
  {
    id: 'uk',
    name: 'è‹±å›½ä¼¦æ•¦',
    flag: 'ğŸ‡¬ğŸ‡§',
    description: 'å¸Œæ–¯ç½—æœºåœºé™†ç©ºé€šè¯',
    airports: []
  }
];

// æ­¥éª¤7.2ï¼šæœºåœºæ•°æ®
var UKData = require('../data/regions/uk.js');

this.airports = [
  {
    regionId: 'uk',
    code: 'EGLL',
    name: 'ä¼¦æ•¦å¸Œæ–¯ç½—æœºåœº',
    name_en: 'London Heathrow Airport',
    clips: UKData.clips
  }
];
```

---

### ğŸš€ æ­¥éª¤ 8ï¼šé…ç½® audio-package-loader.jsï¼ˆğŸ”¥ é‡è¦ï¼‰

> ğŸ’¡ **å†å²æ•™è®­**ï¼šUKéŸ³é¢‘åˆ†åŒ…é…ç½®å®Œæˆåï¼Œç‚¹å‡»æ’­æ”¾æ—¶æç¤º"åˆ†åŒ…åŠ è½½å¤±è´¥"ï¼Œå°±æ˜¯å› ä¸ºé—æ¼äº†è¿™ä¸€æ­¥ï¼

#### 8.1 æ·»åŠ åˆ†åŒ…æ˜ å°„
```javascript
// miniprogram/utils/audio-package-loader.js

AudioPackageLoader.prototype.initPackageMapping = function() {
  this.packageMapping = {
    // ... å…¶ä»–åœ°åŒº
    '{countryId}': {
      packageName: '{country}AudioPackage',      // ä¸app.jsonä¸­çš„nameä¸€è‡´
      packageRoot: 'package{CountryName}'        // ä¸app.jsonä¸­çš„rootä¸€è‡´
    }
  };
};
```

#### 8.2 å‘½åè§„èŒƒï¼ˆå…³é”®ï¼ï¼‰
```javascript
// packageName å‘½åè§„åˆ™ï¼š{country}AudioPackage
// å¿…é¡»ä¸ app.json ä¸­çš„ subPackages[].name å®Œå…¨ä¸€è‡´

const VALID_PACKAGE_NAMES = {
  'uk': 'ukAudioPackage',                 // âœ…
  'japan': 'japanAudioPackage',           // âœ…
  'korea': 'koreaAudioPackage',           // âœ…
  'usa': 'americaAudioPackage',           // âœ…

  // âŒ é”™è¯¯ç¤ºä¾‹
  'uk': 'UKAudioPackage',                 // é¦–å­—æ¯ä¸èƒ½å¤§å†™
  'uk': 'uk_audio_package',               // ä¸èƒ½ç”¨ä¸‹åˆ’çº¿
  'uk': 'ukAudio',                        // å¿…é¡»æœ‰Packageåç¼€
};

// packageRoot å‘½åè§„åˆ™ï¼špackage{CountryName}
// å¿…é¡»ä¸ app.json ä¸­çš„ subPackages[].root å®Œå…¨ä¸€è‡´

const VALID_PACKAGE_ROOTS = {
  'uk': 'packageUK',                      // âœ…
  'japan': 'packageJapan',                // âœ…
  'korea': 'packageKorean',               // âœ…
  'usa': 'packageAmerica',                // âœ…

  // âŒ é”™è¯¯ç¤ºä¾‹
  'uk': 'Packageuk',                      // é¦–å­—æ¯å¿…é¡»å°å†™
  'uk': 'package_uk',                     // ä¸èƒ½ç”¨ä¸‹åˆ’çº¿
  'uk': 'pkgUK',                          // ä¸èƒ½ç”¨ç¼©å†™
};
```

#### 8.3 å®Œæ•´é…ç½®ç¤ºä¾‹
```javascript
// miniprogram/utils/audio-package-loader.js

this.packageMapping = {
  'uk': {
    packageName: 'ukAudioPackage',        // å¯¹åº” app.json ä¸­çš„ name
    packageRoot: 'packageUK'              // å¯¹åº” app.json ä¸­çš„ root
  },
  'japan': {
    packageName: 'japanAudioPackage',
    packageRoot: 'packageJapan'
  },
  'korea': {
    packageName: 'koreaAudioPackage',
    packageRoot: 'packageKorean'
  }
};
```

---

### ğŸš€ æ­¥éª¤ 9ï¼šé…ç½® audio-player/index.tsï¼ˆğŸ”¥ é‡è¦ï¼‰

> ğŸ’¡ **å†å²æ•™è®­**ï¼šUKéŸ³é¢‘åˆ†åŒ…å‰é¢æ­¥éª¤éƒ½é…ç½®æ­£ç¡®ï¼Œä½†æ’­æ”¾å™¨åˆå§‹åŒ–å¤±è´¥ï¼Œå°±æ˜¯å› ä¸ºé—æ¼äº†è¿™ä¸€æ­¥ï¼

#### 9.1 æ·»åŠ è·¯å¾„æ˜ å°„
```javascript
// miniprogram/pages/audio-player/index.ts

const regionPathMap: Record<string, string> = {
  // ... å…¶ä»–åœ°åŒº
  '{countryId}': '/package{CountryName}/'     // âš ï¸ å‰åéƒ½è¦æ–œæ 
};
```

#### 9.2 è·¯å¾„æ ¼å¼è§„èŒƒï¼ˆå…³é”®ï¼ï¼‰
```javascript
// âš ï¸ è·¯å¾„æ ¼å¼å¿…é¡»ä¸¥æ ¼éµå®ˆï¼šå‰åéƒ½è¦æ–œæ 

const VALID_PATH_FORMATS = {
  'uk': '/packageUK/',                    // âœ… å‰åéƒ½æœ‰æ–œæ 
  'japan': '/packageJapan/',              // âœ…
  'korea': '/packageKorean/',             // âœ…

  // âŒ é”™è¯¯ç¤ºä¾‹
  'uk': 'packageUK',                      // ç¼ºå°‘æ–œæ 
  'uk': '/packageUK',                     // ç¼ºå°‘åæ–œæ 
  'uk': 'packageUK/',                     // ç¼ºå°‘å‰æ–œæ 
  'uk': '\\packageUK\\',                  // Windowsè·¯å¾„ï¼ˆé”™è¯¯ï¼‰
};
```

#### 9.3 å®Œæ•´é…ç½®ç¤ºä¾‹
```javascript
// miniprogram/pages/audio-player/index.ts

const regionPathMap: Record<string, string> = {
  'japan': '/packageJapan/',
  'korea': '/packageKorean/',
  'uk': '/packageUK/',
  'usa': '/packageAmerica/',
  'uae': '/packageUAE/',
  'italy': '/packageItaly/',
  'philippines': '/packagePhilippines/',
  'thailand': '/packageThailand/',
  'srilanka': '/packageSrilanka/',
  'turkey': '/packageTurkey/',
  'russia': '/packageRussia/',
  'australia': '/packageAustralia/',
  'france': '/packageFrance/',
  'singapore': '/packageSingapore/'
};
```

---

### ğŸš€ æ­¥éª¤ 10ï¼šé›†æˆæœ¬åœ°ç¼“å­˜ç³»ç»Ÿï¼ˆğŸ”¥ 2025-01-04æ–°å¢ï¼‰

> ğŸ’¡ **æ ¸å¿ƒä»·å€¼**ï¼šç¡®ä¿éŸ³é¢‘é¦–æ¬¡æ’­æ”¾åæ°¸ä¹…ç¼“å­˜åˆ°æœ¬åœ°ï¼Œé£è¡Œæ¨¡å¼ä¸‹ç§’å¼€

#### 10.1 æ’­æ”¾å™¨é›†æˆç¼“å­˜
```javascript
// miniprogram/pages/audio-player/index.ts

import * as AudioCacheManager from '../../utils/audio-cache-manager.js';

Page({
  onLoad: function() {
    // åˆå§‹åŒ–éŸ³é¢‘ç¼“å­˜ç³»ç»Ÿ
    AudioCacheManager.initAudioCache()
      .then(() => console.log('âœ… éŸ³é¢‘ç¼“å­˜ç³»ç»Ÿåˆå§‹åŒ–æˆåŠŸ'))
      .catch(err => console.error('âŒ éŸ³é¢‘ç¼“å­˜ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥:', err));
  },

  playAudio: function(regionId: string, airportCode: string, clipIndex: number) {
    var self = this;

    // 1. ç”Ÿæˆç¼“å­˜é”®
    var cacheKey = regionId + '_' + airportCode + '_' + clipIndex;

    // 2. å°è¯•ä½¿ç”¨æœ¬åœ°ç¼“å­˜
    var cachedPath = AudioCacheManager.getCachedAudioPath(cacheKey);

    if (cachedPath) {
      // 2.1 ä½¿ç”¨ç¼“å­˜è·¯å¾„ï¼ˆç¦»çº¿ç§’å¼€ï¼‰
      console.log('âœ… ä½¿ç”¨æœ¬åœ°ç¼“å­˜:', cachedPath);
      this.audioContext.src = cachedPath;
      this.audioContext.play();
    } else {
      // 2.2 é¦–æ¬¡æ’­æ”¾ï¼šä½¿ç”¨åˆ†åŒ…è·¯å¾„
      var originalSrc = this.buildAudioSrc(regionId, airportCode, clipIndex);
      this.audioContext.src = originalSrc;
      this.audioContext.play();

      // 2.3 æ’­æ”¾æˆåŠŸåå¼‚æ­¥ç¼“å­˜ï¼ˆä¸é˜»å¡ï¼‰
      this.audioContext.onPlay(function() {
        AudioCacheManager.ensureAudioCached(cacheKey, originalSrc)
          .then(path => console.log('âœ… éŸ³é¢‘å·²ç¼“å­˜:', path))
          .catch(err => console.warn('âš ï¸ ç¼“å­˜å¤±è´¥:', err));
      });
    }
  },

  buildAudioSrc: function(regionId: string, airportCode: string, clipIndex: number): string {
    const regionPathMap = {
      'uk': '/packageUK/',
      'japan': '/packageJapan/',
      // ... å…¶ä»–åœ°åŒº
    };

    var packageRoot = regionPathMap[regionId] || '/package/';
    return packageRoot + this.audioData[clipIndex].mp3_file;
  }
});
```

#### 10.2 æˆ‘çš„é¦–é¡µé›†æˆ
```javascript
// miniprogram/pages/home/index.js

var AudioCacheManager = require('../../utils/audio-cache-manager.js');
var AudioPreheatManager = require('../../utils/audio-preheat-manager.js');

Page({
  // æ˜¾ç¤ºç¼“å­˜ç»Ÿè®¡
  showAudioCacheStats: function() {
    var stats = AudioCacheManager.getCacheStats();
    wx.showModal({
      title: 'éŸ³é¢‘ç¼“å­˜ç»Ÿè®¡',
      content: 'å·²ç¼“å­˜: ' + stats.totalCount + 'ä¸ªéŸ³é¢‘\n' +
               'å ç”¨ç©ºé—´: ' + stats.totalSizeMB + ' MB / ' + stats.maxSizeMB + ' MB',
      showCancel: false
    });
  },

  // å¯åŠ¨æ™ºèƒ½é¢„çƒ­
  startAudioPreheat: function() {
    wx.showLoading({ title: 'é¢„çƒ­ä¸­...', mask: true });

    AudioPreheatManager.startPreheat()
      .then(function(result) {
        wx.hideLoading();
        if (result.status === 'completed') {
          wx.showModal({
            title: 'é¢„çƒ­å®Œæˆ',
            content: 'æˆåŠŸ: ' + result.success + 'ä¸ª\n' +
                     'å¤±è´¥: ' + result.failed + 'ä¸ª\n' +
                     'è·³è¿‡: ' + result.skipped + 'ä¸ª\n' +
                     'è€—æ—¶: ' + (result.duration / 1000).toFixed(1) + 'ç§’',
            showCancel: false
          });
        } else if (result.status === 'skipped') {
          wx.showToast({
            title: 'éWiFiç¯å¢ƒï¼Œè·³è¿‡é¢„çƒ­',
            icon: 'none'
          });
        }
      })
      .catch(function(error) {
        wx.hideLoading();
        wx.showToast({
          title: 'é¢„çƒ­å¤±è´¥',
          icon: 'error'
        });
      });
  },

  // æ¸…ç©ºç¼“å­˜
  clearAudioCache: function() {
    wx.showModal({
      title: 'ç¡®è®¤æ¸…ç©ºéŸ³é¢‘ç¼“å­˜',
      content: 'å°†æ¸…ç©ºæ‰€æœ‰ç¦»çº¿éŸ³é¢‘ç¼“å­˜',
      success: function(res) {
        if (res.confirm) {
          wx.showLoading({ title: 'æ¸…ç©ºä¸­...', mask: true });
          AudioCacheManager.clearAllCache()
            .then(function() {
              wx.hideLoading();
              wx.showToast({ title: 'ç¼“å­˜å·²æ¸…ç©º', icon: 'success' });
            })
            .catch(function(error) {
              wx.hideLoading();
              wx.showToast({ title: 'æ¸…ç©ºå¤±è´¥', icon: 'error' });
            });
        }
      }
    });
  }
});
```

---

### âœ… é…ç½®å®Œæ•´æ€§æ£€æŸ¥æ¸…å•

å®Œæˆæ­¥éª¤1-10åï¼Œè¿è¡Œä»¥ä¸‹æ£€æŸ¥ç¡®ä¿é…ç½®æ­£ç¡®ï¼š

```powershell
# æ£€æŸ¥æ¸…å•ï¼ˆåœ¨ miniprogram ç›®å½•è¿è¡Œï¼‰

$regionId = "uk"  # æ›¿æ¢ä¸ºä½ çš„regionId
$packageName = "ukAudioPackage"
$packageRoot = "packageUK"

Write-Output "========== é…ç½®å®Œæ•´æ€§æ£€æŸ¥ =========="

# 1. æ£€æŸ¥éŸ³é¢‘æ–‡ä»¶
$audioCount = (Get-ChildItem "$packageRoot\*.mp3" -File).Count
Write-Output "1. éŸ³é¢‘æ–‡ä»¶æ•°: $audioCount"

# 2. æ£€æŸ¥æ•°æ®æ–‡ä»¶
$dataCount = (Select-String -Path "data\regions\$regionId.js" -Pattern '"mp3_file":').Matches.Count
Write-Output "2. æ•°æ®è®°å½•æ•°: $dataCount"

if ($audioCount -eq $dataCount) {
  Write-Output "   âœ… éŸ³é¢‘æ–‡ä»¶ä¸æ•°æ®è®°å½•æ•°é‡ä¸€è‡´"
} else {
  Write-Output "   âŒ æ•°é‡ä¸ä¸€è‡´ï¼è¯·æ£€æŸ¥"
}

# 3. æ£€æŸ¥ app.json åˆ†åŒ…é…ç½®
$appJsonContent = Get-Content "app.json" -Raw
if ($appJsonContent -match "`"root`": `"$packageRoot`"") {
  Write-Output "3. âœ… app.json subPackages å·²é…ç½®"
} else {
  Write-Output "3. âŒ app.json subPackages æœªé…ç½®"
}

# 4. æ£€æŸ¥ app.json é¢„åŠ è½½é…ç½®
if ($appJsonContent -match "`"$packageName`"") {
  Write-Output "4. âœ… app.json preloadRule å·²é…ç½®"
} else {
  Write-Output "4. âŒ app.json preloadRule æœªé…ç½®"
}

# 5. æ£€æŸ¥ audio-preload-guide.js
$guideContent = Get-Content "utils\audio-preload-guide.js" -Raw
if ($guideContent -match "'$regionId':\s*\{") {
  Write-Output "5. âœ… audio-preload-guide.js å·²é…ç½®"
} else {
  Write-Output "5. âŒ audio-preload-guide.js æœªé…ç½®"
}

# 6. æ£€æŸ¥ audio-config.jsï¼ˆåœ°åŒºå®šä¹‰ï¼‰
$configContent = Get-Content "utils\audio-config.js" -Raw
if ($configContent -match "id:\s*'$regionId'") {
  Write-Output "6. âœ… audio-config.js regions å·²é…ç½®"
} else {
  Write-Output "6. âŒ audio-config.js regions æœªé…ç½®"
}

# 7. æ£€æŸ¥ audio-config.jsï¼ˆæœºåœºæ•°æ®ï¼‰
if ($configContent -match "regionId:\s*'$regionId'") {
  Write-Output "7. âœ… audio-config.js airports å·²é…ç½®"
} else {
  Write-Output "7. âŒ audio-config.js airports æœªé…ç½®"
}

# 8. æ£€æŸ¥ audio-package-loader.js
$loaderContent = Get-Content "utils\audio-package-loader.js" -Raw
if ($loaderContent -match "'$regionId':\s*\{") {
  Write-Output "8. âœ… audio-package-loader.js å·²é…ç½®"
} else {
  Write-Output "8. âŒ audio-package-loader.js æœªé…ç½®"
}

# 9. æ£€æŸ¥ audio-player/index.ts
$playerContent = Get-Content "pages\audio-player\index.ts" -Raw
if ($playerContent -match "'$regionId':\s*'/$packageRoot/'") {
  Write-Output "9. âœ… audio-player/index.ts å·²é…ç½®"
} else {
  Write-Output "9. âŒ audio-player/index.ts æœªé…ç½®"
}

# 10. æ£€æŸ¥æœ¬åœ°ç¼“å­˜ç³»ç»Ÿé›†æˆ
if ($playerContent -match "AudioCacheManager") {
  Write-Output "10. âœ… æ’­æ”¾å™¨å·²é›†æˆæœ¬åœ°ç¼“å­˜ç³»ç»Ÿ"
} else {
  Write-Output "10. âš ï¸ æ’­æ”¾å™¨æœªé›†æˆæœ¬åœ°ç¼“å­˜ç³»ç»Ÿï¼ˆå¯é€‰ï¼‰"
}

Write-Output "========== æ£€æŸ¥å®Œæˆ =========="
```

---


## é…ç½®æ–‡ä»¶è¯¦è§£

### app.json å®Œæ•´ç»“æ„

```json
{
  "pages": [...],           // ä¸»åŒ…é¡µé¢åˆ—è¡¨
  
  "subPackages": [          // åˆ†åŒ…é…ç½®
    {
      "root": "packageXXX",       // åˆ†åŒ…æ ¹ç›®å½•
      "name": "xxxAudioPackage",  // åˆ†åŒ…åç§°ï¼ˆç”¨äº preloadRuleï¼‰
      "pages": ["index"]          // åˆ†åŒ…é¡µé¢åˆ—è¡¨
    }
  ],
  
  "preloadRule": {          // é¢„åŠ è½½è§„åˆ™
    "pages/xxx/index": {          // è§¦å‘é¢„åŠ è½½çš„é¡µé¢è·¯å¾„
      "network": "all",           // ç½‘ç»œæ¨¡å¼ï¼šall, wifi
      "packages": [               // é¢„åŠ è½½çš„åˆ†åŒ…åˆ—è¡¨
        "packageXXX",
        "packageYYY"
      ]
    }
  },
  
  "window": {...},          // çª—å£é…ç½®
  "tabBar": {...},          // TabBar é…ç½®
  "permission": {...},      // æƒé™é…ç½®
  "requiredPrivateInfos": [...] // éšç§ API å£°æ˜
}
```

### audio-preload-guide.js å®Œæ•´ç»“æ„

```javascript
/**
 * éŸ³é¢‘åˆ†åŒ…é¢„åŠ è½½å¼•å¯¼é…ç½®ç®¡ç†å™¨
 */

// TabBar é¡µé¢åˆ—è¡¨ï¼ˆç¦æ­¢é¢„åŠ è½½éŸ³é¢‘ï¼‰
var TABBAR_PAGES = [
  '/pages/search/index',
  '/pages/flight-calculator/index',
  '/pages/cockpit/index',
  '/pages/operations/index',
  '/pages/home/index'
];

function AudioPreloadGuide() {
  // éŸ³é¢‘åˆ†åŒ…é¢„åŠ è½½é¡µé¢æ˜ å°„é…ç½®
  this.preloadPageMapping = {
    '{regionId}': {
      packageName: 'package{CountryName}',
      regionName: '{å›½å®¶}{åŸå¸‚}æœºåœº',
      flag: '{emoji}',
      preloadPage: '{é¡µé¢è·¯å¾„}',
      preloadPageName: '{é¡µé¢åç§°}',
      preloadPageIcon: '{emoji}',
      description: '{æè¿°æ–‡æ¡ˆ}'
    }
  };

  // åˆå§‹åŒ–æœ¬åœ°å­˜å‚¨ç³»ç»Ÿ
  this.initPreloadStorage();
}

// æ ¸å¿ƒæ–¹æ³•
AudioPreloadGuide.prototype = {
  initPreloadStorage: function() {},      // åˆå§‹åŒ–å­˜å‚¨
  getPreloadGuide: function(regionId) {}, // è·å–å¼•å¯¼ä¿¡æ¯
  generateGuideMessage: function(regionId) {}, // ç”Ÿæˆå¼•å¯¼æ¶ˆæ¯
  checkPackagePreloaded: function(regionId) {}, // æ£€æŸ¥é¢„åŠ è½½çŠ¶æ€
  navigateToPreloadPage: function(regionId) {}, // è·³è½¬é¢„åŠ è½½é¡µé¢
  showPreloadGuideDialog: function(regionId) {}, // æ˜¾ç¤ºå¼•å¯¼å¼¹çª—
  markPackagePreloaded: function(regionId) {}, // æ ‡è®°å·²é¢„åŠ è½½
  clearPreloadStatus: function(regionId) {} // æ¸…é™¤é¢„åŠ è½½çŠ¶æ€
};

module.exports = AudioPreloadGuide;
```

---

## æ•°æ®éªŒè¯æ¸…å•

### âœ… æ–‡ä»¶å®Œæ•´æ€§æ£€æŸ¥

```bash
# 1. æ£€æŸ¥éŸ³é¢‘æ–‡ä»¶æ•°é‡
cd miniprogram/package{CountryName}
ls *.mp3 | wc -l

# 2. æ£€æŸ¥æ•°æ®æ–‡ä»¶è®°å½•æ•°
grep -c '"mp3_file":' data/regions/{country}.js

# 3. å¯¹æ¯”æ•°é‡æ˜¯å¦ä¸€è‡´
# éŸ³é¢‘æ–‡ä»¶æ•° = æ•°æ®è®°å½•æ•° âœ…

# 4. æ£€æŸ¥é‡å¤è®°å½•
grep '"mp3_file":' data/regions/{country}.js | sort | uniq -d

# 5. æ£€æŸ¥ç¼ºå¤±æ–‡ä»¶
# å¯¹æ¯”æ•°æ®æ–‡ä»¶ä¸­çš„ mp3_file ä¸å®é™…æ–‡ä»¶åˆ—è¡¨
```

### âœ… è¯­æ³•æ£€æŸ¥

```bash
# JavaScript è¯­æ³•æ£€æŸ¥
cd miniprogram

# æ£€æŸ¥åˆ†åŒ…å…¥å£æ–‡ä»¶
node -c package{CountryName}/index.js

# æ£€æŸ¥æ•°æ®æ–‡ä»¶
node -c data/regions/{country}.js

# æ£€æŸ¥é…ç½®æ–‡ä»¶
node -c utils/audio-preload-guide.js

# æ£€æŸ¥ app.jsonï¼ˆä½¿ç”¨ PowerShellï¼‰
try {
  $json = Get-Content app.json -Raw | ConvertFrom-Json
  Write-Output "âœ… app.json JSONæ ¼å¼éªŒè¯é€šè¿‡"
} catch {
  Write-Output "âŒ app.json JSONæ ¼å¼é”™è¯¯"
}
```

### âœ… é¢„åŠ è½½é™åˆ¶æ£€æŸ¥

```powershell
# è®¡ç®—é¢„åŠ è½½é¡µé¢æ€»å¤§å°
$packages = @('packageRussia', 'packageAustralia', 'packageFrance', 
              'packageSingapore', 'packageUK')
$totalSize = 0
foreach ($pkg in $packages) {
  $size = (Get-ChildItem "$pkg\*.mp3" -File | 
           Measure-Object -Property Length -Sum).Sum / 1MB
  $totalSize += $size
  Write-Output "$pkg`: $([math]::Round($size, 2)) MB"
}
Write-Output "æ€»é¢„åŠ è½½å¤§å°: $([math]::Round($totalSize, 2)) MB"

# éªŒè¯ï¼šæ€»å¤§å° < 2MB âœ…
```

---

## å¸¸è§é—®é¢˜è§£å†³

### é—®é¢˜ 1ï¼šé¢„åŠ è½½è¶…é™ï¼ˆé”™è¯¯ç  80058ï¼‰

#### ç—‡çŠ¶
```
Error: ç³»ç»Ÿé”™è¯¯ï¼Œé”™è¯¯ç ï¼š80058
preloadRule [pages/xxx/index] source size XXX KB exceed max limit 2MB
```

#### åŸå› 
- å•ä¸ªé¡µé¢é¢„åŠ è½½çš„åˆ†åŒ…æ€»å¤§å°è¶…è¿‡ 2MB

#### è§£å†³æ–¹æ¡ˆ
```javascript
// æ–¹æ¡ˆ 1ï¼šå‹ç¼©éŸ³é¢‘æ–‡ä»¶
ffmpeg -i input.mp3 -b:a 24k -ar 22050 -ac 1 output.mp3

// æ–¹æ¡ˆ 2ï¼šæ‹†åˆ†åˆ°å¤šä¸ªé¢„åŠ è½½é¡µé¢
// å°†å¤§åˆ†åŒ…ç§»åˆ°å…¶ä»–é¡µé¢

// æ–¹æ¡ˆ 3ï¼šæ‹†åˆ†åˆ†åŒ…
// å°†ä¸€ä¸ªå¤§åˆ†åŒ…æ‹†åˆ†ä¸ºä¸¤ä¸ªå°åˆ†åŒ…
packageUK1 (0.8 MB) + packageUK2 (0.8 MB)
```

### é—®é¢˜ 2ï¼šæ•°æ®æ–‡ä»¶ä¸éŸ³é¢‘æ–‡ä»¶æ•°é‡ä¸ä¸€è‡´

#### æ£€æµ‹æ–¹æ³•
```bash
# éŸ³é¢‘æ–‡ä»¶æ•°é‡
audio_count=$(ls miniprogram/packageUK/*.mp3 | wc -l)

# æ•°æ®è®°å½•æ•°é‡
data_count=$(grep -c '"mp3_file":' miniprogram/data/regions/uk.js)

# å¯¹æ¯”
if [ $audio_count -eq $data_count ]; then
  echo "âœ… æ•°é‡ä¸€è‡´"
else
  echo "âŒ æ•°é‡ä¸ä¸€è‡´: éŸ³é¢‘$audio_count æ•°æ®$data_count"
fi
```

#### è§£å†³æ–¹æ¡ˆ
```bash
# 1. æ‰¾å‡ºé‡å¤è®°å½•
grep '"mp3_file":' data/regions/uk.js | sort | uniq -d

# 2. æ‰¾å‡ºç¼ºå¤±æ–‡ä»¶
# åˆ—å‡ºæ•°æ®æ–‡ä»¶ä¸­çš„æ‰€æœ‰ mp3_file
grep -oP '"mp3_file": "\K[^"]+' data/regions/uk.js > data_files.txt

# åˆ—å‡ºå®é™…éŸ³é¢‘æ–‡ä»¶
ls packageUK/*.mp3 | xargs -n 1 basename > audio_files.txt

# å¯¹æ¯”
diff data_files.txt audio_files.txt
```

### é—®é¢˜ 3ï¼šéŸ³é¢‘æ’­æ”¾æ—¶æç¤º"åˆ†åŒ…æœªåŠ è½½"

#### åŸå› 
1. ç”¨æˆ·æœªè®¿é—®è¿‡é¢„åŠ è½½é¡µé¢
2. é¢„åŠ è½½é…ç½®é”™è¯¯
3. åˆ†åŒ…åç§°ä¸åŒ¹é…

#### è§£å†³æ–¹æ¡ˆ
```javascript
// 1. éªŒè¯ regionId ä¸ packageName åŒ¹é…
// audio-preload-guide.js
'uk': {
  packageName: 'packageUK',  // å¿…é¡»ä¸ app.json ä¸­çš„ root ä¸€è‡´
}

// app.json
{
  "root": "packageUK",  // å¿…é¡»ä¸ packageName å¯¹åº”
  "name": "ukAudioPackage"
}

// 2. éªŒè¯é¢„åŠ è½½é…ç½®
// audio-preload-guide.js
'uk': {
  preloadPage: 'pages/communication-failure/index'  // é¡µé¢è·¯å¾„
}

// app.json
"pages/communication-failure/index": {
  "packages": ["packageUK"]  // å¿…é¡»åŒ…å«æ­¤åˆ†åŒ…
}
```

### é—®é¢˜ 4ï¼šJSON æ ¼å¼é”™è¯¯

#### å¸¸è§é”™è¯¯
```json
// âŒ é”™è¯¯ 1ï¼šç¼ºå°‘é€—å·
{
  "label": "åŒºè°ƒ"
  "full_transcript": "..."  // ç¼ºå°‘é€—å·
}

// âŒ é”™è¯¯ 2ï¼šå¤šä½™é€—å·
{
  "label": "åŒºè°ƒ",
  "full_transcript": "...",  // æœ€åä¸€é¡¹ä¸è¦é€—å·
}

// âŒ é”™è¯¯ 3ï¼šå¼•å·é”™è¯¯
{
  "label": 'åŒºè°ƒ',  // åº”è¯¥ç”¨åŒå¼•å·
  "mp3_file": "test.mp3"
}

// âœ… æ­£ç¡®æ ¼å¼
{
  "label": "åŒºè°ƒ",
  "full_transcript": "...",
  "translation_cn": "...",
  "mp3_file": "test.mp3"
}
```

#### éªŒè¯å·¥å…·
```bash
# ä½¿ç”¨ jq éªŒè¯ JSON æ ¼å¼
cat data/regions/uk.js | grep -A 9999 "clips" | jq .

# æˆ–ä½¿ç”¨ Node.js
node -e "require('./data/regions/uk.js')"
```

---

## æœ€ä½³å®è·µå»ºè®®

### ğŸ¯ éŸ³é¢‘è´¨é‡ç®¡ç†

```javascript
// æ¨èçš„éŸ³é¢‘å‚æ•°
const AUDIO_SETTINGS = {
  bitrate: '32-48 kbps',      // æ¯”ç‰¹ç‡
  sampleRate: '22050 Hz',     // é‡‡æ ·ç‡
  channels: 'mono',           // å•å£°é“
  format: 'MP3',              // æ ¼å¼
  targetSize: '< 50 KB/file'  // å•æ–‡ä»¶å¤§å°
};

// å‹ç¼©å‘½ä»¤æ¨¡æ¿
const COMPRESS_COMMAND = `
  ffmpeg -i input.mp3 \\
    -b:a 32k \\           # æ¯”ç‰¹ç‡
    -ar 22050 \\          # é‡‡æ ·ç‡
    -ac 1 \\              # å•å£°é“
    output.mp3
`;
```

### ğŸ¯ æ•°æ®ç»„ç»‡è§„èŒƒ

```javascript
// 1. æŒ‰é£è¡Œé˜¶æ®µæ’åº
const PHASE_ORDER = [
  'æ”¾è¡Œ',   // 1. Clearance Delivery
  'åœ°é¢',   // 2. Ground Control
  'å¡”å°',   // 3. Tower (Takeoff)
  'ç¦»åœº',   // 4. Departure
  'åŒºè°ƒ',   // 5. Area Control
  'è¿›åœº',   // 6. Arrival
  'è¿›è¿‘',   // 7. Approach
  'å¡”å°',   // 8. Tower (Landing)
  'åœ°é¢'    // 9. Ground Control (Taxi-in)
];

// 2. åŒä¸€èˆªç­çš„å½•éŸ³è¿ç»­æ’åˆ—
// âœ… æ¨è
China-Eastern-7551_xxx_1.mp3
China-Eastern-7551_xxx_2.mp3
China-Eastern-7551_xxx_3.mp3
Hainan-439_xxx_1.mp3
Hainan-439_xxx_2.mp3

// âŒ ä¸æ¨è
China-Eastern-7551_xxx_1.mp3
Hainan-439_xxx_1.mp3
China-Eastern-7551_xxx_2.mp3
```

### ğŸ¯ ç‰ˆæœ¬ç®¡ç†

```javascript
// package{CountryName}/index.js ç‰ˆæœ¬å·è§„èŒƒ

// ä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.ä¿®è®¢å·
version: 'X.Y.Z'

// X: ä¸»ç‰ˆæœ¬å·ï¼ˆé‡å¤§å˜æ›´ï¼‰
//    - æ›´æ¢æœºåœº
//    - å®Œå…¨é‡å½•
//    - åˆ é™¤ >50% æ–‡ä»¶

// Y: æ¬¡ç‰ˆæœ¬å·ï¼ˆåŠŸèƒ½æ›´æ–°ï¼‰
//    - æ–°å¢å½•éŸ³
//    - æ›´æ–°éƒ¨åˆ†å½•éŸ³
//    - é‡æ–°å‹ç¼©

// Z: ä¿®è®¢å·ï¼ˆbugä¿®å¤ï¼‰
//    - ä¿®æ­£ç¿»è¯‘é”™è¯¯
//    - ä¿®æ­£æ–‡ä»¶å
//    - å…ƒæ•°æ®æ›´æ–°

// ç¤ºä¾‹
'1.0.0'  // åˆå§‹ç‰ˆæœ¬
'1.1.0'  // æ–°å¢10æ¡å½•éŸ³
'1.1.1'  // ä¿®æ­£3æ¡ç¿»è¯‘
'2.0.0'  // æ›´æ¢ä¸ºå¦ä¸€ä¸ªæœºåœº
```

### ğŸ¯ æ–‡æ¡£åŒ–

```markdown
# æ¯ä¸ªæ–°å¢æœºåœºéƒ½åº”åˆ›å»ºæ›´æ–°æ–‡æ¡£

## æ–‡æ¡£ç»“æ„
æ›´æ–°è¯´æ˜/
â””â”€â”€ æ–°å¢{å›½å®¶}{åŸå¸‚}éŸ³é¢‘åˆ†åŒ…_v{ç‰ˆæœ¬}.md
    â”œâ”€â”€ éŸ³é¢‘åˆ†åŒ…ä¿¡æ¯
    â”œâ”€â”€ èˆªç©ºå…¬å¸è¦†ç›–
    â”œâ”€â”€ éŸ³é¢‘å†…å®¹åˆ†ç±»
    â”œâ”€â”€ ç‰¹è‰²é™†ç©ºé€šè¯
    â”œâ”€â”€ æŠ€æœ¯å®ç°
    â”œâ”€â”€ é¡¹ç›®ç»Ÿè®¡æ›´æ–°
    â”œâ”€â”€ é¢„åŠ è½½é…ç½®æ›´æ–°
    â”œâ”€â”€ éªŒè¯æ¸…å•
    â””â”€â”€ æœºåœºä¿¡æ¯

## æ¨¡æ¿
å‚è€ƒ: æ›´æ–°è¯´æ˜/æ–°å¢è‹±å›½ä¼¦æ•¦éŸ³é¢‘åˆ†åŒ…_v2.8.1.md
```

---

## å¿«é€Ÿå‚è€ƒè¡¨

### æ–‡ä»¶è·¯å¾„å¯¹ç…§

| ç±»å‹ | è·¯å¾„ | è¯´æ˜ |
|-----|------|------|
| éŸ³é¢‘åˆ†åŒ… | `miniprogram/package{CountryName}/` | å­˜æ”¾éŸ³é¢‘æ–‡ä»¶ |
| åˆ†åŒ…å…¥å£ | `miniprogram/package{CountryName}/index.js` | åˆ†åŒ…å…ƒæ•°æ® |
| æ•°æ®æ–‡ä»¶ | `miniprogram/data/regions/{country}.js` | è½¬å½•å’Œç¿»è¯‘ |
| å…¨å±€é…ç½® | `miniprogram/app.json` | åˆ†åŒ…å’Œé¢„åŠ è½½ |
| å¼•å¯¼é…ç½® | `miniprogram/utils/audio-preload-guide.js` | é¢„åŠ è½½æ˜ å°„ |
| æ›´æ–°æ–‡æ¡£ | `æ›´æ–°è¯´æ˜/æ–°å¢{å›½å®¶}{åŸå¸‚}éŸ³é¢‘åˆ†åŒ…_v{ç‰ˆæœ¬}.md` | ç‰ˆæœ¬è®°å½• |

### å‘½ä»¤é€ŸæŸ¥

```bash
# ç»Ÿè®¡éŸ³é¢‘æ•°é‡
(Get-ChildItem "packageXXX\*.mp3" -File).Count

# ç»Ÿè®¡åˆ†åŒ…å¤§å°
$size = (Get-ChildItem "packageXXX\*.mp3" -File | 
         Measure-Object -Property Length -Sum).Sum / 1MB
[math]::Round($size, 2)

# æ£€æŸ¥æ•°æ®è®°å½•æ•°
(Select-String -Path "data\regions\xxx.js" -Pattern '"mp3_file":').Matches.Count

# æ£€æŸ¥é‡å¤è®°å½•
Select-String -Path "data\regions\xxx.js" -Pattern '"mp3_file": "(.*?)"' | 
  ForEach-Object { $_.Matches.Groups[1].Value } | 
  Group-Object | Where-Object { $_.Count -gt 1 }

# è¯­æ³•æ£€æŸ¥
node -c packageXXX/index.js
node -c data/regions/xxx.js
```

---

## é™„å½•

### A. å½“å‰éŸ³é¢‘åˆ†åŒ…æ€»è§ˆï¼ˆv2.8.1ï¼‰

| # | å›½å®¶/åœ°åŒº | åˆ†åŒ…åç§° | å¤§å° | æ–‡ä»¶æ•° | é¢„åŠ è½½é¡µé¢ |
|---|---------|---------|------|--------|-----------|
| 1 | ğŸ‡°ğŸ‡· éŸ©å›½ | packageKorean | 1.74 MB | 121 | å½•éŸ³æ’­æ”¾ |
| 2 | ğŸ‡¯ğŸ‡µ æ—¥æœ¬ | packageJapan | 1.00 MB | 67 | èˆªçº¿å½•éŸ³ |
| 3 | ğŸ‡ºğŸ‡¸ ç¾å›½ | packageAmerica | 0.72 MB | 53 | èˆªçº¿å½•éŸ³ |
| 4 | ğŸ‡¦ğŸ‡ª é˜¿è”é…‹ | packageUAE | 0.64 MB | 38 | å½•éŸ³åˆ†ç±» |
| 5 | ğŸ‡¬ğŸ‡§ è‹±å›½ | packageUK | 0.57 MB | 36 | é€šä¿¡å¤±æ•ˆ |
| 6 | ğŸ‡®ğŸ‡¹ æ„å¤§åˆ© | packageItaly | 0.51 MB | 29 | å½•éŸ³åˆ†ç±» |
| 7 | ğŸ‡µğŸ‡­ è²å¾‹å®¾ | packagePhilippines | 0.46 MB | 27 | å½•éŸ³åˆ†ç±» |
| 8 | ğŸ‡¹ğŸ‡­ æ³°å›½ | packageThailand | 0.43 MB | 27 | å½•éŸ³ç‰‡æ®µ |
| 9 | ğŸ‡±ğŸ‡° æ–¯é‡Œå…°å¡ | packageSrilanka | 0.41 MB | 22 | å½•éŸ³ç‰‡æ®µ |
| 10 | ğŸ‡¹ğŸ‡· åœŸè€³å…¶ | packageTurkey | 0.41 MB | 28 | å½•éŸ³ç‰‡æ®µ |
| 11 | ğŸ‡·ğŸ‡º ä¿„ç½—æ–¯ | packageRussia | 0.38 MB | 23 | é€šä¿¡å¤±æ•ˆ |
| 12 | ğŸ‡¦ğŸ‡º æ¾³å¤§åˆ©äºš | packageAustralia | 0.35 MB | 20 | é€šä¿¡å¤±æ•ˆ |
| 13 | ğŸ‡«ğŸ‡· æ³•å›½ | packageFrance | 0.26 MB | 19 | é€šä¿¡å¤±æ•ˆ |
| 14 | ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡ | packageSingapore | 0.15 MB | 8 | é€šä¿¡å¤±æ•ˆ |

**æ€»è®¡**: 14ä¸ªéŸ³é¢‘åˆ†åŒ…ï¼Œ8.03 MBï¼Œ374ä¸ªéŸ³é¢‘æ–‡ä»¶

### B. é¢„åŠ è½½é¡µé¢é…ç½®æ€»è§ˆ

| é¢„åŠ è½½é¡µé¢ | è·¯å¾„ | å›¾æ ‡ | åˆ†åŒ…æ•° | æ€»å¤§å° | å‰©ä½™ç©ºé—´ |
|-----------|------|------|--------|--------|---------|
| å½•éŸ³æ’­æ”¾ | pages/audio-player/index | ğŸµ | 1 | 1.74 MB | 0.26 MB |
| èˆªçº¿å½•éŸ³ | pages/airline-recordings/index | âœˆï¸ | 2 | 1.72 MB | 0.28 MB |
| å½•éŸ³åˆ†ç±» | pages/recording-categories/index | ğŸ“‚ | 3 | 1.61 MB | 0.39 MB |
| é€šä¿¡å¤±æ•ˆ | pages/communication-failure/index | ğŸ“¡ | 5 | 1.71 MB | 0.29 MB |
| å½•éŸ³ç‰‡æ®µ | pages/recording-clips/index | ğŸ¬ | 3 | 1.25 MB | 0.75 MB |

---

**æ–‡æ¡£åˆ›å»º**: 2025-10-25  
**é€‚ç”¨ç‰ˆæœ¬**: v2.8.1+  
**ç»´æŠ¤è´£ä»»**: å¼€å‘å›¢é˜Ÿ  
**æ›´æ–°é¢‘ç‡**: éšé¡¹ç›®æ›´æ–°

