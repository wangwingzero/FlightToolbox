# æ•…éšœæ’æŸ¥ï¼šéŸ³é¢‘æ— æ³•æ’­æ”¾é—®é¢˜

**åˆ›å»ºæ—¥æœŸ**: 2025-10-26  
**é—®é¢˜æ¥æº**: UKå’ŒChinese TaipeiéŸ³é¢‘åˆ†åŒ…æ— æ³•æ’­æ”¾  
**å½±å“ç‰ˆæœ¬**: v2.8.1

---

## ğŸš¨ é—®é¢˜æè¿°

### ç—‡çŠ¶

```
âœ… èˆªçº¿å½•éŸ³é¡µé¢èƒ½çœ‹åˆ°å›½å®¶å¡ç‰‡
âœ… ç‚¹å‡»å›½å®¶å¡ç‰‡èƒ½è·³è½¬åˆ°æ’­æ”¾é¡µé¢
âœ… æ’­æ”¾é¡µé¢èƒ½çœ‹åˆ°å½•éŸ³åˆ—è¡¨
âŒ ç‚¹å‡»æ’­æ”¾æŒ‰é’®æ— ååº”
âŒ æ§åˆ¶å°æ˜¾ç¤ºé”™è¯¯ï¼š
    âŒ æœªæ‰¾åˆ°åœ°åŒºID "xxx" çš„è·¯å¾„æ˜ å°„
    âŒ éŸ³é¢‘ä¸Šä¸‹æ–‡ä¸å­˜åœ¨ï¼Œæ— æ³•æ’­æ”¾
```

### æ§åˆ¶å°é”™è¯¯æ—¥å¿—ç¤ºä¾‹

```javascript
ğŸµ éŸ³é¢‘æ’­æ”¾é¡µé¢åŠ è½½ {regionId: "uk", regionName: "è‹±å›½", ...}
ğŸ” æ£€æŸ¥åœ°åŒº uk çš„éŸ³é¢‘åˆ†åŒ…é¢„åŠ è½½çŠ¶æ€...
âŒ æœªæ‰¾åˆ°åœ°åŒºID "uk" çš„è·¯å¾„æ˜ å°„
  at setAudioSource @ index.ts:352
  at checkPreloadAndSetAudioSource @ index.ts:239
  at onLoad @ index.ts:128

ğŸ¯ ç‚¹å‡»æ’­æ”¾/æš‚åœæŒ‰é’®
ğŸµ åœ°åŒº uk æ— éœ€åˆ†åŒ…åŠ è½½
ğŸ”„ åˆ†åŒ…åŠ è½½å®Œæˆï¼Œå¼€å§‹æ’­æ”¾é€»è¾‘
âŒ éŸ³é¢‘ä¸Šä¸‹æ–‡ä¸å­˜åœ¨ï¼Œæ— æ³•æ’­æ”¾
  at index.ts:1185
```

---

## ğŸ” æ ¹æœ¬åŸå› 

æ–°å¢éŸ³é¢‘åˆ†åŒ…æ—¶ï¼Œ**é—æ¼äº†3ä¸ªæ ¸å¿ƒé…ç½®æ–‡ä»¶çš„æ›´æ–°**ï¼š

1. âŒ `audio-config.js` - ç¼ºå°‘åœ°åŒºæ•°æ®é…ç½®
2. âŒ `audio-package-loader.js` - ç¼ºå°‘åˆ†åŒ…åŠ è½½é…ç½®
3. âŒ `audio-player/index.ts` - ç¼ºå°‘è·¯å¾„æ˜ å°„é…ç½®

è¿™3ä¸ªæ–‡ä»¶æ˜¯**éŸ³é¢‘æ’­æ”¾çš„æ ¸å¿ƒä¾èµ–**ï¼Œç¼ºå°‘ä»»ä½•ä¸€ä¸ªéƒ½ä¼šå¯¼è‡´æ’­æ”¾å¤±è´¥ã€‚

---

## âœ… è§£å†³æ–¹æ¡ˆï¼ˆå¿…é¡»å…¨éƒ¨å®Œæˆï¼‰

### æ–¹æ¡ˆ1: audio-config.jsï¼ˆæ˜¾ç¤ºé—®é¢˜ï¼‰

**ä½œç”¨**: æ§åˆ¶èˆªçº¿å½•éŸ³é¡µé¢çš„åœ°åŒºå¡ç‰‡æ˜¾ç¤ºå’Œæ•°æ®åŠ è½½

**ä¿®æ”¹ä½ç½®**:

```javascript
// miniprogram/utils/audio-config.js

// 1ï¸âƒ£ æ–‡ä»¶é¡¶éƒ¨ - æ·»åŠ æ•°æ®å¯¼å…¥
let ukData, chineseTaipeiData;

try {
  ukData = require('../data/regions/uk.js');
  chineseTaipeiData = require('../data/regions/chinese-taipei.js');
} catch (error) {
  console.error('åŠ è½½éŸ³é¢‘æ•°æ®å¤±è´¥:', error);
  ukData = { clips: [] };
  chineseTaipeiData = { clips: [] };
}

// 2ï¸âƒ£ regions æ•°ç»„ - æ·»åŠ åœ°åŒºé…ç½®
class AudioConfigManager {
  constructor() {
    this.regions = [
      // ... å…¶ä»–åœ°åŒº
      {
        id: 'uk',                    // âš ï¸ å¿…é¡»ä¸å…¶ä»–æ–‡ä»¶ä¿æŒä¸€è‡´
        continentId: 'europe',
        name: 'è‹±å›½',
        flag: 'ğŸ‡¬ğŸ‡§',
        description: 'ä¼¦æ•¦å¸Œæ–¯ç½—æœºåœºçœŸå®é™†ç©ºé€šè¯å½•éŸ³',
        count: 36,
        hasRealRecordings: true,
        subPackageName: 'ukAudioPackage'
      },
      {
        id: 'chinese-taipei',        // âš ï¸ å¿…é¡»ä¸å…¶ä»–æ–‡ä»¶ä¿æŒä¸€è‡´
        continentId: 'asia',
        name: 'ä¸­å›½å°åŒ—',
        flag: 'ğŸ‡¨ğŸ‡³',
        description: 'æ¾å±±æœºåœºçœŸå®é™†ç©ºé€šè¯å½•éŸ³',
        count: 17,
        hasRealRecordings: true,
        subPackageName: 'chineseTaipeiAudioPackage'
      }
    ];

    // 3ï¸âƒ£ airports æ•°ç»„ - æ·»åŠ æœºåœºé…ç½®
    this.airports = [
      // ... å…¶ä»–æœºåœº
      {
        id: 'uk',
        regionId: 'uk',
        name: 'è‹±å›½ä¼¦æ•¦å¸Œæ–¯ç½—æœºåœº',
        city: 'ä¼¦æ•¦',
        icao: 'EGLL',
        packageName: 'packageUK',
        audioPath: '/packageUK/',
        icon: 'ğŸ°',
        description: 'è‹±å›½ä¼¦æ•¦å¸Œæ–¯ç½—æœºåœºçœŸå®é™†ç©ºé€šè¯å½•éŸ³',
        clips: ukData.clips || []    // âš ï¸ ä½¿ç”¨å¯¼å…¥çš„æ•°æ®
      },
      {
        id: 'chinese-taipei',
        regionId: 'chinese-taipei',
        name: 'ä¸­å›½å°åŒ—æ¾å±±æœºåœº',
        city: 'å°åŒ—',
        icao: 'RCSS',
        packageName: 'packageTaipei',
        audioPath: '/packageTaipei/',
        icon: 'ğŸ™ï¸',
        description: 'ä¸­å›½å°åŒ—æ¾å±±æœºåœºçœŸå®é™†ç©ºé€šè¯å½•éŸ³',
        clips: chineseTaipeiData.clips || []
      }
    ];

    // 4ï¸âƒ£ æ›´æ–°å¤§æ´²æ€»æ•°
    this.continents = [
      {
        id: 'europe',
        name: 'æ¬§æ´²',
        totalCount: 135,  // ğŸ‘ˆ åŸå€¼ + æ–°å¢éŸ³é¢‘æ•°
        regionCount: 5,   // ğŸ‘ˆ åŸå€¼ + 1
        // ...
      },
      {
        id: 'asia',
        name: 'äºšæ´²',
        totalCount: 282,  // ğŸ‘ˆ åŸå€¼ + æ–°å¢éŸ³é¢‘æ•°
        regionCount: 8,   // ğŸ‘ˆ åŸå€¼ + 1
        // ...
      }
    ];
  }
}
```

**å¦‚æœç¼ºå°‘æ­¤é…ç½®**:
- âŒ èˆªçº¿å½•éŸ³é¡µé¢çœ‹ä¸åˆ°æ–°å¢çš„å›½å®¶å¡ç‰‡
- âŒ æˆ–è€…å¡ç‰‡æ˜¾ç¤ºä½†éŸ³é¢‘æ•°é‡ä¸º0

---

### æ–¹æ¡ˆ2: audio-package-loader.jsï¼ˆåŠ è½½é—®é¢˜ï¼‰

**ä½œç”¨**: æ§åˆ¶éŸ³é¢‘åˆ†åŒ…çš„æŒ‰éœ€åŠ è½½é€»è¾‘

**ä¿®æ”¹ä½ç½®**:

```javascript
// miniprogram/utils/audio-package-loader.js

function AudioPackageLoader() {
  // ...
  
  this.packageMapping = {
    // ... å…¶ä»–åœ°åŒº
    
    'uk': {                          // âš ï¸ å¿…é¡»ä¸å…¶ä»–æ–‡ä»¶çš„regionIdä¸€è‡´
      packageName: 'ukAudioPackage',
      packageRoot: 'packageUK',
      displayName: 'è‹±å›½ä¼¦æ•¦å¸Œæ–¯ç½—æœºåœº',
      flag: 'ğŸ‡¬ğŸ‡§'
    },
    'chinese-taipei': {              // âš ï¸ å¿…é¡»ä¸å…¶ä»–æ–‡ä»¶çš„regionIdä¸€è‡´
      packageName: 'chineseTaipeiAudioPackage',
      packageRoot: 'packageTaipei',
      displayName: 'ä¸­å›½å°åŒ—æ¾å±±æœºåœº',
      flag: 'ğŸ‡¨ğŸ‡³'
    }
  };
}
```

**å¦‚æœç¼ºå°‘æ­¤é…ç½®**:
- âŒ æ§åˆ¶å°æ˜¾ç¤ºï¼š`âš ï¸ æœªæ‰¾åˆ°åœ°åŒº xxx çš„åˆ†åŒ…é…ç½®`
- âŒ ç‚¹å‡»æ’­æ”¾æ—¶å¼¹çª—ï¼š"åˆ†åŒ…åŠ è½½å¤±è´¥"

---

### æ–¹æ¡ˆ3: audio-player/index.tsï¼ˆæ’­æ”¾é—®é¢˜ï¼‰

**ä½œç”¨**: æ§åˆ¶éŸ³é¢‘æ–‡ä»¶è·¯å¾„çš„è§£æå’Œæ’­æ”¾

**ä¿®æ”¹ä½ç½®**:

```typescript
// miniprogram/pages/audio-player/index.ts

// åœ¨ setAudioSource æ–¹æ³•ä¸­æ·»åŠ è·¯å¾„æ˜ å°„
setAudioSource(clip: any) {
  const regionPathMap: { [key: string]: string } = {
    'japan': '/packageJapan/',
    'philippines': '/packagePhilippines/',
    'korea': '/packageKorean/',
    'singapore': '/packageSingapore/',
    'thailand': '/packageThailand/',
    'germany': '/packageGermany/',
    'france': '/packageFrance/',
    'usa': '/packageAmerica/',
    'italy': '/packageItaly/',
    'australia': '/packageAustralia/',
    'south-africa': '/packageSouthAfrica/',
    'russia': '/packageRussia/',
    'srilanka': '/packageSrilanka/',
    'turkey': '/packageTurkey/',
    'uae': '/packageUAE/',
    'uk': '/packageUK/',                    // âš ï¸ æ–°å¢
    'chinese-taipei': '/packageTaipei/'     // âš ï¸ æ–°å¢
  };

  const basePath = regionPathMap[this.data.regionId];
  if (!basePath) {
    console.error('âŒ æœªæ‰¾åˆ°åœ°åŒºID "' + this.data.regionId + '" çš„è·¯å¾„æ˜ å°„');
    this.setData({ currentAudioSrc: '' });
    return;
  }
  
  // ... åç»­é€»è¾‘
}
```

**è·¯å¾„æ ¼å¼è¦æ±‚**:
- âœ… å‰åéƒ½è¦æœ‰æ–œæ ï¼š`'/packageUK/'`
- âŒ é”™è¯¯ç¤ºä¾‹ï¼š`'packageUK'`, `'/packageUK'`, `'packageUK/'`

**å¦‚æœç¼ºå°‘æ­¤é…ç½®**:
- âŒ æ§åˆ¶å°æ˜¾ç¤ºï¼š`âŒ æœªæ‰¾åˆ°åœ°åŒºID "xxx" çš„è·¯å¾„æ˜ å°„`
- âŒ æ§åˆ¶å°æ˜¾ç¤ºï¼š`âŒ éŸ³é¢‘ä¸Šä¸‹æ–‡ä¸å­˜åœ¨ï¼Œæ— æ³•æ’­æ”¾`
- âŒ ç‚¹å‡»æ’­æ”¾æŒ‰é’®å®Œå…¨æ— ååº”

---

## ğŸ” è¯Šæ–­æµç¨‹

### æ­¥éª¤1: æ£€æŸ¥èˆªçº¿å½•éŸ³é¡µé¢

```bash
âœ… èƒ½çœ‹åˆ°å›½å®¶å¡ç‰‡ â†’ audio-config.js é…ç½®æ­£ç¡®
âŒ çœ‹ä¸åˆ°å›½å®¶å¡ç‰‡ â†’ æ£€æŸ¥ audio-config.js çš„ regions é…ç½®
```

### æ­¥éª¤2: æ£€æŸ¥æ§åˆ¶å°é”™è¯¯

```javascript
// é”™è¯¯1: æœªæ‰¾åˆ°åœ°åŒºçš„åˆ†åŒ…é…ç½®
âš ï¸ æœªæ‰¾åˆ°åœ°åŒº xxx çš„åˆ†åŒ…é…ç½®
â†’ ä¿®å¤ï¼šaudio-package-loader.js æ·»åŠ  packageMapping

// é”™è¯¯2: æœªæ‰¾åˆ°åœ°åŒºIDçš„è·¯å¾„æ˜ å°„
âŒ æœªæ‰¾åˆ°åœ°åŒºID "xxx" çš„è·¯å¾„æ˜ å°„
â†’ ä¿®å¤ï¼šaudio-player/index.ts æ·»åŠ  regionPathMap

// é”™è¯¯3: éŸ³é¢‘ä¸Šä¸‹æ–‡ä¸å­˜åœ¨
âŒ éŸ³é¢‘ä¸Šä¸‹æ–‡ä¸å­˜åœ¨ï¼Œæ— æ³•æ’­æ”¾
â†’ åŸå› ï¼šé€šå¸¸æ˜¯å› ä¸ºé”™è¯¯2å¯¼è‡´çš„è¿é”ååº”
â†’ ä¿®å¤ï¼šå…ˆè§£å†³é”™è¯¯2
```

### æ­¥éª¤3: ä½¿ç”¨å¿«é€Ÿè‡ªæ£€å‘½ä»¤

```powershell
# åœ¨ miniprogram ç›®å½•è¿è¡Œ
$regionId = "uk"  # æ›¿æ¢ä¸ºä½ è¦æ£€æŸ¥çš„ regionId

Write-Output "æ£€æŸ¥ audio-config.js:"
Select-String -Path "utils\audio-config.js" -Pattern "id: '$regionId'" | Select-Object -First 1

Write-Output "æ£€æŸ¥ audio-package-loader.js:"
Select-String -Path "utils\audio-package-loader.js" -Pattern "'$regionId':" | Select-Object -First 1

Write-Output "æ£€æŸ¥ audio-player/index.ts:"
Select-String -Path "pages\audio-player\index.ts" -Pattern "'$regionId':" | Select-Object -First 1

Write-Output ""
Write-Output "âœ… æ‰€æœ‰4ä¸ªæ–‡ä»¶éƒ½æœ‰è¾“å‡º = é…ç½®å®Œæ•´"
Write-Output "âŒ ä»»ä½•æ–‡ä»¶æ²¡æœ‰è¾“å‡º = è¯¥æ–‡ä»¶é—æ¼é…ç½®"
```

---

## ğŸ“‹ å®Œæ•´æ£€æŸ¥æ¸…å•

æ–°å¢æœºåœºæ—¶å¿…é¡»æ›´æ–°çš„æ–‡ä»¶ï¼ˆæŒ‰é¡ºåºï¼‰ï¼š

```bash
âœ… 1. package{CountryName}/index.js          - åˆ†åŒ…å…ƒæ•°æ®
âœ… 2. data/regions/{country}.js              - éŸ³é¢‘æ•°æ®
âœ… 3. app.json (subPackages)                 - åˆ†åŒ…æ³¨å†Œ
âœ… 4. app.json (preloadRule)                 - é¢„åŠ è½½è§„åˆ™
âœ… 5. utils/audio-preload-guide.js           - é¢„åŠ è½½å¼•å¯¼
âœ… 6. utils/audio-config.js (é¡¶éƒ¨)           - æ•°æ®å¯¼å…¥
âœ… 7. utils/audio-config.js (regions)        - åœ°åŒºé…ç½®
âœ… 8. utils/audio-config.js (airports)       - æœºåœºé…ç½®
âœ… 9. utils/audio-config.js (continents)     - å¤§æ´²æ€»æ•°
âœ… 10. utils/audio-package-loader.js         - åˆ†åŒ…åŠ è½½é…ç½®
âœ… 11. pages/audio-player/index.ts           - è·¯å¾„æ˜ å°„é…ç½®
```

**âš ï¸ é‡ç‚¹**: æ­¥éª¤6-11ç»å¸¸è¢«é—æ¼ï¼Œå¿…é¡»ä»”ç»†æ£€æŸ¥ï¼

---

## ğŸ¯ é¢„é˜²æªæ–½

### 1. ä½¿ç”¨æ£€æŸ¥æ¸…å•

æ¯æ¬¡æ–°å¢æœºåœºæ—¶ï¼Œæ‰“å°æ£€æŸ¥æ¸…å•ï¼Œé€é¡¹å‹¾é€‰ã€‚

### 2. è¿è¡Œè‡ªæ£€è„šæœ¬

å®Œæˆé…ç½®åï¼Œç«‹å³è¿è¡Œå¿«é€Ÿè‡ªæ£€å‘½ä»¤éªŒè¯ã€‚

### 3. å…ˆåœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­æœç´¢ç°æœ‰regionId

```powershell
# æœç´¢ç°æœ‰é…ç½®ä½œä¸ºå‚è€ƒ
Select-String -Path "utils\audio-config.js" -Pattern "id: 'korea'"
Select-String -Path "utils\audio-package-loader.js" -Pattern "'korea':"
Select-String -Path "pages\audio-player\index.ts" -Pattern "'korea':"
```

### 4. ä¿æŒregionIdä¸€è‡´æ€§

æ‰€æœ‰æ–‡ä»¶ä½¿ç”¨**å®Œå…¨ç›¸åŒ**çš„regionIdï¼š
- âœ… å…¨éƒ¨ä½¿ç”¨ `'uk'`
- âŒ ä¸è¦æ··ç”¨ `'UK'`, `'united-kingdom'`, `'è‹±å›½'`

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- æ–°å¢æœºåœºå¿«é€Ÿå¼€å§‹æŒ‡å—.md
- èˆªçº¿å½•éŸ³åˆ†åŒ…å®Œæ•´ç®¡ç†æŒ‡å—.md
- é…ç½®æ¨¡æ¿.md

---

**è§£å†³æ—¶é—´**: 2025-10-26  
**æµ‹è¯•ç»“æœ**: âœ… UKå’ŒChinese TaipeiéŸ³é¢‘æ’­æ”¾æ­£å¸¸  
**ç»éªŒæ€»ç»“**: æ–°å¢æœºåœºå¿…é¡»æ›´æ–°11ä¸ªé…ç½®ç‚¹ï¼Œç¼ºä¸€ä¸å¯

