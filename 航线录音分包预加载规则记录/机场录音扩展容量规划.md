# 机场录音扩展容量规划

**文档类型**: 容量规划 & 扩展指南  
**创建日期**: 2025-10-26  
**最后更新**: 2025-10-27  
**当前版本**: v2.8.9  
**当前机场数**: 28个国家/地区，1182条录音，6.68 MB

---

## 📊 当前容量状态

### 已使用容量

```
总计: 28个机场，6.68 MB，1182条录音 🎉 接近1200条！

分布：
- 🌏 亚洲: 15个（738条，4.08 MB）⬆️ +1机场，+30条
- 🌍 欧洲: 5个（146条，0.95 MB）
- 🌎 美洲: 2个（110条，0.60 MB）
- 🏝️ 大洋洲: 2个（61条，0.37 MB）
- 🌍 非洲: 1个（34条，0.19 MB）
- 🌍 中东: 2个（93条，0.48 MB）
```

### 各预加载页面剩余容量

| 页面 | 当前使用 | 剩余容量 | 可增机场 | 优先级 |
|-----|---------|---------|---------|-------|
| **我的首页** | 0.87 MB | **1.13 MB** | ~4个 | ⭐⭐⭐⭐⭐ |
| **录音片段** | 1.36 MB | **0.64 MB** | ~2个 | ⭐⭐⭐⭐ (包含越南+缅甸) |
| **航线录音** | 1.30 MB | **0.70 MB** | ~2-3个 | ⭐⭐⭐ (包含印尼) |
| **通信页面** | 0.94 MB | **1.06 MB** | ~4个 | ⭐⭐⭐ (包含印度+柬埔寨) |
| **通信失效** | 1.25 MB | **0.75 MB** | ~3个 | ⭐⭐ (包含乌兹别克斯坦) |
| **录音分类** | 1.07 MB | **0.93 MB** | ~3个 | ⭐⭐ |

**总剩余容量**: 5.32 MB  
**可扩展机场数**: 19-23个

---

## 🌍 按大洲扩展建议

### 1️⃣ 亚洲（可增加 3-5个）

**当前状态**: 15个，738条，4.08 MB ✅
- 🇨🇳 中国（台北、澳门、香港）: 109条
- 🇯🇵 日本东京: 24条
- 🇰🇷 韩国仁川: 11条
- 🇵🇭 菲律宾马尼拉: 84条
- 🇸🇬 新加坡樟宜: 42条
- 🇲🇾 马来西亚吉隆坡: 83条 ✅ 已添加 (v2.8.3)
- 🇮🇩 印度尼西亚雅加达: 53条 ✅ 已添加 (v2.8.4)
- 🇻🇳 越南胡志明/河内: 115条 ✅ 已添加 (v2.8.5)
- 🇮🇳 印度德里: 29条 ✅ 已添加 (v2.8.6)
- 🇰🇭 柬埔寨金边: 45条 ✅ 已添加 (v2.8.7)
- 🇲🇲 缅甸仰光: 38条 ✅ 已添加 (v2.8.8)
- 🇺🇿 乌兹别克斯坦塔什干: 30条 ✅ 已添加 (v2.8.9)
- 🇹🇭 泰国曼谷: 74条
- 🇱🇰 斯里兰卡科伦坡: 54条

**推荐新增**:

| 机场 | ICAO | 优先级 | 预计大小 | 预计录音 | 预加载页面 |
|-----|------|--------|---------|---------|----------|
| 印度德里 | VIDP | ⭐⭐⭐⭐⭐ | 0.35 MB | 40-50条 | 录音片段/通信页面 |
| 越南河内 | VVNB | ⭐⭐⭐⭐ | 0.25 MB | 30-35条 | 录音片段 |
| 越南胡志明 | VVTS | ⭐⭐⭐⭐ | 0.28 MB | 32-38条 | 录音片段 |
| 巴基斯坦卡拉奇 | OPKC | ⭐⭐⭐ | 0.25 MB | 30-35条 | 通信页面 |
| 尼泊尔加德满都 | VNKT | ⭐⭐⭐ | 0.18 MB | 20-25条 | 我的首页 |
| 缅甸仰光 | VYYY | ⭐⭐ | 0.15 MB | 18-22条 | 录音片段 |
| 蒙古乌兰巴托 | ZMUB | ⭐⭐ | 0.12 MB | 15-18条 | 我的首页 |
| 哈萨克斯坦阿拉木图 | UAAA | ⭐⭐ | 0.22 MB | 25-30条 | 通信失效 |
| 乌兹别克斯坦塔什干 | UTTT | ⭐ | 0.18 MB | 20-25条 | 通信失效 |

**总计**: 约 2.35 MB，可容纳

---

### 2️⃣ 欧洲（可增加 8-10个）

**当前状态**: 5个，135条，0.88 MB

**推荐新增**:

| 机场 | ICAO | 优先级 | 预计大小 | 预计录音 | 预加载页面 |
|-----|------|--------|---------|---------|----------|
| 德国法兰克福 | EDDF | ⭐⭐⭐⭐⭐ | 0.45 MB | 50-55条 | 航线录音 |
| 西班牙马德里 | LEMD | ⭐⭐⭐⭐⭐ | 0.35 MB | 40-45条 | 录音片段 |
| 荷兰阿姆斯特丹 | EHAM | ⭐⭐⭐⭐⭐ | 0.38 MB | 42-48条 | 通信页面 |
| 瑞士苏黎世 | LSZH | ⭐⭐⭐⭐ | 0.28 MB | 32-36条 | 航线录音 |
| 奥地利维也纳 | LOWW | ⭐⭐⭐ | 0.22 MB | 25-30条 | 通信失效 |
| 希腊雅典 | LGAV | ⭐⭐⭐ | 0.20 MB | 23-28条 | 通信失效 |
| 葡萄牙里斯本 | LPPT | ⭐⭐ | 0.18 MB | 20-25条 | 我的首页 |
| 波兰华沙 | EPWA | ⭐⭐ | 0.18 MB | 20-25条 | 录音分类 |
| 捷克布拉格 | LKPR | ⭐⭐ | 0.16 MB | 18-22条 | 录音分类 |
| 瑞典斯德哥尔摩 | ESSA | ⭐⭐ | 0.16 MB | 18-22条 | 录音分类 |

**总计**: 约 2.56 MB，可容纳

---

### 3️⃣ 美洲（可增加 5-6个）

**当前状态**: 2个，110条，0.60 MB

**推荐新增**:

| 机场 | ICAO | 优先级 | 预计大小 | 预计录音 | 预加载页面 |
|-----|------|--------|---------|---------|----------|
| 墨西哥墨西哥城 | MMMX | ⭐⭐⭐⭐ | 0.35 MB | 40-45条 | 录音片段 |
| 巴西圣保罗 | SBGR | ⭐⭐⭐⭐ | 0.35 MB | 40-45条 | 通信页面 |
| 智利圣地亚哥 | SCEL | ⭐⭐⭐ | 0.25 MB | 28-32条 | 我的首页 |
| 阿根廷布宜诺斯艾利斯 | SAEZ | ⭐⭐⭐ | 0.25 MB | 28-32条 | 我的首页 |
| 秘鲁利马 | SPJC | ⭐⭐ | 0.18 MB | 20-25条 | 通信失效 |
| 哥伦比亚波哥大 | SKBO | ⭐⭐ | 0.18 MB | 20-25条 | 通信失效 |

**总计**: 约 1.56 MB，可容纳

---

### 4️⃣ 非洲（可增加 5-6个）

**当前状态**: 1个，34条，0.19 MB

**推荐新增**:

| 机场 | ICAO | 优先级 | 预计大小 | 预计录音 | 预加载页面 |
|-----|------|--------|---------|---------|----------|
| 南非约翰内斯堡 | FAOR | ⭐⭐⭐⭐⭐ | 0.35 MB | 40-45条 | 航线录音 |
| 肯尼亚内罗毕 | HKJK | ⭐⭐⭐⭐ | 0.25 MB | 28-32条 | 通信页面 |
| 埃塞俄比亚亚的斯亚贝巴 | HAAB | ⭐⭐⭐⭐ | 0.25 MB | 28-32条 | 通信页面 |
| 摩洛哥卡萨布兰卡 | GMMN | ⭐⭐⭐ | 0.18 MB | 20-25条 | 录音片段 |
| 尼日利亚拉各斯 | DNMM | ⭐⭐ | 0.18 MB | 20-25条 | 我的首页 |
| 坦桑尼亚达累斯萨拉姆 | HTDA | ⭐⭐ | 0.12 MB | 15-18条 | 我的首页 |

**总计**: 约 1.33 MB，可容纳

---

### 5️⃣ 大洋洲（可增加 1-2个）

**当前状态**: 2个，61条，0.37 MB ✅
- 🇦🇺 澳大利亚悉尼: 20条，0.12 MB
- 🇳🇿 新西兰奥克兰: 41条，0.25 MB ✅ 已添加 (v2.8.2)

**推荐新增**:

| 机场 | ICAO | 优先级 | 预计大小 | 预计录音 | 预加载页面 |
|-----|------|--------|---------|---------|----------|
| 斐济楠迪 | NFFN | ⭐⭐ | 0.12 MB | 15-18条 | 录音片段 |
| 巴布亚新几内亚莫尔兹比港 | AYPY | ⭐ | 0.10 MB | 12-15条 | 录音片段 |

**总计**: 约 0.50 MB，可容纳

---

## 🎯 分阶段扩展计划

### 阶段 1：近期（1-2个月）

**目标**: 新增 8-10个重点机场

**优先级排序**:
1. 🇩🇪 德国法兰克福（欧洲航空枢纽）
2. 🇮🇳 印度德里（亚洲重要市场）
3. 🇿🇦 南非约翰内斯堡（非洲航空中心）
4. 🇪🇸 西班牙马德里（欧洲南部门户）
5. 🇲🇾 马来西亚吉隆坡（东南亚枢纽）
6. 🇳🇱 荷兰阿姆斯特丹（欧洲中转中心）
7. 🇧🇷 巴西圣保罗（南美最大机场）
8. 🇻🇳 越南河内（东南亚新兴市场）

**预计增加**: 2.3-2.5 MB，300-320条录音

**预加载页面分配**:
- 航线录音: 德国、印度、南非（约 1.15 MB）
- 通信页面: 马来西亚、荷兰（约 0.73 MB）
- 录音片段: 西班牙、越南、墨西哥（约 0.95 MB）

**验证要点**:
- ✅ 所有页面仍低于 1.8 MB
- ✅ Android + iOS 真机测试
- ✅ 离线功能验证
- ✅ 音频质量检查

---

### 阶段 2：中期（3-6个月）

**目标**: 再增 10-12个机场

**重点覆盖**:
- 完善亚洲网络（印尼、巴基斯坦、尼泊尔、缅甸）
- 扩展欧洲区域（瑞士、奥地利、希腊、葡萄牙）
- 补充非洲航线（肯尼亚、埃塞俄比亚、摩洛哥）

**预计增加**: 2.3-2.6 MB，280-320条录音

**预加载页面分配**:
- 航线录音: 瑞士、印尼（约 0.58 MB）
- 通信页面: 巴基斯坦、肯尼亚、埃塞俄比亚（约 0.75 MB）
- 录音片段: 摩洛哥、缅甸（约 0.33 MB）
- 我的首页: 尼泊尔、蒙古、葡萄牙（约 0.48 MB）
- 通信失效: 奥地利、希腊（约 0.42 MB）

**里程碑**: 总机场数达到 40+个

---

### 阶段 3：长期（6-12个月）

**目标**: 再增 10-15个机场

**重点**:
- 覆盖南美主要航线（智利、阿根廷、秘鲁、哥伦比亚）
- 补充东欧和北欧（波兰、捷克、瑞典）
- 完善中亚和大洋洲（哈萨克斯坦、新西兰）
- 特色小众机场（斐济、巴布亚新几内亚）

**预计增加**: 2.5-3.0 MB，300-350条录音

**最终目标**: 
- 总机场数: 50-55个
- 总录音数: 1300-1500条
- 总体积: 约 8-9 MB
- 仍保持所有页面 < 1.8 MB

---

## 📐 容量管理策略

### 1. 预留安全余量策略

```javascript
const SAFETY_RULES = {
  // 每页保留至少 0.2 MB 安全余量
  minSafetyMargin: 0.2,  // MB
  
  // 避免超过 90% 限制
  maxPageUsage: 1.8,     // MB (90% of 2MB)
  
  // 新增机场后立即验证
  verifyAfterAdd: true
};
```

**执行规则**:
- 新增机场前，检查目标页面剩余容量
- 如果剩余容量 < 0.3 MB，选择其他页面
- 新增后立即运行验证脚本
- 确保总大小 < 1.8 MB

---

### 2. 动态调整策略

**场景 1**: 某页面接近限制
```
问题：录音分类页面已达 1.07 MB

解决方案：
1. 将较小的分包移到其他页面
   例如：packageMacau (0.16 MB) 移到我的首页
2. 重新验证总大小
3. 更新 app.json 和 audio-preload-guide.js
```

**场景 2**: 需要添加大型分包
```
问题：新增德国法兰克福 (0.45 MB)

解决方案：
1. 选择剩余容量最大的页面（航线录音：1.51 MB）
2. 添加后页面总大小：0.49 + 0.45 = 0.94 MB
3. 仍有 1.06 MB 余量，安全
```

**场景 3**: 定期重新平衡
```
频率：每增加 10 个机场后

操作：
1. 统计所有页面当前使用情况
2. 识别超过 1.5 MB 的页面
3. 将较小分包移到空闲页面
4. 确保所有页面负载均衡
```

---

### 3. 质量优先策略

**音频压缩标准**:
```bash
# FFmpeg 压缩命令（已验证最佳参数）
ffmpeg -i input.mp3 -b:a 32k -ar 22050 -ac 1 output.mp3

参数说明：
-b:a 32k      # 比特率 32kbps（人声通信最佳）
-ar 22050     # 采样率 22.05kHz（足够清晰）
-ac 1         # 单声道（通信录音无需立体声）
```

**质量验证标准**:
```
✅ 通过标准：
- 航班号清晰可辨
- 高度、航向数字清晰
- 管制员语音无失真
- 无严重噪音或断续

❌ 不合格：
- 航班号模糊
- 数字无法辨识
- 语音严重失真
- 音频断续或爆音
```

**文件大小控制**:
```
目标：
- 单个音频文件: < 50 KB
- 单个分包: < 0.5 MB（理想）
- 单个分包: < 1.0 MB（上限）
- 超过 1.0 MB 必须重新压缩或拆分
```

---

### 4. 分包分配决策树

```
新增机场（大小 = X MB）
    ↓
X < 0.3 MB？
    ├─ 是 → 选择任意页面（剩余 > 0.5 MB）
    └─ 否 → X < 0.5 MB？
            ├─ 是 → 选择大容量页面（剩余 > 1.0 MB）
            └─ 否 → 必须重新压缩或拆分

选择页面后：
    ↓
验证：页面总大小 + X < 1.8 MB？
    ├─ 是 → 安全，可添加
    └─ 否 → 选择其他页面或重新平衡

添加完成后：
    ↓
运行验证脚本
    ↓
真机测试（Android + iOS）
    ↓
离线功能测试
    ↓
完成！
```

---

## 🔧 新增机场标准流程（8步）

### 步骤 1: 收集并压缩音频
```bash
# 批量压缩（Windows PowerShell）
$files = Get-ChildItem "原始音频\*.mp3"
foreach ($file in $files) {
  $output = "压缩音频\$($file.Name)"
  ffmpeg -i $file.FullName -b:a 32k -ar 22050 -ac 1 $output
}

# 验证压缩后大小
$total = (Get-ChildItem "压缩音频\*.mp3" | 
          Measure-Object -Property Length -Sum).Sum / 1MB
Write-Output "总大小: $([math]::Round($total, 2)) MB"
```

### 步骤 2: 创建数据文件
```javascript
// data/regions/{country}.js
module.exports = {
  clips: [
    {
      label: "区调",
      full_transcript: "China Eastern 7551, descend flight level 250",
      translation_cn: "东航7551，下降高度层250",
      mp3_file: "China-Eastern-7551_Descend-FL250.mp3"
    }
    // ... 更多录音
  ]
};
```

### 步骤 3: 选择预加载页面
```powershell
# 运行容量检查脚本
cd miniprogram
.\check-preload-capacity.ps1

# 根据剩余容量选择页面
# 剩余 > 1.5 MB: 优先选择
# 剩余 1.0-1.5 MB: 推荐
# 剩余 0.5-1.0 MB: 可用
# 剩余 < 0.5 MB: 避免使用
```

### 步骤 4-8: 配置更新
参考《新增机场快速开始指南》步骤 4-8

---

## 📊 容量监控工具

### 实时容量检查脚本

```powershell
# 保存为：check-all-capacity.ps1

param([switch]$Detailed)

Write-Output "╔═══════════════════════════════════════════════╗"
Write-Output "║     航线录音分包容量监控                      ║"
Write-Output "╚═══════════════════════════════════════════════╝"
Write-Output ""

# 统计所有分包
$packages = Get-ChildItem "package*" -Directory | 
            Where-Object { (Get-ChildItem "$_\*.mp3" -File).Count -gt 0 }

$totalSize = 0
$totalCount = 0

Write-Output "📦 分包统计:"
Write-Output ""
foreach ($pkg in $packages) {
  $count = (Get-ChildItem "$pkg\*.mp3" -File).Count
  $size = (Get-ChildItem "$pkg\*.mp3" -File | 
           Measure-Object -Property Length -Sum).Sum / 1MB
  $totalSize += $size
  $totalCount += $count
  if ($Detailed) {
    Write-Output "  $($pkg.Name): $count 条, $([math]::Round($size, 2)) MB"
  }
}

Write-Output "  总计: $totalCount 条, $([math]::Round($totalSize, 2)) MB"
Write-Output ""

# 统计预加载页面
Write-Output "📄 预加载页面:"
Write-Output ""

$pageConfigs = @{
  "通信失效" = @('packageRussia', 'packageAustralia', 'packageFrance', 
                 'packageThailand', 'packageSrilanka', 'packageTurkey', 
                 'packageItaly')
  "录音片段" = @('packagePhilippines', 'packageJapan')
  "录音分类" = @('packageKorean', 'packageUAE', 'packageAmerica', 'packageMacau')
  "航线录音" = @('packageUK', 'packageTaipei', 'packageEgypt')
  "通信页面" = @('packageHongKong')
  "我的首页" = @('packageSingapore', 'packageCanada')
}

$allSafe = $true
foreach ($page in $pageConfigs.Keys) {
  $pageSize = 0
  foreach ($pkg in $pageConfigs[$page]) {
    if (Test-Path $pkg) {
      $size = (Get-ChildItem "$pkg\*.mp3" -File | 
               Measure-Object -Property Length -Sum).Sum / 1MB
      $pageSize += $size
    }
  }
  $remaining = 2.0 - $pageSize
  $status = if ($pageSize -lt 1.8) { "✅" } else { "❌"; $allSafe = $false }
  
  Write-Output "  $status $page : $([math]::Round($pageSize, 2)) MB " +
               "(余 $([math]::Round($remaining, 2)) MB)"
}

Write-Output ""
if ($allSafe) {
  Write-Output "🎉 所有预加载页面都在安全范围内！"
} else {
  Write-Output "⚠️ 有页面超过安全限制，需要调整！"
}

Write-Output ""
Write-Output "💡 剩余总容量: $([math]::Round(12.0 - $totalSize, 2)) MB"
Write-Output "   可再增加约 $([int]((12.0 - $totalSize) / 0.25)) 个机场"
```

**使用方法**:
```powershell
# 快速检查
.\check-all-capacity.ps1

# 详细报告
.\check-all-capacity.ps1 -Detailed
```

---

## ✅ 扩展检查清单

### 新增机场前检查
```
✅ 音频已收集（至少 15 条）
✅ 音频已压缩（32-48kbps）
✅ 音频质量已验证（语音清晰）
✅ 总大小已计算（< 0.5 MB 理想）
✅ 预加载页面已选择（剩余容量充足）
✅ regionId 已确定（全小写，无冲突）
✅ 国旗 emoji 已准备
✅ ICAO 代码已确认
```

### 新增机场后检查
```
✅ 8步配置全部完成
✅ 验证脚本运行通过
✅ 语法检查无错误
✅ 预加载页面 < 1.8 MB
✅ Android 真机测试通过
✅ iOS 真机测试通过
✅ 离线功能正常
✅ 音频播放流畅
```

### 每批次（5-8个机场）后检查
```
✅ 运行完整容量监控脚本
✅ 检查所有预加载页面负载
✅ 识别需要重新平衡的页面
✅ 全平台真机测试
✅ 用户体验评估
✅ 性能指标监控
✅ 更新文档和版本说明
```

---

## 🎯 扩展目标与里程碑

### 短期目标（3个月内）
- 🎯 总机场数: 30+个
- 🎯 覆盖亚洲: 15+个
- 🎯 覆盖欧洲: 12+个
- 🎯 完善非洲: 5+个

### 中期目标（6个月内）
- 🎯 总机场数: 40+个
- 🎯 总录音数: 1000+条
- 🎯 五大洲全覆盖
- 🎯 主要航线全覆盖

### 长期目标（12个月内）
- 🎯 总机场数: 50+个
- 🎯 总录音数: 1300+条
- 🎯 覆盖全球主要机场
- 🎯 特色小众机场补充

---

## 💡 成功经验总结

### 1. 压缩是关键
- 第二次压缩后，体积减少 55%
- 为扩展腾出了 7.88 MB 空间
- 可再增加 30-35 个机场

### 2. 合理分配预加载页面
- 6个页面均匀分配负载
- 避免单页面过载
- 保持充足的安全余量

### 3. 严格的质量控制
- 32-48kbps 比特率最佳
- 语音清晰度优先
- 文件大小其次

### 4. 分阶段扩展
- 每批次 5-8 个机场
- 全面测试后再继续
- 确保系统稳定性

---

**文档创建**: 2025-10-26  
**适用版本**: v2.8.1+  
**文档版本**: v1.0.0  
**下次更新**: 完成阶段1后（新增8-10个机场）


