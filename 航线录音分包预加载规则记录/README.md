# 航线录音分包预加载规则记录

**目录说明**: FlightToolbox 航线录音分包管理完整文档库  
**最后更新**: 2025-10-26  
**适用版本**: v2.8.1+

---

## 🚨 重要更新（2025-10-26）

### 新增机场必须完成8步，不是5步！

**问题**: UK和Chinese Taipei音频无法播放  
**原因**: 遗漏了3个核心配置文件（audio-config.js, audio-package-loader.js, audio-player/index.ts）

**⚠️ 关键变更**:
- ✅ 快速开始指南已更新为**8步流程**（原5步）
- 🆕 新增"故障排查-音频无法播放.md"文档
- 📋 新增快速自检命令，必须执行！

**立即查看**:
- [新增机场快速开始指南.md](./新增机场快速开始指南.md) - 已更新
- [故障排查-音频无法播放.md](./故障排查-音频无法播放.md) - 新建
- [音频无法播放问题修复报告](../更新说明/音频无法播放问题修复_v2.8.1.md)

---

## 📚 文档索引

### 🚀 快速开始

**如果你想快速新增一个机场，按以下顺序阅读：**

1. **[新增机场快速开始指南](./新增机场快速开始指南.md)** ⭐ 推荐首读
   - **8步完成集成**（30-60分钟）⚠️ 已更新
   - 简洁明了，快速上手
   - 包含验证清单和常见错误
   - **必须完成全部8步**

2. **[配置模板](./配置模板.md)**
   - 可直接复制粘贴的配置模板
   - 详细的占位符说明
   - 完整配置流程示例

3. **[故障排查-音频无法播放](./故障排查-音频无法播放.md)** 🆕 重要
   - 音频无法播放的诊断和修复
   - 3个核心配置文件详解
   - 快速自检命令
   - 完整检查清单（11项）

---

### 📖 深度学习

**如果你想深入了解系统架构和最佳实践：**

4. **[航线录音分包完整管理指南](./航线录音分包完整管理指南.md)** 📘 技术文档
   - 项目架构和核心约束
   - 详细的命名规范
   - 预加载规则系统
   - 配置文件详解
   - 数据验证方法
   - 常见问题解决
   - 最佳实践建议
   - 快速参考表和附录

5. **[航线录音分包实战经验与最佳实践](./航线录音分包实战经验与最佳实践.md)** 🌟 必读
   - ✅ **已在Android和iOS全设备验证通过**
   - 🎯 **17个国家，708条录音，覆盖五大洲**
   - 核心技术原理深度解析
   - 8步配置的技术原理详解
   - 跨平台兼容性验证报告
   - 完整的故障排查与解决方案
   - 真实成功案例展示（埃及、加拿大、英国）
   - 经验教训与避坑指南
   - 自动化验证脚本（完整版）
   - 未来优化方向规划

6. **[机场录音扩展容量规划](./机场录音扩展容量规划.md)** 📈 扩展指南
   - ✅ **基于第二次压缩优化（55.3%压缩率）**
   - 🚀 **可再增加 30-35 个机场**
   - 各预加载页面剩余容量详细分析
   - 按大洲的扩展建议（亚、欧、美、非、大洋洲）
   - 分阶段扩展计划（近期、中期、长期）
   - 容量管理策略（安全余量、动态调整、质量优先）
   - 分包分配决策树
   - 容量监控工具和脚本
   - 扩展检查清单
   - 目标与里程碑规划

---

## 🎯 文档使用场景

### 场景 1：我是新手，第一次新增机场

**推荐阅读路径**:
1. 阅读 **快速开始指南** 前3章（了解基本流程）
2. 使用 **配置模板** 复制粘贴配置
3. 遇到问题查看 **完整管理指南** 的"常见问题解决"章节

**预计时间**: 1-2小时（含学习）

---

### 场景 2：我有经验，需要快速集成

**推荐阅读路径**:
1. 直接使用 **配置模板**
2. 参考 **快速开始指南** 的验证清单

**预计时间**: 30分钟

---

### 场景 3：遇到错误，需要排查问题

**推荐阅读路径**:
1. 查看 **快速开始指南** 的"常见错误避免"
2. 查看 **完整管理指南** 的"常见问题解决"
3. 使用 **完整管理指南** 的"数据验证清单"

---

### 场景 4：需要了解系统架构和设计原理

**推荐阅读路径**:
1. 阅读 **完整管理指南** 全文
2. 重点关注"项目架构概述"和"预加载规则系统"

---

### 场景 5：为未来AI和开发者准备文档

**推荐阅读路径**:
1. 阅读 **实战经验与最佳实践** 全文 ⭐⭐⭐⭐⭐
2. 重点关注"核心技术原理"和"跨平台兼容性"
3. 学习"成功案例"和"经验教训"
4. 使用"自动化验证脚本"

**为什么重要**:
- ✅ 基于真实测试结果（Android + iOS 全验证）
- ✅ 包含完整的技术原理解析
- ✅ 提供可直接使用的自动化脚本
- ✅ 总结了所有避坑经验
- ✅ 展示了17个成功案例

---

### 场景 6：规划未来扩展（准备新增很多机场）

**推荐阅读路径**:
1. 阅读 **机场录音扩展容量规划** 全文 ⭐⭐⭐⭐
2. 重点关注"各预加载页面剩余容量分析"
3. 参考"按大洲扩展建议"
4. 使用"容量监控工具"

**为什么重要**:
- ✅ 基于第二次压缩优化（55.3%压缩率）
- ✅ 可再增加 30-35 个机场
- ✅ 提供详细的分阶段扩展计划
- ✅ 包含容量管理策略和决策树
- ✅ 提供自动化容量监控脚本

---

## 📊 文档对比

| 文档 | 长度 | 难度 | 适用场景 | 阅读时间 |
|-----|------|------|---------|---------|
| **快速开始指南** | 中等 | ⭐⭐ | 快速集成 | 10分钟 |
| **配置模板** | 短 | ⭐ | 复制配置 | 5分钟 |
| **故障排查文档** | 短 | ⭐⭐ | 问题诊断 | 10分钟 |
| **完整管理指南** | 长 | ⭐⭐⭐ | 深度学习 | 30-60分钟 |
| **实战经验文档** | 长 | ⭐⭐⭐⭐ | 技术深度 | 40-80分钟 |
| **扩展容量规划** | 中等 | ⭐⭐ | 容量规划 | 20分钟 |

---

## 🔑 核心概念速查

### 关键约束

```
⚠️ 重要限制：
1. 单个页面 preloadRule 最大预加载: 2MB
2. 禁止在 TabBar 主页面预加载音频
3. 所有音频必须支持离线播放
```

### 文件结构

```
miniprogram/
├── package{CountryName}/          # 音频分包
│   ├── index.js                   # 分包元数据
│   └── *.mp3                      # 音频文件
└── data/regions/{country}.js      # 数据文件
```

### 命名规范

| 类型 | 格式 | 示例 |
|-----|------|------|
| 分包目录 | package + 首字母大写 | packageJapan, packageUK |
| regionId | 全小写英文 | japan, uk, korea |
| 数据文件 | 全小写.js | japan.js, uk.js |
| 音频文件 | 航班号_内容.mp3 | China-Eastern-7551_Descend-FL250.mp3 |

### 可用预加载页面（v2.8.1）

| 页面 | 图标 | 剩余空间 | 推荐度 |
|-----|------|---------|--------|
| 通信失效 | 📡 | 0.29 MB | ⭐⭐⭐ |
| 录音片段 | 🎬 | 0.75 MB | ⭐⭐⭐⭐⭐ |
| 录音分类 | 📂 | 0.39 MB | ⭐⭐⭐⭐ |
| 航线录音 | ✈️ | 0.28 MB | ⭐⭐ |
| 录音播放 | 🎵 | 0.26 MB | ⭐⭐ |

---

## 🛠️ 快速命令参考

### 统计分包信息

```powershell
cd D:\FlightToolbox\miniprogram

# 音频文件数量
(Get-ChildItem "package{CountryName}\*.mp3" -File).Count

# 分包总大小
$size = (Get-ChildItem "package{CountryName}\*.mp3" -File | 
         Measure-Object -Property Length -Sum).Sum / 1MB
[math]::Round($size, 2)
```

### 验证配置

```powershell
# 语法检查
node -c package{CountryName}/index.js
node -c data/regions/{country}.js
node -c utils/audio-preload-guide.js

# 检查重复记录
Select-String -Path "data\regions\{country}.js" -Pattern '"mp3_file": "(.*?)"' | 
  ForEach-Object { $_.Matches.Groups[1].Value } | 
  Group-Object | Where-Object { $_.Count -gt 1 }
```

---

## ✅ 新增机场检查清单

```bash
✅ 音频文件已压缩（推荐 32-48kbps）
✅ 音频文件已复制到 package{CountryName}/
✅ 创建 package{CountryName}/index.js
✅ 创建 data/regions/{country}.js
✅ 更新 app.json - subPackages
✅ 更新 app.json - preloadRule
✅ 更新 audio-preload-guide.js
✅ 音频数量 = 数据记录数
✅ 无重复记录
✅ 语法检查通过
✅ 预加载页面总大小 < 2MB
✅ 真机测试通过
```

---

## 📞 获取帮助

### 遇到问题？

1. **查阅文档**
   - 先查看 [快速开始指南 - 常见错误避免](./新增机场快速开始指南.md#常见错误避免)
   - 再查看 [完整管理指南 - 常见问题解决](./航线录音分包完整管理指南.md#常见问题解决)

2. **检查配置**
   - 使用 [完整管理指南 - 数据验证清单](./航线录音分包完整管理指南.md#数据验证清单)
   - 对比 [配置模板](./配置模板.md) 确认格式正确

3. **真机调试**
   - 微信开发者工具预览
   - 真机测试预加载和播放功能
   - 离线模式测试

---

## 🔄 文档更新记录

### v1.3.0 (2025-10-26) 📈 扩展规划
- ✅ 创建《机场录音扩展容量规划》📈
- ✅ 基于第二次压缩优化（55.3%压缩率）
- ✅ 详细分析各预加载页面剩余容量（7.88 MB）
- ✅ 可再增加 30-35 个机场
- ✅ 提供按大洲的扩展建议（亚、欧、美、非、大洋洲）
- ✅ 分阶段扩展计划（近期、中期、长期）
- ✅ 容量管理策略和分包分配决策树
- ✅ 自动化容量监控工具脚本

### v1.2.0 (2025-10-26) 🌟 重大更新
- ✅ 创建《航线录音分包实战经验与最佳实践》⭐⭐⭐⭐⭐
- ✅ 基于真实测试结果（Android + iOS 全平台验证）
- ✅ 包含17个国家成功案例（708条录音）
- ✅ 提供完整的自动化验证脚本
- ✅ 深度解析核心技术原理
- ✅ 总结跨平台兼容性经验

### v1.1.0 (2025-10-26)
- ✅ 快速开始指南更新为8步流程（原5步）
- ✅ 创建《故障排查-音频无法播放》文档
- ✅ 修复UK和Chinese Taipei播放问题
- ✅ 添加快速自检命令

### v1.0.0 (2025-10-25)
- ✅ 创建《航线录音分包完整管理指南》
- ✅ 创建《新增机场快速开始指南》
- ✅ 创建《配置模板》
- ✅ 创建索引文档（README）
- ✅ 涵盖当前14个音频分包的配置
- ✅ 包含完整的预加载规则说明

---

## 📋 相关文档

### 项目核心文档
- `D:\FlightToolbox\CLAUDE.md` - 项目整体说明和规范
- `D:\FlightToolbox\miniprogram\utils\audio-preload-guide.js` - 预加载引导实现
- `D:\FlightToolbox\miniprogram\app.json` - 全局配置文件

### 更新说明
- `更新说明/音频分包压缩优化_v2.8.1.md` - 音频压缩和预加载优化
- `更新说明/音频预加载策略最终报告_v2.8.1.md` - 预加载策略完整报告
- `更新说明/新增英国伦敦音频分包_v2.8.1.md` - 最新机场集成示例

---

## 🎯 下一步行动

### 如果你是第一次使用

1. ⏭️ 阅读 [新增机场快速开始指南](./新增机场快速开始指南.md)
2. ⏭️ 准备音频文件并进行压缩
3. ⏭️ 使用 [配置模板](./配置模板.md) 开始配置
4. ⏭️ 按照检查清单验证
5. ⏭️ 真机测试

### 如果你遇到问题

1. ⏭️ 查看 [完整管理指南 - 常见问题解决](./航线录音分包完整管理指南.md#常见问题解决)
2. ⏭️ 运行数据验证脚本
3. ⏭️ 检查语法和配置
4. ⏭️ 对比配置模板

---

**文档维护**: 开发团队  
**最后更新**: 2025-10-26  
**文档版本**: v1.3.0  
**测试验证**: ✅ Android + iOS 全平台通过  
**当前规模**: 19个国家/地区，737条真实录音，4.15 MB  
**扩展潜力**: 可再增加 30-35 个机场，约 7.88 MB 剩余容量

