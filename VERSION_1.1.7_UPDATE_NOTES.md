# FlightToolbox 小程序 v1.1.7 更新记录

## 📅 发布日期
2025-06-30

## 🎯 更新主题
增强机场搜索功能 - 支持中文机场名称输入

## ✨ 新增功能

### 1. 中文机场名称搜索
- **夜航时间计算页面**：支持中文机场名称输入
  - 可输入ICAO代码：如 zbaa、ZBAA、zsss、ZSSS
  - 可输入中文名称：如 北京首都、上海浦东、广州白云、深圳宝安
  - 智能匹配：优先ICAO代码，其次中文名称，最后英文名称
  - 重名处理：输入"上海"时弹出选择列表（上海浦东、上海虹桥）

- **日出日落时间查询页面**：同样支持中文机场名称
  - 实时查询：输入时立即显示机场信息
  - 防抖优化：300ms延迟避免频繁查询
  - 智能条件：ICAO代码（4位字母）或中文（2位以上）触发查询
  - 重名处理：多个匹配时自动弹出选择弹窗

### 2. 用户体验优化
- **界面标签更新**：从"机场ICAO"改为"机场代码"
- **提示文字优化**：明确说明支持ICAO代码或中文名称
- **输入长度扩展**：从4字符增加到10字符支持中文名称
- **搜索响应优化**：从500ms优化到300ms

### 3. 功能分类明确
- **日出日落时间查询**：1积分
- **夜航时间计算**：2积分
- **我的首页**：新增日出日落时间查询入口，显示"1积分"标签

## 🔧 技术改进

### 1. 搜索算法优化
```javascript
// 智能查询逻辑
1. 优先匹配ICAO代码（精确匹配）
2. 其次匹配中文名称（模糊匹配）
3. 最后匹配英文名称（大小写忽略）
```

### 2. 实时查询机制
- **夜航时间页面**：支持出发地和到达地的实时查询
- **日出日落页面**：新增实时查询，立即显示机场信息
- **防抖处理**：避免输入过程中的频繁查询

### 3. 数据处理优化
- 保持用户原始输入格式（支持小写）
- 查询时智能转换大小写
- 优先显示中文机场名称

## 🎮 积分规则调整

### 页面级别积分
- `sunrise-sunset`: -2积分（夜航时间计算）
- `sunrise-sunset-only`: -1积分（日出日落时间查询）

### 按钮级别积分
- `sunrise-sunset-calc`: -2积分（夜航时间计算）
- `sun-times-calc`: -1积分（日出日落时间计算）

## 🗂️ 文件变更

### 修改的文件
1. `miniprogram/pages/sunrise-sunset/index.ts` - 夜航时间计算页面
2. `miniprogram/pages/sunrise-sunset/index.wxml` - 夜航时间页面界面
3. `miniprogram/pages/sunrise-sunset-only/index.ts` - 日出日落时间页面
4. `miniprogram/pages/sunrise-sunset-only/index.wxml` - 日出日落页面界面
5. `miniprogram/utils/points-manager.js` - 积分管理规则
6. `miniprogram/pages/others/index.wxml` - 我的首页布局

### 新增功能模块
- `findAirportsByQuery()` - 多机场查询方法，支持返回匹配列表
- `showAirportSelectionDialog()` - 机场选择弹窗
- `lookupAirportInfo()` - 实时机场信息查询
- 智能搜索条件判断逻辑
- 重名机场处理机制

## 📱 用户体验提升

### 输入体验
- 支持中文输入，更符合中国飞行员使用习惯
- 实时反馈，输入即查询
- 小写字母输入正常工作，不会被强制转换

### 界面体验
- 清晰的功能分类（1积分 vs 2积分）
- 一致的搜索提示文字
- 直观的机场信息显示

### 操作体验
- 减少用户记忆负担（不需要记住ICAO代码）
- 提升查询效率（中文名称更容易输入）
- 保持专业性（仍然支持ICAO代码）

## 🧪 测试建议

### ICAO代码测试
- zbaa, ZBAA（北京首都）
- zsss, ZSSS（上海浦东）
- zgsz, ZGSZ（深圳宝安）
- zggg, ZGGG（广州白云）

### 中文名称测试
- 北京首都、北京大兴
- 上海浦东、上海虹桥
- 广州白云、深圳宝安
- 成都双流、重庆江北

### 边界条件测试
- 部分匹配：北京（应显示北京首都、北京大兴选择列表）
- 重名测试：上海（应显示上海浦东、上海虹桥选择列表）
- 错误输入：不存在的机场名称
- 混合输入：中英文混合
- 选择取消：用户点击取消的处理

## 🐛 问题修复

### 界面布局
- **重复工具问题**：移除我的首页中重复显示的"日出日落"工具
- **功能区分**：明确区分日出日落查询（免费）和夜航时间计算（2积分）
- **布局优化**：保持飞行计算区域的3个工具布局整洁

### 积分系统
- **日出日落单独页面**：积分设置为1积分消费
- **积分规则**：sunrise-sunset-only (-1积分)
- **首页显示**：更新为显示"1积分"标签

### 输入处理
- 修复日出日落功能中的用户输入处理问题
- 解决JavaScript编译错误
- 优化时间选择和坐标输入逻辑

## 🎯 下一步计划
- 考虑添加机场搜索历史记录
- 支持更多机场别名和常用称呼
- 优化搜索结果排序算法
- 添加机场收藏功能

---
**开发者**: 虎大王 & Claude Sonnet 4  
**开发环境**: Cursor + 微信开发者工具  
**技术栈**: TypeScript + Vant WeApp + 微信小程序 