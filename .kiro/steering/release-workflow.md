---
inclusion: manual
---

# 发布工作流

代码修改完成后，按以下步骤执行发布流程。

## 1. 更新版本号（自动判断）

根据 [语义化版本](https://semver.org/lang/zh-CN/) 规范自动判断版本号：

| 改动类型            | 版本变化 | 示例             |
| ------------------- | -------- | ---------------- |
| 重大变更/架构重构   | MAJOR +1 | 2.14.5 → 3.0.0   |
| 新功能（feat）      | MINOR +1 | 2.14.5 → 2.15.0  |
| Bug 修复（fix）     | PATCH +1 | 2.14.5 → 2.14.6  |
| 性能优化（perf）    | PATCH +1 | 2.14.5 → 2.14.6  |
| 重构/文档/测试      | 不升级   | 2.14.5 → 2.14.5  |

**判断规则：**

1. 查看 `git log --oneline -30` 确定改动内容
2. 根据改动类型决定是否升级版本
3. 如需升级，同步更新以下位置：

```
miniprogram/pages/home/index.wxml  → 版本信息单元格 value 属性（约第241行）
miniprogram/pages/home/index.js   → onVersionTap 函数中的版本号和更新说明
.kiro/steering/product.md         → 当前版本 vx.x.x（如有）
```

## 2. 编写版本更新说明

### 2.1 更新样例文件

在 `更新说明/版本更新说明样例.md` 顶部添加新版本说明。

### 2.2 文案风格规则（必须遵守）

- **面向飞行员同事**：假装在和机长/副驾驶聊天，不要出现"接口、脚本、npm"等技术词
- **讲用户感受，不讲实现细节**：多说"对你有什么用"，少讲"底层逻辑怎么实现"
- **简短好读**：控制在约 200 字内，分行/分点，避免大段文字
- **语气友好、自然**：可以适当用表情符号（✈️、😊 等），但不要过多

### 2.3 更新说明模板

```markdown
## 版本 x.x.x（YYYY-MM-DD）

### 这版主要改了啥？

- **功能名称**：一句话说明对用户的好处
- **功能名称**：一句话说明对用户的好处
```

### 2.4 同步更新首页弹窗

修改 `miniprogram/pages/home/index.js` 中的 `onVersionTap` 函数：

```javascript
onVersionTap: function() {
  wx.showModal({
    title: '版本信息',
    content: '当前版本：vx.x.x\n\n📦 本次更新重点：\n• 功能点1\n• 功能点2\n\n感谢你一直陪着我飞～✈️',
    showCancel: false,
    confirmText: '确定'
  });
},
```

### 2.5 同步更新首页版本显示

修改 `miniprogram/pages/home/index.wxml` 中版本信息单元格（约第241行）：

```xml
<van-cell title="版本信息" value="vx.x.x" ... />
```

### 2.6 创建正式版本文件（可选）

复制样例内容到 `更新说明/版本更新说明_vx.x.x.md` 存档。

## 3. 更新 Steering 文档（按需）

根据本次改动类型，检查并更新 `.kiro/steering/` 下的文档：

| 变更类型             | 需更新的文件     |
| -------------------- | ---------------- |
| 新增/删除分包        | `structure.md`   |
| 新增/删除功能        | `product.md`     |
| 版本号变更           | `product.md`     |
| 依赖变更             | `tech.md`        |
| 构建命令变更         | `tech.md`        |
| MCP 工具变更         | `mcp-tools.md`   |

### 触发场景

- 在 `miniprogram/package*/` 下新增/删除分包 → 更新 `structure.md`
- 新增核心功能或功能重大变更 → 更新 `product.md`
- 修改 `package.json` 添加新依赖 → 更新 `tech.md`
- 升级基础库版本 → 更新 `tech.md`

## 4. 提交代码

```bash
git add .
git commit -m "<type>: <简短描述>

<详细说明（可选）>"
git push origin main
```

### Commit 类型规范

| 类型     | 说明                   |
| -------- | ---------------------- |
| feat     | 新功能                 |
| fix      | Bug 修复               |
| perf     | 性能优化               |
| refactor | 代码重构（不影响功能） |
| docs     | 文档更新               |
| style    | 代码格式调整           |
| chore    | 构建/工具变更          |

### Commit 示例

```
feat: 新增QAR红色事件监控项查询

- 支持空客、波音、其他机型分类查询
- 新增附件2限制值一键查看
- 全新卡片式设计
```

```
fix: 修复广告卡片被拉长问题

- 计算工具、通信、首页广告样式统一
- 和资料查询页面保持一致
```

## 5. 微信开发者工具上传

1. 打开微信开发者工具
2. 构建 npm：工具 → 构建npm
3. 编译预览，确认功能正常
4. 点击「上传」按钮
5. 填写版本号和项目备注
6. 在微信公众平台提交审核

## 快速检查清单

- [ ] 版本号已同步更新（wxml + js + product.md）
- [ ] `onVersionTap` 弹窗文案已更新，和版本说明一致
- [ ] 版本更新说明已写入样例文件
- [ ] 文案口语化，无技术术语，200字以内
- [ ] Steering 文档已更新（如需要）
- [ ] 代码已提交并推送
- [ ] 微信开发者工具编译通过
- [ ] 已上传并提交审核（仅版本升级时）

## 注意事项

- 重构、文档更新等不影响功能的改动，无需升级版本号
- feat/fix/perf 类型的改动需要升级版本
- **弹窗文案必须和版本说明保持一致**
- 新增分包时，记得同步更新 `app.json` 的 `subpackages` 和 `preloadRule`
