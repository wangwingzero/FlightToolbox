<view class="container page-content" data-theme="{{ isDarkMode ? 'dark' : 'light' }}">
  <!-- é€‰é¡¹å¡ -->
  <van-tabs active="{{ activeTab }}" bind:change="onTabChange" sticky>
    <van-tab title="å…¨éƒ¨" name="å…¨éƒ¨"></van-tab>
    <van-tab title="é£è¡Œä½“èƒ½" name="é£è¡Œä½“èƒ½"></van-tab>
    <van-tab title="å¤ªé˜³çœ¼é•œ" name="å¤ªé˜³çœ¼é•œ"></van-tab>
    <van-tab title="å¬åŠ›ä¿æŠ¤" name="å¬åŠ›ä¿æŠ¤"></van-tab>
  </van-tabs>

  <!-- æœç´¢æ¡† -->
  <view class="search-section health-search">
    <van-search
      value="{{ searchKeyword }}"
      placeholder="{{ searchPlaceholder }}"
      bind:change="onSearchChange"
      bind:clear="onSearchClear"
      shape="round"
    />
  </view>

  <!-- å¥åº·æŒ‡å—åˆ—è¡¨ -->
  <view class="guides-section">
    <view wx:if="{{ filteredGuides.length > 0 }}" class="context7-content-container">
      <view class="context7-card-wrapper">
        <view 
          wx:for="{{ filteredGuides }}"
          wx:key="id"
          wx:for-index="idx"
          class="context7-item-card health-item-card"
          bind:tap="showGuideDetail"
          data-index="{{ idx }}"
        >
          <view class="item-card-header">
            <view class="item-primary">
              <text class="item-name-zh">{{ item.name_zh }}</text>
              <view class="item-badges">
                <view class="context7-badge category-badge" data-category="{{ item.category }}">
                  <van-icon name="bookmark" size="12px" />
                  <text>{{ item.category }}</text>
                </view>
                <view class="publication-badge">
                  <text>{{ item.publication }}</text>
                </view>
              </view>
            </view>
            <view class="item-secondary">
              <text class="item-name-en">{{ item.name_en }}</text>
            </view>
          </view>
          
          <view class="item-card-content">
            <view class="item-summary">
              {{ item.summary }}
            </view>
            <view class="item-source">
              <view class="source-label">æ•°æ®æ¥æº:</view>
              <view class="source-text">{{ item.source }}</view>
            </view>
          </view>
          
          <view class="item-card-footer">
            <view class="item-meta">
              <van-icon name="info-o" size="14px" />
              <text>ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…</text>
            </view>
            <view class="item-arrow">
              <van-icon name="arrow" size="16px" />
            </view>
          </view>
        </view>
      </view>
    </view>
    
    <!-- æ— æœç´¢ç»“æœ -->
    <view wx:else class="no-results">
      <view class="no-results-icon">ğŸ”</view>
      <view class="no-results-text">æœªæ‰¾åˆ°ç›¸å…³å¥åº·æŒ‡å—</view>
      <view class="no-results-tip">è¯·å°è¯•å…¶ä»–å…³é”®è¯æˆ–åˆ‡æ¢åˆ†ç±»</view>
    </view>
  </view>

  <!-- ç»Ÿè®¡ä¿¡æ¯ -->
  <view wx:if="{{ activeTab === 'å…¨éƒ¨' && !searchKeyword }}" class="stats-section">
    <view class="stats-item">
      <text class="stats-number">{{ healthGuides.length }}</text>
      <text class="stats-label">ä¸ªæŒ‡å—</text>
    </view>
    <view class="stats-item">
      <text class="stats-number">3</text>
      <text class="stats-label">ä¸ªåˆ†ç±»</text>
    </view>
  </view>
</view>

<!-- è¯¦æƒ…å¼¹çª— -->
<van-popup
  show="{{ showDetailPopup }}"
  position="bottom"
  round
  closeable
  close-icon="close"
  bind:close="closeDetailPopup"
  custom-style="height: 80%; max-height: 80vh;"
>
  <view class="detail-popup" wx:if="{{ selectedGuide && selectedGuide.name_zh }}">
    <view class="popup-header">
      <view class="popup-header-content">
        <view class="popup-title">{{ selectedGuide.name_zh || 'æŒ‡å—è¯¦æƒ…' }}</view>
        <view class="popup-subtitle">{{ selectedGuide.name_en || '' }}</view>
      </view>
      <view class="popup-close-btn" bind:tap="closeDetailPopup">
        <van-icon name="cross" size="20px" color="white" />
      </view>
    </view>
    
    <scroll-view class="popup-content" scroll-y enhanced>
      <!-- åŸºæœ¬ä¿¡æ¯ -->
      <view class="detail-section">
        <view class="detail-label">åˆ†ç±»</view>
        <view class="detail-content">{{ selectedGuide.category }}</view>
      </view>
      
      <view class="detail-section">
        <view class="detail-label">æ•°æ®æ¥æº</view>
        <view class="detail-content">{{ selectedGuide.source }}</view>
      </view>
      
      <view class="detail-section">
        <view class="detail-label">å‘å¸ƒæ ‡è¯†</view>
        <view class="detail-content">{{ selectedGuide.publication }}</view>
      </view>
      
      <!-- å†…å®¹è¯¦æƒ… -->
      <view class="detail-section">
        <view class="detail-label">è¯¦ç»†å†…å®¹</view>
        <view class="detail-content">
          <!-- é£è¡Œä½“èƒ½å†…å®¹ -->
          <view wx:if="{{ selectedGuide.type === 'fitness' }}" class="fitness-content">
            <view wx:if="{{ selectedGuide.fullContent.content }}" class="content-paragraph">
              {{ selectedGuide.fullContent.content }}
            </view>
            
            <!-- å¥èº«ç»„æˆéƒ¨åˆ† -->
            <view wx:if="{{ selectedGuide.fullContent.components }}" class="components-section">
              <view wx:for="{{ selectedGuide.fullContent.components }}" wx:key="name" class="component-item">
                <view class="component-name">{{ item.name }}</view>
                <view class="component-description">{{ item.description }}</view>
                <view wx:if="{{ item.examples }}" class="component-examples">
                  <view class="examples-title">ç¤ºä¾‹ï¼š</view>
                  <view wx:for="{{ item.examples }}" wx:key="*this" class="example-item">â€¢ {{ item }}</view>
                </view>
              </view>
            </view>
            
            <!-- è¦ç‚¹ -->
            <view wx:if="{{ selectedGuide.fullContent.points }}" class="points-section">
              <view wx:for="{{ selectedGuide.fullContent.points }}" wx:key="*this" class="point-item">
                â€¢ {{ item }}
              </view>
            </view>
          </view>
          
          <!-- å¤ªé˜³é•œå†…å®¹ -->
          <view wx:elif="{{ selectedGuide.type === 'sunglasses' }}" class="sunglasses-content">
            <view wx:if="{{ selectedGuide.fullContent.content }}" class="content-paragraph">
              {{ selectedGuide.fullContent.content }}
            </view>
            
            <!-- ææ–™ä¿¡æ¯ -->
            <view wx:if="{{ selectedGuide.fullContent.materials }}" class="materials-section">
              <view wx:for="{{ selectedGuide.fullContent.materials }}" wx:key="name" class="material-item">
                <view class="material-name">{{ item.name }}</view>
                <view class="material-description">{{ item.description }}</view>
              </view>
            </view>
            
            <!-- è¡¨æ ¼ -->
            <view wx:if="{{ selectedGuide.fullContent.table }}" class="table-section">
              <view class="table-title">{{ selectedGuide.fullContent.table.title }}</view>
              <view class="table-wrapper">
                <view class="table-header">
                  <view wx:for="{{ selectedGuide.fullContent.table.headers }}" wx:key="*this" class="table-cell header-cell">
                    {{ item }}
                  </view>
                </view>
                <view wx:for="{{ selectedGuide.fullContent.table.rows }}" wx:key="*this" class="table-row">
                  <view wx:for="{{ item }}" wx:key="*this" class="table-cell">{{ item }}</view>
                </view>
              </view>
            </view>
          </view>
          
          <!-- å¬åŠ›å†…å®¹ -->
          <view wx:elif="{{ selectedGuide.type === 'hearing' }}" class="hearing-content">
            <view wx:if="{{ selectedGuide.fullContent.content }}" class="content-paragraph">
              {{ selectedGuide.fullContent.content }}
            </view>
            
            <!-- å­ç« èŠ‚ -->
            <view wx:if="{{ selectedGuide.fullContent.subsections }}" class="subsections">
              <view wx:for="{{ selectedGuide.fullContent.subsections }}" wx:key="title" class="subsection-item">
                <view class="subsection-title">{{ item.title }}</view>
                <view class="subsection-content">{{ item.content }}</view>
              </view>
            </view>
            
            <!-- è¦ç‚¹ -->
            <view wx:if="{{ selectedGuide.fullContent.points }}" class="points-section">
              <view wx:for="{{ selectedGuide.fullContent.points }}" wx:key="term" class="point-item">
                <view class="point-term">{{ item.term }}</view>
                <view class="point-description">{{ item.description }}</view>
              </view>
            </view>
            
            <!-- è¡¨æ ¼ -->
            <view wx:if="{{ selectedGuide.fullContent.tables }}" class="tables-section">
              <view wx:for="{{ selectedGuide.fullContent.tables }}" wx:key="title" class="table-section">
                <view class="table-title">{{ item.title }}</view>
                <view class="table-wrapper">
                  <view class="table-header">
                    <view wx:for="{{ item.headers }}" wx:key="*this" class="table-cell header-cell">
                      {{ item }}
                    </view>
                  </view>
                  <view wx:for="{{ item.rows }}" wx:key="*this" class="table-row">
                    <view wx:for="{{ item }}" wx:key="*this" class="table-cell">{{ item }}</view>
                  </view>
                </view>
              </view>
            </view>
            
            <!-- å™ªéŸ³ç±»å‹ -->
            <view wx:if="{{ selectedGuide.fullContent.types }}" class="types-section">
              <view wx:for="{{ selectedGuide.fullContent.types }}" wx:key="type" class="type-item">
                <view class="type-name">{{ item.type }}</view>
                <view class="type-description">{{ item.description }}</view>
              </view>
            </view>
            
            <!-- å½±å“ -->
            <view wx:if="{{ selectedGuide.fullContent.effects }}" class="effects-section">
              <view wx:for="{{ selectedGuide.fullContent.effects }}" wx:key="category" class="effect-category">
                <view class="effect-category-title">{{ item.category }}</view>
                <view wx:for="{{ item.points }}" wx:key="*this" class="effect-point">
                  â€¢ {{ item }}
                </view>
              </view>
            </view>
            
            <!-- ä¿æŠ¤æ–¹æ³• -->
            <view wx:if="{{ selectedGuide.fullContent.methods }}" class="methods-section">
              <view wx:for="{{ selectedGuide.fullContent.methods }}" wx:key="method" class="method-item">
                <view class="method-title">{{ item.method }}</view>
                <view class="method-details">{{ item.details }}</view>
                
                <!-- æ–¹æ³•è¡¨æ ¼ -->
                <view wx:if="{{ item.table }}" class="method-table">
                  <view class="table-title">{{ item.table.title }}</view>
                  <view class="table-wrapper">
                    <view class="table-header">
                      <view wx:for="{{ item.table.headers }}" wx:key="*this" class="table-cell header-cell">
                        {{ item }}
                      </view>
                    </view>
                    <view wx:for="{{ item.table.rows }}" wx:key="*this" class="table-row">
                      <view wx:for="{{ item }}" wx:key="*this" class="table-cell">{{ item }}</view>
                    </view>
                  </view>
                </view>
                
                <!-- è®¾å¤‡ä¿¡æ¯ -->
                <view wx:if="{{ item.devices }}" class="devices-section">
                  <view wx:for="{{ item.devices }}" wx:key="name" class="device-item">
                    <view class="device-name">{{ item.name }}</view>
                    <view class="device-description">{{ item.description }}</view>
                  </view>
                </view>
              </view>
            </view>
          </view>
        </view>
      </view>
    </scroll-view>
  </view>
  
  <view wx:else class="detail-popup">
    <view class="popup-header">
      <view class="popup-title">åŠ è½½ä¸­...</view>
    </view>
    <view class="popup-content">
      <view class="detail-section">
        <view class="detail-content">æ­£åœ¨åŠ è½½æŒ‡å—è¯¦æƒ…...</view>
      </view>
    </view>
  </view>
</van-popup>

<van-toast id="van-toast" />