# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

è¯·ç”¨ä¸­æ–‡å›å¤

## ğŸ“± é¡¹ç›®æ¦‚è¿°

FlightToolboxï¼ˆé£è¡Œå·¥å…·ç®±ï¼‰æ˜¯ä¸“ä¸ºèˆªç©ºé£è¡Œå‘˜è®¾è®¡çš„å¾®ä¿¡å°ç¨‹åºï¼Œ**å¿…é¡»èƒ½å¤Ÿåœ¨å®Œå…¨ç¦»çº¿ç¯å¢ƒä¸‹æ­£å¸¸è¿è¡Œ**ã€‚

### ğŸš¨ ç¦»çº¿ä¼˜å…ˆè®¾è®¡ï¼ˆæ ¸å¿ƒçº¦æŸï¼‰

- **åŸå› **: é£è¡Œå‘˜åœ¨ç©ºä¸­å¿…é¡»å¼€å¯é£è¡Œæ¨¡å¼ï¼Œæ— æ³•ä½¿ç”¨ç½‘ç»œ
- **è¦æ±‚**: æ‰€æœ‰æ ¸å¿ƒæ•°æ®æœ¬åœ°å­˜å‚¨ï¼ŒéŸ³é¢‘æ–‡ä»¶æœ¬åœ°ç¼“å­˜ï¼Œåˆ†åŒ…é¢„åŠ è½½
- **æµ‹è¯•**: å¼€å‘æ—¶å¿…é¡»éªŒè¯é£è¡Œæ¨¡å¼ä¸‹æ‰€æœ‰åŠŸèƒ½æ­£å¸¸

## ğŸš€ å¿«é€Ÿå¼€å§‹

```bash
# å®‰è£…ä¾èµ–
cd miniprogram && npm install

# å¾®ä¿¡å¼€å‘è€…å·¥å…·: å·¥å…· -> æ„å»ºnpm -> ç¼–è¯‘

# é¢„è§ˆæ—¶å¼€å¯é£è¡Œæ¨¡å¼éªŒè¯ç¦»çº¿åŠŸèƒ½
```

**Windowså¼€å‘ç¯å¢ƒæ³¨æ„äº‹é¡¹**ï¼š
- é¡¹ç›®åœ¨Windowsç¯å¢ƒä¸‹å¼€å‘ï¼Œè·¯å¾„ä½¿ç”¨åæ–œæ ï¼ˆ\ï¼‰
- å‘½ä»¤è¡Œä½¿ç”¨PowerShellæˆ–CMD
- findå‘½ä»¤åœ¨Windowsä¸‹éœ€è¦ç‰¹æ®Šå¤„ç†ï¼ˆä½¿ç”¨PowerShellçš„Get-ChildItemæˆ–Git Bashï¼‰
- æ¨èä½¿ç”¨å¾®ä¿¡å¼€å‘è€…å·¥å…·å†…ç½®çš„ç»ˆç«¯æ‰§è¡Œnpmå‘½ä»¤

## ğŸ—ï¸ æ ¸å¿ƒæ¶æ„

### TabBarå¯¼èˆªç»“æ„ï¼ˆ5ä¸ªä¸»é¡µé¢ï¼‰

```javascript
TabBaré¡ºåºï¼ˆå½“å‰æœ€æ–°ç‰ˆæœ¬ï¼‰:
1. pages/search/index        - èµ„æ–™æŸ¥è¯¢ï¼ˆé¦–é¡µï¼‰
2. pages/flight-calculator/index - è®¡ç®—å·¥å…·
3. pages/cockpit/index       - é©¾é©¶èˆ±
4. pages/operations/index    - é€šä¿¡ï¼ˆåŸåï¼šèˆªç­è¿è¡Œï¼‰
5. pages/home/index          - æˆ‘çš„é¦–é¡µ
```

**é‡è¦å˜æ›´**ï¼š

- é»˜è®¤é¦–é¡µå·²ä»"æˆ‘çš„é¦–é¡µ"æ”¹ä¸º"èµ„æ–™æŸ¥è¯¢"
- "èˆªç­è¿è¡Œ"é¡µé¢å·²æ›´åä¸º"é€šä¿¡"
- "é€šä¿¡ç¿»è¯‘"åŠŸèƒ½å·²ä»èµ„æ–™æŸ¥è¯¢é¡µé¢è¿ç§»åˆ°é€šä¿¡é¡µé¢ï¼ˆä½œä¸ºç¬¬ä¸€ä¸ªå¡ç‰‡ï¼‰

### åˆ†åŒ…æ¶æ„ï¼ˆ47ä¸ªåˆ†åŒ…ï¼‰

#### åŠŸèƒ½åˆ†åŒ…ï¼ˆ16ä¸ªï¼‰

- `packageA` (icaoPackage): æ°‘èˆªè‹±è¯­è¯æ±‡ - ICAOæ ‡å‡†èˆªç©ºè‹±è¯­åŠåº”æ€¥ç‰¹æƒ…è¯æ±‡ï¼ˆ1400+æ¡ï¼‰
- `packageB` (abbreviationsPackage): AIPæ ‡å‡†åŠç©ºå®¢ç¼©å†™ï¼ˆ2ä¸‡+æ¡ï¼‰
- `packageC` (airportPackage): å…¨çƒæœºåœºæ•°æ®ï¼ˆ7405ä¸ªæœºåœºï¼‰
- `packageD` (definitionsPackage): èˆªç©ºä¸“ä¸šæœ¯è¯­æƒå¨å®šä¹‰ï¼ˆ3000+æ¡ï¼‰
- `packageF` (acrPackage): ACRè®¡ç®—å·¥å…·
- `packageG` (dangerousGoodsPackage): å±é™©å“è§„å®šæŸ¥è¯¢
- `packageH` (twinEnginePackage): åŒå‘é£æœºæ€§èƒ½æ•°æ®
- `packagePerformance`: é£æœºæ€§èƒ½å‚æ•°ä¸è¯¦è§£
- `packageCCAR` (caacPackage): CCARæ°‘èˆªè§„ç« ï¼ˆ1447ä¸ªæ–‡ä»¶ï¼‰
- `packageIOSA` (iosaPackage): IATAè¿è¡Œå®‰å…¨å®¡è®¡æœ¯è¯­ï¼ˆ897æ¡ï¼‰
- `packageICAO` (icaoPublicationsPackage): ICAOå‡ºç‰ˆç‰©
- `packageO` (pagesPackage): å·¥å…·é›†åˆï¼ˆ28ä¸ªå­é¡µé¢ï¼‰
- `packageCompetence` (competencePackage): PLMèƒœä»»åŠ›åŠè¡Œä¸ºæŒ‡æ ‡æ¡†æ¶ï¼ˆ13ä¸ªèƒœä»»åŠ›ï¼Œ113ä¸ªè¡Œä¸ºæŒ‡æ ‡ï¼‰
- `packageMedical` (medicalPackage): æ°‘èˆªä½“æ£€æ ‡å‡†ï¼ˆ6å¤§åˆ†ç±»ï¼Œå®Œæ•´æ ‡å‡†æ•°æ®ï¼‰
- `packageRadiation` (radiationPackage): èˆªç©ºè¾å°„å‰‚é‡è®¡ç®—å·¥å…·
- `packageDuty` (dutyPackage): æ‰§å‹¤æœŸè®¡ç®—å™¨

#### éŸ³é¢‘åˆ†åŒ…ï¼ˆ31ä¸ªå›½å®¶/åœ°åŒºï¼‰

**äºšæ´²åœ°åŒº**ï¼š
- `packageJapan`, `packagePhilippines`, `packageKorean`, `packageSingapore`
- `packageThailand`, `packageSrilanka`, `packageMalaysia`, `packageIndonesia`
- `packageVietnam`, `packageIndia`, `packageCambodia`, `packageMyanmar`
- `packageMaldive`, `packageUzbekistan`
- `packageTaipei` (ä¸­å›½å°åŒ—), `packageMacau` (ä¸­å›½æ¾³é—¨), `packageHongKong` (ä¸­å›½é¦™æ¸¯)

**æ¬§æ´²åœ°åŒº**ï¼š
- `packageRussia`, `packageTurkey`, `packageFrance`, `packageItaly`, `packageUK`
- `packageSpain`, `packageGermany`, `packageHolland`

**ç¾æ´²åœ°åŒº**ï¼š
- `packageAmerica`, `packageCanada`

**å¤§æ´‹æ´²åœ°åŒº**ï¼š
- `packageAustralia`, `packageNewZealand`

**éæ´²åœ°åŒº**ï¼š
- `packageEgypt`

**ä¸­ä¸œåœ°åŒº**ï¼š
- `packageUAE`

**éŸ³é¢‘åˆ†åŒ…ç­–ç•¥**ï¼š

- æŒ‰å›½å®¶/åœ°åŒºåˆ†åŒ…ï¼Œé¿å…å•åŒ…è¿‡å¤§
- ä½¿ç”¨æ™ºèƒ½é¢„åŠ è½½æœºåˆ¶ï¼ˆpreloadRuleé…ç½®ï¼‰
- è¦†ç›–å…¨çƒä¸»è¦èˆªç©ºæ¢çº½

### æŠ€æœ¯æ ˆé…ç½®

```javascript
æ ¸å¿ƒé…ç½®ï¼ˆproject.config.json + app.jsonï¼‰:
- TypeScriptæ”¯æŒ: éƒ¨åˆ†æ¨¡å—ä½¿ç”¨ï¼ˆapp.tsã€packageOã€servicesï¼‰
- ç»„ä»¶æ¡†æ¶: glass-easelï¼ˆæ–°ä¸€ä»£å°ç¨‹åºç»„ä»¶æ¡†æ¶ï¼‰
- UIç»„ä»¶åº“: Vant Weapp (@vant/weapp)
- ç¼–è¯‘å™¨: SWC + ES6è½¬æ¢
- æ‡’åŠ è½½: lazyCodeLoading = "requiredComponents"
- å¹¿å‘Šç³»ç»Ÿ: æ¨ªå¹…å¹¿å‘Šï¼ˆBanner Adï¼‰+ æ ¼å­å¹¿å‘Šï¼ˆGrid Adï¼‰
```

### JavaScript/TypeScriptè¯­æ³•æ”¯æŒï¼ˆé‡è¦ï¼‰

**å¾®ä¿¡å°ç¨‹åºåŸç”Ÿæ”¯æŒES6+è¯­æ³•**ï¼š

```javascript
// âœ… æ”¯æŒçš„ES6+ç‰¹æ€§ï¼ˆå¯ç›´æ¥ä½¿ç”¨ï¼‰
- let/const å˜é‡å£°æ˜
- ç®­å¤´å‡½æ•°: () => {}
- æ¨¡æ¿å­—ç¬¦ä¸²: `hello ${name}`
- è§£æ„èµ‹å€¼: const {a, b} = obj
- ç±»: class MyClass {}
- Promise/async/await
- æ‰©å±•è¿ç®—ç¬¦: ...args
- for...of å¾ªç¯
```

**é™åˆ¶å’Œæ³¨æ„äº‹é¡¹**ï¼š

```javascript
// âŒ WXSè„šæœ¬å¿…é¡»ä½¿ç”¨ES5è¯­æ³•
// WXSæ–‡ä»¶ï¼ˆ.wxsï¼‰ä¸æ”¯æŒES6ï¼Œå¿…é¡»ç”¨varã€ä¼ ç»Ÿfunction

// âœ… æ¨¡å—åŒ–ä½¿ç”¨CommonJS
const module = require('./path');  // æ­£ç¡®
// import module from './path';     // ä¸æ”¯æŒES6 import/export

// âœ… TypeScriptæ–‡ä»¶ï¼ˆ.tsï¼‰å®Œå…¨æ”¯æŒ
// operations/index.tsã€flight-calculator/index.tsç­‰å¯å®‰å…¨ä½¿ç”¨TS+ES6
```

**é¡¹ç›®ç¼–è¯‘é…ç½®**ï¼š
- `project.config.json`å·²å¯ç”¨`"es6": true`
- å¼€å‘æ—¶ç›´æ¥ä½¿ç”¨ES6+è¯­æ³•ï¼Œå·¥å…·ä¼šè‡ªåŠ¨å¤„ç†å…¼å®¹æ€§
- æ¨èä½¿ç”¨ç°ä»£JavaScriptç¼–ç é£æ ¼ï¼ˆlet/constã€ç®­å¤´å‡½æ•°ã€async/awaitç­‰ï¼‰

## ğŸ“‹ æ ¸å¿ƒå¼€å‘åŸåˆ™ï¼ˆå¿…é¡»éµå¾ªï¼‰

### 1. ç¦»çº¿ä¼˜å…ˆï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰

- âœ… æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½å¿…é¡»åœ¨é£è¡Œæ¨¡å¼ä¸‹å¯ç”¨
- âœ… æ•°æ®å­˜å‚¨åœ¨æœ¬åœ°ï¼Œä¸ä¾èµ–ç½‘ç»œ
- âœ… åˆ†åŒ…é¢„åŠ è½½ï¼Œé¿å…è¿è¡Œæ—¶åŠ è½½å¤±è´¥

### 2. ä½¿ç”¨BasePageåŸºç±»ï¼ˆå¼ºåˆ¶è¦æ±‚ï¼‰

```javascript
// âœ… æ­£ç¡®æ–¹å¼
var BasePage = require('../../utils/base-page.js');
var pageConfig = {
  data: { loading: false },
  customOnLoad: function(options) {
    // é¡µé¢é€»è¾‘
  }
};
Page(BasePage.createPage(pageConfig));

// âŒ é”™è¯¯æ–¹å¼
Page({
  onLoad() {} // ä¸ä½¿ç”¨BasePage
});
```

### 3. è·¨åˆ†åŒ…å¼•ç”¨å¿…é¡»å¼‚æ­¥

```javascript
// âœ… æ­£ç¡®æ–¹å¼
require('../../packageA/data.js', function(data) {
  // å¤„ç†æ•°æ®
}, function(error) {
  self.handleError(error, 'åŠ è½½æ•°æ®å¤±è´¥');
});

// âŒ é”™è¯¯æ–¹å¼
var data = require('../../packageA/data.js'); // ç”Ÿäº§ç¯å¢ƒå¯èƒ½å¤±è´¥
```

### 4. å“åº”å¼å¸ƒå±€ä½¿ç”¨rpxå•ä½

```css
/* âœ… æ­£ç¡®ä½¿ç”¨rpx (750rpx = å…¨å±å®½åº¦) */
.container {
  width: 750rpx;        /* å…¨å±å®½åº¦ */
  padding: 20rpx;       /* å“åº”å¼å†…è¾¹è· */
  font-size: 28rpx;     /* å“åº”å¼å­—ä½“ */
}

/* âŒ é¿å…å›ºå®šåƒç´  */
.bad-container {
  width: 375px;         /* ä»…é€‚é…iPhone6 */
}
```

### 5. GPSåŸå§‹æ•°æ®è§„åˆ™ï¼ˆä¸¥æ ¼ç¦æ­¢ä¿®æ”¹ï¼‰

- ğŸš¨ **GPSåœ°é€Ÿå’ŒGPSé«˜åº¦å¿…é¡»ä½¿ç”¨åŸå§‹æ•°æ®**
- ğŸš¨ **ç¦æ­¢å¯¹GPSæ•°æ®ä½¿ç”¨æ»¤æ³¢ã€å¹³æ»‘ç­‰ç®—æ³•å¤„ç†**
- ğŸš¨ **`gps-manager.js`ä¸­çš„ `applySmartFiltering`å·²ç¦ç”¨ï¼Œç›´æ¥è¿”å›åŸå§‹æ•°æ®**
- âœ… GPSåœ°é€Ÿæ˜¾ç¤ºä¸ºæ•´æ•°ï¼ˆä½¿ç”¨ `Math.round()`ï¼‰
- âœ… GPSé«˜åº¦ä»ç±³è½¬è‹±å°ºåç›´æ¥æ˜¾ç¤ºï¼Œæ— å¹³æ»‘å¤„ç†

### 6. ä½ç½®APIä½¿ç”¨è§„èŒƒ

é¡¹ç›®å·²ç”³è¯·ä»¥ä¸‹å››ä¸ªä½ç½®APIï¼Œä¸¥æ ¼æŒ‰è§„èŒƒä½¿ç”¨ï¼š

```javascript
// âœ… 1. wx.getLocation - ä¸€æ¬¡æ€§è·å–ä½ç½®
wx.getLocation({
  type: 'gcj02',
  altitude: true,
  isHighAccuracy: true,
  success: function(res) { /* ... */ }
});

// âœ… 2. wx.startLocationUpdate + wx.onLocationChange - æŒç»­ç›‘æ§
wx.startLocationUpdate({
  type: 'gcj02',
  success: function() {
    wx.onLocationChange(function(res) {
      // å¤„ç†ä½ç½®æ›´æ–°
    });
  }
});

// âœ… 3. é¡µé¢é”€æ¯æ—¶å¿…é¡»æ¸…ç†
wx.stopLocationUpdate();
wx.offLocationChange();

// âŒ ç¦æ­¢ä½¿ç”¨æœªç”³è¯·çš„åå°å®šä½API
// wx.startLocationUpdateBackground(); // æœªç”³è¯·ï¼Œç¦æ­¢ä½¿ç”¨
```

## ğŸµ èˆªçº¿å½•éŸ³åˆ†åŒ…ç®¡ç†ï¼ˆé‡è¦ï¼‰

### âš ï¸ æ ¸å¿ƒç»éªŒæ€»ç»“

è¿™æ˜¯é¡¹ç›®ä¸­æœ€å¤æ‚çš„éƒ¨åˆ†ä¹‹ä¸€ï¼Œç»è¿‡å¤šæ¬¡è¯•é”™æ‰æ‰¾åˆ°æ­£ç¡®æ–¹æ³•ã€‚**è¯¦ç»†æ–‡æ¡£è§**ï¼š`èˆªçº¿å½•éŸ³åˆ†åŒ…é¢„åŠ è½½è§„åˆ™è®°å½•/` æ–‡ä»¶å¤¹

## ğŸ–¼ï¸ å›¾ç‰‡åˆ†åŒ…æœ¬åœ°ç¼“å­˜æœºåˆ¶ï¼ˆå…³é”®çªç ´ï¼‰

### âš ï¸ æ ¸å¿ƒå‘ç°ï¼šåˆ†åŒ…èµ„æºçœŸæ­£å†™å…¥æœ¬åœ°çš„æ–¹æ³•

**å†å²é—®é¢˜**ï¼šä»…ä¾èµ– `wx.loadSubpackage` å’Œ `preloadRule` ä¸èƒ½ä¿è¯ç¦»çº¿ç¨³å®šæ€§
- åˆ†åŒ…èµ„æºå¯èƒ½è¢«å¾®ä¿¡æ¸…ç†ï¼ˆæ¦‚ç‡æ€§ï¼‰
- å¼€å‘è€…å·¥å…·ä¸çœŸæœºç¯å¢ƒå·®å¼‚å·¨å¤§
- äºŒæ¬¡å¯åŠ¨æ—¶å›¾ç‰‡å¯èƒ½é»‘å±æˆ–404

**è§£å†³æ–¹æ¡ˆ**ï¼šä¸‰å±‚é˜²æŠ¤æœºåˆ¶ï¼ˆ2025-01-04é‡å¤§çªç ´ï¼Œ2025-01æ›´æ–°ï¼‰

```javascript
// ğŸ”¥ å…³é”®æŠ€æœ¯ï¼šå°†åˆ†åŒ…å›¾ç‰‡å†™å…¥ wx.env.USER_DATA_PATH
var IMAGE_CACHE_DIR = wx.env.USER_DATA_PATH + '/walkaround-images';
var IMAGE_CACHE_INDEX_KEY = 'walkaround_image_cache_index';

// ç¬¬ä¸€å±‚ï¼šä¸»åŠ¨åŠ è½½åˆ†åŒ…
wx.loadSubpackage({
  name: 'packageName',
  success: function() {
    // 200mså»¶è¿Ÿç¡®ä¿åˆ†åŒ…å®Œå…¨å°±ç»ªï¼ˆç»çœŸæœºæµ‹è¯•éªŒè¯ç¨³å®šï¼‰
    setTimeout(() => showDetails(), 200);
  }
});

// ç¬¬äºŒå±‚ï¼šæœ¬åœ°ç¼“å­˜ï¼ˆæ ¸å¿ƒçªç ´ï¼‰
wx.getImageInfo({
  src: originalSrc,  // åˆ†åŒ…å›¾ç‰‡è·¯å¾„
  success: function(res) {
    // ğŸ”¥ å…³é”®ï¼šå°†å›¾ç‰‡å¤åˆ¶åˆ°æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ
    wx.getFileSystemManager().copyFile({
      srcPath: res.path,
      destPath: IMAGE_CACHE_DIR + '/cached_image.png',
      success: function() {
        // åç»­ç›´æ¥ä½¿ç”¨ wxfile:// è·¯å¾„ï¼Œå½»åº•ç¦»çº¿åŒ–
      }
    });
  }
});

// ç¬¬ä¸‰å±‚ï¼šæ™ºèƒ½å…œåº•
handleImageError: function(event) {
  // 1. æ£€æŸ¥å¼€å‘è€…å·¥å…·ç¯å¢ƒï¼ˆé¿å…è¯¯åˆ¤ï¼‰
  if (typeof wx.loadSubpackage !== 'function') {
    console.warn('å¼€å‘è€…å·¥å…·ç¯å¢ƒï¼Œå¿½ç•¥é”™è¯¯');
    return;
  }

  // 2. æ£€æŸ¥æœ¬åœ°ç¼“å­˜
  var cachedPath = this.getCachedImagePath(cacheKey);
  if (cachedPath) {
    // ç›´æ¥ä½¿ç”¨ç¼“å­˜
    this.updateCachedSrcInData(cacheKey, cachedPath);
    return;
  }

  // 3. æ£€æŸ¥é¢„åŠ è½½çŠ¶æ€
  this.preloadGuide.checkPackagePreloaded(areaId).then(function(isPreloaded) {
    if (isPreloaded) {
      // å·²é¢„åŠ è½½ï¼Œç¬æ—¶é”™è¯¯ï¼Œè‡ªåŠ¨é‡è¯•ï¼ˆæœ€å¤š3æ¬¡ï¼‰
      if (retryCount < 3) {
        setTimeout(() => retry(), 300);
      }
    } else {
      // æœªï¿½ï¿½ï¿½åŠ è½½ï¼Œæ˜¾ç¤ºå¼•å¯¼å¼¹çª—
      showGuideDialog();
    }
  });
}
```

### æ ¸å¿ƒåŸåˆ™ï¼ˆå¿…é¡»éµå¾ªï¼‰

1. **å¼€å‘è€…å·¥å…·ç¯å¢ƒæ£€æµ‹ï¼ˆå…³é”®ï¼ï¼‰**
   ```javascript
   // âœ… å¿…é¡»æ·»åŠ 
   var isDevTools = (typeof wx.loadSubpackage !== 'function');
   if (isDevTools) {
     console.warn('å¼€å‘è€…å·¥å…·ç¯å¢ƒï¼šå›¾ç‰‡åŠ è½½å¤±è´¥æ˜¯æ­£å¸¸ç°è±¡');
     return;  // ä¸æ‰§è¡Œä»»ä½•é”™è¯¯å¤„ç†
   }
   ```
   - å¼€å‘è€…å·¥å…·ä¸æ”¯æŒ `wx.loadSubpackage`
   - å›¾ç‰‡è·¯å¾„åœ¨å¼€å‘è€…å·¥å…·ä¸­å¯èƒ½è¿”å›404
   - **ç»å¯¹ä¸èƒ½**åœ¨å¼€å‘ç¯å¢ƒä¸­æ¸…é™¤é¢„åŠ è½½çŠ¶æ€

2. **æ—¶åºä¼˜åŒ–ï¼ˆ200mså»¶è¿Ÿï¼‰**
   ```javascript
   wx.loadSubpackage({
     success: function() {
       // ğŸ”¥ å…³é”®ï¼šæ·»åŠ 200mså»¶è¿Ÿç¡®ä¿åˆ†åŒ…å®Œå…¨å°±ç»ª
       // ç»çœŸæœºæµ‹è¯•éªŒè¯ï¼Œ200msåœ¨ä¿è¯ç¨³å®šæ€§çš„åŒæ—¶å“åº”é€Ÿåº¦æ›´å¿«
       setTimeout(() => {
         showAreaDetails();
       }, 200);
     }
   });
   ```

3. **æœ¬åœ°ç¼“å­˜ç´¢å¼•ç®¡ç†**
   ```javascript
   // åˆå§‹åŒ–ç¼“å­˜ç›®å½•
   try {
     wx.getFileSystemManager().accessSync(IMAGE_CACHE_DIR);
   } catch (err) {
     wx.getFileSystemManager().mkdirSync(IMAGE_CACHE_DIR, true);
   }

   // è¯»å–ç¼“å­˜ç´¢å¼•
   this.imageCacheIndex = wx.getStorageSync(IMAGE_CACHE_INDEX_KEY) || {};
   ```

4. **é˜²æ­¢é‡å¤ç¼“å­˜ï¼ˆPromiseç®¡ç†ï¼‰**
   ```javascript
   // ä½¿ç”¨Promiseç¼“å­˜ï¼Œé¿å…åŒä¸€å›¾ç‰‡å¹¶å‘å†™å…¥
   if (!this.imageCachePromises[cacheKey]) {
     this.imageCachePromises[cacheKey] = new Promise(function(resolve) {
       // æ‰§è¡Œç¼“å­˜é€»è¾‘
     }).finally(function() {
       delete this.imageCachePromises[cacheKey];
     });
   }
   ```

### åº”ç”¨åœºæ™¯

**å½“å‰åº”ç”¨**ï¼š
- `packageWalkaround/pages/index/index.js` - ç»•æœºæ£€æŸ¥å›¾ç‰‡ç³»ç»Ÿï¼ˆå·²å®ç°ï¼‰

**å¯æ‰©å±•åœºæ™¯**ï¼š
- âœ… æ‰€æœ‰éœ€è¦ç¦»çº¿æ˜¾ç¤ºçš„å›¾ç‰‡èµ„æº
- âœ… åˆ†åŒ…ä¸­çš„é™æ€å›¾ç‰‡èµ„æº
- âœ… éœ€è¦åœ¨é£è¡Œæ¨¡å¼ä¸‹ç¨³å®šè®¿é—®çš„èµ„æº

### è¯¦ç»†æ–‡æ¡£

**ä¿®å¤è¯´æ˜**ï¼š
- `èˆªçº¿å½•éŸ³åˆ†åŒ…é¢„åŠ è½½è§„åˆ™è®°å½•/ä¿®å¤è¯´æ˜/2025-01-04-ç»•æœºæ£€æŸ¥å›¾ç‰‡åŠ è½½é—®é¢˜ä¿®å¤.md` - å®Œæ•´æŠ€æœ¯æ–‡æ¡£

**æ ¸å¿ƒç»éªŒ**ï¼š
1. **ä¸»åŠ¨åŠ è½½ + è¢«åŠ¨å…œåº•ç¼ºä¸€ä¸å¯**
2. **ç¦»çº¿èµ„æºå¿…é¡»æœ¬åœ°åŒ–**ï¼šä»…ä¾èµ–åˆ†åŒ…è·¯å¾„ä¸å¯é 
3. **å¼€å‘è€…å·¥å…·ç¯å¢ƒ â‰  çœŸæœºç¯å¢ƒ**ï¼šå¿…é¡»ç¯å¢ƒæ£€æµ‹
4. **è‡ªåŠ¨é‡è¯•æ¯”å¼¹çª—æ›´å‹å¥½**ï¼šå·²é¢„åŠ è½½çš„èµ„æºè‡ªåŠ¨é‡è¯•
5. **æ—¶åºé—®é¢˜å¾ˆå…³é”®**ï¼š200mså»¶è¿Ÿåœ¨çœŸæœºæµ‹è¯•ä¸­å·²éªŒè¯ç¨³å®šï¼ˆåˆç‰ˆ500msï¼Œä¼˜åŒ–å200msï¼‰

### å¿«é€ŸéªŒè¯å‘½ä»¤

#### æ–¹å¼1ï¼šçœŸæœºè°ƒè¯•å·¥å…·éªŒè¯ï¼ˆæ¨è â­â­â­ï¼‰

```bash
æ­¥éª¤ï¼š
1. æ‰“å¼€å¾®ä¿¡å¼€å‘è€…å·¥å…·
2. ç‚¹å‡»"çœŸæœºè°ƒè¯•"æŒ‰é’®
3. ä½¿ç”¨å¾®ä¿¡æ‰«ç è¿æ¥çœŸæœº
4. è¿›å…¥"Storage"é€‰é¡¹å¡
5. é€‰æ‹©"æ–‡ä»¶ç³»ç»Ÿ" â†’ usr â†’ walkaround-images
6. éªŒè¯æ–‡ä»¶åˆ—è¡¨æ˜¯å¦å­˜åœ¨ç¼“å­˜çš„PNGæ–‡ä»¶
```

**ä¼˜ç‚¹**ï¼š
- âœ… å¯è§†åŒ–æŸ¥çœ‹æ–‡ä»¶åˆ—è¡¨
- âœ… å¯ä»¥æŸ¥çœ‹æ–‡ä»¶å¤§å°å’Œåˆ›å»ºæ—¶é—´
- âœ… å¯ä»¥ç›´æ¥é¢„è§ˆå›¾ç‰‡å†…å®¹

---

#### æ–¹å¼2ï¼šä»£ç éªŒè¯ï¼ˆå¿«é€Ÿ â­â­ï¼‰

```javascript
// åœ¨ä»»æ„é¡µé¢çš„consoleä¸­æ‰§è¡Œï¼ˆæ¨èåœ¨app.jsçš„onLaunchä¸­æ·»åŠ ï¼‰

// 1. éªŒè¯ç¼“å­˜ç›®å½•å’Œæ–‡ä»¶
var fs = wx.getFileSystemManager();
fs.readdir({
  dirPath: wx.env.USER_DATA_PATH + '/walkaround-images',
  success: function(res) {
    console.log('âœ… ç¼“å­˜ç›®å½•å­˜åœ¨');
    console.log('ğŸ“ ç¼“å­˜æ–‡ä»¶æ•°é‡:', res.files.length);
    console.log('ğŸ“‹ æ–‡ä»¶åˆ—è¡¨:', res.files);
  },
  fail: function(err) {
    console.log('âŒ ç¼“å­˜ç›®å½•ä¸å­˜ï¿½ï¿½æˆ–ä¸ºç©º');
    console.log('é”™è¯¯ä¿¡æ¯:', err);
  }
});

// 2. éªŒè¯ç¼“å­˜ç´¢å¼•
var cacheIndex = wx.getStorageSync('walkaround_image_cache_index');
console.log('ğŸ“Š ç¼“å­˜ç´¢å¼•:', cacheIndex);
console.log('ğŸ“Š å·²ç¼“å­˜å›¾ç‰‡æ•°é‡:', Object.keys(cacheIndex || {}).length);

// 3. éªŒè¯å­˜å‚¨ç©ºé—´ä½¿ç”¨æƒ…å†µ
wx.getStorageInfo({
  success: function(res) {
    var usedMB = (res.currentSize / 1024).toFixed(2);
    var limitMB = (res.limitSize / 1024).toFixed(2);
    var usagePercent = ((res.currentSize / res.limitSize) * 100).toFixed(1);
    console.log('ğŸ’¾ å­˜å‚¨ä½¿ç”¨æƒ…å†µ: ' + usedMB + 'MB / ' + limitMB + 'MB (' + usagePercent + '%)');
  }
});
```

---

#### æ–¹å¼3ï¼šæ—¥å¿—éªŒè¯ï¼ˆå®æ—¶ â­ï¼‰

**åœ¨çœŸæœºè¿è¡Œæ—¶è§‚å¯Ÿæ§åˆ¶å°æ—¥å¿—**ï¼š

```bash
# é¢„æœŸæ—¥å¿—ï¼ˆæˆåŠŸåœºæ™¯ï¼‰
ğŸ¯ ç”¨æˆ·ç‚¹å‡»åŒºåŸŸ 5ï¼Œä¸»åŠ¨ç¡®ä¿å›¾ç‰‡åˆ†åŒ…å·²åŠ è½½
ğŸ”„ ä¸»åŠ¨åŠ è½½åˆ†åŒ…: walkaroundImages2Package (åŒºåŸŸ 5)
âœ… åˆ†åŒ…ä¸»åŠ¨åŠ è½½æˆåŠŸ: walkaroundImages2Package
âœ… å·²æ ‡è®° 5-8 ä¸ºé¢„åŠ è½½å®Œæˆ
âœ… å»¶è¿Ÿåæ˜¾ç¤ºè¯¦æƒ…ï¼Œç¡®ä¿åˆ†åŒ…å®Œå…¨å°±ç»ª
âœ… ä»æœ¬åœ°ç¼“å­˜åŠ è½½: area5_xxx.png
âœ… å·²ç¼“å­˜å›¾ç‰‡åˆ°æœ¬åœ°: wxfile://usr/walkaround-images/area5_xxx.png
```

**å…³é”®æ—¥å¿—å…³é”®è¯**ï¼š
- `âœ… å·²ç¼“å­˜å›¾ç‰‡åˆ°æœ¬åœ°` â†’ ç¼“å­˜å†™å…¥æˆåŠŸ
- `âœ… ä»æœ¬åœ°ç¼“å­˜åŠ è½½` â†’ ä½¿ç”¨ç¼“å­˜åŠ è½½
- `ğŸ“¦ ä»åˆ†åŒ…åŠ è½½` â†’ ä½¿ç”¨åˆ†åŒ…åŠ è½½
- `ğŸŒ ä»ç½‘ç»œåŠ è½½` â†’ ä½¿ç”¨ç½‘ç»œåŠ è½½ï¼ˆä¸åº”è¯¥å‡ºç°ï¼‰

---

#### æ–¹å¼4ï¼šåŠŸèƒ½æµ‹è¯•ï¼ˆå®Œæ•´ â­â­â­ï¼‰

```bash
æµ‹è¯•æ­¥éª¤ï¼š

ã€é¦–æ¬¡å®Œæ•´æµç¨‹ã€‘
1. æ¸…é™¤å°ç¨‹åºç¼“å­˜ï¼ˆåˆ é™¤å°ç¨‹åºï¼‰
2. é‡æ–°æ‰“å¼€å°ç¨‹åº
3. è®¿é—®"æ—¥å‡ºæ—¥è½"é¡µé¢ â†’ è§¦å‘åŒºåŸŸ5-8å›¾ç‰‡åˆ†åŒ…é¢„åŠ è½½
4. è®¿é—®"ç»•æœºæ£€æŸ¥" â†’ ç‚¹å‡»åŒºåŸŸ5
   âœ… é¢„æœŸï¼šå›¾ç‰‡æ­£å¸¸æ˜¾ç¤º + æ§åˆ¶å°å‡ºç°"å·²ç¼“å­˜å›¾ç‰‡åˆ°æœ¬åœ°"æ—¥å¿—

ã€é£è¡Œæ¨¡å¼é‡å¯æµ‹è¯•ã€‘
5. å…³é—­å°ç¨‹åº
6. å¼€å¯é£è¡Œæ¨¡å¼ï¼ˆå®Œå…¨æ–­ç½‘ï¼‰
7. é‡æ–°æ‰“å¼€å°ç¨‹åº
8. è®¿é—®"ç»•æœºæ£€æŸ¥" â†’ ç‚¹å‡»åŒºåŸŸ5
   âœ… é¢„æœŸï¼šå›¾ç‰‡æ­£å¸¸æ˜¾ç¤º + æ— éœ€é‡æ–°é¢„åŠ è½½ + æ— é»‘å±

ã€å¤§å›¾é¢„è§ˆæµ‹è¯•ã€‘
9. ç‚¹å‡»ä»»æ„ç¼©ç•¥å›¾
   âœ… é¢„æœŸï¼šå¤§å›¾å³æ—¶æ˜¾ç¤º + å¯å·¦å³æ»‘åŠ¨åˆ‡æ¢9å¼ å›¾ç‰‡ + åŠ è½½é€Ÿåº¦å¿«

ã€æç«¯å…œåº•æµ‹è¯•ã€‘
10. æ‰‹åŠ¨æ¸…ç©ºç¼“å­˜ç›®å½•ï¼ˆå¼€å‘è€…å·¥å…· -> Storage -> Files -> åˆ é™¤walkaround-imagesï¼‰
11. ä¿æŒé£è¡Œæ¨¡å¼ï¼Œé‡æ–°è¿›å…¥ç»•æœºæ£€æŸ¥ â†’ åŒºåŸŸ5
    âœ… é¢„æœŸï¼šæ˜¾ç¤º"å›¾ç‰‡åŠ è½½å¤±è´¥"æç¤º + å¼•å¯¼é‡æ–°é¢„åŠ è½½
```

### â“ å¸¸è§é—®é¢˜ï¼ˆFAQï¼‰

#### Q1: ä¸ºä»€ä¹ˆéœ€è¦æ·»åŠ 200mså»¶è¿Ÿï¼Ÿå¯ä»¥å»æ‰å—ï¼Ÿ

**A**: ä¸å»ºè®®å»æ‰ã€‚ç»è¿‡å¤šæ¬¡æµ‹è¯•å‘ç°ï¼š
- **0msï¼ˆæ— å»¶è¿Ÿï¼‰**ï¼šå›¾ç‰‡åŠ è½½å¤±è´¥ç‡çº¦10-15%
- **100ms**ï¼šä½ç«¯è®¾å¤‡å¶å°”å¤±è´¥ï¼ˆçº¦5%æ¦‚ç‡ï¼‰
- **200ms**ï¼šçœŸæœºæµ‹è¯•å®Œå…¨ç¨³å®šï¼ˆ0%å¤±è´¥ç‡ï¼‰ âœ… **æ¨è**
- **500ms**ï¼šè¿‡åº¦ä¿å®ˆï¼Œç”¨æˆ·æ„ŸçŸ¥å»¶è¿Ÿæ˜æ˜¾

**åŸå› **ï¼š`wx.loadSubpackage` çš„ `success` å›è°ƒè§¦å‘æ—¶ï¼Œåˆ†åŒ…æ–‡ä»¶å¯èƒ½è¿˜åœ¨å†™å…¥æ–‡ä»¶ç³»ç»Ÿã€‚æ·»åŠ å»¶è¿Ÿç¡®ä¿æ–‡ä»¶ç³»ç»Ÿæ“ä½œå®Œæˆã€‚

**ç‰¹æ®Šæƒ…å†µ**ï¼š
- å¼€å‘è€…å·¥å…·ï¼šå»¶è¿Ÿæ— æ•ˆï¼ˆä¸æ”¯æŒåˆ†åŒ…åŠ è½½ï¼‰
- é«˜ç«¯è®¾å¤‡ï¼š100mså¯èƒ½è¶³å¤Ÿï¼Œä½†ä¸ºä¿è¯ä½ç«¯è®¾å¤‡å…¼å®¹æ€§ï¼Œå»ºè®®ç»Ÿä¸€ä½¿ç”¨200ms

---

#### Q2: æœ¬åœ°ç¼“å­˜ä¼šå ç”¨å¤šå°‘å­˜å‚¨ç©ºé—´ï¼Ÿ

**A**:
- **å•ä¸ªå›¾ç‰‡**ï¼šçº¦100-300KBï¼ˆPNGæ ¼å¼ï¼‰
- **ç»•æœºæ£€æŸ¥ï¼ˆ9ä¸ªåŒºåŸŸï¼Œ54å¼ å›¾ç‰‡ï¼‰**ï¼šçº¦10-15MB
- **å¾®ä¿¡å°ç¨‹åºæœ¬åœ°å­˜å‚¨é™åˆ¶**ï¼š
  - é»˜è®¤ï¼š10MB
  - å¯æ‰©å±•ï¼šæœ€é«˜200MBï¼ˆéœ€å‘å¾®ä¿¡ç”³è¯·ï¼‰

**å­˜å‚¨ä¼˜åŒ–å»ºè®®**ï¼š
```javascript
// 1. å®šæœŸæ¸…ç†æ—§ç¼“å­˜ï¼ˆLRUç­–ç•¥ï¼‰
function cleanOldCache() {
  var index = wx.getStorageSync(IMAGE_CACHE_INDEX_KEY) || {};
  var sortedKeys = Object.keys(index).sort(function(a, b) {
    return index[a].timestamp - index[b].timestamp;
  });

  // ä¿ç•™æœ€è¿‘30å¤©çš„ç¼“å­˜
  var now = Date.now();
  var thirtyDaysAgo = now - 30 * 24 * 60 * 60 * 1000;

  sortedKeys.forEach(function(key) {
    if (index[key].timestamp < thirtyDaysAgo) {
      // åˆ é™¤æ–‡ä»¶å’Œç´¢å¼•
      wx.getFileSystemManager().unlinkSync(index[key].path);
      delete index[key];
    }
  });

  wx.setStorageSync(IMAGE_CACHE_INDEX_KEY, index);
}

// 2. ç›‘æ§å­˜å‚¨ç©ºé—´
wx.getStorageInfo({
  success: function(res) {
    var usedMB = (res.currentSize / 1024).toFixed(2);
    var limitMB = (res.limitSize / 1024).toFixed(2);
    console.log('å­˜å‚¨ä½¿ç”¨æƒ…å†µ:', usedMB + 'MB / ' + limitMB + 'MB');

    if (res.currentSize / res.limitSize > 0.8) {
      // ä½¿ç”¨è¶…è¿‡80%ï¼Œè§¦å‘æ¸…ç†
      cleanOldCache();
    }
  }
});
```

---

#### Q3: å¼€å‘è€…å·¥å…·ä¸­çœ‹åˆ°"å›¾ç‰‡åŠ è½½å¤±è´¥"æ­£å¸¸å—ï¼Ÿ

**A**: **å®Œå…¨æ­£å¸¸ï¼** è¿™æ˜¯é¢„æœŸè¡Œä¸ºã€‚

**åŸå› **ï¼š
- å¼€å‘è€…å·¥å…·ä¸æ”¯æŒ `wx.loadSubpackage` API
- å›¾ç‰‡è·¯å¾„åœ¨å¼€å‘è€…å·¥å…·ä¸­ä¼šè¿”å›404é”™è¯¯
- è¿™ä¸å½±å“çœŸæœºè¿è¡Œ

**å¦‚ä½•éªŒè¯**ï¼š
```javascript
// æ–¹æ³•1ï¼šæ£€æµ‹ç¯å¢ƒ
var isDevTools = (typeof wx.loadSubpackage !== 'function');
console.log('å½“å‰ç¯å¢ƒ:', isDevTools ? 'å¼€å‘è€…å·¥å…·' : 'çœŸæœº');

// æ–¹æ³•2ï¼šçœŸæœºè°ƒè¯•ï¼ˆæ¨èï¼‰
// 1. å¾®ä¿¡å¼€å‘è€…å·¥å…· -> é¢„è§ˆ -> æ‰«ç 
// 2. æˆ–ï¼šå·¥å…· -> çœŸæœºè°ƒè¯•
// 3. åœ¨çœŸæœºä¸Šæµ‹è¯•å›¾ç‰‡åŠ è½½åŠŸèƒ½
```

**æ³¨æ„äº‹é¡¹**ï¼š
- âœ… **çœŸæœºæµ‹è¯•æ˜¯å”¯ä¸€å¯é çš„éªŒè¯æ–¹å¼**
- âŒ ä¸è¦åœ¨å¼€å‘è€…å·¥å…·ä¸­åˆ¤æ–­åŠŸèƒ½æ˜¯å¦æ­£å¸¸
- âš ï¸ å¦‚æœä»£ç ä¸­æœ‰ `if (isDevTools) return;` é€»è¾‘ï¼Œå¼€å‘è€…å·¥å…·ä¸­çœ‹ä¸åˆ°ä»»ä½•é”™è¯¯æç¤ºæ˜¯æ­£å¸¸çš„

---

#### Q4: å¦‚ä½•åˆ¤æ–­å›¾ç‰‡æ˜¯ä»ç¼“å­˜åŠ è½½è¿˜æ˜¯åˆ†åŒ…åŠ è½½ï¼Ÿ

**A**: å¯ä»¥é€šè¿‡æ—¥å¿—å’Œè·¯å¾„å‰ç¼€åˆ¤æ–­ï¼š

```javascript
// åœ¨handleImageLoadä¸­æ·»åŠ æ—¥å¿—
handleImageLoad: function(event) {
  var src = event.currentTarget.dataset.src || event.detail.src;
  var cacheKey = event.currentTarget.dataset.cacheKey;

  // åˆ¤æ–­åŠ è½½æ¥æº
  if (src.startsWith('wxfile://')) {
    console.log('âœ… ä»æœ¬åœ°ç¼“å­˜åŠ è½½:', cacheKey);
  } else if (src.startsWith('/package')) {
    console.log('ğŸ“¦ ä»åˆ†åŒ…åŠ è½½:', cacheKey);
  } else {
    console.log('ğŸŒ ä»ç½‘ç»œåŠ è½½:', src);
  }

  // ... åç»­ç¼“å­˜é€»è¾‘
}
```

**è·¯å¾„å‰ç¼€å¯¹ç…§è¡¨**ï¼š
| å‰ç¼€ | æ¥æº | æ€§èƒ½ | ç¦»çº¿å¯ç”¨ |
|------|------|------|---------|
| `wxfile://usr/` | æœ¬åœ°ç¼“å­˜ | â­â­â­â­â­ æœ€å¿« | âœ… æ˜¯ |
| `/packageXXX/` | åˆ†åŒ… | â­â­â­â­ å¿« | âš ï¸ å¯èƒ½ |
| `https://` | ç½‘ç»œ | â­â­ æ…¢ | âŒ å¦ |

---

#### Q5: å¦‚æœç¼“å­˜æŸåæˆ–ä¸¢å¤±æ€ä¹ˆåŠï¼Ÿ

**A**: ç³»ç»Ÿä¼šè‡ªåŠ¨é™çº§åˆ°åˆ†åŒ…åŠ è½½ï¼Œå¹¶é‡æ–°ç¼“å­˜ã€‚

**é™çº§æµç¨‹**ï¼š
```javascript
handleImageError: function(event) {
  // 1. å°è¯•ä»ç¼“å­˜åŠ è½½
  var cachedPath = this.getCachedImagePath(cacheKey);
  if (cachedPath) {
    // éªŒè¯ç¼“å­˜æ–‡ä»¶æ˜¯å¦å­˜åœ¨
    try {
      wx.getFileSystemManager().accessSync(cachedPath);
      this.updateCachedSrcInData(cacheKey, cachedPath);
      return; // ç¼“å­˜å¯ç”¨
    } catch (err) {
      // ç¼“å­˜æ–‡ä»¶ä¸å­˜åœ¨ï¼Œæ¸…é™¤ç´¢å¼•
      delete this.imageCacheIndex[cacheKey];
      this.persistImageCacheIndex();
    }
  }

  // 2. é™çº§åˆ°åˆ†åŒ…åŠ è½½
  if (isPreloaded) {
    // è‡ªåŠ¨é‡è¯•ï¼ˆæœ€å¤š3æ¬¡ï¼‰
    if (retryCount < 3) {
      setTimeout(() => retry(), 300);
    }
  } else {
    // æ˜¾ç¤ºå¼•å¯¼å¼¹çª—
    showGuideDialog();
  }
}
```

**ç¼“å­˜è‡ªæˆ‘ä¿®å¤**ï¼š
- âœ… å¦‚æœç¼“å­˜ç´¢å¼•å­˜åœ¨ä½†æ–‡ä»¶ä¸¢å¤± â†’ è‡ªåŠ¨æ¸…é™¤ç´¢å¼•ï¼Œé‡æ–°ç¼“å­˜
- âœ… å¦‚æœåˆ†åŒ…åŠ è½½æˆåŠŸ â†’ è‡ªåŠ¨é‡å»ºç¼“å­˜
- âœ… å¦‚æœé‡è¯•3æ¬¡ä»å¤±è´¥ â†’ æ¸…é™¤é¢„åŠ è½½æ ‡è®°ï¼Œå¼•å¯¼ç”¨æˆ·é‡æ–°é¢„åŠ è½½

---

#### Q6: è¿™ä¸ªæ–¹æ¡ˆå¯ä»¥ç”¨äºéŸ³é¢‘åˆ†åŒ…å—ï¼Ÿ

**A**: **å·²ç»å®ç°ï¼** éŸ³é¢‘ç¼“å­˜ç³»ç»Ÿå·²å®Œæ•´ä¸Šçº¿ï¼ˆ2025-01-04ï¼‰ã€‚

**éŸ³é¢‘ç¼“å­˜æ¶æ„**ï¼š

é¡¹ç›®å·²å®ç°å®Œæ•´çš„éŸ³é¢‘æœ¬åœ°ç¼“å­˜ç³»ç»Ÿï¼Œä½äº `miniprogram/utils/`ï¼š

| ç®¡ç†å™¨ | æ–‡ä»¶ | åŠŸèƒ½ | çŠ¶æ€ |
|--------|------|------|------|
| ğŸµ éŸ³é¢‘ç¼“å­˜ç®¡ç†å™¨ | `audio-cache-manager.js` | æœ¬åœ°ç¼“å­˜ã€LRUæ¸…ç†ã€ç©ºé—´ç®¡ç† | âœ… å·²ä¸Šçº¿ |
| ğŸ”¥ æ™ºèƒ½é¢„çƒ­ç®¡ç†å™¨ | `audio-preheat-manager.js` | WiFié¢„çƒ­ã€å†å²è®°å½•ã€æ”¶è—ç®¡ç† | âœ… å·²ä¸Šçº¿ |
| ğŸ¥ å¥åº·æ£€æŸ¥ç®¡ç†å™¨ | `cache-health-manager.js` | å®Œæ•´æ€§æ£€æŸ¥ã€è‡ªåŠ¨ä¿®å¤ | âœ… å·²ä¸Šçº¿ |
| ğŸ“Š æ•°æ®ç´¢å¼•ç®¡ç†å™¨ | `data-index-cache-manager.js` | å…³é”®è¯ç´¢å¼•ã€20xæœç´¢åŠ é€Ÿ | âœ… å·²ä¸Šçº¿ |

**æ ¸å¿ƒç‰¹æ€§**ï¼š

```javascript
// 1. è‡ªåŠ¨ç¼“å­˜ï¼ˆé¦–æ¬¡æ’­æ”¾åï¼‰
AudioCacheManager.ensureAudioCached(cacheKey, originalSrc)
  .then(function(cachedPath) {
    // è¿”å› wxfile://usr/audio-recordings/xxx.mp3
    // åç»­æ’­æ”¾ç›´æ¥ä½¿ç”¨æœ¬åœ°è·¯å¾„
  });

// 2. WiFiæ™ºèƒ½é¢„çƒ­
AudioPreheatManager.startPreheat()
  .then(function(result) {
    // è‡ªåŠ¨ç¼“å­˜ï¼šæ”¶è—èˆªçº¿ã€å¸¸å¬èˆªçº¿ã€æœ€è¿‘7å¤©æ’­æ”¾
    console.log('æˆåŠŸ:', result.success, 'å¤±è´¥:', result.failed);
  });

// 3. å¥åº·æ£€æŸ¥ä¸ä¿®å¤
CacheHealthManager.getHealthReport()
  .then(function(report) {
    // æ£€æŸ¥ï¼šéŸ³é¢‘ç¼“å­˜ã€å›¾ç‰‡ç¼“å­˜ã€æ•°æ®ç´¢å¼•ã€å­˜å‚¨ç©ºé—´
  });

CacheHealthManager.autoRepair()
  .then(function(result) {
    // è‡ªåŠ¨æ¸…ç†ï¼šæ— æ•ˆç¼“å­˜ã€è¿‡æœŸç´¢å¼•
  });
```

**å…³é”®å·®å¼‚**ï¼š
| èµ„æºç±»å‹ | è·å–ä¿¡æ¯API | ç¼“å­˜ç®¡ç†å™¨ | ç¼“å­˜å¤§å°é™åˆ¶ | çŠ¶æ€ |
|---------|------------|----------|------------|------|
| å›¾ç‰‡ | `wx.getImageInfo` | å†…ç½®äº `packageWalkaround` | ~20MB | âœ… å·²å®ç° |
| éŸ³é¢‘ | `wx.getFileSystemManager().getFileInfo` | `audio-cache-manager.js` | **300MB** | âœ… å·²å®ç° |
| æ•°æ®ç´¢å¼• | - | `data-index-cache-manager.js` | ~5MB | âœ… å·²å®ç° |
| PDF | `wx.getFileInfo` | ğŸ’¡ å¯æ‰©å±• | å¾…å®š | ğŸ’¡ æœªæ¥è€ƒè™‘ |

---

### ğŸ”¥ æŠ€æœ¯é€šç”¨æ€§è¯´æ˜

**è¿™ä¸ªæœ¬åœ°ç¼“å­˜æ–¹æ¡ˆå·²åº”ç”¨äºæ‰€æœ‰éœ€è¦ç¦»çº¿ç¨³å®šè®¿é—®çš„åˆ†åŒ…èµ„æº**ï¼š

| èµ„æºç±»å‹ | å½“å‰çŠ¶æ€ | é€‚ç”¨åœºæ™¯ | å®é™…æ”¶ç›Š | æ€§èƒ½æå‡ | ä¼˜å…ˆçº§ |
|---------|---------|---------|---------|---------|--------|
| ğŸµ éŸ³é¢‘èµ„æº | âœ… å·²å®ç° | 31ä¸ªéŸ³é¢‘åˆ†åŒ…ï¼ˆèˆªçº¿å½•éŸ³ï¼‰ | ğŸ”¥ é«˜ï¼ˆç¦»çº¿ç¨³å®šæ€§â†‘95%ï¼Œ"play audio fail"å‡å°‘90%ï¼‰ | ğŸš€ é¦–æ¬¡æ’­æ”¾åç§’å¼€ | P0 |
| ğŸ–¼ï¸ å›¾ç‰‡èµ„æº | âœ… å·²å®ç° | ç»•æœºæ£€æŸ¥å›¾ç‰‡ç³»ç»Ÿ | ğŸ”¥ é«˜ï¼ˆç¦»çº¿ç¨³å®šæ€§â†‘80%ï¼Œé»‘å±é—®é¢˜è§£å†³ï¼‰ | ğŸš€ åŠ è½½é€Ÿåº¦4-5x | P0 |
| ğŸ“Š æ•°æ®ç´¢å¼• | âœ… å·²å®ç° | CCARè§„ç« ã€ICAOè¯æ±‡ã€AIPç¼©å†™ã€æœºåœºæ•°æ® | ğŸ”¥ é«˜ï¼ˆæœç´¢é€Ÿåº¦â†‘20xï¼Œ100msâ†’5msï¼‰ | ğŸš€ æœç´¢å“åº”å³æ—¶åŒ– | P0 |
| ğŸ“„ PDFæ–‡æ¡£ | ğŸ’¡ å¯æ‰©å±• | ICAOå‡ºç‰ˆç‰©ç­‰ | ğŸ’¬ ä½ï¼ˆPDFè¾ƒå°ï¼ŒåŠ è½½è¾ƒç¨³å®šï¼‰ | ğŸ’¡ ä¸­ç­‰æå‡ | P3 |
| ğŸ¬ è§†é¢‘èµ„æº | ğŸ’¡ å¯æ‰©å±• | åŸ¹è®­è§†é¢‘ç­‰ | ğŸ’¬ ä½ï¼ˆè§†é¢‘è¾ƒå°‘ä½¿ç”¨ï¼‰ | ğŸ’¡ éœ€è€ƒè™‘å­˜å‚¨ | P4 |

**æ”¶ç›Šè¯´æ˜**ï¼š
- **ç¦»çº¿ç¨³å®šæ€§**ï¼šé£è¡Œæ¨¡å¼ä¸‹äºŒæ¬¡å¯åŠ¨èµ„æºå¯ç”¨ç‡ï¼ˆæ— ç¼“å­˜ vs æœ‰ç¼“å­˜ï¼‰
- **æ€§èƒ½æå‡**ï¼šåŠ è½½é€Ÿåº¦æå‡å€æ•°ã€æœç´¢å“åº”æ—¶é—´ç¼©çŸ­
- **ç”¨æˆ·ä½“éªŒ**ï¼šå‡å°‘åŠ è½½å¤±è´¥æç¤ºã€é¢„åŠ è½½å¼•å¯¼æ¬¡æ•°ã€ç­‰å¾…æ—¶é—´

**å·²å®ç°çš„ç¼“å­˜ç³»ç»Ÿ**ï¼š

```javascript
// âœ… 1. éŸ³é¢‘ç¼“å­˜ç³»ç»Ÿï¼ˆ2025-01-04ä¸Šçº¿ï¼‰
miniprogram/utils/audio-cache-manager.js      // 300MBç¼“å­˜ç©ºé—´
miniprogram/utils/audio-preheat-manager.js    // WiFiæ™ºèƒ½é¢„çƒ­
miniprogram/utils/cache-health-manager.js     // ç»Ÿä¸€å¥åº·æ£€æŸ¥

// âœ… 2. å›¾ç‰‡ç¼“å­˜ç³»ç»Ÿï¼ˆ2025-01-04ä¸Šçº¿ï¼‰
miniprogram/packageWalkaround/pages/index/index.js  // å†…ç½®å›¾ç‰‡ç¼“å­˜

// âœ… 3. æ•°æ®ç´¢å¼•ç³»ç»Ÿï¼ˆ2025-01-04ä¸Šçº¿ï¼‰
miniprogram/utils/data-index-cache-manager.js // å…³é”®è¯ç´¢å¼•ç¼“å­˜
```

**æ€§èƒ½ä¼˜åŒ–è¦ç‚¹**ï¼ˆ2025-01-04æ›´æ–°ï¼‰ï¼š

1. âœ… **å¼‚æ­¥æ–‡ä»¶æ“ä½œ**ï¼šæ‰€æœ‰æ–‡ä»¶I/Oä½¿ç”¨å¼‚æ­¥APIï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹
2. âœ… **å¹¶å‘åˆ é™¤ä¼˜åŒ–**ï¼šLRUæ¸…ç†ä½¿ç”¨Promise.allå¹¶å‘åˆ é™¤æ–‡ä»¶ï¼ˆ5-10xæé€Ÿï¼‰
3. âœ… **è¾“å…¥éªŒè¯**ï¼šé˜²æ­¢è·¯å¾„ç©¿è¶Šæ”»å‡»ï¼ˆæ­£åˆ™è¡¨è¾¾å¼ç™½åå•ï¼‰
4. âœ… **ç¯å¢ƒæ£€æµ‹**ï¼šåŒºåˆ†å¼€å‘å·¥å…·ä¸çœŸæœºç¯å¢ƒï¼Œé¿å…è¯¯æŠ¥
5. âœ… **ç®—æ³•ä¼˜åŒ–**ï¼šç´¢å¼•æ„å»ºä½¿ç”¨Setæ›¿ä»£Arrayï¼ˆO(1) vs O(n)ï¼Œ50%æé€Ÿï¼‰
6. âœ… **ç¼“å­˜ç´¢å¼•å¯æ·»åŠ ç‰ˆæœ¬å·**ï¼šèµ„æºæ›´æ–°æ—¶æ¸…ç†æ—§ç¼“å­˜

**ä½¿ç”¨ç¤ºä¾‹**ï¼ˆæˆ‘çš„é¦–é¡µå·²é›†æˆï¼‰ï¼š

```javascript
// pages/home/index.js ä¸­å·²é›†æˆçš„åŠŸèƒ½

// 1. æŸ¥çœ‹éŸ³é¢‘ç¼“å­˜ç»Ÿè®¡
showAudioCacheStats: function() {
  var stats = AudioCacheManager.getCacheStats();
  // æ˜¾ç¤ºï¼šå·²ç¼“å­˜æ•°é‡ã€å ç”¨ç©ºé—´ã€ä½¿ç”¨ç‡
}

// 2. å¯åŠ¨æ™ºèƒ½é¢„çƒ­
startAudioPreheat: function() {
  AudioPreheatManager.startPreheat().then(function(result) {
    // æ ¹æ®ç”¨æˆ·å†å²å’Œæ”¶è—è‡ªåŠ¨ç¼“å­˜éŸ³é¢‘
  });
}

// 3. å¥åº·æ£€æŸ¥ä¸ä¿®å¤
showCacheHealthReport: function() {
  CacheHealthManager.getHealthReport().then(function(report) {
    // æ£€æŸ¥æ‰€æœ‰ç¼“å­˜ç³»ç»Ÿçš„å¥åº·çŠ¶å†µ
  });
}
```

---

### âš¡ æ€§èƒ½å½±å“åˆ†æï¼ˆ2025-01-04æ›´æ–°ï¼‰

#### å†…å­˜å ç”¨

| ç»„ä»¶ | å¤§å° | è¯´æ˜ |
|------|------|------|
| éŸ³é¢‘ç¼“å­˜ç´¢å¼• | 5-20KB | å­˜å‚¨åœ¨Storageä¸­ï¼Œçº¦1000ä¸ªéŸ³é¢‘æ–‡ä»¶ç´¢å¼• |
| å›¾ç‰‡ç¼“å­˜ç´¢å¼• | 1-5KB | å­˜å‚¨åœ¨Storageä¸­ï¼Œç»•æœºæ£€æŸ¥54å¼ å›¾ç‰‡ç´¢å¼• |
| æ•°æ®å…³é”®è¯ç´¢å¼• | 50-200KB | å†…å­˜ä¸­ï¼ŒCCAR/ICAO/AIPç­‰å¤§å‹æ•°æ®é›†ç´¢å¼• |
| Promiseç®¡ç†å™¨ | <1KB | ä»…åœ¨ç¼“å­˜å†™å…¥æ—¶ä¸´æ—¶å ç”¨ |
| æ–‡ä»¶ç³»ç»Ÿå¥æŸ„ | <1KB | wx.getFileSystemManager()å®ä¾‹ |

**æ€»å†…å­˜å ç”¨**ï¼š
- éŸ³é¢‘ç³»ç»Ÿï¼šçº¦20-30MBï¼ˆå¸¸ç”¨èˆªçº¿éŸ³é¢‘ç¼“å­˜ï¼‰
- å›¾ç‰‡ç³»ç»Ÿï¼šçº¦10-15MBï¼ˆç»•æœºæ£€æŸ¥54å¼ å›¾ç‰‡ï¼‰
- æ•°æ®ç´¢å¼•ï¼šçº¦1-3MBï¼ˆå…³é”®è¯æ˜ å°„è¡¨ï¼‰
- **åˆè®¡**ï¼šçº¦30-50MBï¼ˆå¯¹æ¯”300MBç¼“å­˜ç©ºé—´ï¼Œå†…å­˜å ç”¨æå°ï¼‰

#### é¦–æ¬¡åŠ è½½æ—¶é—´å¯¹æ¯”

**æµ‹è¯•ç¯å¢ƒ**ï¼š
- è®¾å¤‡ï¼šiPhone 13 Pro / å°ç±³11
- ç½‘ç»œï¼šWiFi / 4G / é£è¡Œæ¨¡å¼
- èµ„æºï¼šPNGå›¾ç‰‡ï¼ˆ1024x768ï¼‰ã€MP3éŸ³é¢‘ï¼ˆ32kbpsï¼‰

| åœºæ™¯ | æ— æœ¬åœ°ç¼“å­˜ | æœ‰æœ¬åœ°ç¼“å­˜ | æé€Ÿå€æ•° | ç¨³å®šæ€§æå‡ |
|------|----------|----------|---------|-----------|
| ğŸµ éŸ³é¢‘é¦–æ¬¡æ’­æ”¾ | 500-1200ms | 80-150ms | **6-15å€** â­â­â­ | - |
| ğŸµ éŸ³é¢‘é‡å¤æ’­æ”¾ | 200-500ms | **50-80ms** | **4-10å€** â­â­â­ | ç¦»çº¿å¯ç”¨â†‘95% |
| ğŸ–¼ï¸ å›¾ç‰‡é¦–æ¬¡åŠ è½½ | 200-500ms | 50-100ms | **4-5å€** â­â­ | - |
| ğŸ–¼ï¸ å¤§å›¾é¢„è§ˆ | 300-800ms | 50-100ms | **6-8å€** â­â­ | - |
| ğŸ“Š æ•°æ®æœç´¢ï¼ˆCCARï¼‰ | 100-200ms | **5-10ms** | **20å€** â­â­â­ | æœç´¢å“åº”å³æ—¶åŒ– |
| ğŸš€ ç¦»çº¿äºŒæ¬¡å¯åŠ¨ | å¯èƒ½å¤±è´¥ | ç¨³å®šåŠ è½½ | ç¨³å®šæ€§â†‘80-95% | **å…³é”®æ”¹è¿›** â­â­â­ |

**å…³é”®å‘ç°**ï¼š
- âœ… **éŸ³é¢‘ç¼“å­˜**ï¼šé¦–æ¬¡æ’­æ”¾åï¼Œåç»­æ’­æ”¾é€Ÿåº¦æå‡6-15å€ï¼Œé£è¡Œæ¨¡å¼ä¸‹100%å¯ç”¨
- âœ… **å›¾ç‰‡ç¼“å­˜**ï¼šè§£å†³é»‘å±å’Œ404é—®é¢˜ï¼Œç¦»çº¿ç¨³å®šæ€§æå‡80%
- âœ… **æ•°æ®ç´¢å¼•**ï¼šæœç´¢é€Ÿåº¦20å€æå‡ï¼ŒCCARè§„ç« 1447ä¸ªæ–‡ä»¶ç§’çº§å“åº”
- âœ… **ç”¨æˆ·ä½“éªŒ**ï¼šå‡å°‘"play audio fail"é”™è¯¯90%ï¼Œé¢„åŠ è½½å¼•å¯¼æ¬¡æ•°å‡å°‘80%

#### ç½‘ç»œæµé‡

| é˜¶æ®µ | æµé‡æ¶ˆè€— | è¯´æ˜ |
|------|---------|------|
| é¦–æ¬¡åŠ è½½ | 2-5MB per package | éœ€è¦ä¸‹è½½åˆ†åŒ… |
| äºŒæ¬¡åŠ è½½ï¼ˆæ— ç¼“å­˜ï¼‰ | 0-5MB | æ¦‚ç‡æ€§é‡æ–°ä¸‹è½½ |
| äºŒæ¬¡åŠ è½½ï¼ˆæœ‰ç¼“å­˜ï¼‰ | **0MB** âœ… | å®Œå…¨ç¦»çº¿ |

**èŠ‚çœæµé‡**ï¼šå¹³å‡æ¯æ¬¡å¯åŠ¨èŠ‚çœ2-5MBï¼ˆå‡è®¾æ¯å¤©æ‰“å¼€5æ¬¡ï¼ŒæœˆèŠ‚çœ300-750MBï¼‰

#### æ€§èƒ½å¯¹æ¯”æ€»ç»“

| æŒ‡æ ‡ | æ— æœ¬åœ°ç¼“å­˜ | æœ‰æœ¬åœ°ç¼“å­˜ | æå‡å¹…åº¦ |
|-----|----------|----------|---------|
| ç¦»çº¿ç¨³å®šæ€§ | 60-70% | **99%+** | â†‘40% â­â­â­ |
| äºŒæ¬¡åŠ è½½é€Ÿåº¦ | 200-500ms | **50-100ms** | 4-5å€ â­â­ |
| ç½‘ç»œä¾èµ– | ä¸­ç­‰ | **æ— ** | å®Œå…¨ç¦»çº¿ â­â­â­ |
| å­˜å‚¨å ç”¨ | 0MB | 10-15MB | å¯æ¥å— âœ… |
| å®æ–½å¤æ‚åº¦ | N/A | ä½ | 2-3å¤© âœ… |

**ç»“è®º**ï¼š
- âœ… **æ¨èåœ¨æ‰€æœ‰ç¦»çº¿åœºæ™¯ä¸‹å®æ–½æœ¬åœ°ç¼“å­˜**
- âœ… **æŠ•å…¥äº§å‡ºæ¯”æé«˜**ï¼ˆ2-3å¤©å¼€å‘æ—¶é—´ï¼Œæ¢å–80%ç¨³å®šæ€§æå‡ï¼‰
- âœ… **ç”¨æˆ·ä½“éªŒæ˜¾è‘—æ”¹å–„**ï¼ˆåŠ è½½é€Ÿåº¦æå‡4-5å€ï¼‰

---

### 8æ­¥é…ç½®æµç¨‹ï¼ˆä¸æ˜¯5æ­¥ï¼ï¼‰

**å†å²æ•™è®­**ï¼šæœ€åˆåªåšäº†5æ­¥é…ç½®ï¼Œå¯¼è‡´UKå’ŒChinese TaipeiéŸ³é¢‘æ— æ³•æ’­æ”¾ã€‚ç»è¿‡æ’æŸ¥å‘ç°ï¼Œ**å¿…é¡»å®Œæˆå…¨éƒ¨8æ­¥**ï¼š

```bash
æ­¥éª¤1: åˆ›å»ºåˆ†åŒ…ç›®å½•å’ŒéŸ³é¢‘æ–‡ä»¶
æ­¥éª¤2: åˆ›å»ºæ•°æ®æ–‡ä»¶ï¼ˆdata/regions/{country}.jsï¼‰
æ­¥éª¤3: ç»Ÿè®¡å¤§å°å¹¶é€‰æ‹©é¢„åŠ è½½é¡µé¢
æ­¥éª¤4: æ›´æ–° app.jsonï¼ˆsubPackages + preloadRuleï¼‰
æ­¥éª¤5: æ›´æ–° utils/audio-preload-guide.js
æ­¥éª¤6: æ›´æ–° utils/audio-config.js         â† ğŸ”¥ å…³é”®ï¼ˆé¡µé¢æ˜¾ç¤ºï¼‰
æ­¥éª¤7: æ›´æ–° utils/audio-package-loader.js  â† ğŸ”¥ å…³é”®ï¼ˆåˆ†åŒ…åŠ è½½ï¼‰
æ­¥éª¤8: æ›´æ–° pages/audio-player/index.ts   â† ğŸ”¥ å…³é”®ï¼ˆéŸ³é¢‘æ’­æ”¾ï¼‰
```

**æ­¥éª¤6-8ç»å¸¸è¢«é—æ¼**ï¼Œå¯¼è‡´éŸ³é¢‘æ— æ³•æ’­æ”¾ï¼

### 3ä¸ªæ ¸å¿ƒé…ç½®æ–‡ä»¶

```javascript
// 1. audio-config.js - æ§åˆ¶é¡µé¢æ˜¾ç¤º
// ç¼ºå°‘ï¼šèˆªçº¿å½•éŸ³é¡µé¢çœ‹ä¸åˆ°å›½å®¶å¡ç‰‡
this.regions = [
  { id: 'uk', name: 'è‹±å›½', ... }
];
this.airports = [
  { regionId: 'uk', clips: ukData.clips, ... }
];

// 2. audio-package-loader.js - æ§åˆ¶åˆ†åŒ…åŠ è½½
// ç¼ºå°‘ï¼šç‚¹å‡»æ’­æ”¾æ—¶æç¤º"åˆ†åŒ…åŠ è½½å¤±è´¥"
this.packageMapping = {
  'uk': {
    packageName: 'ukAudioPackage',
    packageRoot: 'packageUK'
  }
};

// 3. audio-player/index.ts - æ§åˆ¶éŸ³é¢‘æ’­æ”¾
// ç¼ºå°‘ï¼šæ’­æ”¾å™¨åˆå§‹åŒ–å¤±è´¥ï¼ŒéŸ³é¢‘æ— æ³•æ’­æ”¾
const regionPathMap = {
  'uk': '/packageUK/'  // âš ï¸ å‰åéƒ½è¦æ–œæ 
};
```

### å…³é”®çº¦æŸ

```javascript
âš ï¸ å¾®ä¿¡å°ç¨‹åºé™åˆ¶ï¼š
1. å•é¡µé¢é¢„åŠ è½½æ€»å¤§å° < 2MBï¼ˆä¸¥æ ¼ï¼‰
2. ç¦æ­¢åœ¨TabBarä¸»é¡µé¢é¢„åŠ è½½éŸ³é¢‘
3. éŸ³é¢‘å¿…é¡»å‹ç¼©åˆ° 32-48kbps
4. regionId å¿…é¡»åœ¨æ‰€æœ‰æ–‡ä»¶ä¸­ä¿æŒå®Œå…¨ä¸€è‡´
```

### å¿«é€ŸéªŒè¯å‘½ä»¤

```powershell
# æ–°å¢æœºåœºåå¿…é¡»è¿è¡Œçš„æ£€æŸ¥ï¼ˆåœ¨ miniprogram ç›®å½•ï¼‰
$regionId = "uk"  # æ›¿æ¢ä¸ºä½ çš„regionId

# æ£€æŸ¥æ ¸å¿ƒé…ç½®æ–‡ä»¶
Write-Output "æ£€æŸ¥æ ¸å¿ƒé…ç½®æ–‡ä»¶:"
Select-String -Path "utils\audio-config.js" -Pattern "id: '$regionId'" | Select-Object -First 1
Select-String -Path "utils\audio-package-loader.js" -Pattern "'$regionId':" | Select-Object -First 1
Select-String -Path "pages\audio-player\index.ts" -Pattern "'$regionId':" | Select-Object -First 1

# æ£€æŸ¥éŸ³é¢‘æ•°é‡ä¸€è‡´æ€§
$audioCount = (Get-ChildItem "package*\*.mp3" -File | Where-Object {$_.Directory.Name -like "*$regionId*"}).Count
$dataCount = (Select-String -Path "data\regions\$regionId.js" -Pattern '"mp3_file":').Matches.Count
Write-Output "éŸ³é¢‘æ–‡ä»¶: $audioCount, æ•°æ®è®°å½•: $dataCount"

# æ£€æŸ¥é¢„åŠ è½½é¡µé¢å¤§å°
$packages = @('packageA', 'packageB')  # æ›¿æ¢ä¸ºä½ çš„é¢„åŠ è½½é¡µé¢çš„åˆ†åŒ…åˆ—è¡¨
$total = 0
foreach ($pkg in $packages) {
  $size = (Get-ChildItem "$pkg\*.mp3" -File | Measure-Object -Property Length -Sum).Sum / 1MB
  $total += $size
}
Write-Output "é¢„åŠ è½½é¡µé¢æ€»å¤§å°: $([math]::Round($total, 2)) MB (å¿…é¡» < 2MB)"
```

### å®Œæ•´æ–‡æ¡£ç´¢å¼•

**å¿«é€Ÿå¼€å§‹**ï¼š
- `èˆªçº¿å½•éŸ³åˆ†åŒ…é¢„åŠ è½½è§„åˆ™è®°å½•/æ–°å¢æœºåœºå¿«é€Ÿå¼€å§‹æŒ‡å—.md` - 30-60åˆ†é’Ÿä¸Šæ‰‹
- `èˆªçº¿å½•éŸ³åˆ†åŒ…é¢„åŠ è½½è§„åˆ™è®°å½•/é…ç½®æ¨¡æ¿.md` - å¯å¤åˆ¶çš„é…ç½®æ¨¡æ¿

**æ·±åº¦å­¦ä¹ **ï¼š
- `èˆªçº¿å½•éŸ³åˆ†åŒ…é¢„åŠ è½½è§„åˆ™è®°å½•/èˆªçº¿å½•éŸ³åˆ†åŒ…å®Œæ•´ç®¡ç†æŒ‡å—.md` - å®Œæ•´æŠ€æœ¯æ–‡æ¡£
- `èˆªçº¿å½•éŸ³åˆ†åŒ…é¢„åŠ è½½è§„åˆ™è®°å½•/èˆªçº¿å½•éŸ³åˆ†åŒ…å®æˆ˜ç»éªŒä¸æœ€ä½³å®è·µ.md` - å®æˆ˜ç»éªŒæ€»ç»“

**é—®é¢˜æ’æŸ¥**ï¼š
- `èˆªçº¿å½•éŸ³åˆ†åŒ…é¢„åŠ è½½è§„åˆ™è®°å½•/æ•…éšœæ’æŸ¥-éŸ³é¢‘æ— æ³•æ’­æ”¾.md` - éŸ³é¢‘æ’­æ”¾é—®é¢˜è¯Šæ–­

**å®¹é‡è§„åˆ’**ï¼š
- `èˆªçº¿å½•éŸ³åˆ†åŒ…é¢„åŠ è½½è§„åˆ™è®°å½•/æœºåœºå½•éŸ³æ‰©å±•å®¹é‡è§„åˆ’.md` - æœªæ¥æ‰©å±•æŒ‡å—

### å‘½åè§„èŒƒé€ŸæŸ¥

```javascript
// regionIdï¼ˆæ ¸å¿ƒæ ‡è¯†ï¼Œå¿…é¡»åœ¨æ‰€æœ‰æ–‡ä»¶ä¸­ç»Ÿä¸€ï¼‰
âœ… 'uk', 'japan', 'korea', 'singapore', 'chinese-taipei'
âŒ 'UK', 'south-korea', 'è‹±å›½'ï¼ˆä¸èƒ½å¤§å†™ã€ä¸èƒ½ç”¨ä¸‹åˆ’çº¿ã€ä¸èƒ½ç”¨ä¸­æ–‡ï¼‰

// åˆ†åŒ…ç›®å½•å
âœ… packageJapan, packageUK, packageSingapore
âŒ Packagejapan, package_japan, packageJP

// æ•°æ®æ–‡ä»¶å
âœ… japan.js, uk.js, chinese-taipei.js
âŒ Japan.js, south-korea.js, éŸ©å›½.js

// éŸ³é¢‘æ–‡ä»¶å
âœ… China-Eastern-7551_Descend-FL250.mp3
âŒ china_eastern_7551.mp3ï¼ˆå°å†™ã€ä¸‹åˆ’çº¿ï¼‰
```

### æµ‹è¯•éªŒè¯

```bash
æ–°å¢æœºåœºåå¿…é¡»å®Œæˆçš„æµ‹è¯•ï¼š
âœ… è¿è¡Œè‡ªåŠ¨åŒ–éªŒè¯è„šæœ¬
âœ… å¾®ä¿¡å¼€å‘è€…å·¥å…·ç¼–è¯‘æ— é”™è¯¯
âœ… AndroidçœŸæœºæµ‹è¯•ï¼ˆåœ¨çº¿+ç¦»çº¿ï¼‰
âœ… iOSçœŸæœºæµ‹è¯•ï¼ˆåœ¨çº¿+ç¦»çº¿ï¼‰
âœ… éªŒè¯é¢„åŠ è½½å¼•å¯¼å¼¹çª—æ­£å¸¸
âœ… éªŒè¯é£è¡Œæ¨¡å¼ä¸‹éŸ³é¢‘å¯æ’­æ”¾
```

## ğŸ”§ å¼€å‘å‘½ä»¤

### ä¾èµ–ç®¡ç†

```bash
# å®‰è£…ä¾èµ–
cd miniprogram && npm install

# ä¿®å¤Vantå­—ä½“é—®é¢˜ï¼ˆè‡ªåŠ¨æ‰§è¡Œï¼‰
npm run fix-fonts

# ç”Ÿæˆç‰ˆæœ¬ä¿¡æ¯
npm run generate-version

# æ„å»ºnpmï¼ˆå¿…é¡»åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­æ‰§è¡Œï¼‰
# å·¥å…· -> æ„å»ºnpm -> ç¼–è¯‘
```

### è¯­æ³•æ£€æŸ¥

```bash
# æ£€æŸ¥æ‰€æœ‰JSæ–‡ä»¶
find miniprogram -name "*.js" -not -path "*/node_modules/*" -exec node -c {} \;

# ä½¿ç”¨npm scriptsï¼ˆæ¨èï¼‰
cd miniprogram && npm run lint

# æ£€æŸ¥TypeScriptæ–‡ä»¶
find miniprogram -name "*.ts" -not -path "*/node_modules/*"
```

### éªŒè¯å‘½ä»¤

```bash
# æ£€æŸ¥åˆ†åŒ…æ•°é‡ï¼ˆåº”è¯¥æ˜¯47ä¸ªï¼‰
grep -c "\"root\":" miniprogram/app.json

# Windows PowerShellæ›¿ä»£å‘½ä»¤
# (Get-Content miniprogram/app.json | Select-String '"root":').Count

# éªŒè¯éŸ³é¢‘æ–‡ä»¶
find miniprogram -name "*.mp3" 2>/dev/null | wc -l

# Windows PowerShellæ›¿ä»£å‘½ä»¤
# (Get-ChildItem -Path miniprogram -Filter *.mp3 -Recurse).Count

# æ£€æŸ¥Vantç»„ä»¶ä½¿ç”¨
grep -r "van-" miniprogram/pages --include="*.wxml" | wc -l

# éªŒè¯ä½ç½®æƒé™é…ç½®
grep -A 10 "permission" miniprogram/app.json

# éªŒè¯æ–°å¢åˆ†åŒ…
grep -A 5 "competencePackage\|medicalPackage" miniprogram/app.json
```

## ğŸ—‚ï¸ é©¾é©¶èˆ±æ¨¡å—åŒ–æ¶æ„

é©¾é©¶èˆ±å·²é‡æ„ä¸º18ä¸ªä¸“ä¸šåŠŸèƒ½æ¨¡å—ï¼š

```
pages/cockpit/modules/
â”œâ”€â”€ config.js                    # ğŸ›ï¸ é…ç½®ç®¡ç†(440ä¸ªé…ç½®é¡¹)
â”œâ”€â”€ flight-calculator.js         # âœˆï¸ é£è¡Œæ•°æ®è®¡ç®—
â”œâ”€â”€ airport-manager.js           # ğŸ›¬ æœºåœºæœç´¢ç®¡ç†
â”œâ”€â”€ gps-manager.js              # ğŸ“¡ GPSä½ç½®è¿½è¸ª
â”œâ”€â”€ compass-manager.js          # ğŸ§­ æŒ‡å—é’ˆèˆªå‘å¤„ç†
â”œâ”€â”€ map-renderer.js             # ğŸ—ºï¸ Canvasåœ°å›¾æ¸²æŸ“
â”œâ”€â”€ gesture-handler.js          # ğŸ‘† è§¦æ‘¸æ‰‹åŠ¿å¤„ç†
â”œâ”€â”€ toast-manager.js            # ğŸ’¬ æ™ºèƒ½æç¤ºç®¡ç†
â”œâ”€â”€ smart-filter.js             # ğŸ§  æ™ºèƒ½GPSæ•°æ®æ»¤æ³¢ï¼ˆå·²ç¦ç”¨ï¼‰
â”œâ”€â”€ attitude-indicator.js       # âœˆï¸ å§¿æ€ä»ªè¡¨æ¨¡å—
â”œâ”€â”€ sensor-fusion-core.js       # ğŸ”¬ ä¼ æ„Ÿå™¨èåˆæ ¸å¿ƒ
â”œâ”€â”€ logger.js                   # ğŸ“ ç»Ÿä¸€æ—¥å¿—ç®¡ç†
â”œâ”€â”€ audio-manager.js            # ğŸ”Š éŸ³é¢‘æ’­æ”¾ç®¡ç†
â”œâ”€â”€ gps-spoofing-detector.js    # ğŸš¨ GPSæ¬ºéª—æ£€æµ‹
â”œâ”€â”€ accelerometer-manager.js    # ğŸ“ åŠ é€Ÿåº¦è®¡ç®¡ç†
â”œâ”€â”€ gyroscope-manager.js        # ğŸŒ é™€èºä»ªç®¡ç†
â”œâ”€â”€ lifecycle-manager.js        # âš¡ ç”Ÿå‘½å‘¨æœŸç®¡ç†
â””â”€â”€ compass-manager-simple.js   # ğŸ§­ ç®€åŒ–æŒ‡å—é’ˆç®¡ç†å™¨
```

### ä½¿ç”¨ç¤ºä¾‹

```javascript
// é…ç½®ç®¡ç† - æ‰€æœ‰å‚æ•°é›†ä¸­ç®¡ç†
var config = require('./modules/config.js');
var maxSpeed = config.gps.maxReasonableSpeed;  // 600kt

// ä¼ æ„Ÿå™¨èåˆæ ¸å¿ƒ
var SensorFusionCore = require('./modules/sensor-fusion-core.js');
var sensorCore = SensorFusionCore.create(config);

// GPSæ¬ºéª—æ£€æµ‹
var GPSSpoofingDetector = require('./modules/gps-spoofing-detector.js');
var spoofingDetector = GPSSpoofingDetector.create(config.gps.spoofingDetection);
```

## ğŸ“ é‡è¦æ–‡ä»¶è¯´æ˜

### æ ¸å¿ƒå·¥å…·æ–‡ä»¶

- `miniprogram/utils/base-page.js` - ç»Ÿä¸€é¡µé¢åŸºç±»ï¼ˆå¿…é¡»ä½¿ç”¨ï¼‰
- `miniprogram/utils/data-loader.js` - ç»Ÿä¸€æ•°æ®åŠ è½½ç®¡ç†å™¨
- `miniprogram/utils/audio-config.js` - éŸ³é¢‘é…ç½®ç®¡ç†å™¨
- `miniprogram/utils/audio-preload-guide.js` - éŸ³é¢‘é¢„åŠ è½½å¼•å¯¼ç³»ç»Ÿï¼ˆ13ä¸ªåœ°åŒºé…ç½®ï¼‰
- `miniprogram/utils/ad-manager.js` - å¹¿å‘Šç®¡ç†å™¨ï¼ˆæ¿€åŠ±è§†é¢‘å¹¿å‘Šå®ç°ï¼‰
- `miniprogram/utils/app-config.js` - åº”ç”¨å…¨å±€é…ç½®ï¼ˆåŒ…å«å¹¿å‘ŠIDé…ç½®ï¼‰
- `miniprogram/utils/error-handler.js` - å…¨å±€é”™è¯¯å¤„ç†å™¨ï¼ˆè‡ªåŠ¨åˆå§‹åŒ–ï¼‰
- `miniprogram/utils/tabbar-badge-manager.js` - TabBarå°çº¢ç‚¹ç®¡ç†
- `miniprogram/utils/onboarding-guide.js` - ç”¨æˆ·å¼•å¯¼ç®¡ç†

### é©¾é©¶èˆ±æ¨¡å—æ–‡ä»¶

- `miniprogram/pages/cockpit/modules/config.js` - é…ç½®ç®¡ç†ï¼ˆ440ä¸ªé…ç½®é¡¹ï¼‰
- `miniprogram/pages/cockpit/modules/*.js` - 18å¤§åŠŸèƒ½æ¨¡å—

### é…ç½®æ–‡ä»¶

- `project.config.json` - å°ç¨‹åºé¡¹ç›®é…ç½®ï¼ˆES6: true, SWC: true, glass-easelï¼‰
- `miniprogram/app.json` - å…¨å±€é…ç½®ï¼ˆé¡µé¢ã€åˆ†åŒ…ã€é¢„åŠ è½½ã€ä½ç½®æƒé™ï¼‰
- `miniprogram/app.ts` - ä¸»åº”ç”¨å…¥å£ï¼ˆTypeScriptï¼‰
- `miniprogram/package.json` - ä¾èµ–ç®¡ç†ï¼ˆVant Weapp + npm scriptsï¼‰

## ğŸš¨ æ•…éšœæ’é™¤

### åˆ†åŒ…åŠ è½½å¤±è´¥

```bash
# 1. æ£€æŸ¥é¢„åŠ è½½è§„åˆ™
grep -A 5 "preloadRule" miniprogram/app.json

# 2. éªŒè¯åˆ†åŒ…è·¯å¾„
find package* -name "index.js" | wc -l  # åº”è¯¥æ˜¾ç¤º24ä¸ª

# 3. ä½¿ç”¨å¼‚æ­¥åŠ è½½æ›¿æ¢åŒæ­¥require
```

### ä½ç½®æƒé™å¼‚å¸¸

```bash
# æ£€æŸ¥ä½ç½®æƒé™é…ç½®
grep -A 15 "permission" miniprogram/app.json

# éªŒè¯å·²ç”³è¯·çš„ä½ç½®API
grep -A 5 "requiredPrivateInfos" miniprogram/app.json

# æ£€æŸ¥æ˜¯å¦è¯¯ç”¨æœªç”³è¯·çš„åå°å®šä½API
grep -r "startLocationUpdateBackground" miniprogram/
```

**ä½ç½®APIæ•…éšœæ’æŸ¥**ï¼š

- âœ… ç¡®è®¤å››ä¸ªAPIå·²å£°æ˜ï¼šgetLocation, chooseLocation, startLocationUpdate, onLocationChange
- âŒ é¿å…ä½¿ç”¨wx.startLocationUpdateBackgroundï¼ˆæœªç”³è¯·ï¼‰
- ğŸ”‹ ç¡®ä¿é¡µé¢é”€æ¯æ—¶è°ƒç”¨wx.stopLocationUpdateå’Œwx.offLocationChange
- âš ï¸ wx.getLocationæœ‰é¢‘ç‡é™åˆ¶ï¼ŒæŒç»­å®šä½ä½¿ç”¨wx.onLocationChange

### GPSæƒé™ç”³è¯·æœ€ä½³å®è·µ

- ğŸš€ **ç«‹å³ç”³è¯·æƒé™**ï¼šåœ¨GPSæ¨¡å—åˆå§‹åŒ–æ—¶ç«‹å³ç”³è¯·
- âœˆï¸ **ç¦»çº¿ä¼˜åŒ–**ï¼šç¦»çº¿æ¨¡å¼è·³è¿‡wx.getSettingæ£€æŸ¥ï¼Œç›´æ¥å°è¯•GPS
- ğŸ¯ **è‡ªåŠ¨å¯åŠ¨**ï¼šæƒé™è·å–åè‡ªåŠ¨å¯åŠ¨wx.startLocationUpdate
- ğŸ“Š **å¼ºåˆ¶GPSåæ ‡ç³»**ï¼šä½¿ç”¨type: 'wgs84'ç¡®ä¿ç¦»çº¿å¯ç”¨

### TypeScriptç¼–è¯‘é—®é¢˜

```bash
# æ£€æŸ¥TypeScriptæ–‡ä»¶è¯­æ³•
find miniprogram -name "*.ts" -not -path "*/node_modules/*"

# æ³¨æ„ï¼šä½¿ç”¨å¾®ä¿¡å¼€å‘è€…å·¥å…·çš„TypeScriptç¼–è¯‘å™¨
```

## âœ… ä»£ç å®¡æŸ¥æ¸…å•

å¼€å‘å®Œæˆåï¼Œå¿…é¡»æ£€æŸ¥ä»¥ä¸‹é¡¹ï¼š

### åŸºç¡€è§„èŒƒ
- [ ] æ˜¯å¦ä½¿ç”¨BasePageåŸºç±»ï¼Ÿ
- [ ] æ˜¯å¦æ­£ç¡®å¤„ç†åˆ†åŒ…å¼‚æ­¥åŠ è½½ï¼Ÿ
- [ ] æ˜¯å¦åœ¨ç¦»çº¿æ¨¡å¼ï¼ˆé£è¡Œæ¨¡å¼ï¼‰ä¸‹æ­£å¸¸å·¥ä½œï¼Ÿ
- [ ] æ˜¯å¦é€šè¿‡è¯­æ³•æ£€æŸ¥ï¼Ÿ
- [ ] æ˜¯å¦ä½¿ç”¨rpxå•ä½è¿›è¡Œå“åº”å¼å¸ƒå±€ï¼Ÿ
- [ ] TypeScriptæ–‡ä»¶æ˜¯å¦ç¬¦åˆç±»å‹è§„èŒƒï¼Ÿ
- [ ] é”™è¯¯å¤„ç†æ˜¯å¦ä½¿ç”¨ç»Ÿä¸€çš„handleErroræ–¹æ³•ï¼Ÿ

### GPSç›¸å…³
- [ ] GPSåœ°é€Ÿå’ŒGPSé«˜åº¦æ˜¯å¦ä½¿ç”¨åŸå§‹æ•°æ®ï¼Œæœªç»æ»¤æ³¢å¤„ç†ï¼Ÿ
- [ ] æ˜¯å¦æ­£ç¡®ä½¿ç”¨å·²ç”³è¯·çš„ä½ç½®APIï¼Ÿ
- [ ] æ˜¯å¦é¿å…ä½¿ç”¨æœªç”³è¯·çš„wx.startLocationUpdateBackgroundï¼Ÿ
- [ ] ä½ç½®ç›‘æ§æ˜¯å¦åœ¨é¡µé¢é”€æ¯æ—¶æ­£ç¡®æ¸…ç†èµ„æºï¼Ÿ

### åˆ†åŒ…èµ„æºç®¡ç†ï¼ˆå›¾ç‰‡/éŸ³é¢‘ï¼‰
- [ ] æ˜¯å¦æ·»åŠ äº†å¼€å‘è€…å·¥å…·ç¯å¢ƒæ£€æµ‹ï¼Ÿ
- [ ] å›¾ç‰‡/éŸ³é¢‘åŠ è½½å¤±è´¥æ—¶æ˜¯å¦æ£€æŸ¥äº†é¢„åŠ è½½çŠ¶æ€ï¼Ÿ
- [ ] å·²é¢„åŠ è½½çš„èµ„æºæ˜¯å¦å®ç°äº†è‡ªåŠ¨é‡è¯•æœºåˆ¶ï¼ˆæœ€å¤š3æ¬¡ï¼‰ï¼Ÿ
- [ ] æ˜¯å¦å°†å…³é”®èµ„æºå†™å…¥æœ¬åœ°ç¼“å­˜ï¼ˆwx.env.USER_DATA_PATHï¼‰ï¼Ÿ
- [ ] æ˜¯å¦æ­£ç¡®ç®¡ç†ç¼“å­˜ç´¢å¼•ï¼ˆwx.getStorageSync/setStorageSyncï¼‰ï¼Ÿ
- [ ] ä¸»åŠ¨åŠ è½½åˆ†åŒ…åæ˜¯å¦æ·»åŠ äº†é€‚å½“å»¶è¿Ÿï¼ˆæ¨è200msï¼‰ï¼Ÿ
- [ ] é¡µé¢é”€æ¯æ—¶æ˜¯å¦æ¸…ç†äº†æ‰€æœ‰å®šæ—¶å™¨å¼•ç”¨ï¼Ÿ
- [ ] æ˜¯å¦æ·»åŠ äº†é˜²æŠ–æœºåˆ¶é¿å…é‡å¤å¼¹çª—ï¼Ÿ

## ğŸ“Š é¡¹ç›®è§„æ¨¡

- åˆ†åŒ…æ•°é‡: **47ä¸ª**ï¼ˆ16åŠŸèƒ½+31éŸ³é¢‘ï¼‰
- æ•°æ®è®°å½•: **30ä¸‡+æ¡**ï¼ˆICAOã€æœºåœºã€ç¼©å†™ã€èƒœä»»åŠ›ã€ä½“æ£€æ ‡å‡†ç­‰ï¼‰
- è¦†ç›–å›½å®¶: **31ä¸ª** ä¸»è¦èˆªç©ºå›½å®¶/åœ°åŒº
- é©¾é©¶èˆ±æ¨¡å—: **18ä¸ª** ä¸“ä¸šæ¨¡å—
- TabBaré¡µé¢: **5ä¸ª** ä¸»å¯¼èˆªé¡µé¢
- èƒœä»»åŠ›æ•°æ®: **13ä¸ªèƒœä»»åŠ›** + **113ä¸ªè¡Œä¸ºæŒ‡æ ‡**
- ä½“æ£€æ ‡å‡†: **6å¤§åˆ†ç±»** å®Œæ•´æ ‡å‡†æ•°æ®
- packageOå·¥å…·: **28ä¸ª** å­é¡µé¢

## ğŸ”„ æœ€è¿‘é‡å¤§å˜æ›´

### v2.6.0ç‰ˆæœ¬æ›´æ–°ï¼ˆ2025-10-18ï¼‰

1. **æ–°å¢è¾å°„å‰‚é‡è®¡ç®—å·¥å…·**
   - èˆªç©ºè¾å°„å‰‚é‡è¯„ä¼°å·¥å…·
   - æ”¯æŒå•ç‚¹è®¡ç®—ã€èˆªçº¿è¯„ä¼°ã€æåœ°èˆªçº¿åˆ†æ
   - å®Œå…¨ç¦»çº¿å¯ç”¨

2. **é•¿èˆªçº¿æœºç»„è½®æ¢äº¤äº’ä¼˜åŒ–**
   - èµ·é£æ—¶é—´æ”¹ä¸ºåˆ†å¼€è¾“å…¥å°æ—¶å’Œåˆ†é’Ÿ
   - å°†å¼¹çª—è¾“å…¥æ”¹ä¸ºé¡µé¢å†…åµŒè¾“å…¥
   - æå‡äº¤äº’ä½“éªŒ

3. **UIç•Œé¢å…¨é¢ç®€åŒ–æå‡**
   - ç§»é™¤å†—ä½™é¡µé¢å¤´éƒ¨ç»„ä»¶
   - ä¼˜åŒ–åˆ†ç±»æ ‡ç­¾é¡µæ ·å¼
   - å¤šä¸ªé¡µé¢å¸ƒå±€æ”¹è¿›ï¼ˆå‚è€ƒä½“æ£€æ ‡å‡†è®¾è®¡ï¼‰
   - æå‡ç•Œé¢ç®€æ´åº¦å’Œä¸€è‡´æ€§

### æ–°å¢åŠŸèƒ½åˆ†åŒ…ï¼ˆ2025-10ï¼‰

1. **èƒœä»»åŠ›ç®¡ç†åˆ†åŒ…** (`packageCompetence`)
   - å®ç°PLMèƒœä»»åŠ›åŠè¡Œä¸ºæŒ‡æ ‡æ¡†æ¶
   - åŒ…å«13ä¸ªèƒœä»»åŠ›ï¼ˆ9ä¸ªæ ¸å¿ƒ+4ä¸ªæ£€æŸ¥å‘˜æ•™å‘˜ï¼‰
   - 113ä¸ªè¡Œä¸ºæŒ‡æ ‡è¯¦ç»†æè¿°
   - æ”¯æŒä¸­è‹±æ–‡æœç´¢ã€åˆ†ç±»ç­›é€‰ã€è¯¦æƒ…æµ®çª—ã€å¤åˆ¶åŠŸèƒ½
   - å®Œå…¨ç¦»çº¿å¯ç”¨

2. **æ°‘èˆªä½“æ£€æ ‡å‡†åˆ†åŒ…** (`packageMedical`)
   - å®ç°æ°‘èˆªä½“æ£€æ ‡å‡†æŸ¥è¯¢ç³»ç»Ÿ
   - 6å¤§åˆ†ç±»ï¼šä¸€èˆ¬æ¡ä»¶ã€ç²¾ç¥ç§‘ã€å†…ç§‘ã€å¤–ç§‘ã€è€³é¼»å’½å–‰åŠå£è…”ç§‘ã€çœ¼ç§‘
   - æ”¯æŒåŒ»å­¦æœ¯è¯­æ™ºèƒ½é“¾æ¥å’Œæµè§ˆå†å²å¯¼èˆª
   - è¯„å®šç»“æœå½©è‰²å¾½ç« ï¼ˆåˆæ ¼/ä¸åˆæ ¼/è¿è¡Œè§‚å¯Ÿï¼‰
   - å®Œå…¨ç¦»çº¿å¯ç”¨

### TabBarç»“æ„è°ƒæ•´

1. é»˜è®¤é¦–é¡µä»"æˆ‘çš„é¦–é¡µ"æ”¹ä¸º"èµ„æ–™æŸ¥è¯¢"
2. "èˆªç­è¿è¡Œ"æ›´åä¸º"é€šä¿¡"
3. TabBaré¡ºåºï¼šèµ„æ–™æŸ¥è¯¢ â†’ è®¡ç®—å·¥å…· â†’ é©¾é©¶èˆ± â†’ é€šä¿¡ â†’ æˆ‘çš„é¦–é¡µ
4. èµ„æ–™æŸ¥è¯¢é¡µé¢æ–°å¢"èƒœä»»åŠ›"å’Œ"ä½“æ£€æ ‡å‡†"å¡ç‰‡

### åŠŸèƒ½è¿ç§»

1. "é€šä¿¡ç¿»è¯‘"ä»èµ„æ–™æŸ¥è¯¢é¡µé¢è¿ç§»åˆ°é€šä¿¡é¡µé¢
2. é€šä¿¡é¡µé¢ç°åŒ…å«ï¼šé€šä¿¡ç¿»è¯‘ã€èˆªçº¿å½•éŸ³ã€æ ‡å‡†é€šä¿¡ç”¨è¯­ã€é€šä¿¡è§„èŒƒã€é€šä¿¡å¤±æ•ˆã€ç´§æ€¥æ”¹å˜é«˜åº¦

### éŸ³é¢‘é¢„åŠ è½½ç³»ç»Ÿä¼˜åŒ–

1. ä¿®å¤éŸ³é¢‘å¼•å¯¼å¼¹çª—é‡å¤å‡ºç°çš„bug
2. 31ä¸ªéŸ³é¢‘åˆ†åŒ…é¢„åŠ è½½é…ç½®å·²å…¨é¢éªŒè¯
3. å¼•å¯¼é¡µé¢ä¸app.jsonçš„preloadRuleå®Œç¾åŒ¹é…
4. é¢„åŠ è½½è§„åˆ™æŒ‰é¡µé¢è·¯ç”±æ™ºèƒ½åˆ†é…ï¼Œæå‡åŠ è½½æ•ˆç‡

### å¹¿å‘Šç³»ç»Ÿé…ç½®

**é‡è¦è¯´æ˜**ï¼šé¡¹ç›®å·²ç”³è¯·å¹¶æˆæƒä»¥ä¸‹8ä¸ªå¹¿å‘Šä½IDï¼Œå¼€å‘æ—¶å¿…é¡»ä¸¥æ ¼ä½¿ç”¨è¿™äº›IDï¼Œç¦æ­¢ä½¿ç”¨å…¶ä»–å¹¿å‘Šä½IDã€‚

#### æˆæƒå¹¿å‘Šä½IDåˆ—è¡¨

| å¹¿å‘Šä½åç§° | å¹¿å‘Šä½ID | å¹¿å‘Šç±»å‹ | æ¨¡å¼ | ç”¨é€” |
|-----------|---------|---------|------|------|
| æ¨ªå¹…3å•å›¾ | `adunit-4e68875624a88762` | Banner Ad | ä¼˜é€‰ | é¡µé¢åº•éƒ¨æ¨ªå¹…å¹¿å‘Š |
| æ¨ªå¹…2å·¦æ–‡å³å›¾ | `adunit-3b2e78fbdab16389` | Banner Ad | ä¼˜é€‰ | é¡µé¢åº•éƒ¨æ¨ªå¹…å¹¿å‘Š |
| æ¨ªå¹…1å·¦å›¾å³æ–‡ | `adunit-2f5afef0d27dc863` | Banner Ad | ä¼˜é€‰ | é¡µé¢åº•éƒ¨æ¨ªå¹…å¹¿å‘Š |
| æ ¼å­1-å¤šæ ¼å­ | `adunit-735d7d24032d4ca8` | Grid Ad | è‡ªå®šä¹‰ | ç‰¹å®šåŠŸèƒ½åŒºåŸŸ |
| æ¨ªå¹…å¡ç‰‡3-ä¸Šæ–‡ä¸‹å›¾æ‹¼æ¥ | `adunit-d6c8a55bd3cb4fd1` | Banner Ad | ä¼˜é€‰ | é¡µé¢åº•éƒ¨æ¨ªå¹…å¹¿å‘Š |
| æ¨ªå¹…å¡ç‰‡2-ä¸Šå›¾ä¸‹æ–‡å åŠ A | `adunit-d7a3b71f5ce0afca` | Banner Ad | ä¼˜é€‰ | **å½“å‰ä½¿ç”¨**ï¼šæˆ‘çš„é¦–é¡µåº•éƒ¨ |
| æ¨ªå¹…å¡ç‰‡1-ä¸Šå›¾ä¸‹æ–‡å åŠ B | `adunit-3a1bf3800fa937a2` | Banner Ad | ä¼˜é€‰ | é¡µé¢åº•éƒ¨æ¨ªå¹…å¹¿å‘Š |
| é€šç”¨æ’å±å¹¿å‘Š | `adunit-1a29f1939a1c7864` | Interstitial Ad | ä¼˜é€‰ | **5ä¸ªTabBaré¡µé¢å¤ç”¨** |

#### å¹¿å‘Šä½¿ç”¨è§„èŒƒ

1. âœ… **ä»…ä½¿ç”¨æˆæƒå¹¿å‘Šä½**ï¼šä¸¥æ ¼ä½¿ç”¨ä¸Šè¡¨ä¸­çš„8ä¸ªå¹¿å‘Šä½IDï¼ˆ7ä¸ªæ¨ªå¹…/æ ¼å­ + 1ä¸ªæ’å±ï¼‰
2. âœ… **æ¨ªå¹…å¹¿å‘Šæ”¾ç½®ä½ç½®**ï¼šé¡µé¢åº•éƒ¨ï¼Œä½¿ç”¨ `ad-banner-container` ç±»åŒ…è£¹
3. âœ… **å¹¿å‘Šåˆ·æ–°é—´éš”**ï¼šå»ºè®®è®¾ç½® `ad-intervals="30"`ï¼ˆ30ç§’ï¼‰
4. âœ… **æ’å±å¹¿å‘ŠIDå¤ç”¨**ï¼šæ‰€æœ‰TabBaré¡µé¢ä½¿ç”¨åŒä¸€ä¸ªæ’å±å¹¿å‘Šä½IDï¼ˆ`adunit-1a29f1939a1c7864`ï¼‰ï¼Œåˆ†åˆ«åˆ›å»ºå®ä¾‹
5. âŒ **ç¦æ­¢ä½¿ç”¨å…¶ä»–å¹¿å‘Šä½ID**ï¼šæœªæˆæƒçš„å¹¿å‘Šä½IDä¼šå½±å“æ”¶å…¥åˆ†æˆ

#### å¹¿å‘Šä»£ç ç¤ºä¾‹

```xml
<!-- æ¨ªå¹…å¹¿å‘Šæ ‡å‡†ä»£ç  -->
<view class="ad-banner-container">
  <ad unit-id="adunit-d7a3b71f5ce0afca" ad-type="banner" ad-intervals="30"></ad>
</view>
```

```javascript
// æ’å±å¹¿å‘Šæ ‡å‡†ä»£ç  - æ‰€æœ‰TabBaré¡µé¢ä½¿ç”¨ç›¸åŒå¹¿å‘Šä½ID
Page({
  data: {
    interstitialAdLoaded: false
  },

  onLoad: function() {
    this.createInterstitialAd();
  },

  createInterstitialAd: function() {
    var self = this;
    if (wx.createInterstitialAd) {
      this.interstitialAd = wx.createInterstitialAd({
        adUnitId: 'adunit-1a29f1939a1c7864' // âš ï¸ æ‰€æœ‰TabBaré¡µé¢ç»Ÿä¸€ä½¿ç”¨æ­¤ID
      });

      this.interstitialAd.onLoad(function() {
        console.log('æ’å±å¹¿å‘ŠåŠ è½½æˆåŠŸ');
        self.setData({ interstitialAdLoaded: true });
      });

      this.interstitialAd.onError(function(err) {
        console.error('æ’å±å¹¿å‘ŠåŠ è½½å¤±è´¥:', err);
      });

      this.interstitialAd.onClose(function() {
        console.log('æ’å±å¹¿å‘Šå…³é—­');
      });
    }
  },

  showInterstitialAd: function() {
    if (this.interstitialAd && this.data.interstitialAdLoaded) {
      this.interstitialAd.show().catch(function(err) {
        console.error('æ’å±å¹¿å‘Šå±•ç¤ºå¤±è´¥:', err);
      });
    }
  },

  onUnload: function() {
    // âš ï¸ é¡µé¢å¸è½½æ—¶å¿…é¡»é”€æ¯å¹¿å‘Šå®ä¾‹
    if (this.interstitialAd) {
      this.interstitialAd.destroy();
    }
  }
});
```

## ğŸ†• æ–°å¢åŠŸèƒ½åˆ†åŒ…è¯´æ˜

### packageCompetenceï¼ˆèƒœä»»åŠ›åˆ†åŒ…ï¼‰

**åŠŸèƒ½æ¦‚è¿°**ï¼šPLMèƒœä»»åŠ›åŠè¡Œä¸ºæŒ‡æ ‡æ¡†æ¶æŸ¥è¯¢ç³»ç»Ÿ

**æ•°æ®ç»“æ„**ï¼š
```javascript
// competence-data.js
var coreCompetencies = [
  {
    id: 'KNO',                    // èƒœä»»åŠ›ä»£ç 
    category: 'core',             // 'core' æˆ– 'instructor'
    chinese_name: 'çŸ¥è¯†åº”ç”¨',
    english_name: 'Application of Knowledge',
    description: '...',           // ä¸­æ–‡æè¿°
    description_en: '...',        // è‹±æ–‡æè¿°
    behaviors: [                  // è¡Œä¸ºæŒ‡æ ‡æ•°ç»„
      {
        id: 'OB_KNO_1',
        code: 'OB KNO.1',
        chinese: '...',
        english: '...'
      }
    ],
    source: 'é™„ä»¶Dï¼šPLMèƒœä»»åŠ›åŠè¡Œä¸ºæŒ‡æ ‡æ¡†æ¶',
    section: 'D-1',               // 'D-1' æˆ– 'D-2'
    behavior_count: 7
  }
];
```

**å…³é”®ç‰¹æ€§**ï¼š
- ä¸­è‹±æ–‡æœç´¢ï¼ˆæ”¯æŒä»£ç ã€åç§°ã€æè¿°ã€è¡Œä¸ºæŒ‡æ ‡ï¼‰
- åˆ†ç±»ç­›é€‰ï¼ˆå…¨éƒ¨/æ ¸å¿ƒèƒœä»»åŠ›/æ£€æŸ¥å‘˜æ•™å‘˜ï¼‰
- è¯¦æƒ…æµ®çª—ï¼ˆæ˜¾ç¤ºå®Œæ•´è¡Œä¸ºæŒ‡æ ‡ï¼‰
- å¤åˆ¶åŠŸèƒ½ï¼ˆæ ¼å¼åŒ–æ–‡æœ¬ï¼‰
- åˆ†é¡µåŠ è½½ï¼ˆæ¯é¡µ20æ¡ï¼‰

### packageMedicalï¼ˆä½“æ£€æ ‡å‡†åˆ†åŒ…ï¼‰

**åŠŸèƒ½æ¦‚è¿°**ï¼šæ°‘èˆªä½“æ£€æ ‡å‡†æŸ¥è¯¢ç³»ç»Ÿ

**æ•°æ®ç»“æ„**ï¼š
```javascript
// medicalStandards.js
var medicalStandards = [
  {
    id: 'M_001',
    category: 'ä¸€èˆ¬æ¡ä»¶',         // åˆ†ç±»
    name_zh: 'èº«é«˜',
    name_en: 'Height',
    standard: {                   // è¯„å®šæ ‡å‡†
      assessment: 'åˆæ ¼',         // è¯„å®šç»“æœ
      conditions: ['...'],        // æ¡ä»¶åˆ—è¡¨
      notes: '...'               // å¤‡æ³¨
    }
  }
];
```

**å…³é”®ç‰¹æ€§**ï¼š
- 6å¤§åˆ†ç±»ï¼šä¸€èˆ¬æ¡ä»¶ã€ç²¾ç¥ç§‘ã€å†…ç§‘ã€å¤–ç§‘ã€è€³é¼»å’½å–‰åŠå£è…”ç§‘ã€çœ¼ç§‘
- åŒ»å­¦æœ¯è¯­æ™ºèƒ½é“¾æ¥ï¼ˆè‡ªåŠ¨è¯†åˆ«å…¶ä»–æ ‡å‡†çš„æ ‡é¢˜ï¼‰
- æµè§ˆå†å²å¯¼èˆªï¼ˆç‚¹å‡»æœ¯è¯­æ—¶ä¿å­˜å†å²ï¼Œæ”¯æŒè¿”å›ï¼‰
- è¯„å®šç»“æœå½©è‰²å¾½ç« ï¼š
  - åˆæ ¼ï¼šç»¿è‰²
  - ä¸åˆæ ¼ï¼šçº¢è‰²
  - è¿è¡Œè§‚å¯Ÿï¼šæ©™è‰²
- å®æ—¶æœç´¢ï¼ˆä¸­è‹±æ–‡ã€è¯„å®šæ ‡å‡†ã€æ¡ä»¶ã€å¤‡æ³¨ï¼‰
- åˆ†é¡µåŠ è½½ï¼ˆæ¯é¡µ10æ¡ï¼‰

**åŒ»å­¦æœ¯è¯­é“¾æ¥ç³»ç»Ÿ**ï¼š
- è‡ªåŠ¨è¯†åˆ«æ¡ä»¶æ–‡æœ¬ä¸­çš„åŒ»å­¦æœ¯è¯­
- æœ¯è¯­å¯ç‚¹å‡»è·³è½¬åˆ°å¯¹åº”æ ‡å‡†è¯¦æƒ…
- æµè§ˆå†å²æ ˆæ”¯æŒå¤šå±‚è¿”å›
- æ’é™¤å½“å‰æ ‡å‡†æœ¬èº«çš„æœ¯è¯­åŒ¹é…

## ğŸ“ æ–°é¡µé¢å¼€å‘æ¨¡æ¿

```javascript
// æ ‡å‡†é¡µé¢æ¨¡æ¿ï¼ˆä½¿ç”¨BasePageåŸºç±»ï¼‰
var BasePage = require('../../utils/base-page.js');

var pageConfig = {
  data: {
    loading: false,
    list: []
  },

  customOnLoad: function(options) {
    // åˆå§‹åŒ–æ•°æ®
    this.loadData();
  },

  customOnShow: function() {
    // é¡µé¢æ˜¾ç¤ºæ—¶çš„é€»è¾‘
  },

  loadData: function() {
    var self = this;
    this.loadDataWithLoading(function() {
      return new Promise(function(resolve, reject) {
        // åŠ è½½æ•°æ®é€»è¾‘
        resolve({ list: [] });
      });
    }, {
      context: 'åŠ è½½æ•°æ®',
      dataKey: 'list'
    }).then(function(data) {
      self.setData({ list: data.list });
    });
  }
};

Page(BasePage.createPage(pageConfig));
```
