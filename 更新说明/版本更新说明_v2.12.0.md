# FlightToolbox v2.12.0 版本更新说明

**发布日期**：2025-11-22

---

## ✈️ 本次更新概览

- 新增 **CCAR 规章与规范性文件中心**：支持按部号分类浏览、关键字搜索，并自动关联相关 AC/AP/IB/MH/T 等文件
- 新增 **「空勤灶」膳食指南分包**：面向民航空勤人员的膳食建议与示例食谱，支持搜索和分类浏览
- 优化 **法规数据管理与分类逻辑**：通过专用数据管理器统一抽象 CCAR 部号、分类和规范性文件关联关系
- 持续优化离线数据组织方式，为后续法规扩展和多语种支持打基础

---

## 🧭 CCAR 规章与规范性文件中心

### 核心功能

1. **规章快速总览**
   - 内置最新一批 CCAR 规章数据（约 300 条），包含标题、文号、有效性状态和官方链接
   - 按官方部号区间自动分类，例如：
     - 行政程序规则 (1–20 部)
     - 航空器 (21–59 部)
     - 航空人员 (60–70 部)
     - 空域/导航设施/空中交通规则 (71–120 部)
     - 民用航空企业合格审定及运行 (121–139 部)
     - …… 等 15 个大类

2. **一键查看同类法规**
   - 选中某一分类后，可一次性看到该类下所有现行/历史规章
   - 每个分类显示：
     - 规章数量统计
     - 相关规范性文件数量（咨询通告 AC、审定程序 AP、信息通告 IB、管理文件 MD、行业标准 MH/T 等）
     - 简要分类说明（方便记忆该类规章的适用范围）

3. **规章与规范性文件联动**
   - 根据文号自动提取 CCAR 部号（例如：CCAR-121-R8 → 121）
   - 通过统一算法，将以下几类文档自动归并到对应 CCAR 部：
     - CCAR 主规章（例如 CCAR-121-R8、CCAR-91-R4 等）
     - 咨询通告 AC-XX-…
     - 审定程序 AP-XX-…
     - 信息通告 IB-…-XX-…
     - 管理文件 MD-…-XX-…
     - 行业标准 MH/T XXX
   - 支持模糊匹配和多种写法（破折号、下划线、大小写）

4. **数据状态与有效性标记**
   - 对每条文档标注「有效 / 失效 / 废止」等状态，避免误用旧规章
   - 为后续按「当前有效规章」或「历史版本对比」过滤预留接口

### 使用入口

- 在 **「我的首页 → 搜索 / 工具」** 中，找到与 CCAR 相关的入口（例如“规章中心”/“CCAR 规章”）
- 进入后可以：
  - 按分类浏览 CCAR 部号
  - 从列表中进入具体规章详情页（当前以列表形式为主，官方原文通过链接在浏览器中打开）

### 用户能获得什么

- 飞行员、签派和教员可以在一个地方快速概览整个 CCAR 体系
- 快速确认某一 CCAR 部号对应哪类规章、是否仍然有效
- 为后续 P 章工具、执勤期计算等功能提供统一的法规入口

---

## 🥗 「空勤灶」膳食指南

### 核心功能

1. **按人群 / 场景分类**
   - 将膳食建议分为若干大类，例如：
     - 慢性病管理（高脂血、高血压、糖尿病等）
     - 机上配餐
     - 基础原则（通用健康饮食指导）
   - 页面顶部提供可横向滚动的标签栏，显示每类下的条目数量

2. **智能搜索**
   - 支持直接搜索中文关键字，例如：
     - “高脂血”、“高血压”、“糖尿病” 等疾病相关
     - “夜航”、“长航线” 等场景相关
   - 搜索范围覆盖：中文名称、英文名称、标签、分组名称、简要说明、关键词、核心要点等字段

3. **卡片式浏览体验**
   - 列表以卡片形式展示：
     - 中文名称 + 英文名称
     - 所属分组标签（例如「慢性病管理」）
     - 简要说明（核心饮食原则概览）
   - 支持分页加载，避免一次性加载全部数据造成卡顿

4. **详情弹窗**
   - 点击卡片后，从底部弹出「详情弹窗」：
     - 核心饮食要点列表（可快速浏览）
     - 示例食谱（按场景给出可直接参考的搭配）
     - 来源说明（依据的指南或文献）
   - 弹窗支持上下滑动浏览，顶部下拉可快速关闭

5. **无结果提示与引导**
   - 当搜索无匹配结果时：
     - 显示醒目的空状态图标与提示文字
     - 给出示例关键字（如“高血压”、“夜航”）引导用户重新搜索

### 使用入口

- 在「我的首页」工具区点击 **「空勤灶」** 卡片即可进入
- 支持从「分享」中将页面一键转发给同事

### 用户能获得什么

- 针对民航空勤人员的 **场景化膳食建议**（而不是泛泛而谈的健康科普）
- 更快地找到「我这种情况今天应该怎么吃」的具体建议
- 便于在航前、航后或驻外期间快速查阅

---

## 🛠 技术与数据层更新

### 1. CCAR 数据管理器（`utils/ccar-data-manager.js`）

- 新增专用 CCAR 数据管理器，用于：
  - 维护 CCAR 部号到分类名称的完整映射（1–400 部 + 若干特殊补充）
  - 从文号字符串中 **鲁棒地提取 CCAR 部号**，支持多种写法和字符变体
  - 统计每个分类下的规章数和规范性文件数
  - 为页面提供结构化的分类列表（含名称、数量、描述）
- 对外暴露的主要能力：
  - `generateCategories(regulationData, normativeData)`：生成分类汇总
  - `filterRegulationsByCategory(regulationData, category, subcategory)`：按分类过滤规章
  - `getNormativesByRegulation(docNumber, normativeData)`：根据规章自动关联相关 AC/AP/IB/MD/MH/T 文档

### 2. CCAR 数据文件与分包结构

- 新增 / 更新 `packageCCAR` 分包结构：
  - `regulation.js`：CCAR 规章主数据，包含标题、官方链接、有/失效状态与文号
  - `normative.js`：规范性文件数据（咨询通告、审定程序、信息通告、行业标准等）
  - `data-loader.js` / `search-manager.js` / `config.js` 等：负责数据加载、搜索与配置
- 在 `app.json` 中为 `packageCCAR` 配置独立分包，减少主包体积并支持按需加载
- 在通用数据层 `utils/data-manager.js` 中增加 CCAR 数据加载逻辑，统一纳入全局数据缓存

### 3. 空勤灶页面实现（`packageDiet/index.*`）

- 使用通用 `BasePage` 封装页面逻辑：
  - 统一处理生命周期、错误提示、分享等
- 本地加载 `dietGuides.js` 数据文件，支持：
  - 按分组构建分类统计（全部 / 慢性病管理 / 机上配餐 / 基础原则）
  - 实时搜索 + 分组过滤 + 关键字匹配
  - 分页加载和「点击加载更多」的轻量交互
- 通过 WXML + Vant 组件实现：
  - 顶部搜索栏 + 横向滚动分类标签
  - 列表卡片 + 详情弹窗
  - 空状态展示与加载中状态

---

## 🔄 与 v2.11.0 的差异总结

- v2.11.0：主要是 **版本信息与文档同步**，不引入新功能
- v2.12.0：
  - 新增两个 **面向飞行员日常工作的实用模块**：
    - CCAR 规章中心（法规侧）
    - 空勤灶膳食指南（健康管理侧）
  - 同时搭建了 CCAR 数据管理与规范性文件关联的技术基础

从对比角度看：

- v2.11.0 可以视为「缓存与版本信息修整」的收口版本
- v2.12.0 则是面向法规查询与健康支持的 **功能型大版本**，在不增加使用复杂度的前提下扩展了工具箱的边界

---

## ✅ 交付状态

- **功能状态**：已在开发工具与真机环境完成基础测试
- **数据状态**：
  - CCAR 数据基于 2025 年前后公开法规网页整理
  - 未来如有法规更新，将通过更新 `regulation.js` / `normative.js` 的方式迭代
- **已知限制**：
  - 当前版本以 **中文界面 + 官方链接** 为主，暂未引入多语言或全文离线阅读

---

如在使用 CCAR 规章中心或空勤灶过程中遇到问题，欢迎继续通过微信号 `wwingzero` 或公众号「飞行播客」反馈。
