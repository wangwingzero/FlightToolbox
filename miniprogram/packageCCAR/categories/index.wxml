<view class="container">
  <!-- æœç´¢æ  -->
  <view class="search-section">
    <van-search
      value="{{ searchKeyword }}"
      placeholder="æœç´¢è§„ç« æˆ–è§„èŒƒæ€§æ–‡ä»¶"
      use-action-slot
      bind:change="onSearchInput"
      bind:search="onSearchInput"
    >
      <view slot="action" class="search-action">æœç´¢</view>
    </van-search>
  </view>

  <!-- åˆ†ç±»æ ‡ç­¾ (éæœç´¢æ¨¡å¼æ—¶æ˜¾ç¤º) -->
  <view class="tabs-section" wx:if="{{ !isSearchMode }}">
    <van-tabs active="{{ currentTab }}" bind:change="onTabChange" sticky>
      <van-tab 
        wx:for="{{ tabs }}" 
        wx:key="*this" 
        title="{{ item }}"
        name="{{ index }}"
      />
    </van-tabs>
  </view>

  <!-- æœç´¢ç»“æœæ¨¡å¼ -->
  <view wx:if="{{ isSearchMode }}" class="search-results">
    <!-- è§„ç« æœç´¢ç»“æœ -->
    <view wx:if="{{ searchedRegulations.length > 0 }}" class="result-section">
      <view class="section-header">
        <view class="section-title">è§„ç«  ({{ searchedRegulations.length }}æ¡)</view>
      </view>
      <view class="result-list">
        <view 
          wx:for="{{ searchedRegulations }}" 
          wx:key="doc_number"
          class="result-item regulation-item" 
          bind:tap="onRegulationClick"
          data-regulation="{{ item }}"
        >
          <view class="item-main">
            <view class="item-title">{{ item.title }}</view>
            <view class="item-meta">
              <view class="meta-item">{{ item.doc_number }}</view>
              <view class="meta-item">{{ item.office_unit }}</view>
            </view>
          </view>
          <view class="item-arrow">
            <van-icon name="arrow" />
          </view>
        </view>
      </view>
    </view>

    <!-- è§„èŒƒæ€§æ–‡ä»¶æœç´¢ç»“æœ -->
    <view wx:if="{{ searchedNormatives.length > 0 }}" class="result-section">
      <view class="section-header">
        <view class="section-title">è§„èŒƒæ€§æ–‡ä»¶ ({{ searchedNormatives.length }}æ¡)</view>
      </view>
      <view class="result-list">
        <view 
          wx:for="{{ searchedNormatives }}" 
          wx:key="doc_number"
          class="result-item normative-item" 
          bind:tap="onNormativeClick"
          data-normative="{{ item }}"
        >
          <view class="item-main">
            <view class="item-title">{{ item.title }}</view>
            <view class="item-meta">
              <view class="meta-item">{{ item.doc_number }}</view>
              <view class="meta-item">{{ item.publish_date }}</view>
              <view class="meta-item">{{ item.office_unit }}</view>
            </view>
          </view>
          <view class="item-arrow">
            <van-icon name="info-o" />
          </view>
        </view>
      </view>
    </view>

    <!-- æ— æœç´¢ç»“æœ -->
    <view wx:if="{{ searchedRegulations.length === 0 && searchedNormatives.length === 0 }}" class="empty-state">
      <view class="empty-icon">ğŸ”</view>
      <view class="empty-text">æœªæ‰¾åˆ°ç›¸å…³å†…å®¹</view>
      <view class="empty-hint">è¯·å°è¯•å…¶ä»–æœç´¢å…³é”®è¯</view>
    </view>
  </view>

  <!-- åˆ†ç±»åˆ—è¡¨æ¨¡å¼ -->
  <view wx:if="{{ !isSearchMode }}" class="categories-content">
    <view wx:if="{{ filteredCategories.length === 0 && !loading }}" class="empty-state">
      <view class="empty-icon">ğŸ“‹</view>
      <view class="empty-text">æš‚æ— ç›¸å…³è§„ç« åˆ†ç±»</view>
      <view class="empty-hint">å°è¯•æ›´æ¢æœç´¢å…³é”®è¯æˆ–åˆ†ç±»</view>
    </view>

    <view wx:else class="categories-list">
      <view 
        wx:for="{{ filteredCategories }}" 
        wx:key="name"
        class="category-item" 
        bind:tap="onCategoryClick"
        data-category="{{ item }}"
      >
        <view class="category-main">
          <view class="category-name">{{ item.name }}</view>
          <view class="category-category">{{ item.category }}</view>
        </view>
        <view class="category-stats">
          <view class="stat-item">
            <view class="stat-number">{{ item.regulationCount }}</view>
            <view class="stat-label">è§„ç« </view>
          </view>
          <view class="stat-item">
            <view class="stat-number">{{ item.normativeCount }}</view>
            <view class="stat-label">æ–‡ä»¶</view>
          </view>
        </view>
        <view class="category-arrow">
          <van-icon name="arrow" />
        </view>
      </view>
    </view>
  </view>

  <!-- ç»Ÿè®¡ä¿¡æ¯ -->
  <view class="stats-footer" wx:if="{{ !isSearchMode }}">
    <view class="stats-text">
      å…± {{ categories.length }} ä¸ªåˆ†ç±»ï¼Œ{{ regulationData.length }} ä¸ªè§„ç« ï¼Œ{{ normativeData.length }} ä¸ªè§„èŒƒæ€§æ–‡ä»¶
    </view>
  </view>
</view>

<van-toast id="van-toast" />