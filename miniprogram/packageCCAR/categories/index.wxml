<view class="container">
  <!-- ç°ä»£åŒ–æœç´¢åŒºåŸŸ -->
  <view class="search-section">
    <view class="search-container">
      <view class="ccar-search">
        <van-search
          value="{{ searchKeyword }}"
          placeholder="æœç´¢è§„ç« æˆ–è§„èŒƒæ€§æ–‡ä»¶"
          bind:input="onSearchInput"
          bind:change="onSearchInput"
          show-action="{{ false }}"
        />
      </view>
      
      <!-- æœ‰æ•ˆæ€§ç­›é€‰æŒ‰é’® -->
      <view class="validity-filter">
        <view 
          class="filter-btn {{ validityFilter === 'all' ? 'active' : '' }}"
          bind:tap="onValidityFilterChange"
          data-filter="all"
        >
          <view class="filter-icon">ğŸ“‹</view>
          <view class="filter-text">å…¨éƒ¨</view>
        </view>
        <view 
          class="filter-btn {{ validityFilter === 'valid' ? 'active' : '' }}"
          bind:tap="onValidityFilterChange"
          data-filter="valid"
        >
          <view class="filter-icon">âœ…</view>
          <view class="filter-text">æœ‰æ•ˆ</view>
        </view>
        <view 
          class="filter-btn {{ validityFilter === 'invalid' ? 'active' : '' }}"
          bind:tap="onValidityFilterChange"
          data-filter="invalid"
        >
          <view class="filter-icon">âŒ</view>
          <view class="filter-text">å¤±æ•ˆ</view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç°ä»£åŒ–åˆ†ç±»æ ‡ç­¾ (éæœç´¢æ¨¡å¼æ—¶æ˜¾ç¤º) -->
  <view class="modern-tabs-container" wx:if="{{ !isSearchMode }}">
    <view class="tabs-scroll">
      <view class="tabs-wrapper">
        <view 
          wx:for="{{ tabs }}" 
          wx:key="*this"
          class="modern-tab {{ currentTab === index ? 'active' : '' }}"
          bind:tap="onTabChange"
          data-index="{{ index }}"
        >
          <view class="tab-content">
            <view class="tab-title">{{ item }}</view>
            <view wx:if="{{ currentTab === index }}" class="tab-indicator"></view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æœç´¢ç»“æœæ¨¡å¼ -->
  <view wx:if="{{ isSearchMode }}" class="search-results">
    <!-- è§„ç« æœç´¢ç»“æœ -->
    <view wx:if="{{ searchedRegulations.length > 0 }}" class="result-section">
      <view class="section-header">
        <view class="section-title">
          <view class="section-icon">ğŸ“‹</view>
          <view class="section-text">è§„ç«  ({{ searchedRegulations.length }}æ¡)</view>
        </view>
      </view>
      <view class="modern-result-list">
        <view 
          wx:for="{{ searchedRegulations }}" 
          wx:key="doc_number"
          class="modern-result-card regulation-card" 
          bind:tap="onRegulationClick"
          data-regulation="{{ item }}"
        >
          <view class="card-main">
            <view class="card-title">{{ item.title }}</view>
            <view class="card-meta">
              <view class="meta-badge primary">{{ item.doc_number }}</view>
              <view class="meta-badge secondary">{{ item.office_unit }}</view>
              <view class="meta-badge validity {{ item.validity === 'æœ‰æ•ˆ' ? 'valid' : 'invalid' }}">{{ item.validity }}</view>
            </view>
          </view>
          <view class="card-arrow">
            <van-icon name="arrow" />
          </view>
        </view>
      </view>
    </view>

    <!-- è§„èŒƒæ€§æ–‡ä»¶æœç´¢ç»“æœ -->
    <view wx:if="{{ searchedNormatives.length > 0 }}" class="result-section">
      <view class="section-header">
        <view class="section-title">
          <view class="section-icon">ğŸ“„</view>
          <view class="section-text">è§„èŒƒæ€§æ–‡ä»¶ ({{ searchedNormatives.length }}æ¡)</view>
        </view>
      </view>
      <view class="modern-result-list">
        <view 
          wx:for="{{ searchedNormatives }}" 
          wx:key="doc_number"
          class="modern-result-card normative-card" 
          bind:tap="onNormativeClick"
          data-normative="{{ item }}"
        >
          <view class="card-main">
            <view class="card-title">{{ item.title }}</view>
            <view class="card-meta">
              <view class="meta-badge primary">{{ item.doc_number }}</view>
              <view class="meta-badge date">{{ item.publish_date }}</view>
              <view class="meta-badge secondary">{{ item.office_unit }}</view>
              <view class="meta-badge validity {{ item.validity === 'æœ‰æ•ˆ' ? 'valid' : 'invalid' }}">{{ item.validity }}</view>
            </view>
          </view>
          <view class="card-arrow">
            <van-icon name="info-o" />
          </view>
        </view>
      </view>
    </view>

    <!-- æ— æœç´¢ç»“æœ -->
    <view wx:if="{{ searchedRegulations.length === 0 && searchedNormatives.length === 0 }}" class="modern-empty-state">
      <view class="empty-icon">ğŸ”</view>
      <view class="empty-text">æœªæ‰¾åˆ°ç›¸å…³å†…å®¹</view>
      <view class="empty-hint">è¯·å°è¯•å…¶ä»–æœç´¢å…³é”®è¯</view>
    </view>
  </view>

  <!-- åˆ†ç±»åˆ—è¡¨æ¨¡å¼ -->
  <view wx:if="{{ !isSearchMode }}" class="categories-content">
    <view wx:if="{{ filteredCategories.length === 0 && !loading }}" class="modern-empty-state">
      <view class="empty-icon">ğŸ“‹</view>
      <view class="empty-text">æš‚æ— ç›¸å…³è§„ç« åˆ†ç±»</view>
      <view class="empty-hint">å°è¯•æ›´æ¢æœç´¢å…³é”®è¯æˆ–åˆ†ç±»</view>
    </view>

    <view wx:else class="modern-categories-list">
      <view 
        wx:for="{{ filteredCategories }}" 
        wx:key="name"
        class="modern-category-card" 
        bind:tap="onCategoryClick"
        data-category="{{ item }}"
      >
        <view class="category-header">
          <view class="category-name">{{ item.name }}</view>
          <view class="category-badge">{{ item.category }}</view>
        </view>
        
        <view class="category-stats">
          <view class="stat-card regulation-stat">
            <view class="stat-number">{{ item.regulationCount }}</view>
            <view class="stat-label">è§„ç« </view>
          </view>
          <view class="stat-card normative-stat">
            <view class="stat-number">{{ item.normativeCount }}</view>
            <view class="stat-label">æ–‡ä»¶</view>
          </view>
        </view>
        
        <view class="category-arrow">
          <van-icon name="arrow" />
        </view>
      </view>
    </view>
  </view>

  <!-- ç»Ÿè®¡ä¿¡æ¯ -->
  <view class="modern-stats-footer" wx:if="{{ !isSearchMode }}">
    <view class="stats-container">
      <view class="stats-item">
        <view class="stats-number">{{ categories.length }}</view>
        <view class="stats-label">ä¸ªåˆ†ç±»</view>
      </view>
      <view class="stats-divider"></view>
      <view class="stats-item">
        <view class="stats-number">{{ regulationData.length }}</view>
        <view class="stats-label">ä¸ªè§„ç« </view>
      </view>
      <view class="stats-divider"></view>
      <view class="stats-item">
        <view class="stats-number">{{ normativeData.length }}</view>
        <view class="stats-label">ä¸ªæ–‡ä»¶</view>
      </view>
    </view>
  </view>
</view>

<van-toast id="van-toast" />