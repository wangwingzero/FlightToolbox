<view class="container">
  <!-- é¡¶éƒ¨æœ‰æ•ˆæ€§ç­›é€‰æ ‡ç­¾ -->
  <view class="modern-tabs-container">
    <view class="tabs-wrapper">
      <view 
        class="modern-tab {{ validityFilter === 'all' ? 'active' : '' }}"
        bind:tap="onValidityFilterChange"
        data-filter="all"
      >
        <view class="tab-content">
          <view class="tab-icon">ğŸ“‹</view>
          <view class="tab-title">å…¨éƒ¨</view>
          <view class="tab-count">{{ (regulationData.length || 0) + (normativeData.length || 0) }}</view>
        </view>
        <view class="tab-indicator" wx:if="{{ validityFilter === 'all' }}"></view>
      </view>
      <view 
        class="modern-tab {{ validityFilter === 'valid' ? 'active' : '' }}"
        bind:tap="onValidityFilterChange"
        data-filter="valid"
      >
        <view class="tab-content">
          <view class="tab-icon">âœ…</view>
          <view class="tab-title">æœ‰æ•ˆ</view>
          <view class="tab-count">{{ validRegulationsCount + validNormativesCount }}</view>
        </view>
        <view class="tab-indicator" wx:if="{{ validityFilter === 'valid' }}"></view>
      </view>
      <view 
        class="modern-tab {{ validityFilter === 'invalid' ? 'active' : '' }}"
        bind:tap="onValidityFilterChange"
        data-filter="invalid"
      >
        <view class="tab-content">
          <view class="tab-icon">âŒ</view>
          <view class="tab-title">å¤±æ•ˆ</view>
          <view class="tab-count">{{ invalidRegulationsCount + invalidNormativesCount }}</view>
        </view>
        <view class="tab-indicator" wx:if="{{ validityFilter === 'invalid' }}"></view>
      </view>
    </view>
  </view>

  <!-- ç°ä»£åŒ–æœç´¢åŒºåŸŸ -->
  <view class="search-section">
    <view class="search-container">
      <view class="search-input-wrapper">
        <view class="search-icon">ğŸ”</view>
        <van-search
          value="{{ searchKeyword }}"
          placeholder="æœç´¢è§„ç« æˆ–è§„èŒƒæ€§æ–‡ä»¶"
          bind:input="onSearchInput"
          bind:change="onSearchInput"
          show-action="{{ false }}"
          class="ccar-search"
        />
      </view>
    </view>
  </view>

  <!-- æ¨ªå¹…å¹¿å‘Š -->
  <view class="ad-banner-container">
    <ad-custom unit-id="adunit-4e68875624a88762" bindload="adLoad" binderror="adError" bindclose="adClose"></ad-custom>
  </view>

  <!-- åˆ†ç±»æ ‡ç­¾é¡µå·²åˆ é™¤ -->

  <!-- æœç´¢ç»“æœæ¨¡å¼ -->
  <view wx:if="{{ isSearchMode }}" class="search-results">
    <!-- è§„ç« æœç´¢ç»“æœ -->
    <view wx:if="{{ searchedRegulations.length > 0 }}" class="result-section">
      <view class="section-header">
        <view class="section-title">
          <view class="section-icon">ğŸ“‹</view>
          <view class="section-text">è§„ç«  ({{ searchedRegulations.length }}æ¡)</view>
        </view>
      </view>
      <view class="modern-result-list">
        <block wx:for="{{ searchedRegulations }}" wx:key="doc_number" wx:for-index="idx">
          <view 
            class="modern-result-card regulation-card" 
            bind:tap="onRegulationClick"
            data-regulation="{{ item }}"
          >
          <!-- å³ä¸Šè§’æœ‰æ•ˆæ€§çŠ¶æ€æ ‡ç­¾ -->
          <view class="validity-badge {{ item.validity === 'æœ‰æ•ˆ' ? 'valid' : (item.validity === 'åºŸæ­¢' ? 'abolished' : 'invalid') }}">{{ item.validity }}</view>
          
          <view class="card-main">
            <view class="card-title">{{ item.title }}</view>
            <view class="card-meta">
              <view class="meta-badge primary">{{ item.doc_number }}</view>
              <view class="meta-badge secondary">{{ item.office_unit }}</view>
            </view>
          </view>
          
          <view class="card-arrow">
            <van-icon name="arrow" />
          </view>
          </view>
          
          <!-- åœ¨ç¬¬10ä¸ªé¡¹ç›®åæ’å…¥å¹¿å‘Š -->
          <view wx:if="{{ (idx + 1) % 10 === 0 && idx < searchedRegulations.length - 1 }}" class="ad-container list-ad">
            <ad-custom unit-id="adunit-735d7d24032d4ca8" bindload="adLoad" binderror="adError" bindclose="adClose"></ad-custom>
          </view>
        </block>
      </view>
    </view>

    <!-- è§„èŒƒæ€§æ–‡ä»¶æœç´¢ç»“æœ -->
    <view wx:if="{{ searchedNormatives.length > 0 }}" class="result-section">
      <view class="section-header">
        <view class="section-title">
          <view class="section-icon">ğŸ“„</view>
          <view class="section-text">è§„èŒƒæ€§æ–‡ä»¶ ({{ searchedNormatives.length }}æ¡)</view>
        </view>
      </view>
      <view class="modern-result-list">
        <block wx:for="{{ searchedNormatives }}" wx:key="doc_number" wx:for-index="idx">
          <view 
            class="modern-result-card normative-card" 
            bind:tap="onNormativeClick"
            data-normative="{{ item }}"
          >
          <!-- å³ä¸Šè§’æœ‰æ•ˆæ€§çŠ¶æ€æ ‡ç­¾ -->
          <view class="validity-badge {{ item.validity === 'æœ‰æ•ˆ' ? 'valid' : (item.validity === 'åºŸæ­¢' ? 'abolished' : 'invalid') }}">{{ item.validity }}</view>
          
          <view class="card-main">
            <view class="card-title">{{ item.title }}</view>
            <view class="card-meta">
              <view class="meta-badge primary">{{ item.doc_number }}</view>
              <view class="meta-badge date">{{ item.publish_date }}</view>
              <view class="meta-badge secondary">{{ item.office_unit }}</view>
            </view>
          </view>
          
          <view class="card-arrow">
            <van-icon name="info-o" />
          </view>
          </view>
          
          <!-- åœ¨ç¬¬10ä¸ªé¡¹ç›®åæ’å…¥å¹¿å‘Š -->
          <view wx:if="{{ (idx + 1) % 10 === 0 && idx < searchedNormatives.length - 1 }}" class="ad-container list-ad">
            <ad-custom unit-id="adunit-735d7d24032d4ca8" bindload="adLoad" binderror="adError" bindclose="adClose"></ad-custom>
          </view>
        </block>
      </view>
    </view>

    <!-- æ— æœç´¢ç»“æœ -->
    <view wx:if="{{ searchedRegulations.length === 0 && searchedNormatives.length === 0 }}" class="modern-empty-state">
      <view class="empty-icon">ğŸ”</view>
      <view class="empty-text">æœªæ‰¾åˆ°ç›¸å…³å†…å®¹</view>
      <view class="empty-hint">è¯·å°è¯•å…¶ä»–æœç´¢å…³é”®è¯</view>
    </view>
  </view>

  <!-- åˆ†ç±»åˆ—è¡¨æ¨¡å¼ -->
  <view wx:if="{{ !isSearchMode }}" class="categories-content">
    <view wx:if="{{ filteredCategories.length === 0 && !loading }}" class="modern-empty-state">
      <view class="empty-icon">ğŸ“‹</view>
      <view class="empty-text">æš‚æ— ç›¸å…³è§„ç« åˆ†ç±»</view>
      <view class="empty-hint">å°è¯•æ›´æ¢æœç´¢å…³é”®è¯æˆ–åˆ†ç±»</view>
    </view>

    <view wx:else class="modern-categories-list">
      <block wx:for="{{ filteredCategories }}" wx:key="name" wx:for-index="idx">
        <view 
          class="modern-category-card" 
          bind:tap="onCategoryClick"
          data-category="{{ item }}"
        >
        <view class="category-header">
          <view class="category-name">{{ item.name }}</view>
          <view class="category-badge">{{ item.category }}</view>
        </view>
        
        <view class="category-stats">
          <view class="stat-card regulation-stat">
            <view class="stat-number">{{ item.regulationCount }}</view>
            <view class="stat-label">è§„ç« </view>
          </view>
          <view class="stat-card normative-stat">
            <view class="stat-number">{{ item.normativeCount }}</view>
            <view class="stat-label">æ–‡ä»¶</view>
          </view>
        </view>
        
        <view class="category-arrow">
          <van-icon name="arrow" />
        </view>
        </view>
        
        <!-- åœ¨ç¬¬10ä¸ªé¡¹ç›®åæ’å…¥å¹¿å‘Š -->
        <view wx:if="{{ (idx + 1) % 10 === 0 && idx < filteredCategories.length - 1 }}" class="ad-container list-ad">
          <ad-custom unit-id="adunit-735d7d24032d4ca8" bindload="adLoad" binderror="adError" bindclose="adClose"></ad-custom>
        </view>
      </block>
    </view>
  </view>

  <!-- ç»Ÿè®¡ä¿¡æ¯ -->
  <view class="modern-stats-footer" wx:if="{{ !isSearchMode }}">
    <view class="stats-container">
      <view class="stats-item">
        <view class="stats-number">{{ categories.length }}</view>
        <view class="stats-label">ä¸ªåˆ†ç±»</view>
      </view>
      <view class="stats-divider"></view>
      <view class="stats-item">
        <view class="stats-number">{{ regulationData.length }}</view>
        <view class="stats-label">ä¸ªè§„ç« </view>
      </view>
      <view class="stats-divider"></view>
      <view class="stats-item">
        <view class="stats-number">{{ normativeData.length }}</view>
        <view class="stats-label">ä¸ªæ–‡ä»¶</view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ¨ªå¹…å¹¿å‘Š -->
  <view class="ad-banner-container bottom-ad">
    <ad-custom unit-id="adunit-d6c8a55bd3cb4fd1" bindload="adLoad" binderror="adError" bindclose="adClose"></ad-custom>
  </view>
</view>

<van-toast id="van-toast" />