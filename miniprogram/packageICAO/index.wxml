<view class="container page-content">
  <!-- åˆ†ç±»æ ‡ç­¾æ  -->
  <view class="modern-tabs-container">
    <scroll-view scroll-x class="tabs-wrapper" enable-flex>
      <view
        wx:for="{{ categories }}"
        wx:key="id"
        class="modern-tab {{ activeCategory === item.id ? 'active' : '' }}"
        bind:tap="onCategoryChange"
        data-category="{{ item.id }}"
      >
        <view class="tab-content">
          <view class="tab-icon">{{ item.icon }}</view>
          <view class="tab-title">{{ item.name }}</view>
          <view class="tab-count" wx:if="{{ item.count > 0 }}">{{ item.count }}</view>
        </view>
        <view class="tab-indicator" wx:if="{{ activeCategory === item.id }}"></view>
      </view>
    </scroll-view>
  </view>

  <!-- æœç´¢æ¡† -->
  <view class="search-section">
    <van-search
      value="{{ searchValue }}"
      placeholder="æœç´¢æ–‡æ¡£ç¼–å·ã€æ ‡é¢˜æˆ–æè¿°..."
      bind:change="onSearchChange"
      bind:clear="onSearchClear"
      shape="round"
    />
  </view>

  <!-- ç»Ÿè®¡ä¿¡æ¯ -->
  <view class="stats-section">
    <text class="stats-text">å…± {{ totalCount }} æ¡ Â· æ˜¾ç¤º {{ filteredCount }} æ¡</text>
  </view>

  <!-- ICAOå‡ºç‰ˆç‰©åˆ—è¡¨ -->
  <view class="publications-list">
    <view wx:if="{{ displayedPublications.length > 0 }}">
      <block wx:for="{{ displayedPublications }}" wx:key="docNumber">
        <view class="publication-card" bind:tap="showPublicationDetail" data-index="{{ index }}">
          <!-- æ–‡æ¡£ç¼–å· -->
          <view class="doc-number">
            <text class="number-text">{{ item.docNumber }}</text>
            <van-tag type="primary" size="mini">{{ item.categoryName }}</van-tag>
          </view>

          <!-- æ ‡é¢˜ -->
          <view class="publication-title">
            <text class="title-zh" wx:if="{{ item.title.zh }}">{{ item.title.zh }}</text>
            <text class="title-en">{{ item.title.en }}</text>
          </view>

          <!-- ç‰ˆæœ¬å’Œè¯­è¨€ -->
          <view class="publication-meta">
            <text class="edition">{{ item.edition }}</text>
          </view>
        </view>
      </block>

      <!-- åŠ è½½æ›´å¤š -->
      <view wx:if="{{ hasMore }}" class="load-more" bind:tap="onLoadMore">
        <text>åŠ è½½æ›´å¤š</text>
      </view>

      <!-- æ²¡æœ‰æ›´å¤š -->
      <view wx:if="{{ !hasMore && displayedPublications.length > 0 }}" class="no-more">
        <text>å·²æ˜¾ç¤ºå…¨éƒ¨æ•°æ®</text>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:if="{{ displayedPublications.length === 0 }}" class="empty-state">
      <text class="empty-icon">ğŸ“š</text>
      <text class="empty-text">æš‚æ— æ•°æ®</text>
    </view>
  </view>

  <!-- è¯¦æƒ…å¼¹çª— - å‚è€ƒæƒå¨å®šä¹‰è®¾è®¡ -->
  <van-popup
    show="{{ showDetailPopup }}"
    bind:close="closeDetailPopup"
    position="bottom"
    round="{{ true }}"
    close-on-click-overlay="{{ true }}"
    custom-style="height: 85vh; overflow: hidden;"
  >
    <view class="detail-popup-container">
      <!-- å¼¹çª—æ ‡é¢˜æ  -->
      <view class="detail-header">
        <view class="header-left"></view>
        <view class="detail-title-header">{{ selectedPublication.docNumber }}</view>
        <view class="header-right">
          <view class="close-btn" bind:tap="closeDetailPopup" catchtap="closeDetailPopup">
            <van-icon name="cross" class="close-icon" />
          </view>
        </view>
      </view>

      <!-- æ»šåŠ¨å†…å®¹åŒºåŸŸ -->
      <scroll-view scroll-y class="detail-content" enable-flex enhanced show-scrollbar="{{ false }}">
        <!-- å‡ºç‰ˆç‰©è¯¦æƒ… -->
        <view class="publication-detail">

          <!-- æœ¯è¯­ä¿¡æ¯åŒºå— -->
          <view class="info-section">
            <view class="section-title">ğŸ“‹ æœ¯è¯­ä¿¡æ¯</view>
            <view class="info-card">
              <view class="info-item">
                <view class="info-label">æ–‡æ¡£ç¼–å·</view>
                <view class="info-value">{{ selectedPublication.docNumber }}</view>
              </view>
              <view class="info-item">
                <view class="info-label">åˆ†ç±»</view>
                <view class="info-value">{{ selectedPublication.categoryName }}</view>
              </view>
              <view wx:if="{{ selectedPublication.title && selectedPublication.title.zh }}" class="info-item">
                <view class="info-label">ä¸­æ–‡æ ‡é¢˜</view>
                <view class="info-value">{{ selectedPublication.title.zh }}</view>
              </view>
              <view wx:if="{{ selectedPublication.title && selectedPublication.title.en }}" class="info-item">
                <view class="info-label">è‹±æ–‡æ ‡é¢˜</view>
                <view class="info-value info-value-en">{{ selectedPublication.title.en }}</view>
              </view>
            </view>
          </view>

          <!-- æè¿°å†…å®¹åŒºå— -->
          <view wx:if="{{ selectedPublication.description }}" class="info-section">
            <view class="section-title">ğŸ“„ æè¿°</view>
            <view class="description-card">
              <view wx:if="{{ selectedPublication.description.zh }}" class="description-text">
                {{ selectedPublication.description.zh }}
              </view>
              <view wx:if="{{ selectedPublication.description.en }}" class="description-text-en">
                {{ selectedPublication.description.en }}
              </view>
            </view>
          </view>

          <!-- æ¥æºä¿¡æ¯åŒºå— -->
          <view class="info-section">
            <view class="section-title">ğŸ“– æ¥æº</view>
            <view class="info-card">
              <view class="info-item">
                <view class="info-label">æœ€æ–°ç‰ˆæœ¬</view>
                <view class="info-value">{{ selectedPublication.edition }}</view>
              </view>
              <view wx:if="{{ selectedPublication.languagesDisplay }}" class="info-item">
                <view class="info-label">è¯­è¨€</view>
                <view class="info-value">{{ selectedPublication.languagesDisplay }}</view>
              </view>
            </view>
          </view>

        </view>
      </scroll-view>

      <!-- åº•éƒ¨æ“ä½œæ  -->
      <view class="detail-footer">
        <view class="close-button-single" bind:tap="closeDetailPopup">
          <van-icon name="cross" class="button-icon" />
          <text>å…³é—­</text>
        </view>
      </view>
    </view>
  </van-popup>
</view>

<van-toast id="van-toast" />
