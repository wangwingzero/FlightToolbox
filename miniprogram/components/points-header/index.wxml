<view class="points-header-component">
  <view class="points-display" bind:tap="showPointsDetail">
    <view class="points-icon">ğŸ’</view>
    <view class="points-info">
      <view class="points-amount">{{ points }}</view>
      <view class="points-label">ç§¯åˆ†</view>
    </view>
  </view>
  
  <view class="header-actions">
    <van-button 
      wx:if="{{ canSignIn }}"
      type="primary" 
      size="mini" 
      bind:click="onSignIn"
      class="signin-btn"
    >
      ç­¾åˆ°
    </van-button>
    <view wx:else class="signed-status">
      <text>âœ“</text>
    </view>
  </view>
</view>

<!-- ç§¯åˆ†è¯¦æƒ…å¼¹çª— -->
<van-popup
  show="{{ showPointsDetail }}"
  bind:close="closePointsDetail"
  position="bottom"
  round="{{ true }}"
  custom-style="height: 60vh;"
>
  <view class="points-detail-popup">
    <view class="popup-header">
      <text class="popup-title">ç§¯åˆ†è¯¦æƒ…</text>
      <van-icon name="close" bind:click="closePointsDetail" class="close-icon" />
    </view>
    
    <!-- ç§¯åˆ†æ¦‚è§ˆ -->
    <view class="points-overview">
      <view class="overview-item">
        <text class="overview-label">å½“å‰ç§¯åˆ†</text>
        <text class="overview-value primary">{{ currentPoints }}</text>
      </view>
      <view class="overview-item">
        <text class="overview-label">è¿ç»­ç­¾åˆ°</text>
        <text class="overview-value">{{ signInStatus.currentStreak }}å¤©</text>
      </view>
      <view class="overview-item">
        <text class="overview-label">è§‚çœ‹å¹¿å‘Š</text>
        <text class="overview-value warning">+{{ adStatus.rewardPoints }}</text>
      </view>
    </view>
    
    <!-- ç§¯åˆ†è§„åˆ™è¯´æ˜ -->
    <view class="points-rules">
      <text class="rules-title">ç§¯åˆ†è§„åˆ™</text>
      <view class="rule-group">
        <text class="group-title">åŠŸèƒ½æ¶ˆè´¹</text>
        <view class="rule-item">
          <text class="rule-desc">é£è¡Œé€Ÿç®—ã€å¸¸ç”¨æ¢ç®—</text>
          <text class="rule-cost">-1ç§¯åˆ†</text>
        </view>
        <view class="rule-item">
          <text class="rule-desc">ç‰¹æ®Šè®¡ç®—ã€ä¸‡èƒ½æŸ¥è¯¢</text>
          <text class="rule-cost">-2ç§¯åˆ†</text>
        </view>
        <view class="rule-item">
          <text class="rule-desc">å±é™©å“ã€åŒå‘å¤é£ç­‰</text>
          <text class="rule-cost">-2ç§¯åˆ†</text>
        </view>
        <view class="rule-item free">
          <text class="rule-desc">ä¸ªäººæ£€æŸ¥å•ã€èµ„è´¨ç®¡ç†</text>
          <text class="rule-cost free">å…è´¹</text>
        </view>
      </view>
      
      <view class="rule-group">
        <text class="group-title">ç§¯åˆ†è·å–</text>
        <view class="rule-item reward">
          <text class="rule-desc">æ–°ç”¨æˆ·å¥–åŠ±</text>
          <text class="rule-reward">+50ç§¯åˆ†</text>
        </view>
        <view class="rule-item reward">
          <text class="rule-desc">è§‚çœ‹æ¿€åŠ±å¹¿å‘Š</text>
          <text class="rule-reward">+40ç§¯åˆ†</text>
        </view>
        <view class="rule-item reward">
          <text class="rule-desc">æ¯æ—¥ç­¾åˆ°</text>
          <text class="rule-reward">+15~50ç§¯åˆ†</text>
        </view>
      </view>
    </view>
    
    <!-- äº¤æ˜“å†å² -->
    <view class="transaction-history">
      <text class="history-title">æœ€è¿‘è®°å½•</text>
      <scroll-view class="history-list" scroll-y>
        <view 
          wx:for="{{ transactionHistory }}" 
          wx:key="timestamp"
          class="transaction-item {{ item.type }}"
        >
          <view class="transaction-main">
            <text class="transaction-desc">{{ item.description || getTransactionDesc(item) }}</text>
            <text class="transaction-time">{{ formatTime(item.timestamp) }}</text>
          </view>
          <text class="transaction-amount {{ item.type }}">
            {{ item.amount > 0 ? '+' : '' }}{{ item.amount }}
          </text>
        </view>
        <view wx:if="{{ transactionHistory.length === 0 }}" class="empty-history">
          <van-empty description="æš‚æ— äº¤æ˜“è®°å½•" />
        </view>
      </scroll-view>
    </view>
  </view>
</van-popup> 