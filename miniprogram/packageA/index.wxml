<!--é€šä¿¡ç¿»è¯‘é¡µé¢WXML-->
<view class="communication-page">
  <!-- å¤´éƒ¨åŒºåŸŸ -->
  <view class="header">
    <view class="title">é€šä¿¡ç¿»è¯‘</view>
    <view class="subtitle">ICAOæ ‡å‡†èˆªç©ºè‹±è¯­åŠåº”æ€¥ç‰¹æƒ…è¯æ±‡</view>
  </view>

  <!-- æœç´¢æ¡† -->
  <view class="search-container">
    <van-search
      value="{{ searchValue }}"
      placeholder="{{ searchPlaceholder }}"
      use-action-slot
      bind:change="onSearchChange"
      bind:clear="onSearchClear"
    >
      <view slot="action" class="search-action">
        <text wx:if="{{ searchValue }}">{{ displayData.length }}æ¡</text>
        <text wx:else>{{ totalCount }}æ¡</text>
      </view>
    </van-search>
  </view>

  <!-- æ ‡ç­¾æ  -->
  <view class="tabs-container">
    <scroll-view class="tabs-scroll" scroll-x="true" enable-flex="true">
      <view class="tabs-wrapper">
        <view 
          wx:for="{{ tabList }}" 
          wx:key="name"
          class="tab-item {{ activeTab === item.name ? 'active' : '' }}"
          data-tab="{{ item.name }}"
          bindtap="onCustomTabChange"
        >
          <text class="tab-icon">{{ item.icon }}</text>
          <text class="tab-title">{{ item.title }}</text>
          <text class="tab-count">({{ item.count }})</text>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- æ•°æ®åˆ—è¡¨ -->
  <view class="content-container">
    <view wx:if="{{ displayData.length > 0 }}" class="data-list">
      <view 
        wx:for="{{ displayData }}" 
        wx:key="id"
        class="data-item"
        data-index="{{ index }}"
        bindtap="showItemDetail"
      >
        <!-- åˆ†ç±»æ ‡ç­¾ -->
        <view class="category-tag {{ item.category }}">
          {{ item.categoryName }}
        </view>
        
        <!-- ç« èŠ‚ä¿¡æ¯ -->
        <view wx:if="{{ item.chapterName }}" class="chapter-info">
          {{ item.chapterName }}
        </view>
        
        <!-- è‹±æ–‡å†…å®¹ -->
        <view class="english-text">
          {{ item.english }}
        </view>
        
        <!-- ä¸­æ–‡ç¿»è¯‘ -->
        <view class="chinese-text">
          {{ item.chinese }}
        </view>
        
        <!-- ç±»å‹æ ‡è¯† -->
        <view class="type-indicator">
          <text wx:if="{{ item.type === 'sentence' }}" class="type-sentence">å¥å­</text>
          <text wx:else class="type-term">è¯æ±‡</text>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:else class="empty-state">
      <view class="empty-icon">ğŸ”</view>
      <view class="empty-text">
        <text wx:if="{{ searchValue }}">æœªæ‰¾åˆ°ç›¸å…³å†…å®¹</text>
        <text wx:else>æš‚æ— æ•°æ®</text>
      </view>
      <view wx:if="{{ searchValue }}" class="empty-tip">
        <text>è¯·å°è¯•æ›´æ¢æœç´¢å…³é”®è¯</text>
      </view>
    </view>
  </view>

  <!-- è¯¦æƒ…å¼¹çª— -->
  <van-popup 
    show="{{ showDetailPopup }}" 
    position="bottom" 
    round
    closeable
    close-icon="close"
    bind:close="closeDetailPopup"
    custom-style="height: 70%;"
  >
    <view class="detail-popup">
      <view class="detail-header">
        <view class="detail-title">è¯¦ç»†ä¿¡æ¯</view>
        <view class="detail-category {{ selectedItem.category }}">
          {{ selectedItem.categoryName }}
        </view>
      </view>
      
      <view class="detail-content">
        <!-- ç« èŠ‚ä¿¡æ¯ -->
        <view wx:if="{{ selectedItem.chapterName }}" class="detail-section">
          <view class="section-title">ç« èŠ‚</view>
          <view class="section-content">{{ selectedItem.chapterName }}</view>
        </view>
        
        <!-- è‹±æ–‡å†…å®¹ -->
        <view class="detail-section">
          <view class="section-title">English</view>
          <view class="section-content english">{{ selectedItem.english }}</view>
        </view>
        
        <!-- ä¸­æ–‡ç¿»è¯‘ -->
        <view class="detail-section">
          <view class="section-title">ä¸­æ–‡ç¿»è¯‘</view>
          <view class="section-content chinese">{{ selectedItem.chinese }}</view>
        </view>
        
        <!-- ç±»å‹ä¿¡æ¯ -->
        <view class="detail-section">
          <view class="section-title">ç±»å‹</view>
          <view class="section-content">
            <text wx:if="{{ selectedItem.type === 'sentence' }}">æ ‡å‡†å¥å­</text>
            <text wx:else>ä¸“ä¸šè¯æ±‡</text>
          </view>
        </view>
      </view>
    </view>
  </van-popup>
</view>