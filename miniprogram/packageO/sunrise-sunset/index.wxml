<view class="container">
  <!-- 出发地信息卡片 -->
  <view class="airport-input-card">
    <view class="card-header">
      <view class="header-left">
        <text class="emoji-icon">🛫</text>
        <text class="card-title">出发地信息</text>
      </view>
      <!-- 时区切换器（紧凑型） -->
      <view class="timezone-switcher-compact" bind:tap="toggleTimeZone">
        <view class="timezone-toggle-compact {{ useBeijingTime ? 'beijing' : 'utc' }}">
          <view class="toggle-track-compact">
            <view class="toggle-thumb-compact"></view>
          </view>
        </view>
        <text class="timezone-text-compact">{{ useBeijingTime ? '北京时' : 'UTC' }}</text>
      </view>
    </view>
    <view class="input-section">
      <view class="input-wrapper">
        <input 
          class="airport-input"
          value="{{ departureIcaoCode }}"
          placeholder="输入ICAO/IATA代码或中文名"
          bindinput="onDepartureIcaoInput"
          maxlength="20"
          type="text"
          confirm-type="done"
        />
        <view class="input-clear" wx:if="{{ departureIcaoCode }}" bind:tap="clearDepartureInput">
          <text class="emoji-icon small">❌</text>
        </view>
      </view>
      <view class="input-hint">支持ICAO(ZBAA)、IATA(PEK)或中文(北京)</view>
    </view>
    
    <!-- 显示查找到的出发机场信息 -->
    <view class="airport-info" wx:if="{{ departureAirportInfo }}">
      <view class="info-item">
        <text class="info-label">机场名称</text>
        <text class="info-value">{{ departureAirportInfo.name }}</text>
      </view>
      <view class="info-item">
        <text class="info-label">ICAO/IATA</text>
        <text class="info-value">{{ departureAirportInfo.icaoCode }}{{ departureAirportInfo.iataCode ? '/' + departureAirportInfo.iataCode : '' }}</text>
      </view>
      <view class="info-item">
        <text class="info-label">地区</text>
        <text class="info-value">{{ departureAirportInfo.countryName }}</text>
      </view>
    </view>
    
    <view class="time-selector" bind:tap="showDepartureTimePicker">
      <text class="time-label">出发时间</text>
      <text class="time-value">{{ departureTimeStr || '点击选择时间' }}</text>
      <text class="emoji-icon small">⏰</text>
    </view>
  </view>

  <!-- 横幅广告 -->
  <view wx:if="{{ !isAdFree }}" class="ad-banner-container">
    <ad unit-id="adunit-4e68875624a88762" ad-type="banner" ad-intervals="30"></ad>
  </view>

  <!-- 到达地信息卡片 -->
  <view class="airport-input-card">
    <view class="card-header">
      <text class="emoji-icon">🛬</text>
      <text class="card-title">到达地信息</text>
    </view>
    <view class="input-section">
      <view class="input-wrapper">
        <input 
          class="airport-input"
          value="{{ arrivalIcaoCode }}"
          placeholder="输入ICAO/IATA代码或中文名"
          bindinput="onArrivalIcaoInput"
          maxlength="20"
          type="text"
          confirm-type="done"
        />
        <view class="input-clear" wx:if="{{ arrivalIcaoCode }}" bind:tap="clearArrivalInput">
          <text class="emoji-icon small">❌</text>
        </view>
      </view>
      <view class="input-hint">支持ICAO(ZSSS)、IATA(PVG)或中文(上海)</view>
    </view>
    
    <!-- 显示查找到的到达机场信息 -->
    <view class="airport-info" wx:if="{{ arrivalAirportInfo }}">
      <view class="info-item">
        <text class="info-label">机场名称</text>
        <text class="info-value">{{ arrivalAirportInfo.name }}</text>
      </view>
      <view class="info-item">
        <text class="info-label">ICAO/IATA</text>
        <text class="info-value">{{ arrivalAirportInfo.icaoCode }}{{ arrivalAirportInfo.iataCode ? '/' + arrivalAirportInfo.iataCode : '' }}</text>
      </view>
      <view class="info-item">
        <text class="info-label">地区</text>
        <text class="info-value">{{ arrivalAirportInfo.countryName }}</text>
      </view>
    </view>
    
    <view class="time-selector" bind:tap="showArrivalTimePicker">
      <text class="time-label">到达时间</text>
      <text class="time-value">{{ arrivalTimeStr || '点击选择时间' }}</text>
      <text class="emoji-icon small">⏰</text>
    </view>
  </view>

  <!-- 计算按钮 -->
  <view class="calculate-section">
    <view class="calculate-button" bind:tap="calculateNightFlightTime">
      <text class="emoji-icon">🧮</text>
      <text class="button-text">计算夜航时间</text>
      <view class="button-ripple"></view>
    </view>
  </view>

  <!-- 夜航计算结果卡片 -->
  <view class="results-card" wx:if="{{ nightFlightResults }}">
    <view class="results-header">
      <text class="emoji-icon">📊</text>
      <text class="results-title">夜航时间计算结果</text>
    </view>
    
    <view class="results-grid">
      <view class="result-item primary">
        <text class="result-label">总飞行时间</text>
        <text class="result-value">{{ nightFlightResults.totalFlightTime }}</text>
      </view>
      <view class="result-item highlight">
        <text class="result-label">夜间飞行时间</text>
        <text class="result-value">{{ nightFlightResults.nightFlightTime }}</text>
      </view>
      <view class="result-item percentage">
        <text class="result-label">夜间飞行比例</text>
        <text class="result-value">{{ nightFlightResults.nightFlightPercentage }}</text>
      </view>
      <view class="result-item">
        <text class="result-label">夜航进入时间</text>
        <text class="result-value">{{ nightFlightResults.nightEntryTime }}</text>
      </view>
      <view class="result-item">
        <text class="result-label">夜航退出时间</text>
        <text class="result-value">{{ nightFlightResults.nightExitTime }}</text>
      </view>
    </view>
    
    <!-- 两地日出日落时间 - 大卡片样式 -->
    <view class="sun-times-section">
      <view class="sun-times-header">
        <text class="emoji-icon small">🌅</text>
        <text class="sun-times-title">两地日出日落时间</text>
      </view>
      
      <!-- 出发地日出日落时间 -->
      <view class="location-sun-times">
        <view class="location-title">📍 出发地</view>
        <view class="sun-times-main">
          <view class="sun-time-card sunrise">
            <view class="sun-icon">🌅</view>
            <view class="sun-info">
              <text class="sun-title">日出时间</text>
              <text class="sun-time">{{ nightFlightResults.departureSunrise }}</text>
              <text class="sun-subtitle">当地时间</text>
            </view>
          </view>
          <view class="sun-time-card sunset">
            <view class="sun-icon">🌇</view>
            <view class="sun-info">
              <text class="sun-title">日落时间</text>
              <text class="sun-time">{{ nightFlightResults.departureSunset }}</text>
              <text class="sun-subtitle">当地时间</text>
            </view>
          </view>
        </view>
      </view>
      
      <!-- 到达地日出日落时间 -->
      <view class="location-sun-times">
        <view class="location-title">📍 到达地</view>
        <view class="sun-times-main">
          <view class="sun-time-card sunrise">
            <view class="sun-icon">🌅</view>
            <view class="sun-info">
              <text class="sun-title">日出时间</text>
              <text class="sun-time">{{ nightFlightResults.arrivalSunrise }}</text>
              <text class="sun-subtitle">当地时间</text>
            </view>
          </view>
          <view class="sun-time-card sunset">
            <view class="sun-icon">🌇</view>
            <view class="sun-info">
              <text class="sun-title">日落时间</text>
              <text class="sun-time">{{ nightFlightResults.arrivalSunset }}</text>
              <text class="sun-subtitle">当地时间</text>
            </view>
          </view>
        </view>
      </view>
    </view>
    
    <!-- 广告已移除 -->
  </view>

  <!-- 出发时间选择器 - 分步：先日历后时间 -->
  <!-- 步骤1：日历选择日期 -->
  <van-calendar
    show="{{ showDepartureCalendar }}"
    min-date="{{ minDate }}"
    max-date="{{ maxDate }}"
    default-date="{{ validDepartureTimestamp }}"
    bind:confirm="onDepartureDateConfirm"
    bind:close="closeDepartureCalendar"
    color="#1976d2"
    title="选择出发日期"
  />

  <!-- 步骤2：选择时间（时分） -->
  <van-popup
    show="{{ showDepartureTimeOnly }}"
    bind:close="closeDepartureTimePicker"
    position="bottom"
    round="{{ true }}"
  >
    <van-datetime-picker
      type="time"
      value="{{ departureTimeStr.split(' ')[1].split(':').slice(0, 2).join(':') || '12:00' }}"
      bind:confirm="onDepartureTimeConfirm"
      bind:cancel="closeDepartureTimePicker"
      title="选择出发时间"
    />
  </van-popup>

  <!-- 到达时间选择器 - 分步：先日历后时间 -->
  <!-- 步骤1：日历选择日期 -->
  <van-calendar
    show="{{ showArrivalCalendar }}"
    min-date="{{ minDate }}"
    max-date="{{ maxDate }}"
    default-date="{{ validArrivalTimestamp }}"
    bind:confirm="onArrivalDateConfirm"
    bind:close="closeArrivalCalendar"
    color="#1976d2"
    title="选择到达日期"
  />

  <!-- 步骤2：选择时间（时分） -->
  <van-popup
    show="{{ showArrivalTimeOnly }}"
    bind:close="closeArrivalTimePicker"
    position="bottom"
    round="{{ true }}"
  >
    <van-datetime-picker
      type="time"
      value="{{ arrivalTimeStr && arrivalTimeStr.split(' ')[1] ? arrivalTimeStr.split(' ')[1].split(':').slice(0, 2).join(':') : '12:00' }}"
      bind:confirm="onArrivalTimeConfirm"
      bind:cancel="closeArrivalTimePicker"
      title="选择到达时间"
    />
  </van-popup>
</view> 