<view class="container">
  <!-- å‡ºå‘åœ°ä¿¡æ¯å¡ç‰‡ -->
  <view class="airport-input-card">
    <view class="card-header">
      <view class="header-left">
        <text class="emoji-icon">ğŸ›«</text>
        <text class="card-title">å‡ºå‘åœ°ä¿¡æ¯</text>
      </view>
      <!-- æ—¶åŒºåˆ‡æ¢å™¨ï¼ˆç´§å‡‘å‹ï¼‰ -->
      <view class="timezone-switcher-compact" bind:tap="toggleTimeZone">
        <view class="timezone-toggle-compact {{ useBeijingTime ? 'beijing' : 'utc' }}">
          <view class="toggle-track-compact">
            <view class="toggle-thumb-compact"></view>
          </view>
        </view>
        <text class="timezone-text-compact">{{ useBeijingTime ? 'åŒ—äº¬æ—¶' : 'UTC' }}</text>
      </view>
    </view>
    <view class="input-section">
      <view class="input-wrapper">
        <input 
          class="airport-input"
          value="{{ departureIcaoCode }}"
          placeholder="è¾“å…¥ICAO/IATAä»£ç æˆ–ä¸­æ–‡å"
          bindinput="onDepartureIcaoInput"
          maxlength="20"
          type="text"
          confirm-type="done"
        />
        <view class="input-clear" wx:if="{{ departureIcaoCode }}" bind:tap="clearDepartureInput">
          <text class="emoji-icon small">âŒ</text>
        </view>
      </view>
      <view class="input-hint">æ”¯æŒICAO(ZBAA)ã€IATA(PEK)æˆ–ä¸­æ–‡(åŒ—äº¬)</view>
    </view>
    
    <!-- æ˜¾ç¤ºæŸ¥æ‰¾åˆ°çš„å‡ºå‘æœºåœºä¿¡æ¯ -->
    <view class="airport-info" wx:if="{{ departureAirportInfo }}">
      <view class="info-item">
        <text class="info-label">æœºåœºåç§°</text>
        <text class="info-value">{{ departureAirportInfo.name }}</text>
      </view>
      <view class="info-item">
        <text class="info-label">ICAO/IATA</text>
        <text class="info-value">{{ departureAirportInfo.icaoCode }}{{ departureAirportInfo.iataCode ? '/' + departureAirportInfo.iataCode : '' }}</text>
      </view>
      <view class="info-item">
        <text class="info-label">åœ°åŒº</text>
        <text class="info-value">{{ departureAirportInfo.countryName }}</text>
      </view>
    </view>
    
    <view class="time-selector" bind:tap="showDepartureTimePicker">
      <text class="time-label">å‡ºå‘æ—¶é—´</text>
      <text class="time-value">{{ departureTimeStr || 'ç‚¹å‡»é€‰æ‹©æ—¶é—´' }}</text>
      <text class="emoji-icon small">â°</text>
    </view>
  </view>

  <!-- æ¨ªå¹…å¹¿å‘Š -->
  <view class="ad-banner-container">
    <ad unit-id="adunit-4e68875624a88762" ad-type="banner" ad-intervals="30"></ad>
  </view>

  <!-- åˆ°è¾¾åœ°ä¿¡æ¯å¡ç‰‡ -->
  <view class="airport-input-card">
    <view class="card-header">
      <text class="emoji-icon">ğŸ›¬</text>
      <text class="card-title">åˆ°è¾¾åœ°ä¿¡æ¯</text>
    </view>
    <view class="input-section">
      <view class="input-wrapper">
        <input 
          class="airport-input"
          value="{{ arrivalIcaoCode }}"
          placeholder="è¾“å…¥ICAO/IATAä»£ç æˆ–ä¸­æ–‡å"
          bindinput="onArrivalIcaoInput"
          maxlength="20"
          type="text"
          confirm-type="done"
        />
        <view class="input-clear" wx:if="{{ arrivalIcaoCode }}" bind:tap="clearArrivalInput">
          <text class="emoji-icon small">âŒ</text>
        </view>
      </view>
      <view class="input-hint">æ”¯æŒICAO(ZSSS)ã€IATA(PVG)æˆ–ä¸­æ–‡(ä¸Šæµ·)</view>
    </view>
    
    <!-- æ˜¾ç¤ºæŸ¥æ‰¾åˆ°çš„åˆ°è¾¾æœºåœºä¿¡æ¯ -->
    <view class="airport-info" wx:if="{{ arrivalAirportInfo }}">
      <view class="info-item">
        <text class="info-label">æœºåœºåç§°</text>
        <text class="info-value">{{ arrivalAirportInfo.name }}</text>
      </view>
      <view class="info-item">
        <text class="info-label">ICAO/IATA</text>
        <text class="info-value">{{ arrivalAirportInfo.icaoCode }}{{ arrivalAirportInfo.iataCode ? '/' + arrivalAirportInfo.iataCode : '' }}</text>
      </view>
      <view class="info-item">
        <text class="info-label">åœ°åŒº</text>
        <text class="info-value">{{ arrivalAirportInfo.countryName }}</text>
      </view>
    </view>
    
    <view class="time-selector" bind:tap="showArrivalTimePicker">
      <text class="time-label">åˆ°è¾¾æ—¶é—´</text>
      <text class="time-value">{{ arrivalTimeStr || 'ç‚¹å‡»é€‰æ‹©æ—¶é—´' }}</text>
      <text class="emoji-icon small">â°</text>
    </view>
  </view>

  <!-- è®¡ç®—æŒ‰é’® -->
  <view class="calculate-section">
    <view class="calculate-button" bind:tap="calculateNightFlightTime">
      <text class="emoji-icon">ğŸ§®</text>
      <text class="button-text">è®¡ç®—å¤œèˆªæ—¶é—´</text>
      <view class="button-ripple"></view>
    </view>
  </view>

  <!-- å¤œèˆªè®¡ç®—ç»“æœå¡ç‰‡ -->
  <view class="results-card" wx:if="{{ nightFlightResults }}">
    <view class="results-header">
      <text class="emoji-icon">ğŸ“Š</text>
      <text class="results-title">å¤œèˆªæ—¶é—´è®¡ç®—ç»“æœ</text>
    </view>
    
    <view class="results-grid">
      <view class="result-item primary">
        <text class="result-label">æ€»é£è¡Œæ—¶é—´</text>
        <text class="result-value">{{ nightFlightResults.totalFlightTime }}</text>
      </view>
      <view class="result-item highlight">
        <text class="result-label">å¤œé—´é£è¡Œæ—¶é—´</text>
        <text class="result-value">{{ nightFlightResults.nightFlightTime }}</text>
      </view>
      <view class="result-item percentage">
        <text class="result-label">å¤œé—´é£è¡Œæ¯”ä¾‹</text>
        <text class="result-value">{{ nightFlightResults.nightFlightPercentage }}</text>
      </view>
      <view class="result-item">
        <text class="result-label">å¤œèˆªè¿›å…¥æ—¶é—´</text>
        <text class="result-value">{{ nightFlightResults.nightEntryTime }}</text>
      </view>
      <view class="result-item">
        <text class="result-label">å¤œèˆªé€€å‡ºæ—¶é—´</text>
        <text class="result-value">{{ nightFlightResults.nightExitTime }}</text>
      </view>
    </view>
    
    <!-- ä¸¤åœ°æ—¥å‡ºæ—¥è½æ—¶é—´ - å¤§å¡ç‰‡æ ·å¼ -->
    <view class="sun-times-section">
      <view class="sun-times-header">
        <text class="emoji-icon small">ğŸŒ…</text>
        <text class="sun-times-title">ä¸¤åœ°æ—¥å‡ºæ—¥è½æ—¶é—´</text>
      </view>
      
      <!-- å‡ºå‘åœ°æ—¥å‡ºæ—¥è½æ—¶é—´ -->
      <view class="location-sun-times">
        <view class="location-title">ğŸ“ å‡ºå‘åœ°</view>
        <view class="sun-times-main">
          <view class="sun-time-card sunrise">
            <view class="sun-icon">ğŸŒ…</view>
            <view class="sun-info">
              <text class="sun-title">æ—¥å‡ºæ—¶é—´</text>
              <text class="sun-time">{{ nightFlightResults.departureSunrise }}</text>
              <text class="sun-subtitle">å½“åœ°æ—¶é—´</text>
            </view>
          </view>
          <view class="sun-time-card sunset">
            <view class="sun-icon">ğŸŒ‡</view>
            <view class="sun-info">
              <text class="sun-title">æ—¥è½æ—¶é—´</text>
              <text class="sun-time">{{ nightFlightResults.departureSunset }}</text>
              <text class="sun-subtitle">å½“åœ°æ—¶é—´</text>
            </view>
          </view>
        </view>
      </view>
      
      <!-- åˆ°è¾¾åœ°æ—¥å‡ºæ—¥è½æ—¶é—´ -->
      <view class="location-sun-times">
        <view class="location-title">ğŸ“ åˆ°è¾¾åœ°</view>
        <view class="sun-times-main">
          <view class="sun-time-card sunrise">
            <view class="sun-icon">ğŸŒ…</view>
            <view class="sun-info">
              <text class="sun-title">æ—¥å‡ºæ—¶é—´</text>
              <text class="sun-time">{{ nightFlightResults.arrivalSunrise }}</text>
              <text class="sun-subtitle">å½“åœ°æ—¶é—´</text>
            </view>
          </view>
          <view class="sun-time-card sunset">
            <view class="sun-icon">ğŸŒ‡</view>
            <view class="sun-info">
              <text class="sun-title">æ—¥è½æ—¶é—´</text>
              <text class="sun-time">{{ nightFlightResults.arrivalSunset }}</text>
              <text class="sun-subtitle">å½“åœ°æ—¶é—´</text>
            </view>
          </view>
        </view>
      </view>
    </view>
    
    <!-- å¹¿å‘Šå·²ç§»é™¤ -->
  </view>

  <!-- å‡ºå‘æ—¶é—´é€‰æ‹©å™¨ - åˆ†æ­¥ï¼šå…ˆæ—¥å†åæ—¶é—´ -->
  <!-- æ­¥éª¤1ï¼šæ—¥å†é€‰æ‹©æ—¥æœŸ -->
  <van-calendar
    show="{{ showDepartureCalendar }}"
    min-date="{{ minDate }}"
    max-date="{{ maxDate }}"
    default-date="{{ validDepartureTimestamp }}"
    bind:confirm="onDepartureDateConfirm"
    bind:close="closeDepartureCalendar"
    color="#1976d2"
    title="é€‰æ‹©å‡ºå‘æ—¥æœŸ"
  />

  <!-- æ­¥éª¤2ï¼šé€‰æ‹©æ—¶é—´ï¼ˆæ—¶åˆ†ï¼‰ -->
  <van-popup
    show="{{ showDepartureTimeOnly }}"
    bind:close="closeDepartureTimePicker"
    position="bottom"
    round="{{ true }}"
  >
    <van-datetime-picker
      type="time"
      value="{{ departureTimeStr.split(' ')[1].split(':').slice(0, 2).join(':') || '12:00' }}"
      bind:confirm="onDepartureTimeConfirm"
      bind:cancel="closeDepartureTimePicker"
      title="é€‰æ‹©å‡ºå‘æ—¶é—´"
    />
  </van-popup>

  <!-- åˆ°è¾¾æ—¶é—´é€‰æ‹©å™¨ - åˆ†æ­¥ï¼šå…ˆæ—¥å†åæ—¶é—´ -->
  <!-- æ­¥éª¤1ï¼šæ—¥å†é€‰æ‹©æ—¥æœŸ -->
  <van-calendar
    show="{{ showArrivalCalendar }}"
    min-date="{{ minDate }}"
    max-date="{{ maxDate }}"
    default-date="{{ validArrivalTimestamp }}"
    bind:confirm="onArrivalDateConfirm"
    bind:close="closeArrivalCalendar"
    color="#1976d2"
    title="é€‰æ‹©åˆ°è¾¾æ—¥æœŸ"
  />

  <!-- æ­¥éª¤2ï¼šé€‰æ‹©æ—¶é—´ï¼ˆæ—¶åˆ†ï¼‰ -->
  <van-popup
    show="{{ showArrivalTimeOnly }}"
    bind:close="closeArrivalTimePicker"
    position="bottom"
    round="{{ true }}"
  >
    <van-datetime-picker
      type="time"
      value="{{ arrivalTimeStr.split(' ')[1].split(':').slice(0, 2).join(':') || '12:00' }}"
      bind:confirm="onArrivalTimeConfirm"
      bind:cancel="closeArrivalTimePicker"
      title="é€‰æ‹©åˆ°è¾¾æ—¶é—´"
    />
  </van-popup>
</view> 