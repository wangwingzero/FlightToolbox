<view class="container">
  <!-- èˆªç©ºä¸»é¢˜åŠ¨ç”»èƒŒæ™¯ -->
  <view class="animated-bg">
    <view class="aviation-glow aviation-glow1"></view>
    <view class="aviation-glow aviation-glow2"></view>
    <view class="aviation-pulse"></view>
    <view class="radar-sweep"></view>
    <view class="floating-particles"></view>
  </view>

  <!-- è‹±é›„åŒºåŸŸ -->
  <view class="hero-section">
    <view class="hero-content">
      <view class="hero-icon">âœˆï¸</view>
      <view class="hero-title">ä¸ªäººæ£€æŸ¥å•</view>
      <view class="hero-subtitle">ä¸“ä¸šé£è¡Œæ£€æŸ¥æ¸…å•ç®¡ç†ç³»ç»Ÿ</view>
      <view class="hero-features">
        <view class="feature-item">
          <view class="feature-icon">ğŸ“‹</view>
          <text>æ™ºèƒ½ç®¡ç†</text>
        </view>
        <view class="feature-item">
          <view class="feature-icon">âš¡</view>
          <text>å¿«é€Ÿæ£€æŸ¥</text>
        </view>
        <view class="feature-item">
          <view class="feature-icon">ğŸ¯</view>
          <text>ç²¾ç¡®è¿½è¸ª</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
  <view class="main-content">
    <!-- æ£€æŸ¥å•ç½‘æ ¼ -->
    <view class="checklist-grid" wx:if="{{ checklists.length > 0 }}">
      <view 
        class="checklist-card {{ item.isCompleted ? 'completed' : 'in-progress' }}"
        wx:for="{{ checklists }}" 
        wx:key="id"
        bind:tap="openChecklist"
        data-id="{{ item.id }}"
      >
        <!-- å¡ç‰‡çŠ¶æ€æŒ‡ç¤ºå™¨ -->
        <view class="card-status-indicator"></view>
        
        <view class="card-header">
          <view class="card-title">{{ item.name }}</view>
          <view class="card-actions">
            <view 
              class="action-btn edit-btn"
              catch:tap="editChecklist"
              data-id="{{ item.id }}"
            >
              <view class="btn-icon">âœï¸</view>
            </view>
            <view 
              class="action-btn delete-btn"
              catch:tap="deleteChecklist"
              data-id="{{ item.id }}"
            >
              <view class="btn-icon">ğŸ—‘ï¸</view>
            </view>
          </view>
        </view>
        
        <view class="card-content">
          <!-- è¿›åº¦ç¯å½¢å›¾ -->
          <view class="progress-circle-container">
            <view class="progress-circle">
              <view class="circle-bg"></view>
              <view 
                class="circle-progress" 
                style="--progress: {{ item.progressPercentage || 0 }}%"
              ></view>
              <view class="circle-content">
                <view class="progress-percentage">{{ item.progressPercentage || 0 }}%</view>
                <view class="progress-label">å®Œæˆåº¦</view>
              </view>
            </view>
          </view>
          
          <!-- è¯¦ç»†è¿›åº¦ä¿¡æ¯ -->
          <view class="progress-details">
            <view class="progress-numbers">
              <view class="progress-current">{{ item.completedCount || 0 }}</view>
              <view class="progress-divider">/</view>
              <view class="progress-total">{{ item.items ? item.items.length : 0 }}</view>
            </view>
            <view class="progress-text">é¡¹ç›®å®Œæˆ</view>
            
            <view class="completion-badge {{ item.isCompleted ? 'completed' : 'in-progress' }}">
              <view class="badge-icon">{{ item.isCompleted ? 'âœ…' : 'â³' }}</view>
              <view class="badge-text">{{ item.isCompleted ? 'å·²å®Œæˆ' : 'è¿›è¡Œä¸­' }}</view>
            </view>
          </view>
        </view>
        
        <!-- æ‚¬æµ®æ“ä½œæŒ‰é’® -->
        <view class="card-quick-actions">
          <view class="quick-action-btn" catch:tap="openChecklist" data-id="{{ item.id }}">
            <view class="quick-action-icon">â–¶ï¸</view>
          </view>
        </view>
      </view>
    </view>

    <!-- åˆ›å»ºæ–°æ£€æŸ¥å•å¡ç‰‡ -->
    <view class="create-card" bind:tap="createCustomChecklist">
      <view class="create-card-bg"></view>
      <view class="create-content">
        <view class="create-icon-container">
          <view class="create-icon">â•</view>
          <view class="create-glow"></view>
        </view>
        <view class="create-text">
          <view class="create-title">åˆ›å»ºæ£€æŸ¥å•</view>
          <view class="create-subtitle">æ·»åŠ æ‚¨çš„ä¸“å±é£è¡Œæ£€æŸ¥æ¸…å•</view>
        </view>
      </view>
      <view class="create-particles">
        <view class="particle particle1"></view>
        <view class="particle particle2"></view>
        <view class="particle particle3"></view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{ checklists.length === 0 }}">
      <view class="empty-animation">
        <view class="empty-icon">ğŸ“‹</view>
        <view class="empty-pulse"></view>
      </view>
      <view class="empty-content">
        <view class="empty-title">å¼€å§‹æ‚¨çš„é£è¡Œæ£€æŸ¥</view>
        <view class="empty-description">åˆ›å»ºæ‚¨çš„ç¬¬ä¸€ä¸ªæ£€æŸ¥å•ï¼Œç¡®ä¿æ¯æ¬¡é£è¡Œçš„å®‰å…¨ä¸å‡†ç¡®</view>
      </view>
    </view>
  </view>

  <!-- æ£€æŸ¥å•è¯¦æƒ…å¼¹çª— -->
  <van-popup 
    show="{{ showChecklistDetail }}" 
    position="bottom" 
    round
    bind:close="closeChecklistDetail"
    custom-style="height: 85%; background: transparent;"
  >
    <view class="detail-container">
      <!-- è¯¦æƒ…å¤´éƒ¨ -->
      <view class="detail-header">
        <view class="detail-bg-animation"></view>
        <view class="header-content">
          <view class="header-top">
            <view class="detail-title">{{ currentChecklist.name }}</view>
            <view class="close-btn" bind:tap="closeChecklistDetail">
              <view class="close-icon">âœ•</view>
            </view>
          </view>
          
          <view class="progress-overview">
            <!-- å¤§å‹è¿›åº¦ç¯ -->
            <view class="large-progress-circle">
              <view class="large-circle-bg"></view>
              <view 
                class="large-circle-progress" 
                style="--progress: {{ currentChecklist.progressPercentage || 0 }}%"
              ></view>
              <view class="large-circle-content">
                <view class="large-progress-percentage">{{ currentChecklist.progressPercentage || 0 }}%</view>
                <view class="large-progress-label">å®Œæˆåº¦</view>
              </view>
            </view>
            
            <!-- ç»Ÿè®¡ä¿¡æ¯å’Œç¼–è¾‘æŒ‰é’® -->
            <view class="stats-and-actions">
              <!-- ç»Ÿè®¡ä¿¡æ¯ -->
              <view class="progress-stats">
                <view class="stat-item">
                  <view class="stat-number">{{ currentChecklist.completedCount || 0 }}</view>
                  <view class="stat-label">å·²å®Œæˆ</view>
                </view>
                <view class="stat-divider"></view>
                <view class="stat-item">
                  <view class="stat-number">{{ currentChecklist.items ? currentChecklist.items.length : 0 }}</view>
                  <view class="stat-label">æ€»è®¡</view>
                </view>
              </view>
              
              <!-- ç¼–è¾‘æŒ‰é’® - ç°åœ¨ä¸ç»Ÿè®¡ä¿¡æ¯åœ¨åŒä¸€æ°´å¹³ä½ç½® -->
              <view class="edit-action">
                <view class="edit-btn" bind:tap="editCurrentChecklist">
                  <view class="edit-icon">âœï¸</view>
                  <view class="edit-text">ç¼–è¾‘</view>
                </view>
              </view>
            </view>
          </view>
        </view>
      </view>

      <!-- æ£€æŸ¥é¡¹ç›®åˆ—è¡¨ -->
      <view class="detail-content">
        <van-checkbox-group value="{{ checkedItems }}" bind:change="onCheckboxChange">
          <view class="items-list">
            <view 
              class="item-card {{ (checkedItems && Array.isArray(checkedItems) && checkedItems.includes && checkedItems.includes(item.id)) ? 'completed' : '' }}"
              wx:for="{{ currentChecklist.items }}" 
              wx:key="id"
              bind:tap="toggleCheckbox"
              data-item-id="{{ item.id }}"
            >
              <view class="item-status-line"></view>
              
              <view class="item-checkbox">
                <van-checkbox 
                  name="{{ item.id }}" 
                  checked="{{ checkedItems && Array.isArray(checkedItems) && checkedItems.includes && checkedItems.includes(item.id) }}"
                  disabled="{{ false }}"
                  shape="square"
                />
              </view>
              
              <view class="item-content">
                <view class="item-text">{{ item.text }}</view>
                <view class="item-completion" wx:if="{{ checkedItems && Array.isArray(checkedItems) && checkedItems.includes && checkedItems.includes(item.id) }}">
                  <view class="completion-icon">âœ“</view>
                  <view class="completion-text">å·²å®Œæˆ</view>
                </view>
              </view>
              
              <view class="item-indicator {{ (checkedItems && Array.isArray(checkedItems) && checkedItems.includes && checkedItems.includes(item.id)) ? 'checked' : '' }}">
                <view class="indicator-dot"></view>
              </view>
            </view>
          </view>
        </van-checkbox-group>
      </view>

      <!-- åº•éƒ¨æ“ä½œæ  -->
      <view class="detail-actions">
        <view class="detail-action-btn reset-btn" bind:tap="resetChecklist">
          <view class="detail-action-icon">ğŸ”„</view>
          <view class="detail-action-text">é‡ç½®æ£€æŸ¥å•</view>
        </view>
      </view>
    </view>
  </van-popup>

  <!-- æ–°å»º/ç¼–è¾‘æ£€æŸ¥å•å¼¹çª— - é«˜ç«¯ä¼˜é›…è®¾è®¡ -->
  <view class="modal-overlay" wx:if="{{showEditDialog}}" bindtap="closeEditDialog">
    <!-- åˆ›å»ºæ£€æŸ¥å•å¼¹çª— -->
    <view class="create-modal" catchtap="stopPropagation">
      <!-- å¼¹çª—å¤´éƒ¨ -->
      <view class="modal-header">
        <view class="modal-title-section">
          <view class="modal-icon">
            <view class="icon-checklist"></view>
          </view>
          <view class="modal-title-content">
            <text class="modal-title">{{ editMode === 'create' ? 'åˆ›å»ºæ£€æŸ¥å•' : 'ç¼–è¾‘æ£€æŸ¥å•' }}</text>
            <text class="modal-subtitle">{{ editMode === 'create' ? 'Create New Checklist' : 'Edit Checklist' }}</text>
          </view>
        </view>
        <view class="close-btn" bindtap="closeEditDialog">
          <view class="close-icon"></view>
        </view>
      </view>

      <!-- å¼¹çª—å†…å®¹ -->
      <view class="modal-content">
        <!-- åŸºæœ¬ä¿¡æ¯åŒºåŸŸ -->
        <view class="form-section">
          <view class="section-header">
            <view class="section-icon basic-info-icon"></view>
            <view class="section-title">
              <text class="title-main">åŸºæœ¬ä¿¡æ¯</text>
              <text class="title-sub">Basic Information</text>
            </view>
          </view>
          
          <view class="input-group">
            <view class="input-label">
              <text class="label-text">æ£€æŸ¥å•åç§°</text>
              <text class="label-required">*</text>
            </view>
            <view class="input-wrapper">
              <input 
                class="form-input" 
                placeholder="è¯·è¾“å…¥æ£€æŸ¥å•åç§°"
                placeholder-class="input-placeholder"
                value="{{editingChecklist.name}}"
                bindinput="onNameChange"
                maxlength="50"
              />
              <view class="input-border"></view>
            </view>
            <view class="input-counter">
              <text class="counter-text">{{editingChecklist.name.length || 0}}/50</text>
            </view>
          </view>
        </view>

        <!-- æ£€æŸ¥é¡¹ç›®åŒºåŸŸ -->
        <view class="form-section">
          <view class="section-header">
            <view class="section-icon items-icon"></view>
            <view class="section-title">
              <text class="title-main">æ£€æŸ¥é¡¹ç›®</text>
              <text class="title-sub">Check Items</text>
            </view>
            <view class="items-count">
              <text class="count-number">{{editingChecklist.items.length || 0}}</text>
              <text class="count-label">é¡¹</text>
            </view>
          </view>

          <!-- é¡¹ç›®åˆ—è¡¨ -->
          <view class="items-list" wx:if="{{editingChecklist.items.length > 0}}">
            <view class="item-card" wx:for="{{editingChecklist.items}}" wx:key="index">
              <view class="item-content">
                <view class="item-number">{{index + 1}}</view>
                
                <!-- ç¼–è¾‘æ¨¡å¼ -->
                <view class="item-text-container" wx:if="{{editingItemIndex === index}}">
                  <input 
                    class="item-edit-input" 
                    value="{{editingItemText}}"
                    bindinput="onEditingItemTextChange"
                    placeholder="è¯·è¾“å…¥é¡¹ç›®å†…å®¹"
                    focus="{{true}}"
                    maxlength="100"
                  />
                  <view class="edit-actions">
                    <view class="save-btn-enhanced" bindtap="saveItemText" data-loading="{{false}}">
                      <view class="save-btn-bg"></view>
                      <view class="save-btn-content">
                        <view class="save-btn-icon">âœ“</view>
                        <text class="save-btn-text">ä¿å­˜</text>
                      </view>
                      <view class="save-btn-ripple"></view>
                    </view>
                    <view class="cancel-btn-enhanced" bindtap="cancelEditItem">
                      <view class="cancel-btn-content">
                        <view class="cancel-btn-icon">âœ•</view>
                        <text class="cancel-btn-text">å–æ¶ˆ</text>
                      </view>
                    </view>
                  </view>
                </view>
                
                <!-- æ˜¾ç¤ºæ¨¡å¼ -->
                <view class="item-text" wx:else>{{item.text}}</view>
                
                <view class="item-actions" wx:if="{{editingItemIndex !== index}}">
                  <!-- ä¸Šç§»æŒ‰é’® -->
                  <view class="action-btn move-btn" wx:if="{{index > 0}}" bindtap="moveItemUp" bindlongpress="showButtonTip" data-index="{{index}}" data-tip="ä¸Šç§»">
                    <view class="move-up-icon">â†‘</view>
                  </view>
                  <!-- ä¸‹ç§»æŒ‰é’® -->
                  <view class="action-btn move-btn" wx:if="{{index < editingChecklist.items.length - 1}}" bindtap="moveItemDown" bindlongpress="showButtonTip" data-index="{{index}}" data-tip="ä¸‹ç§»">
                    <view class="move-down-icon">â†“</view>
                  </view>
                  <!-- ç¼–è¾‘æŒ‰é’® -->
                  <view class="action-btn edit-btn" bindtap="editItemText" bindlongpress="showButtonTip" data-index="{{index}}" data-tip="ç¼–è¾‘">
                    <view class="edit-icon">âœï¸</view>
                  </view>
                  <!-- åˆ é™¤æŒ‰é’® -->
                  <view class="action-btn delete-btn" bindtap="deleteItem" bindlongpress="showButtonTip" data-index="{{index}}" data-tip="åˆ é™¤">
                    <view class="delete-icon">ğŸ—‘ï¸</view>
                  </view>
                </view>
              </view>
            </view>
          </view>

          <!-- ç©ºçŠ¶æ€ -->
          <view class="empty-state" wx:else>
            <view class="empty-icon"></view>
            <text class="empty-text">æš‚æ— æ£€æŸ¥é¡¹ç›®</text>
            <text class="empty-subtitle">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æ·»åŠ ç¬¬ä¸€ä¸ªæ£€æŸ¥é¡¹ç›®</text>
          </view>

          <!-- æ·»åŠ é¡¹ç›®æŒ‰é’® -->
          <view class="add-item-btn" bindtap="showAddItemDialog">
            <view class="add-icon"></view>
            <text class="add-text">æ·»åŠ æ£€æŸ¥é¡¹ç›®</text>
          </view>
        </view>
      </view>

      <!-- å¼¹çª—åº•éƒ¨æ“ä½œåŒº -->
      <view class="modal-footer">
        <view class="footer-actions">
          <view class="cancel-btn" bindtap="closeEditDialog">
            <text class="btn-text">å–æ¶ˆ</text>
          </view>
          <view class="create-btn" bindtap="saveChecklist">
            <view class="btn-gradient"></view>
            <text class="btn-text">{{ editMode === 'create' ? 'åˆ›å»ºæ£€æŸ¥å•' : 'ä¿å­˜æ›´æ”¹' }}</text>
            <view class="btn-icon"></view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æ·»åŠ é¡¹ç›®è¾“å…¥å¼¹çª— -->
  <view class="input-modal-overlay" wx:if="{{showAddItemModal}}" bindtap="hideAddItemModal">
    <view class="input-modal" catchtap="stopPropagation">
      <view class="input-modal-header">
        <text class="input-modal-title">æ·»åŠ æ£€æŸ¥é¡¹ç›®</text>
      </view>
      <view class="input-modal-content">
        <view class="input-wrapper">
          <input 
            class="item-input" 
            placeholder="è¯·è¾“å…¥æ£€æŸ¥é¡¹ç›®å†…å®¹"
            placeholder-class="input-placeholder"
            value="{{newItemText}}"
            bindinput="onNewItemChange"
            maxlength="100"
            focus="{{showAddItemModal}}"
          />
        </view>
        <view class="input-counter">
          <text class="counter-text">{{newItemText.length || 0}}/100</text>
        </view>
      </view>
      <view class="input-modal-footer">
        <view class="input-cancel-btn" bindtap="hideAddItemModal">å–æ¶ˆ</view>
        <view class="input-confirm-btn" bindtap="addNewItem">ç¡®è®¤</view>
      </view>
    </view>
  </view>

  <!-- Toast ç»„ä»¶ -->
  <van-toast id="van-toast" />
  
  <!-- Dialog ç»„ä»¶ -->
  <van-dialog id="van-dialog" />
</view>