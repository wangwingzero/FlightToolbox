<view class="container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <view class="page-title">âš ï¸ å±é™©å“æŸ¥è¯¢</view>
    <view class="page-subtitle">Dangerous Goods Inquiry</view>
  </view>

  <!-- ç°ä»£æ ‡ç­¾é¡µ - å‚è€ƒé€šä¿¡ç¿»è¯‘é¡µé¢è®¾è®¡ -->
  <view class="modern-tabs-container">
    <scroll-view class="tabs-scroll" scroll-x="true" show-scrollbar="false">
      <view class="tabs-wrapper">
        <view class="modern-tab {{ activeTab === 'regulations' ? 'active' : '' }}"
              bind:tap="onTabChange" data-tab="regulations">
          <view class="tab-content">
            <view class="tab-icon">ğŸ“‹</view>
            <view class="tab-title">æºå¸¦è§„å®š</view>
            <view class="tab-count">{{ filteredRegulations.length }}æ¡</view>
          </view>
        </view>
        <view class="modern-tab {{ activeTab === 'emergency' ? 'active' : '' }}"
              bind:tap="onTabChange" data-tab="emergency">
          <view class="tab-content">
            <view class="tab-icon">ğŸš¨</view>
            <view class="tab-title">åº”æ€¥å“åº”</view>
            <view class="tab-count">{{ filteredEmergency.length }}æ¡</view>
          </view>
        </view>
        <view class="modern-tab {{ activeTab === 'hidden' ? 'active' : '' }}"
              bind:tap="onTabChange" data-tab="hidden">
          <view class="tab-content">
            <view class="tab-icon">ğŸ”</view>
            <view class="tab-title">éšå«å±é™©å“</view>
            <view class="tab-count">{{ filteredHidden.length }}æ¡</view>
          </view>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- æœç´¢æ  -->
  <view class="search-section">
    <van-search
      value="{{ searchValue }}"
      placeholder="æœç´¢å±é™©å“åç§°æˆ–ç±»åˆ«..."
      bind:change="onSearchChange"
      bind:clear="onSearchClear"
      show-action="{{ false }}"
      background="transparent"
      shape="round"
    >
      <view slot="left-icon" class="search-left-icon">
        <van-icon name="search" class="search-placeholder-icon" />
      </view>
    </van-search>
  </view>


  <!-- å†…å®¹åŒºåŸŸ -->
  <view class="content-area">
    <!-- æºå¸¦è§„å®šå†…å®¹ -->
    <view wx:if="{{ activeTab === 'regulations' }}" class="tab-content-area">
      <view wx:if="{{ loading }}" class="loading-section">
        <van-loading size="24px" vertical>æ•°æ®åŠ è½½ä¸­...</van-loading>
      </view>
      
      <view wx:else class="regulations-section">
        <view class="content-title">
          <view class="content-icon">ğŸ“‹</view>
          <text>å±é™©å“æºå¸¦è§„å®š ({{ filteredRegulations.length }}æ¡)</text>
        </view>
        
        <view wx:if="{{ filteredRegulations.length > 0 }}" class="results-section">
          <view class="item-list">
            <block wx:for="{{ filteredRegulations }}" wx:key="index" wx:for-index="idx">
              <view 
                class="item regulation-item"
                bind:tap="viewRegulationDetail"
                data-item="{{ item }}"
              >
                <view class="item-title">{{ item.item_name }}</view>
                <view class="item-desc">{{ item.shortDescription || 'æš‚æ— æè¿°' }}</view>
                <view class="item-tags">
                  <view wx:if="{{ item.allowed_in_carry_on }}" class="tag tag-success">å¯æ‰‹æ</view>
                  <view wx:if="{{ item.allowed_in_checked_baggage }}" class="tag tag-primary">å¯æ‰˜è¿</view>
                  <view wx:if="{{ !item.allowed_in_carry_on && !item.allowed_in_checked_baggage }}" class="tag tag-danger">ç¦æ­¢</view>
                </view>
              </view>
            </block>
          </view>
        </view>

        <van-empty
          wx:if="{{ filteredRegulations.length === 0 && searchValue }}"
          description="æœªæ‰¾åˆ°ç›¸å…³å±é™©å“è§„å®š"
        />
      </view>
    </view>

    <!-- åº”æ€¥å“åº”å†…å®¹ -->
    <view wx:if="{{ activeTab === 'emergency' }}" class="tab-content-area">
      <view wx:if="{{ loading }}" class="loading-section">
        <van-loading size="24px" vertical>æ•°æ®åŠ è½½ä¸­...</van-loading>
      </view>
      
      <view wx:else class="emergency-section">
        <view class="content-title">
          <view class="content-icon">ğŸš¨</view>
          <text>åº”æ€¥å“åº”ç¨‹åº ({{ filteredEmergency.length }}æ¡)</text>
        </view>
        
        <view wx:if="{{ filteredEmergency.length > 0 }}" class="results-section">
          <view class="item-list">
            <block wx:for="{{ filteredEmergency }}" wx:key="code" wx:for-index="idx">
              <view 
                class="item emergency-item"
                bind:tap="viewEmergencyDetail"
                data-item="{{ item }}"
              >
                <view class="item-title">ä»£ç  {{ item.code }}</view>
                <view class="item-desc">{{ item.inherent_hazard }}</view>
                <view class="item-tags">
                  <view class="tag tag-warning">{{ item.code }}</view>
                </view>
              </view>
            </block>
          </view>
        </view>

        <van-empty
          wx:if="{{ filteredEmergency.length === 0 && searchValue }}"
          description="æœªæ‰¾åˆ°ç›¸å…³åº”æ€¥å“åº”ç¨‹åº"
        />
      </view>
    </view>

    <!-- éšå«å±é™©å“å†…å®¹ -->
    <view wx:if="{{ activeTab === 'hidden' }}" class="tab-content-area">
      <view wx:if="{{ loading }}" class="loading-section">
        <van-loading size="24px" vertical>æ•°æ®åŠ è½½ä¸­...</van-loading>
      </view>
      
      <view wx:else class="hidden-section">
        <view class="content-title">
          <view class="content-icon">ğŸ”</view>
          <text>éšå«å±é™©å“ç±»åˆ« ({{ filteredHidden.length }}æ¡)</text>
        </view>
        
        <view wx:if="{{ filteredHidden.length > 0 }}" class="results-section">
          <view class="item-list">
            <block wx:for="{{ filteredHidden }}" wx:key="category_zh" wx:for-index="idx">
              <view 
                class="item hidden-item"
                bind:tap="viewHiddenDetail"
                data-item="{{ item }}"
              >
                <view class="item-title">{{ item.category_zh }}</view>
                <view class="item-desc">{{ item.category_en }}</view>
                <view class="item-tags">
                  <view class="tag tag-warning">éœ€æ£€æŸ¥</view>
                </view>
              </view>
            </block>
          </view>
        </view>

        <van-empty
          wx:if="{{ filteredHidden.length === 0 && searchValue }}"
          description="æœªæ‰¾åˆ°ç›¸å…³éšå«å±é™©å“"
        />
      </view>
    </view>
  </view>

  <!-- è¯¦æƒ…å¼¹çª— -->
  <van-popup
    show="{{ showDetailPopup }}"
    bind:close="closeDetailPopup"
    position="bottom"
    round="{{ true }}"
    close-on-click-overlay="{{ true }}"
    custom-style="height: 85vh; overflow: hidden;"
  >
    <view class="detail-popup-container">
      <!-- å¼¹çª—æ ‡é¢˜æ  -->
      <view class="detail-header">
        <view class="detail-title">{{ detailData.title }}</view>
        <view class="close-btn" bind:tap="closeDetailPopup" catchtap="closeDetailPopup">
          <van-icon name="cross" class="close-icon" />
        </view>
      </view>

          <!-- æ»šåŠ¨å†…å®¹åŒºåŸŸ -->
    <scroll-view scroll-y class="detail-content" enable-flex enhanced show-scrollbar="{{ false }}">
        <!-- æºå¸¦è§„å®šè¯¦æƒ… -->
        <view wx:if="{{ detailType === 'regulation' }}" class="regulation-detail">
          <!-- ç‰©å“åŸºæœ¬ä¿¡æ¯ -->
          <van-cell-group title="åŸºæœ¬ä¿¡æ¯" class="detail-section">
            <van-cell title="ç‰©å“åç§°" value="{{ detailData.item_name }}" />
          </van-cell-group>

          <!-- æºå¸¦æ¡ä»¶ -->
          <view class="detail-section">
            <view class="conditions-grid">
              <view class="condition-item {{ detailData.allowed_in_carry_on ? 'allowed' : 'forbidden' }}">
                <van-icon name="{{ detailData.allowed_in_carry_on ? 'success' : 'close' }}" />
                <view class="condition-content">
                  <text class="condition-title">æ‰‹æè¡Œæ</text>
                  <text class="condition-limit">{{ detailData.carry_on_limit || (detailData.allowed_in_carry_on ? 'â‰¤ 100ml' : 'ç¦æ­¢æºå¸¦') }}</text>
                </view>
              </view>
              <view class="condition-item {{ detailData.allowed_in_checked_baggage ? 'allowed' : 'forbidden' }}">
                <van-icon name="{{ detailData.allowed_in_checked_baggage ? 'success' : 'close' }}" />
                <view class="condition-content">
                  <text class="condition-title">æ‰˜è¿è¡Œæ</text>
                  <text class="condition-limit">{{ detailData.checked_limit || (detailData.allowed_in_checked_baggage ? 'å…è®¸æºå¸¦' : 'ç¦æ­¢æºå¸¦') }}</text>
                </view>
              </view>
            </view>
            
            <!-- èˆªç©ºå…¬å¸æ‰¹å‡†è¦æ±‚ -->
            <view wx:if="{{ detailData.requires_operator_approval }}" class="approval-required">
              <van-icon name="warning" />
              <view class="approval-content">
                <text class="approval-title">éœ€è¦èˆªç©ºå…¬å¸æ‰¹å‡†</text>
                <text class="approval-note">æå‰48å°æ—¶ç”³è¯·</text>
              </view>
            </view>
            
            <!-- æœºé•¿é€šçŸ¥è¦æ±‚ -->
            <view wx:if="{{ detailData.requires_captain_notification }}" class="approval-required">
              <van-icon name="info" />
              <view class="approval-content">
                <text class="approval-title">éœ€è¦é€šçŸ¥æœºé•¿</text>
                <text class="approval-note">ç™»æœºå‰å‘ŠçŸ¥</text>
              </view>
            </view>
            
            <!-- ç‰¹æ®Šè¦æ±‚ -->
            <view wx:if="{{ detailData.special_condition }}" class="special-requirements">
              <view class="special-header">
                <van-icon name="info-o" color="#1890ff" />
                <text class="special-title">ç‰¹æ®Šè¦æ±‚</text>
              </view>
              <view class="special-content">
                <text class="special-text">â€¢ å¿…é¡»ä½¿ç”¨åŸè£…åŒ…è£…</text>
                <text class="special-text">â€¢ æ ‡ç­¾æ¸…æ™°å¯è§</text>
                <text class="special-text">â€¢ ä¸å¾—ä¸é£Ÿå“åŒæ”¾</text>
                <text wx:if="{{ detailData.special_condition }}" class="special-text">â€¢ {{ detailData.special_condition }}</text>
              </view>
            </view>
          </view>

          <!-- è¯¦ç»†è¯´æ˜ -->
          <van-cell-group title="è¯¦ç»†è¯´æ˜" class="detail-section">
            <view class="description-content">
              <text class="description-text">{{ detailData.description }}</text>
            </view>
          </van-cell-group>
        </view>

        <!-- åº”æ€¥å“åº”è¯¦æƒ… -->
        <view wx:if="{{ detailType === 'emergency' }}" class="emergency-detail">
          <!-- ä»£ç ä¿¡æ¯ -->
          <van-cell-group title="ä»£ç ä¿¡æ¯" class="detail-section">
            <van-cell title="åº”æ€¥ä»£ç " value="{{ detailData.code }}" />
          </van-cell-group>

          <!-- å±é™©ç±»å‹ -->
          <van-cell-group title="å±é™©ç±»å‹" class="detail-section">
            <view class="hazard-item">
              <view class="hazard-title">
                <van-icon name="warning" color="#ff976a" />
                <text>å›ºæœ‰å±é™©</text>
              </view>
              <text class="hazard-content">{{ detailData.inherent_hazard }}</text>
            </view>
            
            <view class="hazard-item">
              <view class="hazard-title">
                <van-icon name="cluster" color="#ee0a24" />
                <text>å¯¹èˆªç©ºå™¨çš„å±é™©</text>
              </view>
              <text class="hazard-content">{{ detailData.aircraft_hazard }}</text>
            </view>
            
            <view class="hazard-item">
              <view class="hazard-title">
                <van-icon name="friends" color="#ff976a" />
                <text>å¯¹ä¹˜å‘˜çš„å±é™©</text>
              </view>
              <text class="hazard-content">{{ detailData.occupant_hazard }}</text>
            </view>
          </van-cell-group>

          <!-- åº”æ€¥ç¨‹åº - ç¾åŒ–åçš„ç›´è§‚å±•ç¤º -->
          <van-cell-group title="åº”æ€¥ç¨‹åº" class="detail-section">
            <!-- æ³„æ¼å¤„ç†ç¨‹åº -->
            <view class="procedure-card spill-card">
              <view class="procedure-header">
                <van-icon name="warning-o" color="#ff976a" size="20px" />
                <text class="procedure-title">æ³„æ¼å¤„ç†ç¨‹åº</text>
              </view>
              <view class="procedure-content">
                <text class="procedure-text">{{ detailData.spill_leak_procedure }}</text>
              </view>
            </view>
            
            <!-- ç­ç«ç¨‹åº -->
            <view class="procedure-card fire-card">
              <view class="procedure-header">
                <van-icon name="fire-o" color="#ee0a24" size="20px" />
                <text class="procedure-title">ç­ç«ç¨‹åº</text>
              </view>
              <view class="procedure-content">
                <text class="procedure-text">{{ detailData.fire_fighting_procedure }}</text>
              </view>
            </view>
            
            <!-- å…¶ä»–è€ƒè™‘ -->
            <view class="procedure-card other-card">
              <view class="procedure-header">
                <van-icon name="info-o" color="#1989fa" size="20px" />
                <text class="procedure-title">å…¶ä»–è€ƒè™‘</text>
              </view>
              <view class="procedure-content">
                <text class="procedure-text">{{ detailData.other_considerations }}</text>
              </view>
            </view>
          </van-cell-group>
        </view>

        <!-- éšå«å±é™©å“è¯¦æƒ… -->
        <view wx:if="{{ detailType === 'hidden' }}" class="hidden-detail">
          <!-- ç±»åˆ«ä¿¡æ¯ -->
          <van-cell-group title="ç±»åˆ«ä¿¡æ¯" class="detail-section">
            <van-cell title="ä¸­æ–‡åç§°" value="{{ detailData.category_zh }}" />
            <van-cell title="è‹±æ–‡åç§°" value="{{ detailData.category_en }}" />
          </van-cell-group>

          <!-- è¯´æ˜ -->
          <van-cell-group title="è¯¦ç»†è¯´æ˜" class="detail-section">
            <view class="description-content">
              <text class="description-text">{{ detailData.description }}</text>
            </view>
          </van-cell-group>

          <!-- å¯èƒ½åŒ…å«çš„ç‰©å“ -->
          <van-cell-group wx:if="{{ detailData.possible_items && detailData.possible_items.length > 0 }}" title="å¯èƒ½åŒ…å«çš„ç‰©å“" class="detail-section">
            <view class="possible-items">
              <van-tag
                wx:for="{{ detailData.possible_items }}"
                wx:key="index"
                type="primary"
                size="medium"
                class="item-tag"
              >
                {{ item }}
              </van-tag>
            </view>
          </van-cell-group>
        </view>
      </scroll-view>

      <!-- åº•éƒ¨æ“ä½œæ  -->
      <view class="detail-footer">
        <van-button type="primary" block bind:click="closeDetailPopup" class="close-button">
          <van-icon name="success" class="button-icon" />
          çŸ¥é“äº†
        </van-button>
      </view>
    </view>
  </van-popup>

  <!-- ç»Ÿè®¡ä¿¡æ¯ -->
  <view wx:if="{{ !loading && !searchValue }}" class="stats-section">
    <view class="stats-grid">
      <view class="stats-item">
        <text class="stats-number">{{ regulationsData.length }}</text>
        <text class="stats-label">æ¡æºå¸¦è§„å®š</text>
      </view>
      <view class="stats-item">
        <text class="stats-number">{{ emergencyData.length }}</text>
        <text class="stats-label">ä¸ªåº”æ€¥ç¨‹åº</text>
      </view>
      <view class="stats-item">
        <text class="stats-number">{{ hiddenGoodsData.length }}</text>
        <text class="stats-label">ç±»éšå«å±é™©å“</text>
      </view>
    </view>
  </view>

</view>