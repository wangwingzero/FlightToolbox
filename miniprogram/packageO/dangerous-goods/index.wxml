<view class="container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <view class="page-title">âš ï¸ å±é™©å“æŸ¥è¯¢</view>
    <view class="page-subtitle">Dangerous Goods Inquiry</view>
  </view>

  <!-- ç°ä»£æ ‡ç­¾é¡µ - å‚è€ƒé€šä¿¡ç¿»è¯‘é¡µé¢è®¾è®¡ -->
  <view class="modern-tabs-container">
    <scroll-view class="tabs-scroll" scroll-x="true" show-scrollbar="false">
      <view class="tabs-wrapper">
        <view class="modern-tab {{ activeTab === 'all' ? 'active' : '' }}"
              bind:tap="onTabChange" data-tab="all">
          <view class="tab-content">
            <view class="tab-icon">ğŸ“š</view>
            <view class="tab-title">å…¨éƒ¨</view>
            <view class="tab-count">{{ totalCount }}æ¡</view>
          </view>
        </view>
        <view class="modern-tab {{ activeTab === 'emergency' ? 'active' : '' }}"
              bind:tap="onTabChange" data-tab="emergency">
          <view class="tab-content">
            <view class="tab-icon">ğŸš¨</view>
            <view class="tab-title">åº”æ€¥å“åº”</view>
            <view class="tab-count">{{ filteredEmergency.length }}æ¡</view>
          </view>
        </view>
        <view class="modern-tab {{ activeTab === 'regulations' ? 'active' : '' }}"
              bind:tap="onTabChange" data-tab="regulations">
          <view class="tab-content">
            <view class="tab-icon">ğŸ“‹</view>
            <view class="tab-title">æºå¸¦è§„å®š</view>
            <view class="tab-count">{{ filteredRegulations.length }}æ¡</view>
          </view>
        </view>
        <view class="modern-tab {{ activeTab === 'hidden' ? 'active' : '' }}"
              bind:tap="onTabChange" data-tab="hidden">
          <view class="tab-content">
            <view class="tab-icon">ğŸ”</view>
            <view class="tab-title">éšå«å±é™©å“</view>
            <view class="tab-count">{{ filteredHidden.length }}æ¡</view>
          </view>
        </view>
        <view class="modern-tab {{ activeTab === 'groundEmergency' ? 'active' : '' }}"
              bind:tap="onTabChange" data-tab="groundEmergency">
          <view class="tab-content">
            <view class="tab-icon">ğŸš‘</view>
            <view class="tab-title">åœ°é¢åº”æ€¥</view>
            <view class="tab-count">{{ filteredGroundEmergency.length }}æ¡</view>
          </view>
        </view>
        <view class="modern-tab {{ activeTab === 'segregation' ? 'active' : '' }}"
              bind:tap="onTabChange" data-tab="segregation">
          <view class="tab-content">
            <view class="tab-icon">ğŸ”—</view>
            <view class="tab-title">éš”ç¦»è§„åˆ™</view>
            <view class="tab-count">çŸ©é˜µ</view>
          </view>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- æœç´¢æ  -->
  <view class="search-section">
    <van-search
      value="{{ searchValue }}"
      placeholder="æœç´¢å±é™©å“åç§°æˆ–ç±»åˆ«..."
      bind:change="onSearchChange"
      bind:clear="onSearchClear"
      show-action="{{ false }}"
      background="transparent"
      shape="round"
    >
      <view slot="left-icon" class="search-left-icon">
        <van-icon name="search" class="search-placeholder-icon" />
      </view>
    </van-search>
  </view>


  <!-- å†…å®¹åŒºåŸŸ -->
  <view class="content-area">
    <!-- å…¨éƒ¨å†…å®¹ -->
    <view wx:if="{{ activeTab === 'all' }}" class="tab-content-area">
      <view wx:if="{{ loading }}" class="loading-section">
        <van-loading size="24px" vertical>æ•°æ®åŠ è½½ä¸­...</van-loading>
      </view>

      <view wx:else class="all-section">
        <view class="content-title">
          <view class="content-icon">ğŸ“š</view>
          <text>å…¨éƒ¨å±é™©å“ä¿¡æ¯ ({{ totalCount }}æ¡)</text>
        </view>

        <view wx:if="{{ totalCount > 0 }}" class="results-section">
          <!-- åº”æ€¥å“åº” -->
          <view wx:if="{{ filteredEmergency.length > 0 }}" class="category-group">
            <view class="category-header">
              <text class="category-title">ğŸš¨ åº”æ€¥å“åº” ({{ filteredEmergency.length }}æ¡)</text>
            </view>
            <view class="item-list">
              <block wx:for="{{ filteredEmergency }}" wx:key="code" wx:for-index="idx">
                <view
                  class="item emergency-item"
                  bind:tap="viewEmergencyDetail"
                  data-item="{{ item }}"
                >
                  <view class="item-title">ä»£ç  {{ item.code }}</view>
                  <view class="item-desc">{{ item.inherent_hazard }}</view>
                  <view class="item-tags">
                    <view class="tag tag-warning">{{ item.code }}</view>
                  </view>
                </view>
              </block>
            </view>
          </view>

          <!-- æºå¸¦è§„å®š -->
          <view wx:if="{{ filteredRegulations.length > 0 }}" class="category-group">
            <view class="category-header">
              <text class="category-title">ğŸ“‹ æºå¸¦è§„å®š ({{ filteredRegulations.length }}æ¡)</text>
            </view>
            <view class="item-list">
              <block wx:for="{{ filteredRegulations }}" wx:key="index" wx:for-index="idx">
                <view
                  class="item regulation-item"
                  bind:tap="viewRegulationDetail"
                  data-item="{{ item }}"
                >
                  <view class="item-title">{{ item.item_name }}</view>
                  <view class="item-desc">{{ item.shortDescription || 'æš‚æ— æè¿°' }}</view>
                  <view class="item-tags">
                    <view wx:if="{{ item.allowed_in_carry_on }}" class="tag tag-success">å¯æ‰‹æ</view>
                    <view wx:if="{{ item.allowed_in_checked_baggage }}" class="tag tag-primary">å¯æ‰˜è¿</view>
                    <view wx:if="{{ !item.allowed_in_carry_on && !item.allowed_in_checked_baggage }}" class="tag tag-danger">ç¦æ­¢</view>
                  </view>
                </view>
              </block>
            </view>
          </view>

          <!-- éšå«å±é™©å“ -->
          <view wx:if="{{ filteredHidden.length > 0 }}" class="category-group">
            <view class="category-header">
              <text class="category-title">ğŸ” éšå«å±é™©å“ ({{ filteredHidden.length }}æ¡)</text>
            </view>
            <view class="item-list">
              <block wx:for="{{ filteredHidden }}" wx:key="category_zh" wx:for-index="idx">
                <view
                  class="item hidden-item"
                  bind:tap="viewHiddenDetail"
                  data-item="{{ item }}"
                >
                  <view class="item-title">{{ item.category_zh }}</view>
                  <view class="item-desc">{{ item.category_en }}</view>
                  <view class="item-tags">
                    <view class="tag tag-warning">éœ€æ£€æŸ¥</view>
                  </view>
                </view>
              </block>
            </view>
          </view>

          <!-- åœ°é¢åº”æ€¥ -->
          <view wx:if="{{ filteredGroundEmergency.length > 0 }}" class="category-group">
            <view class="category-header">
              <text class="category-title">ğŸš‘ åœ°é¢åº”æ€¥å“åº” ({{ filteredGroundEmergency.length }}æ¡)</text>
            </view>
            <view class="item-list">
              <block wx:for="{{ filteredGroundEmergency }}" wx:key="code" wx:for-index="idx">
                <view
                  class="item emergency-item"
                  bind:tap="viewGroundEmergencyDetail"
                  data-item="{{ item }}"
                >
                  <view class="item-title">{{ item.code }} - {{ item.class }}</view>
                  <view class="item-desc">{{ item.category_zh }}</view>
                  <view class="item-tags">
                    <view class="tag tag-danger">{{ item.code }}</view>
                  </view>
                </view>
              </block>
            </view>
          </view>
        </view>

        <van-empty
          wx:if="{{ totalCount === 0 && searchValue }}"
          description="æœªæ‰¾åˆ°ç›¸å…³å±é™©å“ä¿¡æ¯"
        />
      </view>
    </view>

    <!-- æºå¸¦è§„å®šå†…å®¹ -->
    <view wx:if="{{ activeTab === 'regulations' }}" class="tab-content-area">
      <view wx:if="{{ loading }}" class="loading-section">
        <van-loading size="24px" vertical>æ•°æ®åŠ è½½ä¸­...</van-loading>
      </view>
      
      <view wx:else class="regulations-section">
        <view class="content-title">
          <view class="content-icon">ğŸ“‹</view>
          <text>å±é™©å“æºå¸¦è§„å®š ({{ filteredRegulations.length }}æ¡)</text>
        </view>
        
        <view wx:if="{{ filteredRegulations.length > 0 }}" class="results-section">
          <view class="item-list">
            <block wx:for="{{ filteredRegulations }}" wx:key="index" wx:for-index="idx">
              <view 
                class="item regulation-item"
                bind:tap="viewRegulationDetail"
                data-item="{{ item }}"
              >
                <view class="item-title">{{ item.item_name }}</view>
                <view class="item-desc">{{ item.shortDescription || 'æš‚æ— æè¿°' }}</view>
                <view class="item-tags">
                  <view wx:if="{{ item.allowed_in_carry_on }}" class="tag tag-success">å¯æ‰‹æ</view>
                  <view wx:if="{{ item.allowed_in_checked_baggage }}" class="tag tag-primary">å¯æ‰˜è¿</view>
                  <view wx:if="{{ !item.allowed_in_carry_on && !item.allowed_in_checked_baggage }}" class="tag tag-danger">ç¦æ­¢</view>
                </view>
              </view>
            </block>
          </view>
        </view>

        <van-empty
          wx:if="{{ filteredRegulations.length === 0 && searchValue }}"
          description="æœªæ‰¾åˆ°ç›¸å…³å±é™©å“è§„å®š"
        />
      </view>
    </view>

    <!-- åº”æ€¥å“åº”å†…å®¹ -->
    <view wx:if="{{ activeTab === 'emergency' }}" class="tab-content-area">
      <view wx:if="{{ loading }}" class="loading-section">
        <van-loading size="24px" vertical>æ•°æ®åŠ è½½ä¸­...</van-loading>
      </view>
      
      <view wx:else class="emergency-section">
        <view class="content-title">
          <view class="content-icon">ğŸš¨</view>
          <text>åº”æ€¥å“åº”ç¨‹åº ({{ filteredEmergency.length }}æ¡)</text>
        </view>
        
        <view wx:if="{{ filteredEmergency.length > 0 }}" class="results-section">
          <view class="item-list">
            <block wx:for="{{ filteredEmergency }}" wx:key="code" wx:for-index="idx">
              <view 
                class="item emergency-item"
                bind:tap="viewEmergencyDetail"
                data-item="{{ item }}"
              >
                <view class="item-title">ä»£ç  {{ item.code }}</view>
                <view class="item-desc">{{ item.inherent_hazard }}</view>
                <view class="item-tags">
                  <view class="tag tag-warning">{{ item.code }}</view>
                </view>
              </view>
            </block>
          </view>
        </view>

        <van-empty
          wx:if="{{ filteredEmergency.length === 0 && searchValue }}"
          description="æœªæ‰¾åˆ°ç›¸å…³åº”æ€¥å“åº”ç¨‹åº"
        />
      </view>
    </view>

    <!-- éšå«å±é™©å“å†…å®¹ -->
    <view wx:if="{{ activeTab === 'hidden' }}" class="tab-content-area">
      <view wx:if="{{ loading }}" class="loading-section">
        <van-loading size="24px" vertical>æ•°æ®åŠ è½½ä¸­...</van-loading>
      </view>

      <view wx:else class="hidden-section">
        <view class="content-title">
          <view class="content-icon">ğŸ”</view>
          <text>éšå«å±é™©å“ç±»åˆ« ({{ filteredHidden.length }}æ¡)</text>
        </view>

        <view wx:if="{{ filteredHidden.length > 0 }}" class="results-section">
          <view class="item-list">
            <block wx:for="{{ filteredHidden }}" wx:key="category_zh" wx:for-index="idx">
              <view
                class="item hidden-item"
                bind:tap="viewHiddenDetail"
                data-item="{{ item }}"
              >
                <view class="item-title">{{ item.category_zh }}</view>
                <view class="item-desc">{{ item.category_en }}</view>
                <view class="item-tags">
                  <view class="tag tag-warning">éœ€æ£€æŸ¥</view>
                </view>
              </view>
            </block>
          </view>
        </view>

        <van-empty
          wx:if="{{ filteredHidden.length === 0 && searchValue }}"
          description="æœªæ‰¾åˆ°ç›¸å…³éšå«å±é™©å“"
        />
      </view>
    </view>

    <!-- åœ°é¢åº”æ€¥å†…å®¹ -->
    <view wx:if="{{ activeTab === 'groundEmergency' }}" class="tab-content-area">
      <view wx:if="{{ loading }}" class="loading-section">
        <van-loading size="24px" vertical>æ•°æ®åŠ è½½ä¸­...</van-loading>
      </view>

      <view wx:else class="ground-emergency-section">
        <view class="content-title">
          <view class="content-icon">ğŸš‘</view>
          <text>åœ°é¢å±é™©å“åº”æ€¥å“åº” ({{ filteredGroundEmergency.length }}æ¡)</text>
        </view>

        <view wx:if="{{ filteredGroundEmergency.length > 0 }}" class="results-section">
          <view class="item-list">
            <block wx:for="{{ filteredGroundEmergency }}" wx:key="code" wx:for-index="idx">
              <view
                class="item emergency-item"
                bind:tap="viewGroundEmergencyDetail"
                data-item="{{ item }}"
              >
                <view class="item-title">{{ item.code }} - {{ item.class }}</view>
                <view class="item-desc">{{ item.category_zh }}</view>
                <view class="item-tags">
                  <view class="tag tag-danger">{{ item.code }}</view>
                  <view class="tag tag-warning">{{ item.class }}</view>
                </view>
              </view>
            </block>
          </view>
        </view>

        <van-empty
          wx:if="{{ filteredGroundEmergency.length === 0 && searchValue }}"
          description="æœªæ‰¾åˆ°ç›¸å…³åœ°é¢åº”æ€¥å“åº”"
        />
      </view>
    </view>

    <!-- éš”ç¦»è§„åˆ™å†…å®¹ -->
    <view wx:if="{{ activeTab === 'segregation' }}" class="tab-content-area">
      <view wx:if="{{ loading }}" class="loading-section">
        <van-loading size="24px" vertical>æ•°æ®åŠ è½½ä¸­...</van-loading>
      </view>

      <view wx:else class="segregation-section">
        <view class="content-title">
          <view class="content-icon">ğŸ”—</view>
          <text>å±é™©å“éš”ç¦»è§„åˆ™çŸ©é˜µ</text>
        </view>

        <view wx:if="{{ segregationMatrix }}" class="segregation-content">
          <!-- éš”ç¦»è§„åˆ™è¯´æ˜ -->
          <view class="segregation-intro">
            <view class="intro-card">
              <view class="intro-title">ğŸ“‹ éš”ç¦»è§„åˆ™è¯´æ˜</view>
              <view class="intro-text">â€¢ <text class="highlight-x">X</text> = å¿…é¡»éš”ç¦»</view>
              <view class="intro-text">â€¢ <text class="highlight-dash">â€”</text> = æ— éœ€éš”ç¦»</view>
              <view class="intro-text">â€¢ <text class="highlight-note">See Note 3</text> = ç‰¹æ®Šè§„åˆ™</view>
            </view>
          </view>

          <!-- å±é™©å“ç±»åˆ«é€‰æ‹©å™¨ -->
          <view class="selector-container">
            <view class="selector-item">
              <view class="selector-label">é€‰æ‹©ç±»åˆ« 1</view>
              <picker mode="selector" range="{{ classList }}" value="{{ classIndex1 }}" bindchange="onSelectClass1">
                <view class="picker-display">
                  {{ selectedClass1 || 'è¯·é€‰æ‹©å±é™©å“ç±»åˆ«' }}
                </view>
              </picker>
            </view>

            <view class="selector-item">
              <view class="selector-label">é€‰æ‹©ç±»åˆ« 2</view>
              <picker mode="selector" range="{{ classList }}" value="{{ classIndex2 }}" bindchange="onSelectClass2">
                <view class="picker-display">
                  {{ selectedClass2 || 'è¯·é€‰æ‹©å±é™©å“ç±»åˆ«' }}
                </view>
              </picker>
            </view>
          </view>

          <!-- éš”ç¦»ç»“æœæ˜¾ç¤º -->
          <view wx:if="{{ segregationResult }}" class="result-container">
            <view class="result-card {{ segregationResult === 'X' ? 'result-segregate' : (segregationResult === 'â€”' ? 'result-no-segregate' : 'result-note') }}">
              <view class="result-icon">
                {{ segregationResult === 'X' ? 'âš ï¸' : (segregationResult === 'â€”' ? 'âœ…' : 'ğŸ“') }}
              </view>
              <view class="result-text">
                <view class="result-main">{{ segregationResult }}</view>
                <view class="result-desc">
                  {{ segregationResult === 'X' ? 'è¿™ä¸¤ç±»å±é™©å“å¿…é¡»éš”ç¦»' : (segregationResult === 'â€”' ? 'è¿™ä¸¤ç±»å±é™©å“æ— éœ€éš”ç¦»' : 'å­˜åœ¨ç‰¹æ®Šè§„åˆ™ï¼Œè¯·æŸ¥çœ‹æ³¨é‡Š3') }}
                </view>
              </view>
            </view>
          </view>

          <!-- æ³¨é‡Šè¯´æ˜ -->
          <view class="notes-container">
            <view class="notes-title">ğŸ“š é‡è¦æ³¨é‡Š</view>
            <view class="note-item" bind:tap="viewSegregationNote" data-note="note1">
              <view class="note-label">æ³¨é‡Š 1</view>
              <view class="note-preview">æ¨ªè¡Œå’Œçºµè¡Œäº¤å‰ç‚¹ä¸º"Ã—"ï¼Œåˆ™è¡¨ç¤ºæ‰€å¯¹åº”çš„ä¸¤ç§å±é™©å“çš„æ€§è´¨äº’ç›¸æŠµè§¦...</view>
            </view>
            <view class="note-item" bind:tap="viewSegregationNote" data-note="note2">
              <view class="note-label">æ³¨é‡Š 2</view>
              <view class="note-preview">ç¬¬1.4Sé¡¹ã€ç¬¬6ã€7ã€9ç±»ï¼ˆé™¤é”‚ç”µæ± å¤–ï¼‰å±é™©å“ä¸åœ¨è¡¨å†…...</view>
            </view>
            <view class="note-item" bind:tap="viewSegregationNote" data-note="note3">
              <view class="note-label">æ³¨é‡Š 3</view>
              <view class="note-preview">1.4Bé¡¹çš„çˆ†ç‚¸å“ä¸å¾—ä¸ 1.4S é¡¹ä»¥å¤–çš„å…¶ä»–çˆ†ç‚¸å“è£…åœ¨ä¸€èµ·...</view>
            </view>
            <view class="note-item" bind:tap="viewSegregationNote" data-note="note4">
              <view class="note-label">æ³¨é‡Š 4</view>
              <view class="note-preview">æŒ‡ç¬¬9ç±»å±é™©å“ä¸­ç¬¦åˆåŒ…è£…è¯´æ˜ PI965 Section IA æˆ–IB çš„é”‚ç¦»å­ç”µæ± ...</view>
            </view>
          </view>
        </view>

        <van-empty
          wx:else
          description="éš”ç¦»è§„åˆ™æ•°æ®åŠ è½½å¤±è´¥"
        />
      </view>
    </view>
  </view>

  <!-- è¯¦æƒ…å¼¹çª— -->
  <van-popup
    show="{{ showDetailPopup }}"
    bind:close="closeDetailPopup"
    position="bottom"
    round="{{ true }}"
    close-on-click-overlay="{{ true }}"
    custom-style="height: 85vh; overflow: hidden;"
    custom-class="custom-detail-popup"
  >
    <view class="detail-popup-container">
      <!-- å¼¹çª—æ ‡é¢˜æ  -->
      <view class="detail-header">
        <view class="header-left">
          <view wx:if="{{ navigationHistory.length > 0 }}" class="back-btn" bind:tap="goBackInHistory" catchtap="goBackInHistory">
            <van-icon name="arrow-left" class="back-icon" />
          </view>
        </view>
        <view class="detail-title">{{ detailData.title }}</view>
        <view class="header-right">
          <view class="close-btn" bind:tap="closeDetailPopup" catchtap="closeDetailPopup">
            <van-icon name="cross" class="close-icon" />
          </view>
        </view>
      </view>

          <!-- æ»šåŠ¨å†…å®¹åŒºåŸŸ -->
    <scroll-view scroll-y class="detail-content" enable-flex enhanced show-scrollbar="{{ false }}">
        <!-- æºå¸¦è§„å®šè¯¦æƒ… -->
        <view wx:if="{{ detailType === 'regulation' }}" class="regulation-detail">
          <!-- åŸºæœ¬ä¿¡æ¯ -->
          <van-cell-group title="åŸºæœ¬ä¿¡æ¯" class="detail-section">
            <van-cell title="ç‰©å“åç§°" value="{{ detailData.item_name }}" />
            <van-cell title="æ‰‹æè¡Œæ" value="{{ detailData.carry_on_limit || (detailData.allowed_in_carry_on ? 'å…è®¸æºå¸¦' : 'ç¦æ­¢æºå¸¦') }}" />
            <van-cell title="æ‰˜è¿è¡Œæ" value="{{ detailData.checked_limit || (detailData.allowed_in_checked_baggage ? 'å…è®¸æºå¸¦' : 'ç¦æ­¢æºå¸¦') }}" />
            <van-cell wx:if="{{ detailData.requires_operator_approval }}" title="ç‰¹æ®Šè¦æ±‚" value="éœ€èˆªç©ºå…¬å¸æ‰¹å‡†" />
            <van-cell wx:if="{{ detailData.requires_captain_notification }}" title="æœºé•¿é€šçŸ¥" value="éœ€æå‰å‘ŠçŸ¥æœºé•¿" />
          </van-cell-group>

          <!-- è¯¦ç»†è¯´æ˜ -->
          <van-cell-group title="è¯¦ç»†è¯´æ˜" class="detail-section">
            <view class="description-content">
              <!-- ä½¿ç”¨è§£æåçš„descriptionPartsæ¸²æŸ“å¸¦å±é™©å“é“¾æ¥çš„å†…å®¹ -->
              <view class="description-text">
                <block wx:if="{{ detailData.descriptionParts && detailData.descriptionParts.length > 0 }}">
                  <block wx:for="{{ detailData.descriptionParts }}" wx:key="index">
                    <text wx:if="{{ item.type === 'text' }}">{{ item.text }}</text>
                    <text wx:elif="{{ item.type === 'term' }}"
                          class="term-highlight clickable-term"
                          catchtap="onItemClick"
                          data-item="{{ item.itemName }}">{{ item.text }}</text>
                  </block>
                </block>
                <text wx:else>{{ detailData.description }}</text>
              </view>
            </view>
          </van-cell-group>

          <!-- ç‰¹æ®Šæ¡ä»¶ -->
          <van-cell-group wx:if="{{ detailData.special_condition }}" title="ç‰¹æ®Šæ¡ä»¶" class="detail-section">
            <view class="description-content">
              <text class="description-text">{{ detailData.special_condition }}</text>
            </view>
          </van-cell-group>
        </view>

        <!-- åº”æ€¥å“åº”è¯¦æƒ… -->
        <view wx:if="{{ detailType === 'emergency' }}" class="emergency-detail">
          <!-- åŸºæœ¬ä¿¡æ¯ -->
          <van-cell-group title="ä»£ç ä¿¡æ¯" class="detail-section">
            <van-cell title="åº”æ€¥ä»£ç " value="{{ detailData.code }}" />
          </van-cell-group>

          <!-- å±é™©ç±»å‹ -->
          <van-cell-group title="å±é™©ç±»å‹" class="detail-section">
            <view class="description-content">
              <view class="hazard-section">
                <view class="hazard-label">å›ºæœ‰å±é™©</view>
                <view class="description-text">
                  <block wx:if="{{ detailData.inherent_hazard_parts && detailData.inherent_hazard_parts.length > 0 }}">
                    <block wx:for="{{ detailData.inherent_hazard_parts }}" wx:key="index">
                      <text wx:if="{{ item.type === 'text' }}">{{ item.text }}</text>
                      <text wx:elif="{{ item.type === 'term' }}"
                            class="term-highlight clickable-term"
                            catchtap="onItemClick"
                            data-item="{{ item.itemName }}">{{ item.text }}</text>
                    </block>
                  </block>
                  <text wx:else>{{ detailData.inherent_hazard }}</text>
                </view>
              </view>

              <view class="hazard-section">
                <view class="hazard-label">å¯¹èˆªç©ºå™¨çš„å±é™©</view>
                <view class="description-text">
                  <block wx:if="{{ detailData.aircraft_hazard_parts && detailData.aircraft_hazard_parts.length > 0 }}">
                    <block wx:for="{{ detailData.aircraft_hazard_parts }}" wx:key="index">
                      <text wx:if="{{ item.type === 'text' }}">{{ item.text }}</text>
                      <text wx:elif="{{ item.type === 'term' }}"
                            class="term-highlight clickable-term"
                            catchtap="onItemClick"
                            data-item="{{ item.itemName }}">{{ item.text }}</text>
                    </block>
                  </block>
                  <text wx:else>{{ detailData.aircraft_hazard }}</text>
                </view>
              </view>

              <view class="hazard-section">
                <view class="hazard-label">å¯¹ä¹˜å‘˜çš„å±é™©</view>
                <view class="description-text">
                  <block wx:if="{{ detailData.occupant_hazard_parts && detailData.occupant_hazard_parts.length > 0 }}">
                    <block wx:for="{{ detailData.occupant_hazard_parts }}" wx:key="index">
                      <text wx:if="{{ item.type === 'text' }}">{{ item.text }}</text>
                      <text wx:elif="{{ item.type === 'term' }}"
                            class="term-highlight clickable-term"
                            catchtap="onItemClick"
                            data-item="{{ item.itemName }}">{{ item.text }}</text>
                    </block>
                  </block>
                  <text wx:else>{{ detailData.occupant_hazard }}</text>
                </view>
              </view>
            </view>
          </van-cell-group>

          <!-- åº”æ€¥ç¨‹åº -->
          <van-cell-group title="åº”æ€¥ç¨‹åº" class="detail-section">
            <view class="description-content">
              <view class="procedure-section">
                <view class="procedure-label">æ³„æ¼å¤„ç†ç¨‹åº</view>
                <text class="description-text">{{ detailData.spill_leak_procedure }}</text>
              </view>

              <view class="procedure-section">
                <view class="procedure-label">ç­ç«ç¨‹åº</view>
                <text class="description-text">{{ detailData.fire_fighting_procedure }}</text>
              </view>

              <view class="procedure-section">
                <view class="procedure-label">å…¶ä»–è€ƒè™‘</view>
                <text class="description-text">{{ detailData.other_considerations }}</text>
              </view>
            </view>
          </van-cell-group>
        </view>

        <!-- éšå«å±é™©å“è¯¦æƒ… -->
        <view wx:if="{{ detailType === 'hidden' }}" class="hidden-detail">
          <!-- ç±»åˆ«ä¿¡æ¯ -->
          <van-cell-group title="ç±»åˆ«ä¿¡æ¯" class="detail-section">
            <van-cell title="ä¸­æ–‡åç§°" value="{{ detailData.category_zh }}" />
            <van-cell title="è‹±æ–‡åç§°" value="{{ detailData.category_en }}" />
          </van-cell-group>

          <!-- è¯´æ˜ -->
          <van-cell-group title="è¯¦ç»†è¯´æ˜" class="detail-section">
            <view class="description-content">
              <!-- ä½¿ç”¨è§£æåçš„descriptionPartsæ¸²æŸ“å¸¦å±é™©å“é“¾æ¥çš„å†…å®¹ -->
              <view class="description-text">
                <block wx:if="{{ detailData.descriptionParts && detailData.descriptionParts.length > 0 }}">
                  <block wx:for="{{ detailData.descriptionParts }}" wx:key="index">
                    <text wx:if="{{ item.type === 'text' }}">{{ item.text }}</text>
                    <text wx:elif="{{ item.type === 'term' }}"
                          class="term-highlight clickable-term"
                          catchtap="onItemClick"
                          data-item="{{ item.itemName }}">{{ item.text }}</text>
                  </block>
                </block>
                <text wx:else>{{ detailData.description }}</text>
              </view>
            </view>
          </van-cell-group>

          <!-- å¯èƒ½åŒ…å«çš„ç‰©å“ -->
          <van-cell-group wx:if="{{ detailData.possible_items && detailData.possible_items.length > 0 }}" title="å¯èƒ½åŒ…å«çš„ç‰©å“" class="detail-section">
            <view class="description-content">
              <view class="possible-items-list">
                <view wx:for="{{ detailData.possible_items }}" wx:key="index" class="possible-item">
                  â€¢ {{ item }}
                </view>
              </view>
            </view>
          </van-cell-group>
        </view>

        <!-- åœ°é¢åº”æ€¥è¯¦æƒ… -->
        <view wx:if="{{ detailType === 'groundEmergency' }}" class="ground-emergency-detail">
          <!-- åŸºæœ¬ä¿¡æ¯ -->
          <van-cell-group title="åŸºæœ¬ä¿¡æ¯" class="detail-section">
            <van-cell title="åº”æ€¥ä»£ç " value="{{ detailData.code }}" />
            <van-cell title="å±é™©å“ç±»åˆ«" value="{{ detailData.class }}" />
            <van-cell title="ç±»åˆ«åç§°ï¼ˆä¸­æ–‡ï¼‰" value="{{ detailData.category_zh }}" />
            <van-cell title="ç±»åˆ«åç§°ï¼ˆè‹±æ–‡ï¼‰" value="{{ detailData.category_en }}" />
          </van-cell-group>

          <!-- å±é™©æè¿° -->
          <van-cell-group title="å±é™©æè¿°" class="detail-section">
            <view class="description-content">
              <view class="hazard-section">
                <view class="hazard-label">ä¸­æ–‡æè¿°</view>
                <view class="description-text">{{ detailData.hazard_description_zh }}</view>
              </view>
              <view class="hazard-section">
                <view class="hazard-label">è‹±æ–‡æè¿°</view>
                <view class="description-text">{{ detailData.hazard_description_en }}</view>
              </view>
            </view>
          </van-cell-group>

          <!-- ç«‹å³è¡ŒåŠ¨ -->
          <van-cell-group title="ç«‹å³è¡ŒåŠ¨" class="detail-section">
            <view class="description-content">
              <view class="procedure-section">
                <view class="procedure-label">ä¸­æ–‡è¯´æ˜</view>
                <text class="description-text">{{ detailData.immediate_action_zh }}</text>
              </view>
              <view class="procedure-section">
                <view class="procedure-label">è‹±æ–‡è¯´æ˜</view>
                <text class="description-text">{{ detailData.immediate_action_en }}</text>
              </view>
            </view>
          </van-cell-group>
        </view>
      </scroll-view>

      <!-- åº•éƒ¨æ“ä½œæ  -->
      <view class="detail-footer">
        <van-button type="primary" block bind:click="closeDetailPopup" class="close-button">
          <van-icon name="success" class="button-icon" />
          çŸ¥é“äº†
        </van-button>
      </view>
    </view>
  </van-popup>

  <!-- ç»Ÿè®¡ä¿¡æ¯ -->
  <view wx:if="{{ !loading && !searchValue }}" class="stats-section">
    <view class="stats-grid">
      <view class="stats-item">
        <text class="stats-number">{{ regulationsData.length }}</text>
        <text class="stats-label">æ¡æºå¸¦è§„å®š</text>
      </view>
      <view class="stats-item">
        <text class="stats-number">{{ emergencyData.length }}</text>
        <text class="stats-label">ä¸ªåº”æ€¥ç¨‹åº</text>
      </view>
      <view class="stats-item">
        <text class="stats-number">{{ hiddenGoodsData.length }}</text>
        <text class="stats-label">ç±»éšå«å±é™©å“</text>
      </view>
    </view>
  </view>

</view>