<view class="container" data-theme="{{ isDarkMode ? 'dark' : 'light' }}">
  <!-- 页面标题 -->
  <view class="page-header">
    <view class="header-title">✈️ 特殊计算工具</view>
    <view class="header-subtitle">专业航空计算，精准可靠</view>
  </view>

  

  <!-- 功能模块选择 -->
  <view class="modules-grid">
    <view class="module-card" bind:tap="selectModule" data-module="coldTemp">
      <view class="module-icon">🌡️</view>
      <view class="module-title">温度修正</view>
      <view class="module-desc">ICAO标准低温修正计算</view>
    </view>

    <view class="module-card" bind:tap="selectModule" data-module="gradient">
      <view class="module-icon">📐</view>
      <view class="module-title">梯度计算</view>
      <view class="module-desc">飞行梯度、升降率换算</view>
    </view>

    <view class="module-card" bind:tap="selectModule" data-module="pitch">
      <view class="module-icon">⚠️</view>
      <view class="module-title">PITCH警告</view>
      <view class="module-desc">PITCH PITCH警告计算</view>
    </view>

    <view class="module-card" bind:tap="selectModule" data-module="acr">
      <view class="module-icon">🛬</view>
      <view class="module-title">ACR-PCR</view>
      <view class="module-desc">飞机道面承载能力对比</view>
    </view>

    <view class="module-card" bind:tap="selectModule" data-module="gpws">
      <view class="module-icon">🚨</view>
      <view class="module-title">GPWS模拟</view>
      <view class="module-desc">地面接近警告系统模拟</view>
    </view>
  </view>


  <!-- 梯度计算模块 -->
  <view wx:if="{{ selectedModule === 'gradient' }}" class="calculation-module">
    <view class="module-header">
      <view class="back-btn" bind:tap="backToModules">← 返回</view>
      <view class="module-title">📐 梯度计算</view>
    </view>

    <view class="input-section">
      <view class="section-title">输入参数</view>
      
      <view class="input-group">
        <view class="input-label">📐 梯度</view>
        <van-field
          value="{{ gradientInput }}"
          placeholder="请输入梯度"
          type="digit"
          bind:change="onGradientInputChange"
          input-align="right"
        >
          <view slot="right-icon" class="unit-label">%</view>
        </van-field>
      </view>

      <view class="input-group">
        <view class="input-label">🌬️ 地速</view>
        <van-field
          value="{{ groundSpeedInput }}"
          placeholder="请输入地速"
          type="digit"
          bind:change="onGroundSpeedInputChange"
          input-align="right"
        >
          <view slot="right-icon" class="unit-label">节</view>
        </van-field>
      </view>

      <view class="input-group">
        <view class="input-label">⬆️ 升降率</view>
        <van-field
          value="{{ verticalSpeedInput }}"
          placeholder="请输入升降率"
          type="digit"
          bind:change="onVerticalSpeedInputChange"
          input-align="right"
        >
          <view slot="right-icon" class="unit-label">ft/min</view>
        </van-field>
      </view>

      <view class="input-group">
        <view class="input-label">📐 角度</view>
        <van-field
          value="{{ angleInput }}"
          placeholder="请输入角度"
          type="digit"
          bind:change="onAngleInputChange"
          input-align="right"
        >
          <view slot="right-icon" class="unit-label">度</view>
        </van-field>
      </view>
    </view>

    <view class="action-buttons">
      <van-button type="primary" bind:click="convertGradient" block>
        🚀 开始换算
      </van-button>
      <van-button type="default" bind:click="clearGradient" block>
        🗑️ 清空数据
      </van-button>
    </view>

    <!-- 计算结果 -->
    <view wx:if="{{ gradientResult || verticalSpeedResult || angleResult }}" class="result-section">
      <view class="result-title">📊 计算结果</view>
      <view class="result-grid">
        <view wx:if="{{ gradientResult }}" class="result-item">
          <view class="result-label">梯度</view>
          <view class="result-value">{{ gradientResult }}%</view>
        </view>
        <view wx:if="{{ verticalSpeedResult }}" class="result-item">
          <view class="result-label">升降率</view>
          <view class="result-value">{{ verticalSpeedResult }} ft/min</view>
        </view>
        <view wx:if="{{ angleResult }}" class="result-item">
          <view class="result-label">角度</view>
          <view class="result-value">{{ angleResult }}°</view>
        </view>
      </view>
    </view>
  </view>

  <!-- PITCH警告计算模块 -->
  <view wx:if="{{ selectedModule === 'pitch' }}" class="calculation-module">
    <view class="module-header">
      <view class="back-btn" bind:tap="backToModules">← 返回</view>
      <view class="module-title">⚠️ PITCH PITCH警告计算</view>
    </view>

    <view class="input-section">
      <view class="section-title">飞机型号选择</view>
      
      <view class="picker-group">
        <view class="picker-label">飞机型号</view>
        <view class="picker-value" bind:tap="showAircraftPicker">
          {{ pitchAircraftModelDisplay }}
        </view>
      </view>
    </view>

    <view class="input-section">
      <view class="section-title">飞行参数</view>
      
      <view class="input-group">
        <view class="input-label">📡 无线电高度 (RA)</view>
        <van-field
          value="{{ pitchRadioHeight }}"
          placeholder="例如: 15"
          type="digit"
          bind:change="onPitchRadioHeightChange"
          input-align="right"
        >
          <view slot="right-icon" class="unit-label">英尺</view>
        </van-field>
      </view>

      <view class="input-group">
        <view class="input-label">✈️ 当前飞机姿态</view>
        <van-field
          value="{{ pitchCurrentPitch }}"
          placeholder="例如: 8.0"
          type="digit"
          bind:change="onPitchCurrentPitchChange"
          input-align="right"
        >
          <view slot="right-icon" class="unit-label">度</view>
        </van-field>
      </view>

      <view class="input-group">
        <view class="input-label">📈 下一秒飞机姿态增加</view>
        <van-field
          value="{{ pitchPitchRate }}"
          placeholder="例如: 1.5"
          type="digit"
          bind:change="onPitchPitchRateChange"
          input-align="right"
        >
          <view slot="right-icon" class="unit-label">度/秒</view>
        </van-field>
      </view>
    </view>

    <view class="action-buttons">
      <van-button type="primary" bind:click="calculatePitchPitch" block>
        🚀 计算 PITCH PITCH 警告
      </van-button>
    </view>

    <!-- 计算结果 -->
    <view wx:if="{{ pitchResult }}" class="result-section">
      <view class="result-title">📊 计算结果</view>
      <view class="result-grid">
        <view class="result-item">
          <view class="result-label">预测俯仰角</view>
          <view class="result-value">{{ pitchPredictivePitch }}°</view>
        </view>
        <view class="result-item">
          <view class="result-label">触发阈值</view>
          <view class="result-value">{{ pitchThreshold }}°</view>
        </view>
        <view class="result-item {{ pitchShouldTrigger ? 'warning-item' : 'normal-item' }}">
          <view class="result-label">警告状态</view>
          <view class="result-value">{{ pitchWarningStatus }}</view>
        </view>
      </view>
    </view>

    <!-- 默认前提条件 -->
    <view wx:if="{{ pitchResult }}" class="info-section">
      <view class="info-title">ℹ️ 默认前提条件</view>
      <view class="info-list">
        <view class="info-item">飞行阶段: 着陆阶段</view>
        <view class="info-item">自动驾驶仪: 未接通</view>
        <view class="info-item">无线电高度: 有效</view>
        <view wx:if="{{ pitchAircraftModel !== 'A330-200' && pitchAircraftModel !== 'A330-300' }}" class="info-item">擦尾保护引脚: 已激活</view>
        <view wx:if="{{ pitchAircraftModel !== 'A330-200' && pitchAircraftModel !== 'A330-300' }}" class="info-item">推力手柄位置: 非起飞位</view>
        <view wx:if="{{ pitchAircraftModel !== 'A330-200' && pitchAircraftModel !== 'A330-300' }}" class="info-item">低高度条件: RA &lt; 20英尺</view>
        <view wx:if="{{ pitchAircraftModel === 'A330-200' || pitchAircraftModel === 'A330-300' }}" class="info-item">低高度条件: RA &lt; 25英尺</view>
      </view>
    </view>
  </view>

  <!-- ACR-PCR计算模块 -->
  <view wx:if="{{ selectedModule === 'acr' }}" class="calculation-module">
    <view class="module-header">
      <view class="back-btn" bind:tap="backToModules">← 返回</view>
      <view class="module-title">🛬 ACR-PCR计算</view>
    </view>

    <view class="input-section">
      <view class="section-title">飞机选择</view>
      
      <view class="picker-group">
        <view class="picker-label">制造商</view>
        <view class="picker-value" bind:tap="showManufacturerPicker">
          {{ acrSelectedManufacturer }}
        </view>
      </view>

      <view wx:if="{{ acrSelectedManufacturer }}" class="picker-group">
        <view class="picker-label">飞机型号</view>
        <view class="picker-value" bind:tap="showModelPicker">
          {{ acrSelectedModel }}
        </view>
      </view>

      <view wx:if="{{ acrSelectedModel }}" class="picker-group">
        <view class="picker-label">具体改型</view>
        <view class="picker-value" bind:tap="showVariantPicker">
          {{ acrSelectedVariantDisplay }}
        </view>
      </view>
    </view>

    <view class="input-section">
      <view class="section-title">飞机参数</view>
      
      <view wx:if="{{ acrMassInputEnabled }}" class="input-group">
        <view class="input-label">⚖️ {{ acrMassDisplayLabel }}</view>
        <van-field
          value="{{ acrAircraftMass }}"
          placeholder="请输入飞机重量"
          type="digit"
          bind:change="onAcrAircraftMassChange"
          input-align="right"
        >
          <view slot="right-icon" class="unit-label">kg</view>
        </van-field>
      </view>

      <view wx:if="{{ !acrMassInputEnabled }}" class="info-group">
        <view class="info-label">⚖️ {{ acrMassDisplayLabel }}</view>
        <view class="info-value">{{ acrAircraftMass }} kg</view>
      </view>
    </view>

    <view class="input-section">
      <view class="section-title">机场道面参数</view>
      <view class="help-text">对比航图上的PCR信息（格式示例：PCR560/F/B/W/T），对应输入到下方：</view>
      
      <view class="input-group">
        <view class="input-label">📊 PCR数值</view>
        <van-field
          value="{{ acrPcrNumber }}"
          placeholder="例如: 560, 1090"
          type="number"
          bind:change="onAcrPcrNumberChange"
          input-align="right"
        />
      </view>

      <view class="picker-group">
        <view class="picker-label">🛤️ 道面类型</view>
        <view class="picker-value" bind:tap="showPavementTypePicker">
          {{ acrPavementTypeDisplay }}
        </view>
      </view>

      <view class="picker-group">
        <view class="picker-label">🏗️ 道基强度类别</view>
        <view class="picker-value" bind:tap="showSubgradeStrengthPicker">
          {{ acrSubgradeStrengthDisplay }}
        </view>
      </view>

      <view class="picker-group">
        <view class="picker-label">💨 最大允许胎压</view>
        <view class="picker-value" bind:tap="showTirePressurePicker">
          {{ acrTirePressureDisplay }}
        </view>
      </view>

      <view class="picker-group">
        <view class="picker-label">📋 评估方法</view>
        <view class="picker-value" bind:tap="showEvaluationMethodPicker">
          {{ acrEvaluationMethodDisplay }}
        </view>
      </view>
    </view>

    <view class="action-buttons">
      <van-button type="primary" bind:click="calculateACR" block>
        🚀 开始对比
      </van-button>
    </view>

    <!-- ACR-PCR分析结果 -->
    <view wx:if="{{ acrResult }}" class="result-section">
      <view class="result-title">📊 分析结果</view>
      
      <view class="info-section">
        <view class="info-title">✈️ 飞机信息</view>
        <view class="info-list">
          <view class="info-item">飞机型号: {{ acrResult.aircraftInfo }}</view>
          <view class="info-item">输入质量: {{ acrResult.inputMass }} kg</view>
          <view class="info-item">具体改型: {{ acrResult.variantName }}</view>
          <view class="info-item">{{ acrResult.isInterpolated ? '计算质量' : '标准质量' }}: {{ acrResult.actualMass }} kg</view>
          <view class="info-item">计算方式: {{ acrResult.calculationMethod }}</view>
        </view>
      </view>

      <view class="info-section">
        <view class="info-title">🛬 道面条件</view>
        <view class="info-list">
          <view class="info-item">PCR代码: {{ acrResult.pcrCode }}</view>
          <view class="info-item">道面类型: {{ acrResult.pavementTypeName }}</view>
          <view class="info-item">道基强度: {{ acrResult.subgradeName }}</view>
          <view class="info-item {{ acrResult.tirePressureCheckPassed ? 'success-item' : 'error-item' }}">胎压检查: {{ acrResult.tirePressureCheck }}</view>
          <view class="info-item">评估方法: {{ acrResult.evaluationMethod }}</view>
        </view>
      </view>

      <view class="comparison-section">
        <view class="comparison-title">⚖️ ACR-PCR对比</view>
        <view class="comparison-grid">
          <view class="comparison-item acr-item">
            <view class="comparison-label">飞机ACR值</view>
            <view class="comparison-value">{{ acrResult.acr }}</view>
          </view>
          <view class="comparison-item pcr-item">
            <view class="comparison-label">机场PCR值</view>
            <view class="comparison-value">{{ acrResult.pcr }}</view>
          </view>
          <view class="comparison-item margin-item">
            <view class="comparison-label">安全余量</view>
            <view class="comparison-value">{{ acrResult.safetyMargin >= 0 ? '+' : '' }}{{ acrResult.safetyMargin }}</view>
          </view>
        </view>
      </view>

      <view class="conclusion-section {{ acrResult.canOperate ? 'success-conclusion' : 'error-conclusion' }}">
        <view class="conclusion-status">{{ acrResult.operationStatus }}</view>
        <view class="conclusion-reason">{{ acrResult.operationReason }}</view>
      </view>

      <view wx:if="{{ !acrResult.canOperate }}" class="warning-section">
        <view class="warning-title">⚠️ 安全提醒</view>
        <view wx:if="{{ !acrResult.tirePressureCheckPassed }}" class="warning-message">
          飞机轮胎压力超过了道面允许的限制，可能对道面造成损坏。
        </view>
        <view wx:elif="{{ acrResult.safetyMargin < 0 }}" class="warning-message">
          飞机的ACR值超过了道面的PCR值，可能对道面造成损坏。
        </view>
      </view>
    </view>

    <!-- 错误信息 -->
    <view wx:if="{{ acrError }}" class="error-section">
      <view class="error-title">⚠️ 错误信息</view>
      <view class="error-message">{{ acrError }}</view>
    </view>
  </view>

  <!-- GPWS告警模拟模块 -->
  <view wx:if="{{ selectedModule === 'gpws' }}" class="calculation-module">
    <view class="module-header">
      <view class="back-btn" bind:tap="backToModules">← 返回</view>
      <view class="module-title">🚨 GPWS告警模拟</view>
    </view>

    <!-- GPWS模式选择器 -->
    <view class="gpws-mode-selector">
      <view class="mode-tabs">
        <view 
          class="mode-tab {{ gpwsActiveMode === 'mode1' ? 'active' : '' }}"
          bind:tap="selectGPWSMode"
          data-mode="mode1"
        >Mode 1</view>
        <view 
          class="mode-tab {{ gpwsActiveMode === 'mode2' ? 'active' : '' }}"
          bind:tap="selectGPWSMode"
          data-mode="mode2"
        >Mode 2</view>
        <view 
          class="mode-tab {{ gpwsActiveMode === 'mode3' ? 'active' : '' }}"
          bind:tap="selectGPWSMode"
          data-mode="mode3"
        >Mode 3</view>
        <view 
          class="mode-tab {{ gpwsActiveMode === 'mode4' ? 'active' : '' }}"
          bind:tap="selectGPWSMode"
          data-mode="mode4"
        >Mode 4</view>
        <view 
          class="mode-tab {{ gpwsActiveMode === 'mode5' ? 'active' : '' }}"
          bind:tap="selectGPWSMode"
          data-mode="mode5"
        >Mode 5</view>
      </view>
    </view>

    <!-- Mode 1: 过度下降率 -->
    <view wx:if="{{ gpwsActiveMode === 'mode1' }}" class="gpws-mode-content">
      <view class="input-section">
        <view class="section-title">Mode 1 - 过度下降率阈值计算</view>
        <view class="help-text">Excessive Descent Rate Thresholds</view>
        
        <view class="input-group">
          <view class="input-label">📡 无线电高度</view>
          <van-field
            value="{{ mode1RA }}"
            placeholder="例如: 1000"
            type="digit"
            bind:change="onMode1RAChange"
            input-align="right"
          >
            <view slot="right-icon" class="unit-label">英尺</view>
          </van-field>
        </view>

        <view class="input-group">
          <view class="input-label">⬇️ 下降率</view>
          <van-field
            value="{{ mode1DescentRate }}"
            placeholder="例如: 1500"
            type="digit"
            bind:change="onMode1DescentRateChange"
            input-align="right"
          >
            <view slot="right-icon" class="unit-label">英尺/分</view>
          </van-field>
        </view>
      </view>

      <view class="action-buttons">
        <van-button type="primary" bind:click="calculateMode1" block>
          🚀 Mode 1 告警分析
        </van-button>
      </view>

      <!-- Mode 1 结果 -->
      <view wx:if="{{ mode1ThresholdResult }}" class="result-section">
        <view class="result-title">📊 分析结果</view>
        <view wx:if="{{ mode1ThresholdResult.valid }}" class="gpws-result {{ mode1ThresholdResult.type }}">
          <view class="gpws-status">{{ mode1ThresholdResult.status }}</view>
          <view class="gpws-message">{{ mode1ThresholdResult.message }}</view>
          <view wx:if="{{ mode1ThresholdResult.thresholdInfo }}" class="gpws-threshold">{{ mode1ThresholdResult.thresholdInfo }}</view>
          <view wx:if="{{ mode1ThresholdResult.detailedInfo }}" class="gpws-detail">{{ mode1ThresholdResult.detailedInfo }}</view>
          <view wx:if="{{ mode1ThresholdResult.warningLevel }}" class="gpws-level">{{ mode1ThresholdResult.warningLevel }}</view>
        </view>
        <view wx:else class="gpws-result warning">
          <view class="gpws-status">计算错误</view>
          <view class="gpws-message">{{ mode1ThresholdResult.message }}</view>
        </view>
      </view>
    </view>

    <!-- Mode 2: 过度地形接近率 -->
    <view wx:if="{{ gpwsActiveMode === 'mode2' }}" class="gpws-mode-content">
      <view class="input-section">
        <view class="section-title">Mode 2 - 过度地形接近率</view>
        <view class="help-text">Excessive Terrain Closure Rate</view>
        
        <view class="input-group">
          <view class="input-label">📡 无线电高度</view>
          <van-field
            value="{{ mode2RA }}"
            placeholder="例如: 1000"
            type="digit"
            bind:change="onMode2RAChange"
            input-align="right"
          >
            <view slot="right-icon" class="unit-label">英尺</view>
          </van-field>
        </view>

        <view class="input-group">
          <view class="input-label">🏔️ 地形接近率</view>
          <van-field
            value="{{ mode2TCR }}"
            placeholder="例如: 500"
            type="digit"
            bind:change="onMode2TCRChange"
            input-align="right"
          >
            <view slot="right-icon" class="unit-label">英尺/分</view>
          </van-field>
        </view>

        <view class="input-group">
          <view class="input-label">✈️ 计算空速</view>
          <van-field
            value="{{ mode2Airspeed }}"
            placeholder="例如: 180"
            type="digit"
            bind:change="onMode2AirspeedChange"
            input-align="right"
          >
            <view slot="right-icon" class="unit-label">节</view>
          </van-field>
        </view>

        <view class="switch-group">
          <view class="switch-label">襟翼在着陆构型</view>
          <van-switch 
            checked="{{ mode2FlapsInLanding }}" 
            bind:change="onMode2FlapsChange"
          />
        </view>

        <view class="switch-group">
          <view class="switch-label">起落架放下</view>
          <view class="switch-desc">影响Mode 2B的警告类型</view>
          <van-switch 
            checked="{{ mode2GearDown }}" 
            bind:change="onMode2GearChange"
          />
        </view>

        <view class="switch-group">
          <view class="switch-label">ILS进近模式</view>
          <view class="switch-desc">在±2个点偏差内的ILS进近，影响Mode 2B逻辑</view>
          <van-switch 
            checked="{{ mode2ILSMode }}" 
            bind:change="onMode2ILSChange"
          />
        </view>

        <view class="switch-group">
          <view class="switch-label">TAD/几何高度激活（增强功能）</view>
          <view class="switch-desc">激活时会显著影响Mode 2和Mode 4的警告逻辑</view>
          <van-switch 
            checked="{{ mode2TADActive }}" 
            bind:change="onMode2TADChange"
          />
        </view>
      </view>

      <view class="action-buttons">
        <van-button type="primary" bind:click="calculateMode2" block>
          🚀 Mode 2 告警分析
        </van-button>
      </view>

      <!-- Mode 2 结果 -->
      <view wx:if="{{ mode2Result }}" class="result-section">
        <view class="result-title">📊 分析结果</view>
        <view class="gpws-result {{ mode2Result.type }}">
          <view class="gpws-status">{{ mode2Result.status }}</view>
          <view class="gpws-message">{{ mode2Result.message }}</view>
          <view wx:if="{{ mode2Result.thresholdInfo }}" class="gpws-threshold">{{ mode2Result.thresholdInfo }}</view>
          <view wx:if="{{ mode2Result.envelopeInfo }}" class="gpws-detail">{{ mode2Result.envelopeInfo }}</view>
        </view>
      </view>
    </view>

    <!-- Mode 3: 起飞后高度损失 -->
    <view wx:if="{{ gpwsActiveMode === 'mode3' }}" class="gpws-mode-content">
      <view class="input-section">
        <view class="section-title">Mode 3 - 起飞后高度损失</view>
        <view class="help-text">Altitude Loss After Takeoff</view>
        <view class="help-text">输入无线电高度和实际高度损失，判断是否触发DON'T SINK警告</view>
        
        <view class="input-group">
          <view class="input-label">📡 无线电高度 (RA)</view>
          <van-field
            value="{{ mode3RA }}"
            placeholder="例如: 100, 200, 500"
            type="digit"
            bind:change="onMode3RAChange"
            input-align="right"
          >
            <view slot="right-icon" class="unit-label">英尺</view>
          </van-field>
        </view>

        <view class="input-group">
          <view class="input-label">📉 高度损失</view>
          <van-field
            value="{{ mode3AltitudeLoss }}"
            placeholder="例如: 50, 100, 150"
            type="digit"
            bind:change="onMode3AltitudeLossChange"
            input-align="right"
          >
            <view slot="right-icon" class="unit-label">英尺</view>
          </van-field>
        </view>
      </view>

      <view class="action-buttons">
        <van-button type="primary" bind:click="calculateMode3" block>
          🚀 Mode 3 告警分析
        </van-button>
      </view>

      <!-- Mode 3 结果 -->
      <view wx:if="{{ mode3Result }}" class="result-section">
        <view class="result-title">📊 分析结果</view>
        <view class="gpws-result {{ mode3Result.type }}">
          <view class="gpws-status">{{ mode3Result.status }}</view>
          <view class="gpws-message">{{ mode3Result.message }}</view>
          <view wx:if="{{ mode3Result.thresholdInfo }}" class="gpws-threshold">{{ mode3Result.thresholdInfo }}</view>
          <view wx:if="{{ mode3Result.detailedInfo }}" class="gpws-detail">{{ mode3Result.detailedInfo }}</view>
        </view>
      </view>
    </view>

    <!-- Mode 4: 不安全地形穿越 -->
    <view wx:if="{{ gpwsActiveMode === 'mode4' }}" class="gpws-mode-content">
      <view class="input-section">
        <view class="section-title">Mode 4 - 不安全地形穿越</view>
        <view class="help-text">Unsafe Terrain Clearance</view>
        <view class="help-text">选择具体子模式进行分析，每个子模式有不同的激活条件和阈值计算逻辑</view>
        
        <view class="picker-group">
          <view class="picker-label">子模式选择</view>
          <view class="picker-value" bind:tap="showMode4SubModePicker">
            {{ mode4SubModeDisplayName }}
          </view>
        </view>

        <view class="input-group">
          <view class="input-label">📡 无线电高度 (RA)</view>
          <van-field
            value="{{ mode4RA }}"
            placeholder="例如: 300, 600, 800"
            type="digit"
            bind:change="onMode4RAChange"
            input-align="right"
          >
            <view slot="right-icon" class="unit-label">英尺</view>
          </van-field>
        </view>

        <view class="input-group">
          <view class="input-label">✈️ 计算空速 (CAS)</view>
          <van-field
            value="{{ mode4Airspeed }}"
            placeholder="例如: 150, 200, 250"
            type="digit"
            bind:change="onMode4AirspeedChange"
            input-align="right"
          >
            <view slot="right-icon" class="unit-label">节</view>
          </van-field>
        </view>

        <!-- Mode 4A 专属参数 -->
        <view wx:if="{{ mode4SubMode === '4A' }}" class="mode-specific-section">
          <view class="info-text">✈️ 巡航、进近阶段 | 🎛️ 起落架收上 | 🛬 襟翼非着陆构型 | ⚙️ MCDU已选择正确的着陆构型（比如形态3）</view>
          
          <view class="switch-group">
            <view class="switch-label">TAD高完整性模式</view>
            <view class="switch-desc">地形感知数据高精度模式</view>
            <van-switch 
              checked="{{ mode4A_TADHighIntegrity }}" 
              bind:change="onMode4A_TADHighIntegrityChange"
            />
          </view>

          <view class="switch-group">
            <view class="switch-label">TCF启用</view>
            <view class="switch-desc">地形穿越下限功能</view>
            <van-switch 
              checked="{{ mode4A_TCFEnabled }}" 
              bind:change="onMode4A_TCFEnabledChange"
            />
          </view>

          <view class="switch-group">
            <view class="switch-label">飞越其他航空器</view>
            <view class="switch-desc">盘旋等待或飞越其他飞机时启用（阈值降至800ft）</view>
            <van-switch 
              checked="{{ mode4A_OverflightDetected }}" 
              bind:change="onMode4A_OverflightDetectedChange"
            />
          </view>

          <view class="info-text">💡 计算示例: 空速150kts，RA400ft → TOO LOW GEAR | 空速220kts，RA400ft → 安全（阈值≈583ft）</view>
        </view>

        <!-- Mode 4B 专属参数 -->
        <view wx:if="{{ mode4SubMode === '4B' }}" class="mode-specific-section">
          <view class="info-text">✈️ 进近构型 | 🎛️ 起落架放下或襟翼着陆构型 | 📊 标准边界245ft | 🛡️ 全构型时自动抑制</view>
          
          <view class="switch-group">
            <view class="switch-label">起落架放下</view>
            <view class="switch-desc">起落架在着陆构型</view>
            <van-switch 
              checked="{{ mode4B_GearDown }}" 
              bind:change="onMode4B_GearDownChange"
            />
          </view>

          <view class="switch-group">
            <view class="switch-label">襟翼在着陆构型</view>
            <view class="switch-desc">全襟翼或CONF 3构型</view>
            <van-switch 
              checked="{{ mode4B_FlapsInLanding }}" 
              bind:change="onMode4B_FlapsInLandingChange"
            />
          </view>

          <view class="switch-group">
            <view class="switch-label">TAD高完整性模式</view>
            <view class="switch-desc">地形感知数据高精度模式</view>
            <van-switch 
              checked="{{ mode4B_TADHighIntegrity }}" 
              bind:change="onMode4B_TADHighIntegrityChange"
            />
          </view>

          <view class="switch-group">
            <view class="switch-label">TCF启用</view>
            <view class="switch-desc">地形穿越下限功能</view>
            <van-switch 
              checked="{{ mode4B_TCFEnabled }}" 
              bind:change="onMode4B_TCFEnabledChange"
            />
          </view>

          <view class="switch-group">
            <view class="switch-label">飞越其他航空器</view>
            <view class="switch-desc">检测到飞越时800ft限制（需襟翼收上）</view>
            <van-switch 
              checked="{{ mode4B_OverflightDetected }}" 
              bind:change="onMode4B_OverflightDetectedChange"
            />
          </view>

          <view class="info-text">💡 计算示例: 空速150kts，RA200ft，起落架收上+襟翼着陆构型 → TOO LOW GEAR | 空速220kts，RA200ft，起落架放下+襟翼非着陆构型 → 安全（阈值≈583ft）</view>
        </view>

        <!-- Mode 4C 专属参数 -->
        <view wx:if="{{ mode4SubMode === '4C' }}" class="mode-specific-section">
          <view class="info-text">起飞阶段地形穿越检查</view>
          
          <view class="input-group">
            <view class="input-label">📈 起飞后最大RA</view>
            <van-field
              value="{{ mode4MaxRA }}"
              placeholder="例如: 1000"
              type="digit"
              bind:change="onMode4MaxRAChange"
              input-align="right"
            >
              <view slot="right-icon" class="unit-label">英尺</view>
            </van-field>
          </view>

          <view class="switch-group">
            <view class="switch-label">起落架或襟翼放下</view>
            <view class="switch-desc">影响TOO LOW TERRAIN消息触发</view>
            <van-switch 
              checked="{{ mode4C_GearOrFlapsDown }}" 
              bind:change="onMode4C_GearOrFlapsDownChange"
            />
          </view>
        </view>
      </view>

      <view class="action-buttons">
        <van-button type="primary" bind:click="calculateMode4" block>
          🚀 Mode {{ mode4SubMode }} 告警分析
        </van-button>
      </view>

      <!-- Mode 4 结果 -->
      <view wx:if="{{ mode4Result }}" class="result-section">
        <view class="result-title">📊 分析结果</view>
        <view class="gpws-result {{ mode4Result.type }}">
          <view class="gpws-status">{{ mode4Result.status }}</view>
          <view class="gpws-message">{{ mode4Result.message }}</view>
          <view wx:if="{{ mode4Result.subModeInfo }}" class="gpws-submode">{{ mode4Result.subModeInfo }}</view>
          <view wx:if="{{ mode4Result.thresholdInfo }}" class="gpws-threshold">{{ mode4Result.thresholdInfo }}</view>
          <view wx:if="{{ mode4Result.envelopeInfo }}" class="gpws-detail">{{ mode4Result.envelopeInfo }}</view>
        </view>
      </view>
    </view>

    <!-- Mode 5: 过度下滑道偏离 -->
    <view wx:if="{{ gpwsActiveMode === 'mode5' }}" class="gpws-mode-content">
      <view class="input-section">
        <view class="section-title">Mode 5 - 过度下滑道偏离</view>
        <view class="help-text">Glide Slope Deviation</view>
        
        <view class="input-group">
          <view class="input-label">📡 无线电高度</view>
          <van-field
            value="{{ mode5RA }}"
            placeholder="例如: 300"
            type="digit"
            bind:change="onMode5RAChange"
            input-align="right"
          >
            <view slot="right-icon" class="unit-label">英尺</view>
          </van-field>
        </view>

        <view class="input-group">
          <view class="input-label">📐 下滑道向下偏离度</view>
          <van-field
            value="{{ mode5GSDeviation }}"
            placeholder="例如: 1.5"
            type="digit"
            bind:change="onMode5GSDeviationChange"
            input-align="right"
          >
            <view slot="right-icon" class="unit-label">点</view>
          </van-field>
        </view>
      </view>

      <view class="action-buttons">
        <van-button type="primary" bind:click="calculateMode5" block>
          🚀 Mode 5 告警分析
        </van-button>
      </view>

      <!-- Mode 5 结果 -->
      <view wx:if="{{ mode5Result }}" class="result-section">
        <view class="result-title">📊 分析结果</view>
        <view class="gpws-result {{ mode5Result.type }}">
          <view class="gpws-status">{{ mode5Result.status }}</view>
          <view class="gpws-message">{{ mode5Result.message }}</view>
          <view wx:if="{{ mode5Result.thresholdInfo }}" class="gpws-threshold">{{ mode5Result.thresholdInfo }}</view>
          <view wx:if="{{ mode5Result.envelopeInfo }}" class="gpws-detail">{{ mode5Result.envelopeInfo }}</view>
        </view>
      </view>
    </view>
  </view>

  <!-- 所有弹窗选择器保持原有功能 -->
  <!-- 飞机型号选择器 -->
  <van-action-sheet
    show="{{ showAircraftModelPicker }}"
    title="选择飞机型号"
    bind:close="onAircraftPickerClose"
    bind:select="onAircraftModelSelect"
    actions="{{ aircraftModelActions }}"
  />

  <!-- ACR制造商选择器 -->
  <van-action-sheet
    show="{{ showAcrManufacturerPicker }}"
    title="选择制造商"
    bind:close="onAcrManufacturerPickerClose"
    bind:select="onAcrManufacturerSelect"
    actions="{{ acrManufacturerActions }}"
  />

  <!-- ACR型号选择器 -->
  <van-action-sheet
    show="{{ showAcrModelPicker }}"
    title="选择飞机型号"
    bind:close="onAcrModelPickerClose"
    bind:select="onAcrModelSelect"
    actions="{{ acrModelActions }}"
  />

  <!-- ACR变型选择器 -->
  <van-action-sheet
    show="{{ showAcrVariantPicker }}"
    title="选择具体改型"
    bind:close="onAcrVariantPickerClose"
    bind:select="onAcrVariantSelect"
    actions="{{ acrVariantActions }}"
  />

  <!-- 道面类型选择器 -->
  <van-action-sheet
    show="{{ showPavementTypePicker }}"
    title="选择道面类型"
    bind:close="onPavementTypePickerClose"
    bind:select="onPavementTypeSelect"
    actions="{{ pavementTypeActions }}"
  />

  <!-- 道基强度类别选择器 -->
  <van-action-sheet
    show="{{ showSubgradeStrengthPicker }}"
    title="选择道基强度类别"
    bind:close="onSubgradeStrengthPickerClose"
    bind:select="onSubgradeStrengthSelect"
    actions="{{ subgradeStrengthActions }}"
  />

  <!-- 最大允许胎压选择器 -->
  <van-action-sheet
    show="{{ showTirePressurePicker }}"
    title="选择最大允许胎压"
    bind:close="onTirePressurePickerClose"
    bind:select="onTirePressureSelect"
    actions="{{ tirePressureActions }}"
  />

  <!-- 评估方法选择器 -->
  <van-action-sheet
    show="{{ showEvaluationMethodPicker }}"
    title="选择评估方法"
    bind:close="onEvaluationMethodPickerClose"
    bind:select="onEvaluationMethodSelect"
    actions="{{ evaluationMethodActions }}"
  />

  <!-- Mode 4 子模式选择器 -->
  <van-popup
    show="{{ showMode4SubModePicker }}"
    bind:close="onMode4SubModePickerClose"
    position="bottom"
    round="{{ true }}"
    custom-style="padding: 20px;"
  >
    <view class="mode-picker-container">
      <view class="mode-picker-title">选择GPWS Mode 4子模式</view>
      
      <view class="mode-cards-container">
        <view 
          class="mode-card {{ mode4SubMode === '4A' ? 'mode-card-selected' : '' }}"
          bind:tap="onMode4SubModeCardSelect"
          data-mode="4A"
        >
          <view class="mode-card-header">
            <view class="mode-card-icon">🛫</view>
            <view class="mode-card-badge" wx:if="{{ mode4SubMode === '4A' }}">✓</view>
          </view>
          <view class="mode-card-title">Mode 4A</view>
          <view class="mode-card-subtitle">巡航进近</view>
          <view class="mode-card-description">起落架收上，襟翼非着陆构型</view>
        </view>
        
        <view 
          class="mode-card {{ mode4SubMode === '4B' ? 'mode-card-selected' : '' }}"
          bind:tap="onMode4SubModeCardSelect"
          data-mode="4B"
        >
          <view class="mode-card-header">
            <view class="mode-card-icon">🛬</view>
            <view class="mode-card-badge" wx:if="{{ mode4SubMode === '4B' }}">✓</view>
          </view>
          <view class="mode-card-title">Mode 4B</view>
          <view class="mode-card-subtitle">进近构型</view>
          <view class="mode-card-description">起落架放下或襟翼着陆构型</view>
        </view>
        
        <view 
          class="mode-card {{ mode4SubMode === '4C' ? 'mode-card-selected' : '' }}"
          bind:tap="onMode4SubModeCardSelect"
          data-mode="4C"
        >
          <view class="mode-card-header">
            <view class="mode-card-icon">🚀</view>
            <view class="mode-card-badge" wx:if="{{ mode4SubMode === '4C' }}">✓</view>
          </view>
          <view class="mode-card-title">Mode 4C</view>
          <view class="mode-card-subtitle">起飞阶段</view>
          <view class="mode-card-description">地形穿越检查</view>
        </view>
      </view>
    </view>
  </van-popup>
</view>

<van-toast id="van-toast" />