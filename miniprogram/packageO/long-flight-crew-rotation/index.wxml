<!--é•¿èˆªçº¿æ¢ç­é¡µé¢-->
<view class="container">

  <!-- èˆªç­åŸºæœ¬ä¿¡æ¯ -->
  <van-cell-group title="èˆªç­åŸºæœ¬ä¿¡æ¯" custom-class="section-group">
    <!-- èµ·é£æ—¶é—´ -->
    <van-cell 
      title="èµ·é£æ—¶é—´" 
      value="{{ departureTimeDisplay || 'ç‚¹å‡»é€‰æ‹©èµ·é£æ—¶é—´' }}"
      is-link
      bind:click="showDepartureTimePicker"
    />

    <!-- é£è¡Œæ—¶é—´ -->
    <van-cell 
      title="é£è¡Œæ—¶é—´" 
      value="{{ flightHours }}å°æ—¶{{ flightMinutes }}åˆ†é’Ÿ"
      is-link
      bind:click="showFlightDurationPicker"
    />

    <!-- æœºç»„å¥—æ•° -->
    <van-cell title="æœºç»„å¥—æ•°" center>
      <view slot="right-icon">
        <van-stepper 
          value="{{ crewCount }}" 
          min="2" 
          max="5" 
          integer
          bind:change="onCrewCountChange"
          input-width="50px"
          disable-input
        />
      </view>
    </van-cell>
  </van-cell-group>

  <!-- æ¢ç­è§„åˆ™è¯´æ˜ -->
  <van-cell-group title="æ¢ç­è§„åˆ™" custom-class="section-group">
    <!-- å¹³å‡åˆ†é…è¯´æ˜ -->
    <van-cell 
      title="åˆ†é…æ–¹å¼" 
      value="æ€»é£è¡Œæ—¶é—´Ã·æœºç»„å¥—æ•°Ã·è½®æ•°"
      label="å¤šè½®æ¢ç­ï¼Œæ¯æ®µæ—¶é—´å¹³å‡åˆ†é…"
    />
    
    <!-- ç¬¬ä¸€å¥—æœºç»„è¯´æ˜ -->
    <van-cell 
      title="ç¬¬ä¸€å¥—æœºç»„" 
      value="èµ·é£ + ç€é™†"
      label="èµ·é£æ—¶é—´=å¹³å‡æ—¶é—´-è¿›é©¾é©¶èˆ±æ—¶é—´ï¼Œç€é™†å‰æŒ‡å®šæ—¶é—´é‡æ–°ä¸Šåº§"
    />
    
    <!-- å…¶ä»–æœºç»„è¯´æ˜ -->
    <van-cell 
      title="å…¶ä»–æœºç»„" 
      value="å·¡èˆªè½®æ¢"
      label="ç¬¬2å¥—æœºç»„ä½¿ç”¨å¹³å‡æ—¶é—´ï¼Œåç»­æœºç»„ç»§ç»­è½®æ¢"
    />
    
    <!-- æ¢ç­è½®æ•°è®¾ç½® -->
    <van-cell title="æ¢ç­è½®æ•°" center>
      <view slot="right-icon">
        <van-stepper 
          value="{{ rotationRounds }}" 
          min="1" 
          max="5" 
          integer
          bind:change="onRotationRoundsChange"
          input-width="50px"
          disable-input
        />
      </view>
    </van-cell>
    
    <!-- è¿›é©¾é©¶èˆ±æ—¶é—´è®¾ç½® -->
    <van-cell 
      title="è¿›é©¾é©¶èˆ±æ—¶é—´" 
      value="{{ landingAdvanceHours }}å°æ—¶{{ landingAdvanceMinutes }}åˆ†é’Ÿ"
      label="ç€é™†å‰å¤šä¹…ç¬¬ä¸€å¥—æœºç»„è¿›å…¥é©¾é©¶èˆ±å€¼ç­"
      is-link
      bind:click="showLandingAdvanceTimePicker"
    />
  </van-cell-group>

  <!-- ğŸ¯ åŸºäºContext7æœ€ä½³å®è·µï¼šè®¡ç®—æŒ‰é’®ï¼ˆå·²åœ¨è¿›å…¥é¡µé¢æ—¶æ‰£é™¤3ç§¯åˆ†ï¼‰ -->
  <van-cell-group custom-class="section-group">
    <van-cell class="button-cell">
      <van-button 
        type="primary" 
        block
        bind:click="calculateRotation"
      >
        è®¡ç®—æ¢ç­å®‰æ’
      </van-button>
    </van-cell>
  </van-cell-group>

  <!-- è®¡ç®—ç»“æœ -->
  <view wx:if="{{ showResult && rotationResult }}" class="result-section" id="result-section">
    




    <!-- è¯¦ç»†å€¼å‹¤å®‰æ’ -->
    <van-cell-group title="è¯¦ç»†å€¼å‹¤å®‰æ’" custom-class="result-group">
      <van-cell 
        wx:for="{{ rotationResult.dutySchedule }}" 
        wx:key="index"
        title="{{ item.phase === 'takeoff' ? 'ç¬¬' + item.crewNumber + 'å¥—æœºç»„(èµ·é£)' : item.phase === 'landing' ? 'ç¬¬' + item.crewNumber + 'å¥—æœºç»„(ç€é™†)' : 'ç¬¬' + item.crewNumber + 'å¥—æœºç»„(å·¡èˆª)' }}"
        label="{{ item.displayStartTime }} - {{ item.displayEndTime }}"
        value="{{ item.displayDuration }}"
        custom-class="duty-cell {{ item.phase === 'takeoff' ? 'takeoff-phase' : item.phase === 'landing' ? 'landing-phase' : 'crew-' + item.crewNumber }}"
      >
        <view slot="icon" class="duty-icon">
          <van-tag 
            type="primary" 
            size="medium"
            custom-class="crew-tag {{ item.phase === 'takeoff' ? 'takeoff-tag' : item.phase === 'landing' ? 'landing-tag' : 'crew-' + item.crewNumber + '-tag' }}"
          >
            {{ item.phase === 'takeoff' ? 'èµ·é£' : item.phase === 'landing' ? 'ç€é™†' : 'å·¡èˆª' }}
          </van-tag>
        </view>
      </van-cell>
    </van-cell-group>



    <!-- æ“ä½œæŒ‰é’® -->
    <van-cell-group custom-class="result-group">
      <van-cell class="button-cell">
        <van-button 
          type="default" 
          block
          bind:click="clearResult"
        >
          é‡æ–°è®¡ç®—
        </van-button>
      </van-cell>
      <van-cell class="button-cell copy-button">
        <van-button 
          type="primary" 
          block
          bind:click="shareRotation"
        >
          å¤åˆ¶å®‰æ’
        </van-button>
      </van-cell>
    </van-cell-group>

  </view>

</view>

<!-- èµ·é£æ—¶é—´é€‰æ‹©å™¨ -->
<van-popup
  show="{{ showDepartureTimePicker }}"
  bind:close="closeDepartureTimePicker"
  position="bottom"
  round="{{ true }}"
>
  <van-datetime-picker
    type="time"
    value="{{ departureTimeValue }}"
    bind:confirm="confirmDepartureTime"
    bind:cancel="closeDepartureTimePicker"
    title="é€‰æ‹©èµ·é£æ—¶é—´"
  />
</van-popup>

<!-- é£è¡Œæ—¶é—´é€‰æ‹©å™¨ -->
<van-popup
  show="{{ showFlightDurationPicker }}"
  bind:close="closeFlightDurationPicker"
  position="bottom"
  round="{{ true }}"
>
  <van-picker
    columns="{{ flightDurationColumns }}"
    bind:confirm="confirmFlightDuration"
    bind:cancel="closeFlightDurationPicker"
    title="é€‰æ‹©é£è¡Œæ—¶é—´"
    show-toolbar="{{ true }}"
    confirm-button-text="ç¡®è®¤"
    cancel-button-text="å–æ¶ˆ"
  />
</van-popup>

<!-- è¿›é©¾é©¶èˆ±æ—¶é—´é€‰æ‹©å™¨ -->
<van-popup
  show="{{ showLandingAdvanceTimePicker }}"
  bind:close="closeLandingAdvanceTimePicker"
  position="bottom"
  round="{{ true }}"
>
  <van-picker
    columns="{{ landingAdvanceTimeColumns }}"
    bind:confirm="confirmLandingAdvanceTime"
    bind:cancel="closeLandingAdvanceTimePicker"
    title="é€‰æ‹©è¿›é©¾é©¶èˆ±æ—¶é—´"
    show-toolbar="{{ true }}"
    confirm-button-text="ç¡®è®¤"
    cancel-button-text="å–æ¶ˆ"
  />
</van-popup>


 