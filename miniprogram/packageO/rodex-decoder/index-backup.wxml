<view class="container">
  <!-- 页面标题 -->
  <view class="page-header">
    <view class="header-title">
      <text class="title-icon">🛬</text>
      <text class="title-text">RODEX 跑道状态解码器</text>
    </view>
    <view class="header-subtitle">专业飞行员工具 - 分步引导式RODEX代码生成</view>
  </view>

  <!-- 示例引导 -->
  <view class="example-guide" wx:if="{{ currentStep <= 5 }}">
    <view class="guide-header">
      <text class="guide-icon">📝</text>
      <text class="guide-title">示例引导</text>
    </view>
    <view class="guide-content">
      <text class="guide-description">以 R99/421594 为例，我们将分步生成这个RODEX代码：</text>
      <view class="guide-breakdown">
        <view class="guide-item {{ currentStep >= 1 ? 'highlight' : '' }}">
          <text class="guide-code">R99</text>
          <text class="guide-desc">跑道识别</text>
        </view>
        <view class="guide-separator">/</view>
        <view class="guide-item {{ currentStep >= 2 ? 'highlight' : '' }}">
          <text class="guide-code">4</text>
          <text class="guide-desc">污染物</text>
        </view>
        <view class="guide-item {{ currentStep >= 3 ? 'highlight' : '' }}">
          <text class="guide-code">2</text>
          <text class="guide-desc">覆盖</text>
        </view>
        <view class="guide-item {{ currentStep >= 4 ? 'highlight' : '' }}">
          <text class="guide-code">15</text>
          <text class="guide-desc">深度</text>
        </view>
        <view class="guide-item {{ currentStep >= 5 ? 'highlight' : '' }}">
          <text class="guide-code">94</text>
          <text class="guide-desc">刹车</text>
        </view>
      </view>
      <view class="guide-action" wx:if="{{ currentStep === 1 }}">
        <button 
          class="example-fill-button" 
          bind:tap="fillExample" 
          data-code="R99/421594"
        >
          一键填入此示例
        </button>
      </view>
    </view>
  </view>

  <!-- 步骤指示器 -->
  <view class="step-indicator">
    <view class="step-item {{ currentStep >= 1 ? 'active' : '' }} {{ currentStep > 1 ? 'completed' : '' }} clickable" bind:tap="goToStep" data-step="1">
      <view class="step-number">1</view>
      <view class="step-label">跑道</view>
    </view>
    <view class="step-line {{ currentStep > 1 ? 'completed' : '' }}"></view>
    <view class="step-item {{ currentStep >= 2 ? 'active' : '' }} {{ currentStep > 2 ? 'completed' : '' }} clickable" bind:tap="goToStep" data-step="2">
      <view class="step-number">2</view>
      <view class="step-label">污染物</view>
    </view>
    <view class="step-line {{ currentStep > 2 ? 'completed' : '' }}"></view>
    <view class="step-item {{ currentStep >= 3 ? 'active' : '' }} {{ currentStep > 3 ? 'completed' : '' }} clickable" bind:tap="goToStep" data-step="3">
      <view class="step-number">3</view>
      <view class="step-label">覆盖范围</view>
    </view>
    <view class="step-line {{ currentStep > 3 ? 'completed' : '' }}"></view>
    <view class="step-item {{ currentStep >= 4 ? 'active' : '' }} {{ currentStep > 4 ? 'completed' : '' }} clickable" bind:tap="goToStep" data-step="4">
      <view class="step-number">4</view>
      <view class="step-label">深度</view>
    </view>
    <view class="step-line {{ currentStep > 4 ? 'completed' : '' }}"></view>
    <view class="step-item {{ currentStep >= 5 ? 'active' : '' }} {{ currentStep > 5 ? 'completed' : '' }} clickable" bind:tap="goToStep" data-step="5">
      <view class="step-number">5</view>
      <view class="step-label">刹车效应</view>
    </view>
  </view>

  <!-- 实时RODEX代码预览 -->
  <view class="preview-section" wx:if="{{ currentStep <= 5 }}">
    <view class="preview-header">
      <text class="preview-title">🎯 实时RODEX代码预览</text>
    </view>
    <view class="preview-code-container">
      <view class="preview-code-parts">
        <!-- 跑道部分 -->
        <text class="code-part {{ currentInputPart === 'runway' ? 'active' : (rodex.runwayDesignator ? 'completed' : 'pending') }}">
          R{{ rodex.runwayDesignator || '__' }}
        </text>
        
        <!-- 分隔符 -->
        <text class="code-separator" wx:if="{{ currentStep >= 2 }}">/</text>
        
        <!-- 污染物类型 -->
        <text class="code-part {{ currentInputPart === 'deposit' ? 'active' : (rodex.depositType || rodex.isCleared ? 'completed' : 'pending') }}" wx:if="{{ currentStep >= 2 }}">
          {{ rodex.isCleared ? 'CLRD' : (rodex.depositType || '_') }}
        </text>
        
        <!-- 覆盖范围 -->
        <text class="code-part {{ currentInputPart === 'extent' ? 'active' : (rodex.contaminationExtent ? 'completed' : 'pending') }}" wx:if="{{ currentStep >= 3 && !rodex.isCleared }}">
          {{ rodex.contaminationExtent || '_' }}
        </text>
        
        <!-- 深度 -->
        <text class="code-part {{ currentInputPart === 'depth' ? 'active' : (rodex.depthCode ? 'completed' : 'pending') }}" wx:if="{{ currentStep >= 4 && !rodex.isCleared }}">
          {{ rodex.depthCode || '__' }}
        </text>
        
        <!-- 刹车效应 -->
        <text class="code-part {{ currentInputPart === 'braking' ? 'active' : (rodex.brakingCode ? 'completed' : 'pending') }}" wx:if="{{ currentStep >= 5 && !rodex.isCleared }}">
          {{ rodex.brakingCode || '__' }}
        </text>
        
        <!-- 清除状态的结尾 -->
        <text class="code-separator" wx:if="{{ currentStep >= 2 && rodex.isCleared }}">//</text>
      </view>
      
      <!-- 当前输入说明 -->
      <view class="current-input-hint" wx:if="{{ currentInputPart }}">
        <text class="hint-icon">👆</text>
        <text class="hint-text">
          {{ currentInputPart === 'runway' ? '正在输入：跑道编号' : 
             currentInputPart === 'deposit' ? '正在输入：污染物类型' :
             currentInputPart === 'extent' ? '正在输入：覆盖范围' :
             currentInputPart === 'depth' ? '正在输入：污染物深度' :
             currentInputPart === 'braking' ? '正在输入：刹车效应' : '' }}
        </text>
      </view>
    </view>
  </view>

  <!-- 步骤1: 跑道选择 -->
  <view class="step-content">
    <view class="step-card">
      <view class="step-title">
        <text class="step-icon">🛬</text>
        <text>第一步：选择跑道</text>
      </view>
      <view class="step-description">输入跑道代码或选择常用选项</view>
      
      <!-- 输入框 -->
      <view class="runway-input-section">
        <input
          class="runway-input"
          value="{{ rodex.runwayDesignator }}"
          placeholder="输入跑道代码 (如: 27, 14L, 99)"
          bindinput="onRunwayInput"
        />
      </view>

      <!-- 数字键盘区域 -->
      <view class="number-keyboard">
        <view class="keyboard-row">
          <view class="key-button" bind:tap="inputRunwayNumber" data-value="0">0</view>
          <view class="key-button" bind:tap="inputRunwayNumber" data-value="1">1</view>
          <view class="key-button" bind:tap="inputRunwayNumber" data-value="2">2</view>
        </view>
        <view class="keyboard-row">
          <view class="key-button" bind:tap="inputRunwayNumber" data-value="3">3</view>
          <view class="key-button" bind:tap="inputRunwayNumber" data-value="4">4</view>
          <view class="key-button" bind:tap="inputRunwayNumber" data-value="5">5</view>
        </view>
        <view class="keyboard-row">
          <view class="key-button" bind:tap="inputRunwayNumber" data-value="6">6</view>
          <view class="key-button" bind:tap="inputRunwayNumber" data-value="7">7</view>
          <view class="key-button" bind:tap="inputRunwayNumber" data-value="8">8</view>
        </view>
        <view class="keyboard-row">
          <view class="key-button" bind:tap="inputRunwayNumber" data-value="9">9</view>
          <view class="key-button special" bind:tap="clearRunwayInput">清除</view>
          <view class="key-button special" bind:tap="deleteRunwayChar">删除</view>
        </view>
      </view>

      <!-- 特殊选项 -->
      <view class="special-options">
        <view class="option-row">
          <view class="option-button" bind:tap="selectRunwayOption" data-value="L">L (左)</view>
          <view class="option-button" bind:tap="selectRunwayOption" data-value="R">R (右)</view>
          <view class="option-button" bind:tap="selectRunwayOption" data-value="C">C (中)</view>
        </view>
        <view class="option-row">
          <view class="option-button wide" bind:tap="selectRunwayOption" data-value="99">99 (重复报告)</view>
          <view class="option-button wide" bind:tap="selectRunwayOption" data-value="88">88 (所有跑道)</view>
        </view>
      </view>

      <!-- 显示已选择的跑道 -->
      <view class="selected-display" wx:if="{{ rodex.runwayDesignator }}">
        <view class="selected-label">已选择：</view>
        <view class="selected-value">R{{ rodex.runwayDesignator }}</view>
      </view>
    </view>
  </view>

  <!-- 步骤2: 污染物类型选择 -->
  <view class="step-content" wx:if="{{ currentStep === 2 }}">
    <view class="step-card">
      <view class="step-title">
        <text class="step-icon">❄️</text>
        <text>第二步：选择污染物类型</text>
      </view>
      <view class="step-description">选择跑道上的污染物类型代码</view>
      
      <!-- 输入框 -->
      <view class="input-section">
        <van-field
          value="{{ rodex.depositType }}"
          placeholder="选择污染物类型代码"
          border="{{ false }}"
          readonly="{{ true }}"
          custom-style="background: #f8f9fa; border-radius: 12rpx; margin-bottom: 20rpx;"
        />
      </view>

      <!-- 污染物类型选择区域 -->
      <view class="deposit-keyboard">
        <view class="deposit-grid">
          <view class="deposit-item" bind:tap="selectDepositType" data-code="0" data-desc="清洁干燥">
            <view class="deposit-code">0</view>
            <view class="deposit-desc">清洁干燥</view>
          </view>
          <view class="deposit-item" bind:tap="selectDepositType" data-code="1" data-desc="潮湿">
            <view class="deposit-code">1</view>
            <view class="deposit-desc">潮湿</view>
          </view>
          <view class="deposit-item" bind:tap="selectDepositType" data-code="2" data-desc="湿雪">
            <view class="deposit-code">2</view>
            <view class="deposit-desc">湿雪</view>
          </view>
          <view class="deposit-item" bind:tap="selectDepositType" data-code="3" data-desc="霜/雾凇">
            <view class="deposit-code">3</view>
            <view class="deposit-desc">霜/雾凇</view>
          </view>
          <view class="deposit-item" bind:tap="selectDepositType" data-code="4" data-desc="干雪">
            <view class="deposit-code">4</view>
            <view class="deposit-desc">干雪</view>
          </view>
          <view class="deposit-item" bind:tap="selectDepositType" data-code="5" data-desc="雪泥">
            <view class="deposit-code">5</view>
            <view class="deposit-desc">雪泥</view>
          </view>
          <view class="deposit-item" bind:tap="selectDepositType" data-code="6" data-desc="冰">
            <view class="deposit-code">6</view>
            <view class="deposit-desc">冰</view>
          </view>
          <view class="deposit-item" bind:tap="selectDepositType" data-code="8" data-desc="压实雪">
            <view class="deposit-code">8</view>
            <view class="deposit-desc">压实雪</view>
          </view>
          <view class="deposit-item" bind:tap="selectDepositType" data-code="9" data-desc="冰脊">
            <view class="deposit-code">9</view>
            <view class="deposit-desc">冰脊</view>
          </view>
        </view>
      </view>

      <!-- 特殊选项 -->
      <view class="special-options">
        <view class="option-row">
          <view class="option-button special-clrd" bind:tap="setCleared" wx:if="{{ !rodex.isCleared }}">
            CLRD (已清除)
          </view>
          <view class="option-button" bind:tap="clearDepositInput">清除选择</view>
        </view>
      </view>

      <!-- 显示已选择的污染物类型 -->
      <view class="selected-display" wx:if="{{ rodex.depositType || rodex.isCleared }}">
        <view class="selected-label">已选择：</view>
        <view class="selected-value">
          {{ rodex.isCleared ? 'CLRD - 污染已清除' : rodex.depositTypeDisplay }}
        </view>
      </view>
    </view>
  </view>

  <!-- 步骤3: 污染覆盖范围选择 -->
  <view class="step-content" wx:if="{{ currentStep === 3 && !rodex.isCleared }}">
    <view class="step-card">
      <view class="step-title">
        <text class="step-icon">📏</text>
        <text>第三步：选择污染覆盖范围</text>
      </view>
      <view class="step-description">选择污染物覆盖跑道的百分比范围</view>
      
      <!-- 输入框 -->
      <view class="input-section">
        <van-field
          value="{{ rodex.contaminationExtent }}"
          placeholder="选择覆盖范围代码"
          border="{{ false }}"
          readonly="{{ true }}"
          custom-style="background: #f8f9fa; border-radius: 12rpx; margin-bottom: 20rpx;"
        />
      </view>

      <!-- 覆盖范围选择区域 -->
      <view class="coverage-keyboard">
        <view class="coverage-grid">
          <view class="coverage-item" bind:tap="selectCoverage" data-code="1" data-desc="10%以下">
            <view class="coverage-code">1</view>
            <view class="coverage-desc">10%以下</view>
          </view>
          <view class="coverage-item" bind:tap="selectCoverage" data-code="2" data-desc="11-25%">
            <view class="coverage-code">2</view>
            <view class="coverage-desc">11-25%</view>
          </view>
          <view class="coverage-item" bind:tap="selectCoverage" data-code="5" data-desc="26-50%">
            <view class="coverage-code">5</view>
            <view class="coverage-desc">26-50%</view>
          </view>
          <view class="coverage-item" bind:tap="selectCoverage" data-code="9" data-desc="51-100%">
            <view class="coverage-code">9</view>
            <view class="coverage-desc">51-100%</view>
          </view>
        </view>
      </view>

      <!-- 特殊选项 -->
      <view class="special-options">
        <view class="option-row">
          <view class="option-button" bind:tap="clearCoverageInput">清除选择</view>
        </view>
      </view>

      <!-- 显示已选择的覆盖范围 -->
      <view class="selected-display" wx:if="{{ rodex.contaminationExtent }}">
        <view class="selected-label">已选择：</view>
        <view class="selected-value">{{ rodex.contaminationExtentDisplay }}</view>
      </view>
    </view>
  </view>

  <!-- 步骤4: 污染物深度选择 -->
  <view class="step-content" wx:if="{{ currentStep === 4 && !rodex.isCleared }}">
    <view class="step-card">
      <view class="step-title">
        <text class="step-icon">📐</text>
        <text>第四步：选择污染物深度</text>
      </view>
      <view class="step-description">输入深度数值(毫米)或选择特殊代码</view>
      
      <!-- 输入框 -->
      <view class="input-section">
        <van-field
          value="{{ rodex.depthCode }}"
          placeholder="输入深度代码 (如: 15, 99, //)"
          border="{{ false }}"
          bind:change="onDepthInput"
          custom-style="background: #f8f9fa; border-radius: 12rpx; margin-bottom: 20rpx;"
        />
      </view>

      <!-- 数字键盘区域 -->
      <view class="number-keyboard">
        <view class="keyboard-row">
          <view class="key-button" bind:tap="inputDepthNumber" data-value="0">0</view>
          <view class="key-button" bind:tap="inputDepthNumber" data-value="1">1</view>
          <view class="key-button" bind:tap="inputDepthNumber" data-value="2">2</view>
        </view>
        <view class="keyboard-row">
          <view class="key-button" bind:tap="inputDepthNumber" data-value="3">3</view>
          <view class="key-button" bind:tap="inputDepthNumber" data-value="4">4</view>
          <view class="key-button" bind:tap="inputDepthNumber" data-value="5">5</view>
        </view>
        <view class="keyboard-row">
          <view class="key-button" bind:tap="inputDepthNumber" data-value="6">6</view>
          <view class="key-button" bind:tap="inputDepthNumber" data-value="7">7</view>
          <view class="key-button" bind:tap="inputDepthNumber" data-value="8">8</view>
        </view>
        <view class="keyboard-row">
          <view class="key-button" bind:tap="inputDepthNumber" data-value="9">9</view>
          <view class="key-button special" bind:tap="clearDepthInput">清除</view>
          <view class="key-button special" bind:tap="deleteDepthChar">删除</view>
        </view>
      </view>

      <!-- 特殊选项 -->
      <view class="special-options">
        <view class="option-row">
          <view class="option-button" bind:tap="selectDepthOption" data-value="99">99 (40mm以上)</view>
          <view class="option-button" bind:tap="selectDepthOption" data-value="//">//(无法测量)</view>
        </view>
        <view class="option-row">
          <view class="option-button wide" bind:tap="selectDepthOption" data-value="92">92 (10cm以上)</view>
          <view class="option-button wide" bind:tap="selectDepthOption" data-value="93">93 (15cm以上)</view>
        </view>
      </view>

      <!-- 显示已选择的深度 -->
      <view class="selected-display" wx:if="{{ rodex.depthCode }}">
        <view class="selected-label">已选择：</view>
        <view class="selected-value">{{ rodex.depthCodeDisplay }}</view>
      </view>
    </view>
  </view>

  <!-- 步骤5: 刹车效应选择 -->
  <view class="step-content" wx:if="{{ currentStep === 5 && !rodex.isCleared }}">
    <view class="step-card">
      <view class="step-title">
        <text class="step-icon">🚨</text>
        <text>第五步：选择刹车效应</text>
      </view>
      <view class="step-description">输入摩擦系数或选择估算刹车效应</view>
      
      <!-- 输入框 -->
      <view class="input-section">
        <van-field
          value="{{ rodex.brakingCode }}"
          placeholder="输入刹车代码 (如: 35, 95)"
          border="{{ false }}"
          bind:change="onBrakingInput"
          custom-style="background: #f8f9fa; border-radius: 12rpx; margin-bottom: 20rpx;"
        />
      </view>

      <!-- 数字键盘区域 -->
      <view class="number-keyboard">
        <view class="keyboard-row">
          <view class="key-button" bind:tap="inputBrakingNumber" data-value="0">0</view>
          <view class="key-button" bind:tap="inputBrakingNumber" data-value="1">1</view>
          <view class="key-button" bind:tap="inputBrakingNumber" data-value="2">2</view>
        </view>
        <view class="keyboard-row">
          <view class="key-button" bind:tap="inputBrakingNumber" data-value="3">3</view>
          <view class="key-button" bind:tap="inputBrakingNumber" data-value="4">4</view>
          <view class="key-button" bind:tap="inputBrakingNumber" data-value="5">5</view>
        </view>
        <view class="keyboard-row">
          <view class="key-button" bind:tap="inputBrakingNumber" data-value="6">6</view>
          <view class="key-button" bind:tap="inputBrakingNumber" data-value="7">7</view>
          <view class="key-button" bind:tap="inputBrakingNumber" data-value="8">8</view>
        </view>
        <view class="keyboard-row">
          <view class="key-button" bind:tap="inputBrakingNumber" data-value="9">9</view>
          <view class="key-button special" bind:tap="clearBrakingInput">清除</view>
          <view class="key-button special" bind:tap="deleteBrakingChar">删除</view>
        </view>
      </view>

      <!-- 估算刹车效应选项 -->
      <view class="braking-options">
        <view class="braking-title">估算刹车效应</view>
        <view class="braking-grid">
          <view class="braking-item" bind:tap="selectBrakingOption" data-code="95" data-desc="好">
            <view class="braking-code">95</view>
            <view class="braking-desc">好</view>
          </view>
          <view class="braking-item" bind:tap="selectBrakingOption" data-code="94" data-desc="中上">
            <view class="braking-code">94</view>
            <view class="braking-desc">中上</view>
          </view>
          <view class="braking-item" bind:tap="selectBrakingOption" data-code="93" data-desc="中等">
            <view class="braking-code">93</view>
            <view class="braking-desc">中等</view>
          </view>
          <view class="braking-item" bind:tap="selectBrakingOption" data-code="92" data-desc="中下">
            <view class="braking-code">92</view>
            <view class="braking-desc">中下</view>
          </view>
          <view class="braking-item" bind:tap="selectBrakingOption" data-code="91" data-desc="差">
            <view class="braking-code">91</view>
            <view class="braking-desc">差</view>
          </view>
          <view class="braking-item" bind:tap="selectBrakingOption" data-code="99" data-desc="不可靠">
            <view class="braking-code">99</view>
            <view class="braking-desc">不可靠</view>
          </view>
        </view>
      </view>

      <!-- 俄罗斯模式开关 -->
      <view class="russia-mode-section">
        <van-cell title="俄罗斯模式" title-width="200rpx">
          <van-switch 
            checked="{{ rodex.russiaMode }}" 
            bind:change="onRussiaModeChange"
            size="24px"
          />
        </van-cell>
      </view>

      <!-- 俄罗斯模式说明 -->
      <view class="russia-mode-tip" wx:if="{{ rodex.russiaMode }}">
        <text class="tip-icon">🇷🇺</text>
        <text class="tip-text">俄罗斯模式已启用，摩擦系数将按俄罗斯标准解读</text>
      </view>

      <!-- 显示已选择的刹车效应 -->
      <view class="selected-display" wx:if="{{ rodex.brakingCode }}">
        <view class="selected-label">已选择：</view>
        <view class="selected-value">{{ rodex.brakingCodeDisplay }}</view>
      </view>
    </view>
  </view>

  <!-- 步骤导航按钮 -->
  <view class="step-navigation" wx:if="{{ currentStep < 6 }}">
    <van-button 
      wx:if="{{ currentStep > 1 }}"
      type="default" 
      size="large" 
      bind:click="prevStep"
      custom-style="margin-right: 20rpx; flex: 1;"
    >
      上一步
    </van-button>
    <van-button 
      type="primary" 
      size="large" 
      bind:click="nextStep"
      custom-style="flex: 1;"
    >
      {{ currentStep === 5 || rodex.isCleared ? '生成代码' : '下一步' }}
    </van-button>
  </view>

  <!-- 清除状态显示 -->
  <view class="step-content" wx:if="{{ currentStep >= 3 && currentStep <= 5 && rodex.isCleared }}">
    <view class="cleared-skip-card">
      <view class="cleared-icon">✅</view>
      <view class="cleared-title">跑道已清除</view>
      <view class="cleared-description">由于选择了清除状态，无需设置污染相关参数</view>
      <van-button type="primary" size="large" bind:click="nextStep" custom-style="margin-top: 30rpx;">
        直接生成代码
      </van-button>
    </view>
  </view>

  <!-- 步骤6: 结果显示 -->
  <view class="result-section" wx:if="{{ currentStep === 6 && rodex.result }}">
    <!-- 成功动画和标题 -->
    <view class="success-header">
      <view class="success-icon">✨</view>
      <view class="success-title">RODEX代码生成成功！</view>
      <view class="success-subtitle">您的跑道状态报告已准备就绪</view>
    </view>

    <!-- 生成的代码卡片 -->
    <view class="generated-code-card">
      <view class="code-card-header">
        <view class="code-icon">📋</view>
        <view class="code-title">生成的RODEX代码</view>
      </view>
      <view class="code-display-area">
        <view class="code-container">
          <text class="final-code">{{ generatedCode }}</text>
        </view>
      </view>
    </view>
      
    <!-- 解码结果详情 -->
    <view class="decode-details">
      <view class="details-header">
        <view class="details-icon">🔍</view>
        <view class="details-title">代码解析详情</view>
      </view>
      <view class="parts-container">
        <view 
          class="result-part-card {{ item.type || 'default' }}" 
          wx:for="{{ rodex.result.parts }}" 
          wx:key="title"
        >
          <view class="part-badge">
            <text class="part-code">{{ item.code }}</text>
          </view>
          <view class="part-content">
            <view class="part-title">{{ item.title }}</view>
            <view class="part-description">{{ item.description }}</view>
          </view>
        </view>
      </view>
    </view>
      
    <!-- 俄罗斯特殊说明 -->
    <view class="russia-special-card" wx:if="{{ rodex.result.russiaNote }}">
      <view class="russia-header">
        <text class="russia-flag">🇷🇺</text>
        <text class="russia-title">俄罗斯联邦特殊规定</text>
      </view>
      <view class="russia-content">{{ rodex.result.russiaNote }}</view>
    </view>

    <!-- 操作按钮区域 -->
    <view class="action-buttons">
      <van-button 
        type="primary" 
        size="large" 
        bind:click="restart"
        custom-style="width: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none;"
      >
        🔄 重新生成
      </van-button>
    </view>
  </view>

  <!-- 兼容性：原有解码结果显示 -->
  <view class="result-section" wx:if="{{ decodeResult && currentStep !== 6 }}">
    <van-cell-group title="✅ 解码结果" inset>
      <view class="result-content">
        <!-- 原始代码显示 -->
        <view class="original-code">
          <view class="code-header">
            <text class="code-label">原始代码</text>
            <van-tag type="primary" size="large">{{ rodexInput }}</van-tag>
          </view>
        </view>
        
        <!-- 解码详情 -->
        <view class="decoded-parts">
          <view class="part-card" wx:for="{{ decodeResult.parts }}" wx:key="index">
            <view class="part-header">
              <view class="part-title-section">
                <text class="part-title">{{ item.title }}</text>
                <van-tag type="{{ item.type || 'default' }}" size="medium">{{ item.code }}</van-tag>
              </view>
            </view>
            <view class="part-content">{{ item.description }}</view>
          </view>
        </view>
        
        <!-- 俄罗斯模式指示器 -->
        <view class="russia-mode-card" wx:if="{{ russiaMode }}">
          <view class="mode-header">
            <text class="mode-icon">🇷🇺</text>
            <text class="mode-title">俄罗斯规范模式</text>
            <van-tag type="warning" size="mini">已启用</van-tag>
          </view>
          <view class="mode-description">
            摩擦系数按俄罗斯联邦航空标准解读，数值可能高于国际标准
          </view>
        </view>
        
        <!-- 俄罗斯特殊说明 -->
        <view class="russia-note-card" wx:if="{{ russiaMode && decodeResult.russiaNote }}">
          <view class="note-header">
            <text class="note-icon">📋</text>
            <text class="note-title">俄罗斯标准说明</text>
          </view>
          <view class="note-content">{{ decodeResult.russiaNote }}</view>
        </view>
      </view>
    </van-cell-group>
  </view>

  <!-- 帮助和示例 -->
  <view class="help-section">
    <van-collapse value="{{ activeCollapseItems }}" bind:change="onCollapseChange">
      <!-- 格式说明 -->
      <van-collapse-item title="📖 RODEX格式详解" name="format" icon="question-o">
        <view class="help-content">
          <view class="format-explanation">
            <view class="format-title">
              <text class="format-icon">🎯</text>
              <text class="format-text">标准格式：RDrDr/ErCrErErBrBr</text>
            </view>
            
            <view class="format-breakdown">
              <view class="format-item">
                <view class="format-code">RDrDr</view>
                <view class="format-desc">
                  <text class="desc-title">跑道识别码</text>
                  <text class="desc-detail">如：R14L（跑道14左）、R27（跑道27）、R99（重复报告）、R88（所有跑道）</text>
                </view>
              </view>
              
              <view class="format-item">
                <view class="format-code">Er</view>
                <view class="format-desc">
                  <text class="desc-title">污染物类型</text>
                  <text class="desc-detail">0=清洁干燥 1=潮湿 2=湿雪 3=霜 4=干雪 5=雪泥 6=冰 8=压实雪 9=冰脊</text>
                </view>
              </view>
              
              <view class="format-item">
                <view class="format-code">Cr</view>
                <view class="format-desc">
                  <text class="desc-title">污染覆盖范围</text>
                  <text class="desc-detail">1=10%以下 2=11-25% 5=26-50% 9=51-100%</text>
                </view>
              </view>
              
              <view class="format-item">
                <view class="format-code">ErEr</view>
                <view class="format-desc">
                  <text class="desc-title">污染物深度</text>
                  <text class="desc-detail">以毫米为单位，如：15=15mm 99=40mm以上 //=无法测量</text>
                </view>
              </view>
              
              <view class="format-item">
                <view class="format-code">BrBr</view>
                <view class="format-desc">
                  <text class="desc-title">刹车效应</text>
                  <text class="desc-detail">摩擦系数×100，如：35=0.35 或 估算值：5=好 4=中上 3=中等 2=中下 1=差 9=不可靠</text>
                </view>
              </view>
            </view>
          </view>
        </view>
      </van-collapse-item>
      
      <!-- 示例代码 -->
      <van-collapse-item title="📝 实用示例" name="examples" icon="apps-o">
        <view class="examples-content">
          <view class="examples-grid">
            <view class="example-card" wx:for="{{ examples }}" wx:key="index">
              <view class="example-header">
                <van-tag type="primary" size="mini">{{ item.category }}</van-tag>
              </view>
              <view class="example-code" bind:tap="fillExample" data-code="{{ item.code }}">
                <text class="code-display">{{ item.code }}</text>
                <text class="tap-hint">点击填入</text>
              </view>
              <view class="example-explanation">{{ item.explanation }}</view>
            </view>
          </view>
        </view>
      </van-collapse-item>
      
    </van-collapse>
  </view>

  <!-- 选择器组件 -->
  <!-- 跑道选择器 -->
  <van-action-sheet
    show="{{ showRunwayPicker }}"
    title="选择跑道"
    bind:close="onRunwayPickerClose"
    bind:select="onRunwaySelect"
    actions="{{ runwayActions }}"
    cancel-text="取消"
    close-on-click-overlay="{{ true }}"
  />

  <!-- 污染物类型选择器 -->
  <van-action-sheet
    show="{{ showDepositTypePicker }}"
    title="选择污染物类型"
    bind:close="onDepositTypePickerClose"
    bind:select="onDepositTypeSelect"
    actions="{{ depositTypeActions }}"
    cancel-text="取消"
  />

  <!-- 污染覆盖范围选择器 -->
  <van-action-sheet
    show="{{ showContaminationExtentPicker }}"
    title="选择污染覆盖范围"
    bind:close="onContaminationExtentPickerClose"
    bind:select="onContaminationExtentSelect"
    actions="{{ contaminationExtentActions }}"
    cancel-text="取消"
  />

  <!-- 深度选择器 -->
  <van-action-sheet
    show="{{ showDepthPicker }}"
    title="选择污染物深度"
    bind:close="onDepthPickerClose"
    bind:select="onDepthSelect"
    actions="{{ depthActions }}"
    cancel-text="取消"
  />

  <!-- 刹车效应选择器 -->
  <van-action-sheet
    show="{{ showBrakingPicker }}"
    title="选择刹车效应"
    bind:close="onBrakingPickerClose"
    bind:select="onBrakingSelect"
    actions="{{ brakingActions }}"
    cancel-text="取消"
  />
</view>