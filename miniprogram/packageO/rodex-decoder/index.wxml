<view class="container">
  <!-- è®¡ç®—å™¨å¼è¾“å…¥é¡µé¢ -->
  <view class="calculator-page" wx:if="{{ currentView === 'input' }}">
    <!-- ä¿„ç½—æ–¯æ¨¡å¼åˆ‡æ¢ -->
    <view class="mode-toggle">
      <view class="mode-label">
        <text class="mode-icon">ğŸ‡·ğŸ‡º</text>
        <text>ä¿„ç½—æ–¯æ¨¡å¼</text>
      </view>
      <switch checked="{{ russiaMode }}" bindchange="toggleRussiaMode" />
    </view>

    <!-- æ˜¾ç¤ºå±åŒºåŸŸ -->
    <view class="display-section">
      <view class="input-display">
        <text class="prefix">R</text>
        <text wx:if="{{ inputCode }}">{{ inputCode }}</text>
        <text wx:else class="placeholder">è¯·è¾“å…¥</text>
        <view class="cursor" wx:if="{{ showCursor }}"></view>
      </view>
      <view class="hint-text">{{ codeHint || 'è¯·è¾“å…¥è·‘é“ä»£ç ' }}</view>
    </view>

    <!-- è®¡ç®—å™¨é”®ç›˜åŒº -->
    <view class="calculator-section">
      <!-- ä¸»é”®ç›˜ç½‘æ ¼ -->
      <view class="keyboard-container">
        <!-- æ•°å­—é”®ç›˜ -->
        <view class="numpad-rows">
          <view class="numpad-row">
            <button class="key num-key" bindtap="inputKey" data-value="1">1</button>
            <button class="key num-key" bindtap="inputKey" data-value="2">2</button>
            <button class="key num-key" bindtap="inputKey" data-value="3">3</button>
          </view>
          <view class="numpad-row">
            <button class="key num-key" bindtap="inputKey" data-value="4">4</button>
            <button class="key num-key" bindtap="inputKey" data-value="5">5</button>
            <button class="key num-key" bindtap="inputKey" data-value="6">6</button>
          </view>
          <view class="numpad-row">
            <button class="key num-key" bindtap="inputKey" data-value="7">7</button>
            <button class="key num-key" bindtap="inputKey" data-value="8">8</button>
            <button class="key num-key" bindtap="inputKey" data-value="9">9</button>
          </view>
          <view class="numpad-row">
            <button class="key slash-key" bindtap="inputKey" data-value="/">/</button>
            <button class="key num-key" bindtap="inputKey" data-value="0">0</button>
            <button class="key del-key" bindtap="deleteChar">âŒ«</button>
          </view>
        </view>

        <!-- ç‰¹æ®Šé”®åŒº -->
        <view class="special-rows">
          <view class="special-row">
            <button class="key special-key" bindtap="inputKey" data-value="L">L</button>
            <button class="key special-key" bindtap="inputSpecial" data-value="99">99</button>
            <button class="key special-key" bindtap="inputKey" data-value="C">C</button>
          </view>
          <view class="special-row">
            <button class="key special-key" bindtap="inputSpecial" data-value="88">88</button>
            <button class="key special-key" bindtap="inputKey" data-value="R">R</button>
            <button class="key clrd-key" bindtap="inputSpecial" data-value="CLRD">CLRD</button>
          </view>
        </view>
        <!-- é‡ç½®æŒ‰é’®ç‹¬ç«‹ä¸€è¡Œ -->
        <view class="reset-section">
          <button class="key reset-key full-width" bindtap="clearAll">æ¸…é™¤æ‰€æœ‰</button>
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="action-buttons">
        <button class="action-btn analyze-btn {{ canDecode ? '' : 'disabled' }}"
                disabled="{{ !canDecode }}"
                bindtap="decodeRODEX">
          è§£ç åˆ†æ
        </button>
      </view>

      <!-- æ¨ªå¹…å¹¿å‘Š -->
      <view class="ad-banner-container">
        <ad unit-id="adunit-d7a3b71f5ce0afca" ad-type="banner" ad-intervals="30"></ad>
      </view>
    </view>
  </view>

  <!-- åˆ†æç»“æœé¡µé¢ -->
  <view class="result-page" wx:if="{{ currentView === 'result' }}">
    <!-- ç»“æœé¡µå¤´éƒ¨ -->
    <view class="result-header">
      <view class="result-title">
        <text class="title-text">è§£ç åˆ†æç»“æœ</text>
      </view>
      <view class="code-display">
        <text>{{ decodedCode }}</text>
      </view>
      <view wx:if="{{ russiaMode }}" style="color: rgba(255,255,255,0.8); font-size: 24rpx; margin-top: 10rpx;">
        ä¿„ç½—æ–¯æ¨¡å¼
      </view>
    </view>

    <!-- è¯¦ç»†åˆ†æç»“æœ -->
    <view class="analysis-cards">
      <!-- è·‘é“ä¿¡æ¯ -->
      <view class="info-card" wx:if="{{ analysis.runway }}">
        <view class="card-header">
          <view class="card-icon runway-icon">âœˆ</view>
          <view class="card-title">è·‘é“ä¿¡æ¯</view>
          <view class="input-badge">{{ analysis.runway.code }}</view>
        </view>
        <view class="card-content">
          <view class="info-item">
            <text class="info-label">è·‘é“ä»£ç ï¼š</text>
            <text class="info-value">{{ analysis.runway.code }}</text>
          </view>
          <view class="info-item">
            <text class="info-label">æè¿°ï¼š</text>
            <text class="info-value">{{ analysis.runway.description }}</text>
          </view>
        </view>
      </view>

      <!-- æ±¡æŸ“ç‰©ä¿¡æ¯ -->
      <view class="info-card" wx:if="{{ analysis.contaminant }}">
        <view class="card-header">
          <view class="card-icon contaminant-icon">â„</view>
          <view class="card-title">æ±¡æŸ“ç‰©çŠ¶æ€</view>
          <view class="input-badge">{{ analysis.statusCode || '//////' }}</view>
        </view>
        <view class="card-content">
          <view class="info-item">
            <text class="info-label">ç±»å‹ï¼š</text>
            <text class="info-value">{{ analysis.contaminant.type }}</text>
          </view>
          <view class="info-item">
            <text class="info-label">è¦†ç›–èŒƒå›´ï¼š</text>
            <text class="info-value">{{ analysis.contaminant.coverage }}</text>
          </view>
          <view class="info-item" wx:if="{{ analysis.contaminant.depth }}">
            <text class="info-label">æ·±åº¦ï¼š</text>
            <text class="info-value">{{ analysis.contaminant.depth }}</text>
          </view>
        </view>
      </view>

      <!-- åˆ¹è½¦æ•ˆåº” -->
      <view class="info-card" wx:if="{{ analysis.braking }}">
        <view class="card-header">
          <view class="card-icon braking-icon">ğŸš¨</view>
          <view class="card-title">åˆ¹è½¦æ•ˆåº”</view>
          <view class="input-badge">{{ analysis.braking.code }}</view>
        </view>
        <view class="card-content">
          <view class="info-item">
            <text class="info-label">æ‘©æ“¦ç³»æ•°ï¼š</text>
            <text class="info-value">{{ analysis.braking.coefficient }}</text>
          </view>
          <view class="info-item">
            <text class="info-label">åˆ¹è½¦æ•ˆåº”ï¼š</text>
            <text class="info-value">{{ analysis.braking.levelEn }}</text>
          </view>
          <view wx:if="{{ russiaMode && analysis.braking.russiaInfo }}">
            <view class="info-item">
              <text class="info-label">ä¿„ç½—æ–¯è§„èŒƒå€¼ï¼š</text>
              <text class="info-value">{{ analysis.braking.russiaInfo.normative }}</text>
            </view>
            <view class="info-item">
              <text class="info-label">æµ‹é‡å€¼èŒƒå›´ï¼š</text>
              <text class="info-value">{{ analysis.braking.russiaInfo.measured }}</text>
            </view>
          </view>
        </view>
      </view>


      <!-- ç‰¹æ®Šè¯´æ˜ -->
      <view class="info-card" wx:if="{{ analysis.specialNotes }}">
        <view class="card-header">
          <view class="card-icon">ğŸ’¡</view>
          <view class="card-title">ç‰¹æ®Šè¯´æ˜</view>
        </view>
        <view class="card-content">
          <text>{{ analysis.specialNotes }}</text>
        </view>
      </view>
    </view>

    <!-- åº•éƒ¨æŒ‰é’®åŒºåŸŸ -->
    <view class="bottom-actions">
      <button class="back-button" bindtap="backToInput">è¿”å›è¾“å…¥</button>

      <!-- æ¨ªå¹…å¹¿å‘Š -->
      <view class="ad-banner-container">
        <ad unit-id="adunit-d7a3b71f5ce0afca" ad-type="banner" ad-intervals="30"></ad>
      </view>
    </view>
  </view>
</view>