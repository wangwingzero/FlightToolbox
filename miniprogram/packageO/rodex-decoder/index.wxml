<view class="container">
  <!-- 计算器式输入页面 -->
  <view class="calculator-page" wx:if="{{ currentView === 'input' }}">
    <!-- 示例代码提示 -->
    <view class="example-hint">
      <text class="example-label">示例代码：</text>
      <text class="example-code">R99/421594</text>
    </view>

    <!-- 俄罗斯模式切换 -->
    <view class="mode-toggle">
      <view class="mode-label">
        <text class="mode-icon">🇷🇺</text>
        <text>俄罗斯模式</text>
      </view>
      <switch checked="{{ russiaMode }}" bindchange="toggleRussiaMode" />
    </view>

    <!-- 显示屏区域 -->
    <view class="display-section">
      <view class="input-display">
        <text class="prefix">R</text>
        <text wx:if="{{ inputCode }}">{{ inputCode }}</text>
        <text wx:else class="placeholder">请输入</text>
        <view class="cursor" wx:if="{{ showCursor }}"></view>
      </view>
      <view class="hint-text">{{ codeHint || '请输入跑道代码' }}</view>
    </view>

    <!-- 计算器键盘区 -->
    <view class="calculator-section">
      <!-- 主键盘网格 -->
      <view class="keyboard-container">
        <!-- 数字键盘 -->
        <view class="numpad-rows">
          <view class="numpad-row">
            <button class="key num-key" bindtap="inputKey" data-value="1">1</button>
            <button class="key num-key" bindtap="inputKey" data-value="2">2</button>
            <button class="key num-key" bindtap="inputKey" data-value="3">3</button>
          </view>
          <view class="numpad-row">
            <button class="key num-key" bindtap="inputKey" data-value="4">4</button>
            <button class="key num-key" bindtap="inputKey" data-value="5">5</button>
            <button class="key num-key" bindtap="inputKey" data-value="6">6</button>
          </view>
          <view class="numpad-row">
            <button class="key num-key" bindtap="inputKey" data-value="7">7</button>
            <button class="key num-key" bindtap="inputKey" data-value="8">8</button>
            <button class="key num-key" bindtap="inputKey" data-value="9">9</button>
          </view>
          <view class="numpad-row">
            <button class="key slash-key" bindtap="inputKey" data-value="/">/</button>
            <button class="key num-key" bindtap="inputKey" data-value="0">0</button>
            <button class="key del-key" bindtap="deleteChar">⌫</button>
          </view>
        </view>

        <!-- 特殊键区 -->
        <view class="special-rows">
          <view class="special-row">
            <button class="key special-key" bindtap="inputKey" data-value="L">L</button>
            <button class="key special-key" bindtap="inputSpecial" data-value="99">99</button>
            <button class="key special-key" bindtap="inputKey" data-value="C">C</button>
          </view>
          <view class="special-row">
            <button class="key special-key" bindtap="inputSpecial" data-value="88">88</button>
            <button class="key special-key" bindtap="inputKey" data-value="R">R</button>
            <button class="key clrd-key" bindtap="inputSpecial" data-value="CLRD">CLRD</button>
          </view>
        </view>
        <!-- 重置按钮独立一行 -->
        <view class="reset-section">
          <button class="key reset-key full-width" bindtap="clearAll">清除所有</button>
        </view>
      </view>

      <!-- 操作按钮 -->
      <view class="action-buttons">
        <button class="action-btn analyze-btn {{ canDecode ? '' : 'disabled' }}"
                disabled="{{ !canDecode }}"
                bindtap="decodeRODEX">
          解码分析
        </button>
      </view>

      <!-- 竖版广告 -->
      <view wx:if="{{ !isAdFree && nativeAdEnabled }}" class="ad-banner-container">
        <ad unit-id="adunit-d7a3b71f5ce0afca" ad-type="video" ad-intervals="30"></ad>
      </view>
    </view>
  </view>

  <!-- 分析结果页面 -->
  <view class="result-page" wx:if="{{ currentView === 'result' }}">
    <!-- 结果页头部 -->
    <view class="result-header">
      <view class="result-title">
        <text class="title-text">解码分析结果</text>
      </view>
      <view class="code-display">
        <text>{{ decodedCode }}</text>
      </view>
      <view wx:if="{{ russiaMode }}" style="color: rgba(255,255,255,0.8); font-size: 24rpx; margin-top: 10rpx;">
        俄罗斯模式
      </view>
    </view>

    <!-- 详细分析结果 -->
    <view class="analysis-cards">
      <!-- 跑道信息 -->
      <view class="info-card" wx:if="{{ analysis.runway }}">
        <view class="card-header">
          <view class="card-icon runway-icon">✈</view>
          <view class="card-title">跑道信息</view>
          <view class="input-badge">{{ analysis.runway.code }}</view>
        </view>
        <view class="card-content">
          <view class="info-item">
            <text class="info-label">跑道代码：</text>
            <text class="info-value">{{ analysis.runway.code }}</text>
          </view>
          <view class="info-item">
            <text class="info-label">描述：</text>
            <text class="info-value">{{ analysis.runway.description }}</text>
          </view>
        </view>
      </view>

      <!-- 污染物信息 -->
      <view class="info-card" wx:if="{{ analysis.contaminant }}">
        <view class="card-header">
          <view class="card-icon contaminant-icon">❄</view>
          <view class="card-title">污染物状态</view>
          <view class="input-badge">{{ analysis.statusCode || '//////' }}</view>
        </view>
        <view class="card-content">
          <view class="info-item">
            <text class="info-label">类型：</text>
            <text class="info-value">{{ analysis.contaminant.type }}</text>
          </view>
          <view class="info-item">
            <text class="info-label">覆盖范围：</text>
            <text class="info-value">{{ analysis.contaminant.coverage }}</text>
          </view>
          <view class="info-item" wx:if="{{ analysis.contaminant.depth }}">
            <text class="info-label">深度：</text>
            <text class="info-value">{{ analysis.contaminant.depth }}</text>
          </view>
        </view>
      </view>

      <!-- 刹车效应 -->
      <view class="info-card" wx:if="{{ analysis.braking }}">
        <view class="card-header">
          <view class="card-icon braking-icon">🚨</view>
          <view class="card-title">刹车效应</view>
          <view class="input-badge">{{ analysis.braking.code }}</view>
        </view>
        <view class="card-content">
          <view class="info-item">
            <text class="info-label">摩擦系数：</text>
            <text class="info-value">{{ analysis.braking.coefficient }}</text>
          </view>
          <view class="info-item">
            <text class="info-label">刹车效应：</text>
            <text class="info-value">{{ analysis.braking.levelEn }}</text>
          </view>
          <view wx:if="{{ russiaMode && analysis.braking.russiaInfo }}">
            <view class="info-item">
              <text class="info-label">俄罗斯规范值：</text>
              <text class="info-value">{{ analysis.braking.russiaInfo.normative }}</text>
            </view>
            <view class="info-item">
              <text class="info-label">测量值范围：</text>
              <text class="info-value">{{ analysis.braking.russiaInfo.measured }}</text>
            </view>
          </view>
        </view>
      </view>


      <!-- 特殊说明 -->
      <view class="info-card" wx:if="{{ analysis.specialNotes }}">
        <view class="card-header">
          <view class="card-icon">💡</view>
          <view class="card-title">特殊说明</view>
        </view>
        <view class="card-content">
          <text>{{ analysis.specialNotes }}</text>
        </view>
      </view>
    </view>

    <!-- 底部按钮区域 -->
    <view class="bottom-actions">
      <button class="back-button" bindtap="backToInput">返回输入</button>

      <!-- 竖版广告 -->
      <view wx:if="{{ !isAdFree && nativeAdEnabled }}" class="ad-banner-container">
        <ad unit-id="adunit-d7a3b71f5ce0afca" ad-type="video" ad-intervals="30"></ad>
      </view>
    </view>
  </view>
</view>