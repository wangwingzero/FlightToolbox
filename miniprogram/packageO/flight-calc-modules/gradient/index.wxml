<view class="container" data-theme="{{ isDarkMode ? 'dark' : 'light' }}">
  <view class="page-header">
    <view class="header-title">📐 梯度计算</view>
    <view class="header-subtitle">飞行梯度、升降率换算</view>
  </view>

  <view class="calculation-module">
    <!-- 🎯 新增：使用说明和引导 -->
    <view class="instruction-section">
      <view class="instruction-title">📝 使用说明</view>
      <view class="instruction-content">
        <text class="instruction-text">• 请输入任意两个参数，系统将自动计算其他参数</text>
        <text class="instruction-text">• 最常用的组合：梯度 + 地速，或者升降率 + 地速</text>
        <text class="instruction-text">• 输入冲突时系统会提示并帮助修正</text>
      </view>
    </view>

    <view class="input-section">
      <view class="section-title">📊 输入参数</view>
      
      <view class="input-group">
        <view class="input-label">
          <text class="label-text">📐 梯度</text>
          <text class="label-desc">(爬升/下降百分比)</text>
        </view>
        <van-field
          value="{{ gradient.gradientInput }}"
          placeholder="请输入梯度"
          type="digit"
          bind:change="onGradientInputChange"
          bind:focus="onInputFocus"
          data-field="gradient"
          input-align="right"
        >
          <view slot="right-icon" class="unit-label">%</view>
        </van-field>
      </view>

      <view class="input-group">
        <view class="input-label">
          <text class="label-text">🌬️ 地速</text>
          <text class="label-desc">(相对地面速度)</text>
        </view>
        <van-field
          value="{{ gradient.groundSpeedInput }}"
          placeholder="请输入地速"
          type="digit"
          bind:change="onGroundSpeedInputChange"
          bind:focus="onInputFocus"
          data-field="groundSpeed"
          input-align="right"
        >
          <view slot="right-icon" class="unit-label">节</view>
        </van-field>
      </view>

      <view class="input-group">
        <view class="input-label">
          <text class="label-text">⬆️ 升降率</text>
          <text class="label-desc">(垂直方向速度)</text>
        </view>
        <van-field
          value="{{ gradient.verticalSpeedInput }}"
          placeholder="请输入升降率"
          type="digit"
          bind:change="onVerticalSpeedInputChange"
          bind:focus="onInputFocus"
          data-field="verticalSpeed"
          input-align="right"
        >
          <view slot="right-icon" class="unit-label">ft/min</view>
        </van-field>
      </view>

      <view class="input-group">
        <view class="input-label">
          <text class="label-text">📐 角度</text>
          <text class="label-desc">(与水平面夹角)</text>
        </view>
        <van-field
          value="{{ gradient.angleInput }}"
          placeholder="请输入角度"
          type="digit"
          bind:change="onAngleInputChange"
          bind:focus="onInputFocus"
          data-field="angle"
          input-align="right"
        >
          <view slot="right-icon" class="unit-label">度</view>
        </van-field>
      </view>
    </view>

    <view class="action-buttons">
      <van-button type="primary" bind:click="convertGradient" block>
        🚀 智能计算
      </van-button>
      <van-button type="default" bind:click="clearGradient" block>
        🗑️ 清空数据
      </van-button>
    </view>

    <!-- 🎯 新增：常用组合快捷键 -->
    <view class="quick-presets">
      <view class="preset-title">⚡ 常用组合</view>
      <view class="preset-buttons">
        <van-button size="small" bind:click="setPreset" data-preset="standard">
          标准下降 3°
        </van-button>
        <van-button size="small" bind:click="setPreset" data-preset="steep">
          陡峪下降 6°
        </van-button>
        <van-button size="small" bind:click="setPreset" data-preset="climb">
          标准爬升 5%
        </van-button>
      </view>
    </view>

    <!-- 🎯 改进的计算结果 -->
    <view wx:if="{{ gradient.gradientResult || gradient.verticalSpeedResult || gradient.angleResult }}" class="result-section">
      <view class="result-title">🎯 自动计算结果</view>
      <view class="result-grid">
        <view wx:if="{{ gradient.gradientResult }}" class="result-item calculated">
          <view class="result-label">
            <text class="label-icon">📐</text>
            <text>梯度</text>
            <text class="auto-tag">自动计算</text>
          </view>
          <view class="result-value">{{ gradient.gradientResult }}%</view>
        </view>
        <view wx:if="{{ gradient.verticalSpeedResult }}" class="result-item calculated">
          <view class="result-label">
            <text class="label-icon">⬆️</text>
            <text>升降率</text>
            <text class="auto-tag">自动计算</text>
          </view>
          <view class="result-value">{{ gradient.verticalSpeedResult }} ft/min</view>
        </view>
        <view wx:if="{{ gradient.angleResult }}" class="result-item calculated">
          <view class="result-label">
            <text class="label-icon">📐</text>
            <text>角度</text>
            <text class="auto-tag">自动计算</text>
          </view>
          <view class="result-value">{{ gradient.angleResult }}°</view>
        </view>
      </view>
      
      <!-- 计算公式说明 -->
      <view class="formula-section">
        <view class="formula-title">📝 计算公式</view>
        <view class="formula-content">
          <text class="formula-text">• 梯度(%) = 升降率(ft/min) ÷ 地速(ft/min) × 100</text>
          <text class="formula-text">• 角度(°) = arctan(梯度 ÷ 100)</text>
          <text class="formula-text">• 升降率 = 地速 × 梯度 ÷ 100</text>
          <text class="formula-note">注：1节 = 101.27 英尺/分钟</text>
        </view>
      </view>
    </view>
  </view>
</view>