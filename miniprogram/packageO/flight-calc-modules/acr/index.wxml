<view class="container">
  <!-- 动画背景 -->
  <view class="animated-bg">
    <view class="runway-light runway-light1"></view>
    <view class="runway-light runway-light2"></view>
    <view class="runway-light runway-light3"></view>
    <view class="aircraft-shadow"></view>
  </view>

  <!-- 步骤指示器 -->
  <view class="step-indicator">
    <view class="step-item {{ currentStep >= 1 ? 'active' : '' }}" bind:tap="jumpToStep" data-step="1">
      <view class="step-number">1</view>
      <view class="step-label">制造商</view>
    </view>
    <view class="step-line {{ currentStep > 1 ? 'active' : '' }}"></view>

    <view class="step-item {{ currentStep >= 2 ? 'active' : '' }}" bind:tap="jumpToStep" data-step="2">
      <view class="step-number">2</view>
      <view class="step-label">{{ showSeriesStep ? '系列/机型' : '机型' }}</view>
    </view>
    <view class="step-line {{ currentStep > 2 ? 'active' : '' }}"></view>

    <view class="step-item {{ currentStep >= 3 ? 'active' : '' }}" bind:tap="jumpToStep" data-step="3">
      <view class="step-number">3</view>
      <view class="step-label">改型</view>
    </view>
    <view class="step-line {{ currentStep > 3 ? 'active' : '' }}"></view>

    <view class="step-item {{ currentStep >= 4 ? 'active' : '' }}" bind:tap="jumpToStep" data-step="4">
      <view class="step-number">4</view>
      <view class="step-label">重量</view>
    </view>
    <view class="step-line {{ currentStep > 4 ? 'active' : '' }}"></view>

    <view class="step-item {{ currentStep >= 5 ? 'active' : '' }}" bind:tap="jumpToStep" data-step="5">
      <view class="step-number">5</view>
      <view class="step-label">参数&结果</view>
    </view>
  </view>

  <!-- 主要内容区域 -->
  <view class="main-content">

    <!-- 步骤1：选择制造商 -->
    <view wx:if="{{ currentStep === 1 }}" class="step-card">
      <view class="card-header">
        <view class="card-title">🏭 选择制造商</view>
        <view class="card-desc">{{ dataLoaded ? '请选择飞机制造商' : '数据加载中...' }}</view>
      </view>
      <view class="manufacturer-grid">
        <view
          class="manufacturer-item {{ selectedManufacturer === 'Airbus' ? 'selected' : '' }} {{ !dataLoaded ? 'disabled' : '' }}"
          bind:tap="selectManufacturer"
          data-manufacturer="Airbus"
        >
          <view class="mfr-icon airbus">A</view>
          <view class="mfr-name">Airbus</view>
          <view class="mfr-desc">空中客车</view>
        </view>

        <view
          class="manufacturer-item {{ selectedManufacturer === 'Boeing' ? 'selected' : '' }} {{ !dataLoaded ? 'disabled' : '' }}"
          bind:tap="selectManufacturer"
          data-manufacturer="Boeing"
        >
          <view class="mfr-icon boeing">B</view>
          <view class="mfr-name">Boeing</view>
          <view class="mfr-desc">波音公司</view>
        </view>

        <view
          class="manufacturer-item {{ selectedManufacturer === 'COMAC' ? 'selected' : '' }} {{ !dataLoaded ? 'disabled' : '' }}"
          bind:tap="selectManufacturer"
          data-manufacturer="COMAC"
        >
          <view class="mfr-icon comac">C</view>
          <view class="mfr-name">COMAC</view>
          <view class="mfr-desc">中国商飞</view>
        </view>

        <view
          class="manufacturer-item {{ selectedManufacturer === 'Others' ? 'selected' : '' }} {{ !dataLoaded ? 'disabled' : '' }}"
          bind:tap="selectManufacturer"
          data-manufacturer="Others"
        >
          <view class="mfr-icon others">O</view>
          <view class="mfr-name">Others</view>
          <view class="mfr-desc">其他制造商</view>
        </view>
      </view>
    </view>

    <!-- 步骤2：选择系列（如果需要） -->
    <view wx:if="{{ currentStep === 2 && showSeriesStep && seriesList.length > 0 }}" class="step-card" id="series-card">
      <view class="card-header">
        <view class="card-title">📋 选择系列</view>
        <view class="card-desc">{{ selectedManufacturer }} 系列列表</view>
      </view>
      <view class="series-list">
        <view
          wx:for="{{ seriesList }}"
          wx:key="*this"
          class="series-item {{ selectedSeries === item ? 'selected' : '' }}"
          bind:tap="selectSeries"
          data-series="{{ item }}"
        >
          <view class="series-icon">📁</view>
          <view class="series-name">{{ item }}</view>
        </view>
      </view>
    </view>

    <!-- 步骤2：选择机型 -->
    <view wx:if="{{ currentStep === 2 && modelList.length > 0 && (!showSeriesStep || selectedSeries) }}" class="step-card" id="model-card">
      <view class="card-header">
        <view class="card-title">✈️ 选择机型</view>
        <view class="card-desc">{{ selectedSeries || selectedManufacturer }} 机型列表</view>
      </view>
      <view class="model-list">
        <view
          wx:for="{{ modelList }}"
          wx:key="*this"
          class="model-item {{ selectedModel === item ? 'selected' : '' }}"
          bind:tap="selectModel"
          data-model="{{ item }}"
        >
          <view class="model-icon">✈️</view>
          <view class="model-name">{{ item }}</view>
        </view>
      </view>
    </view>

    <!-- 步骤3：选择改型 -->
    <view wx:if="{{ currentStep === 3 }}" class="step-card" id="variant-card">
      <view class="card-header">
        <view class="card-title">🔧 选择改型</view>
        <view class="card-desc">{{ selectedModel }} 改型列表</view>
      </view>
      <view class="variant-list">
        <view
          wx:for="{{ variantList }}"
          wx:key="name"
          class="variant-item {{ selectedVariant === item.name ? 'selected' : '' }}"
          bind:tap="selectVariant"
          data-variant="{{ item.name }}"
        >
          <view class="variant-icon">⚙️</view>
          <view class="variant-name">{{ item.display }}</view>
        </view>
      </view>
    </view>

    <!-- 步骤4：输入重量 -->
    <view wx:if="{{ currentStep === 4 }}" class="step-card" id="weight-card">
      <view class="card-header">
        <view class="card-title">⚖️ 飞机重量</view>
        <view class="card-desc">{{ selectedVariant }}</view>
      </view>
      <view class="weight-input">
        <view class="input-label">飞机重量 (kg)</view>
        <view class="weight-range-hint">{{ massRange.min }} kg - {{ massRange.max }} kg</view>
        <van-field
          model:value="{{ aircraftMass }}"
          placeholder="请输入飞机重量"
          type="digit"
          bind:change="onMassInput"
          input-align="center"
          class="custom-input"
        />
      </view>
      <view class="nav-buttons">
        <view class="nav-btn secondary" bind:tap="prevStep">⬅️ 上一步</view>
        <view class="nav-btn primary" bind:tap="nextStep">下一步 ➡️</view>
      </view>
    </view>

    <!-- 步骤5：参数选择和ACR结果 -->
    <view wx:if="{{ currentStep === 5 }}" class="step-card" id="params-card">
      <view class="card-header">
        <view class="card-title">📊 选择参数并查看ACR</view>
        <view class="card-desc">{{ selectedModel }} - {{ selectedVariant }}</view>
      </view>

      <!-- 参数选择区域 -->
      <view class="params-section">
        <!-- 道面类型 -->
        <view class="param-group">
          <view class="param-label">🛣️ 道面类型</view>
          <view class="param-options">
            <view
              class="param-btn {{ pavementType === 'F' ? 'selected' : '' }}"
              bind:tap="onPavementTypeSelect"
              data-value="F"
            >
              <view class="btn-icon">F</view>
              <view class="btn-text">柔性道面</view>
            </view>
            <view
              class="param-btn {{ pavementType === 'R' ? 'selected' : '' }}"
              bind:tap="onPavementTypeSelect"
              data-value="R"
            >
              <view class="btn-icon">R</view>
              <view class="btn-text">刚性道面</view>
            </view>
          </view>
        </view>

        <!-- 道基强度 -->
        <view class="param-group">
          <view class="param-label">🏗️ 道基强度</view>
          <view class="param-options grid">
            <view
              class="param-btn small {{ subgradeStrength === 'A' ? 'selected' : '' }}"
              bind:tap="onSubgradeStrengthSelect"
              data-value="A"
            >
              <view class="btn-icon">A</view>
              <view class="btn-text">高强度</view>
            </view>
            <view
              class="param-btn small {{ subgradeStrength === 'B' ? 'selected' : '' }}"
              bind:tap="onSubgradeStrengthSelect"
              data-value="B"
            >
              <view class="btn-icon">B</view>
              <view class="btn-text">中强度</view>
            </view>
            <view
              class="param-btn small {{ subgradeStrength === 'C' ? 'selected' : '' }}"
              bind:tap="onSubgradeStrengthSelect"
              data-value="C"
            >
              <view class="btn-icon">C</view>
              <view class="btn-text">低强度</view>
            </view>
            <view
              class="param-btn small {{ subgradeStrength === 'D' ? 'selected' : '' }}"
              bind:tap="onSubgradeStrengthSelect"
              data-value="D"
            >
              <view class="btn-icon">D</view>
              <view class="btn-text">超低强度</view>
            </view>
          </view>
        </view>

        <!-- 胎压限制 -->
        <view class="param-group">
          <view class="param-label">🛞 胎压限制</view>
          <view class="param-options grid">
            <view
              class="param-btn small {{ tirePressure === 'W' ? 'selected' : '' }}"
              bind:tap="onTirePressureSelect"
              data-value="W"
            >
              <view class="btn-icon">W</view>
              <view class="btn-text">无限制</view>
            </view>
            <view
              class="param-btn small {{ tirePressure === 'X' ? 'selected' : '' }}"
              bind:tap="onTirePressureSelect"
              data-value="X"
            >
              <view class="btn-icon">X</view>
              <view class="btn-text">高压限制</view>
            </view>
            <view
              class="param-btn small {{ tirePressure === 'Y' ? 'selected' : '' }}"
              bind:tap="onTirePressureSelect"
              data-value="Y"
            >
              <view class="btn-icon">Y</view>
              <view class="btn-text">中压限制</view>
            </view>
            <view
              class="param-btn small {{ tirePressure === 'Z' ? 'selected' : '' }}"
              bind:tap="onTirePressureSelect"
              data-value="Z"
            >
              <view class="btn-icon">Z</view>
              <view class="btn-text">低压限制</view>
            </view>
          </view>
        </view>

        <!-- 评估方法 -->
        <view class="param-group">
          <view class="param-label">🔍 评估方法</view>
          <view class="param-options">
            <view
              class="param-btn {{ evaluationMethod === 'T' ? 'selected' : '' }}"
              bind:tap="onEvaluationMethodSelect"
              data-value="T"
            >
              <view class="btn-icon">T</view>
              <view class="btn-text">技术评估</view>
            </view>
            <view
              class="param-btn {{ evaluationMethod === 'U' ? 'selected' : '' }}"
              bind:tap="onEvaluationMethodSelect"
              data-value="U"
            >
              <view class="btn-icon">U</view>
              <view class="btn-text">使用经验</view>
            </view>
          </view>
        </view>
      </view>

      <!-- ACR结果显示 -->
      <view wx:if="{{ acrValue !== null }}" class="acr-result">
        <view class="result-header">
          <view class="result-icon">📍</view>
          <view class="result-label">ACR值</view>
        </view>
        <view class="result-value">{{ acrValue }}</view>
        <view class="result-info">
          <text>飞机重量: {{ aircraftMass }} kg</text>
          <text>道面类型: {{ pavementType === 'F' ? '柔性' : '刚性' }}</text>
          <text>道基强度: {{ subgradeStrength }}</text>
        </view>
      </view>

      <!-- 按钮 -->
      <view class="nav-buttons">
        <view class="nav-btn secondary" bind:tap="prevStep">⬅️ 上一步</view>
        <view class="nav-btn restart" bind:tap="restart">🔄 重新开始</view>
      </view>
    </view>

  </view>

  <!-- 横幅广告 -->
  <view wx:if="{{ !isAdFree }}" class="ad-banner-container">
    <ad unit-id="adunit-3a1bf3800fa937a2" ad-type="banner" ad-intervals="30"></ad>
  </view>
</view>
