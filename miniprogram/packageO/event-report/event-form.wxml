<view class="bento-container">
  <!-- é¡¶éƒ¨çŠ¶æ€æ  -->
  <view class="status-bar">
    <view class="status-content">
      <view class="status-left">
        <view class="back-btn" bind:tap="goBack">
          <text class="back-icon">â†</text>
        </view>
        <text class="status-title">å¡«å†™äº‹ä»¶ä¿¡æ¯</text>
      </view>
      <view class="status-right">
        <view class="save-btn" bind:tap="saveDraft">
          <text class="save-icon">ğŸ’¾</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
  <scroll-view class="bento-content" scroll-y enhanced>
    <!-- äº‹ä»¶ä¿¡æ¯ä¾¿å½“ç›’ -->
    <view class="bento-box event-info-box" wx:if="{{eventType}}">
      <view class="event-header">
        <view class="event-icon-wrapper">
          <text class="event-icon">ğŸ“</text>
        </view>
        <view class="event-meta">
          <view class="event-name">{{eventType.name}}</view>
          <view class="event-details">
            <view class="urgency-chip {{eventType.urgency === 'ç´§æ€¥' ? 'urgent' : 'normal'}}">
              <text class="urgency-icon">{{eventType.urgency === 'ç´§æ€¥' ? 'ğŸš¨' : 'ğŸ“'}}</text>
              <text class="urgency-text">{{eventType.urgency}}</text>
            </view>
            <view class="deadline-chip">
              <text class="deadline-icon">â°</text>
              <text class="deadline-text">{{customDeadline || eventType.deadline.domestic}}</text>
            </view>
          </view>
        </view>
      </view>
      
      <!-- è¿›åº¦ä¾¿å½“æ ¼ -->
      <view class="progress-section">
        <view class="progress-header">
          <text class="progress-label">ğŸ“Š å¡«å†™è¿›åº¦</text>
          <view class="progress-stats">
            <text class="progress-text">{{completedFields}}/{{totalFields}}</text>
            <text class="progress-percent">{{progressPercentage}}%</text>
          </view>
        </view>
        <view class="progress-track">
          <view class="progress-fill" style="width: {{progressPercentage}}%"></view>
        </view>
        <view class="progress-tips">
          <text class="tip-text">{{canSubmit ? 'âœ… å¯ä»¥æäº¤' : 'âš ï¸ è¯·å®Œæˆå¿…å¡«é¡¹'}}</text>
        </view>
      </view>
    </view>

    <!-- è¡¨å•å­—æ®µä¾¿å½“ç›’ -->
    <view class="bento-box form-fields-box" wx:if="{{eventType}}">
      <view class="fields-header">
        <text class="fields-title">ğŸ“‹ è¯¦ç»†ä¿¡æ¯</text>
        <text class="fields-subtitle">è¯·è®¤çœŸå¡«å†™ä»¥ä¸‹ä¿¡æ¯ï¼Œå¸¦ * çš„ä¸ºå¿…å¡«é¡¹</text>
      </view>
      
      <view class="fields-bento">
        <block wx:for="{{eventType.fields}}" wx:key="id" wx:for-index="fieldIndex">
          <view class="field-card">
            <!-- å­—æ®µå¤´éƒ¨ -->
            <view class="field-header">
              <view class="field-number">{{fieldIndex + 1}}</view>
              <view class="field-info">
                <view class="field-label">
                  {{item.label}}
                  <text wx:if="{{item.required}}" class="required-mark">*</text>
                </view>
                <view class="field-status {{getFieldStatus(item.id)}}">
                  <text class="status-icon">{{getFieldStatusIcon(item.id)}}</text>
                  <text class="status-text">{{getFieldStatusText(item.id)}}</text>
                </view>
              </view>
            </view>
            
            <!-- æ–‡æœ¬è¾“å…¥ä¾¿å½“æ ¼ -->
            <view class="input-bento" wx:if="{{item.type === 'text' || item.type === 'number'}}">
              <van-field
                value="{{formData[item.id] || ''}}"
                placeholder="{{item.placeholder || fieldPlaceholders[item.id] || 'è¯·è¾“å…¥' + item.label}}"
                required="{{item.required}}"
                type="{{item.type}}"
                bind:change="onFieldChange"
                data-field-id="{{item.id}}"
                border="{{false}}"
                class="bento-field"
                clearable
              />
              <view class="field-example" wx:if="{{fieldPlaceholders[item.id]}}">
                <text class="example-icon">ğŸ’¡</text>
                <text class="example-text">ç¤ºä¾‹ï¼š{{fieldPlaceholders[item.id]}}</text>
              </view>
            </view>
            
            <!-- æ—¥æœŸæ—¶é—´è¾“å…¥ä¾¿å½“æ ¼ -->
            <view class="input-bento" wx:if="{{item.type === 'datetime'}}">
              <view class="datetime-picker" bind:tap="showDateTimePicker" data-field-id="{{item.id}}">
                <view class="datetime-content">
                  <view class="datetime-icon-wrapper">
                    <text class="datetime-icon">ğŸ“…</text>
                  </view>
                  <view class="datetime-text">
                    <view class="datetime-value {{formData[item.id] ? 'has-value' : 'placeholder'}}">
                      {{formData[item.id] || 'é€‰æ‹©äº‹ä»¶å‘ç”Ÿæ—¶é—´'}}
                    </view>
                    <view class="datetime-hint">ç‚¹å‡»é€‰æ‹©æ—¥æœŸå’Œæ—¶é—´</view>
                  </view>
                  <view class="datetime-arrow">â†’</view>
                </view>
              </view>
            </view>
            
            <!-- æ–‡æœ¬åŸŸè¾“å…¥ä¾¿å½“æ ¼ -->
            <view class="input-bento" wx:if="{{item.type === 'textarea'}}">
              <van-field
                value="{{formData[item.id] || ''}}"
                placeholder="{{item.placeholder || fieldPlaceholders[item.id] || 'è¯·è¾“å…¥' + item.label}}"
                required="{{item.required}}"
                type="textarea"
                autosize="{{true}}"
                bind:change="onFieldChange"
                data-field-id="{{item.id}}"
                border="{{false}}"
                class="bento-field textarea-field"
                clearable
              />
              <view class="field-example" wx:if="{{fieldPlaceholders[item.id]}}">
                <text class="example-icon">ğŸ’¡</text>
                <text class="example-text">ç¤ºä¾‹ï¼š{{fieldPlaceholders[item.id]}}</text>
              </view>
            </view>
          </view>
        </block>
      </view>
    </view>

    <!-- æ“ä½œæŒ‰é’®ä¾¿å½“ç›’ -->
    <view class="bento-box actions-box">
      <view class="actions-header">
        <text class="actions-title">ğŸ¯ æ“ä½œé€‰é¡¹</text>
      </view>
      <view class="actions-bento">
        <view class="action-card draft-card" bind:tap="saveDraft">
          <view class="action-icon-wrapper">
            <text class="action-icon">ğŸ’¾</text>
          </view>
          <view class="action-content">
            <view class="action-title">ä¿å­˜è‰ç¨¿</view>
            <view class="action-desc">ç¨åç»§ç»­å¡«å†™</view>
          </view>
        </view>
        <view class="action-card submit-card {{canSubmit ? 'enabled' : 'disabled'}}" bind:tap="generateReport">
          <view class="action-icon-wrapper">
            <text class="action-icon">{{canSubmit ? 'âœ…' : 'â³'}}</text>
          </view>
          <view class="action-content">
            <view class="action-title">ç”ŸæˆæŠ¥å‘Š</view>
            <view class="action-desc">{{canSubmit ? 'ç«‹å³ç”Ÿæˆæ ‡å‡†æŠ¥å‘Š' : 'è¯·å®Œæˆå¿…å¡«é¡¹'}}</view>
          </view>
        </view>
      </view>
    </view>

    <!-- åº•éƒ¨å®‰å…¨è·ç¦» -->
    <view class="bottom-safe-area"></view>
  </scroll-view>

  <!-- æ—¥æœŸæ—¶é—´é€‰æ‹©å™¨ä¾¿å½“å¼¹çª— -->
  <van-popup 
    show="{{showDatePicker}}" 
    position="bottom" 
    bind:close="closeDateTimePicker"
    custom-class="datetime-popup"
  >
    <view class="datetime-bento">
      <view class="picker-header">
        <view class="picker-title">ğŸ“… é€‰æ‹©äº‹ä»¶å‘ç”Ÿæ—¶é—´</view>
        <view class="picker-actions">
          <view class="picker-btn cancel" bind:tap="closeDateTimePicker">å–æ¶ˆ</view>
          <view class="picker-btn confirm" bind:tap="confirmDateTime">ç¡®è®¤</view>
        </view>
      </view>
      
      <!-- æ—¥æœŸé€‰æ‹©ä¾¿å½“æ ¼ -->
      <view class="picker-section">
        <view class="picker-label">ğŸ“† é€‰æ‹©æ—¥æœŸ</view>
        <van-datetime-picker
          type="date"
          value="{{selectedDate}}"
          min-date="{{minDate}}"
          max-date="{{maxDate}}"
          bind:change="onDateChange"
        />
      </view>
      
      <!-- æ—¶é—´é€‰æ‹©ä¾¿å½“æ ¼ -->
      <view class="picker-section">
        <view class="picker-label">ğŸ• é€‰æ‹©æ—¶é—´</view>
        <view class="time-picker-bento">
          <picker-view class="time-picker-view" value="{{[selectedHour, selectedMinute]}}" bind:change="onTimeChange">
            <picker-view-column>
              <view wx:for="{{hourRange}}" wx:key="*this" class="picker-item">{{item}}</view>
            </picker-view-column>
            <picker-view-column>
              <view wx:for="{{minuteRange}}" wx:key="*this" class="picker-item">{{item}}</view>
            </picker-view-column>
          </picker-view>
        </view>
      </view>
      
      <!-- å¿«æ·æ—¶é—´ä¾¿å½“æ ¼ -->
      <view class="quick-time-section">
        <view class="quick-time-label">âš¡ å¿«æ·é€‰æ‹©</view>
        <view class="quick-time-bento">
          <view class="quick-time-btn" bind:tap="selectQuickTime" data-time="now">
            <text class="quick-icon">ğŸ•</text>
            <text class="quick-text">ç°åœ¨</text>
          </view>
          <view class="quick-time-btn" bind:tap="selectQuickTime" data-time="morning">
            <text class="quick-icon">ğŸŒ…</text>
            <text class="quick-text">ä¸Šåˆ9ç‚¹</text>
          </view>
          <view class="quick-time-btn" bind:tap="selectQuickTime" data-time="noon">
            <text class="quick-icon">â˜€ï¸</text>
            <text class="quick-text">ä¸­åˆ12ç‚¹</text>
          </view>
          <view class="quick-time-btn" bind:tap="selectQuickTime" data-time="afternoon">
            <text class="quick-icon">ğŸŒ¤ï¸</text>
            <text class="quick-text">ä¸‹åˆ2ç‚¹</text>
          </view>
          <view class="quick-time-btn" bind:tap="selectQuickTime" data-time="evening">
            <text class="quick-icon">ğŸŒ†</text>
            <text class="quick-text">ä¸‹åˆ6ç‚¹</text>
          </view>
        </view>
      </view>
    </view>
  </van-popup>

  <!-- éªŒè¯æç¤ºä¾¿å½“å¼¹çª— -->
  <van-dialog
    show="{{showValidationDialog}}"
    title="âš ï¸ ä¿¡æ¯ä¸å®Œæ•´"
    message="{{validationMessage}}"
    show-cancel-button="{{false}}"
    confirm-button-text="æˆ‘çŸ¥é“äº†"
    bind:confirm="closeValidationDialog"
  />
</view>