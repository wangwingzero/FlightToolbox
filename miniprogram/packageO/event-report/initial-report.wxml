<!-- äº‹ä»¶ä¿¡æ¯å¡«æŠ¥é¡µé¢ - 4æ­¥æµç¨‹ -->
<view class="container">
  <!-- æ­¥éª¤å¯¼èˆª -->
  <view class="step-navigation">
    <view class="steps-header">
      <view class="steps-title-row">
        <view class="steps-title-content">
          <text class="steps-title">äº‹ä»¶ä¿¡æ¯å¡«æŠ¥</text>
          <text class="steps-subtitle">ç¬¬{{currentStep + 1}}æ­¥ï¼š{{steps[currentStep].title}}</text>
        </view>
        <view class="clear-button" wx:if="{{currentStep === 0}}" bind:tap="clearAllData">
          <text class="clear-text">ğŸ—‘ï¸ å…¨éƒ¨æ¸…é™¤</text>
        </view>
      </view>
    </view>

    <view class="steps-progress">
      <view class="step-item {{index <= currentStep ? 'active' : ''}} {{item.completed ? 'completed' : ''}}"
            wx:for="{{steps}}" wx:key="title"
            data-step="{{index}}" bind:tap="goToStep">
        <view class="step-icon">{{item.icon}}</view>
        <text class="step-text">{{item.title}}</text>
      </view>
    </view>
  </view>

  <!-- æ­¥éª¤å†…å®¹ -->
  <view class="step-content">

    <!-- ç¬¬ä¸€æ­¥ï¼šåŸºæœ¬ä¿¡æ¯ -->
    <view class="step-panel" wx:if="{{currentStep === 0}}">
      <view class="panel-header">
        <view class="panel-icon">âœˆï¸</view>
        <view class="panel-title">
          <text class="title">åŸºæœ¬ä¿¡æ¯</text>
          <text class="subtitle">å¡«å†™èˆªç­åŸºç¡€ä¿¡æ¯</text>
        </view>
      </view>

      <view class="form-sections">
        <!-- äº‹å‘æ—¥æœŸ -->
        <view class="form-section">
          <view class="section-header">
            <text class="section-title">ğŸ“… äº‹å‘æ—¥æœŸ</text>
          </view>
          <view class="field-group">
            <input class="field-input"
                   placeholder="è‡ªåŠ¨å¡«å…¥å½“å‰æ—¥æœŸ"
                   value="{{reportData.basicInfo.eventDate}}"
                   data-field="reportData.basicInfo.eventDate"
                   bind:input="onFieldInput" />
          </view>
        </view>

        <!-- æ‰€å±éƒ¨é—¨ -->
        <view class="form-section">
          <view class="section-header">
            <text class="section-title">ğŸ¢ æ‰€å±éƒ¨é—¨</text>
          </view>
          <view class="field-group">
            <view class="field-row">
              <input class="field-input required"
                     placeholder="å¦‚ï¼šé£è¡Œæ€»é˜Ÿé£è¡Œä¸ƒå¤§é˜Ÿä¸€ä¸­é˜Ÿ"
                     value="{{reportData.basicInfo.department}}"
                     data-field="reportData.basicInfo.department"
                     bind:input="onFieldInput" />
            </view>
          </view>
        </view>

        <!-- èˆªç­ä¿¡æ¯ -->
        <view class="form-section">
          <view class="section-header">
            <text class="section-title">ğŸ›« èˆªç­ä¿¡æ¯</text>
          </view>
          <view class="field-group">
            <view class="field-row">
              <input class="field-input required"
                     placeholder="èˆªç­å·ï¼ˆå¦‚ï¼šCA1234ï¼‰"
                     value="{{reportData.basicInfo.flightNumber}}"
                     data-field="reportData.basicInfo.flightNumber"
                     bind:input="onFieldInput" />
            </view>

            <view class="field-row dual">
              <view class="field-item">
                <input class="field-input required"
                       placeholder="æœºå‹"
                       value="{{reportData.basicInfo.aircraftType}}"
                       data-field="reportData.basicInfo.aircraftType"
                       bind:input="onFieldInput" />
                <view class="quick-btn" data-type="aircraftTypes" data-field="reportData.basicInfo.aircraftType" bind:tap="showQuickInputModal">
                  <text class="quick-text">å¿«é€‰</text>
                </view>
              </view>
              <view class="field-item">
                <input class="field-input required"
                       placeholder="æœºå·ï¼ˆå¦‚ï¼šB-1234ï¼‰"
                       value="{{reportData.basicInfo.aircraftReg}}"
                       data-field="reportData.basicInfo.aircraftReg"
                       bind:input="onFieldInput" />
              </view>
            </view>
          </view>
        </view>

        <!-- èˆªçº¿ä¿¡æ¯ -->
        <view class="form-section">
          <view class="section-header">
            <text class="section-title">ğŸ›¤ï¸ èˆªçº¿ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰</text>
          </view>
          <view class="field-group">
            <view class="field-row dual">
              <view class="field-item">
                <input class="field-input"
                       placeholder="èµ·é£æœºåœº"
                       value="{{reportData.basicInfo.route.departure}}"
                       data-field="reportData.basicInfo.route.departure"
                       bind:input="onFieldInput" />
              </view>
              <view class="field-item">
                <input class="field-input"
                       placeholder="ç€é™†æœºåœº"
                       value="{{reportData.basicInfo.route.arrival}}"
                       data-field="reportData.basicInfo.route.arrival"
                       bind:input="onFieldInput" />
              </view>
            </view>
          </view>
        </view>

        <!-- æ—¶é—´ä¿¡æ¯ -->
        <view class="form-section">
          <view class="section-header">
            <text class="section-title">â° æ—¶é—´ä¿¡æ¯</text>
          </view>
          <view class="field-group">
            <view class="field-row">
              <view class="field-item">
                <view class="field-label">
                  <text class="label-text">èµ·é£æ—¶é—´</text>
                  <text class="label-required">*</text>
                </view>
                <view class="field-input-group">
                  <input class="field-input required"
                         placeholder="å¦‚ï¼š08:13"
                         value="{{reportData.basicInfo.times.takeoff}}"
                         data-field="reportData.basicInfo.times.takeoff"
                         bind:input="onFieldInput"
                         type="text" />
                  <picker mode="time"
                          value="{{reportData.basicInfo.times.takeoff}}"
                          bind:change="onTimeChange"
                          data-field="reportData.basicInfo.times.takeoff"
                          class="large-time-picker">
                    <view class="quick-btn">
                      <text class="quick-text">é€‰æ‹©</text>
                    </view>
                  </picker>
                </view>
              </view>
            </view>
            <view class="field-row">
              <view class="field-item">
                <view class="field-label">
                  <text class="label-text">ç€é™†æ—¶é—´</text>
                  <text class="label-required">*</text>
                </view>
                <view class="field-input-group">
                  <input class="field-input required"
                         placeholder="å¦‚ï¼š10:45"
                         value="{{reportData.basicInfo.times.landing}}"
                         data-field="reportData.basicInfo.times.landing"
                         bind:input="onFieldInput"
                         type="text" />
                  <picker mode="time"
                          value="{{reportData.basicInfo.times.landing}}"
                          bind:change="onTimeChange"
                          data-field="reportData.basicInfo.times.landing"
                          class="large-time-picker">
                    <view class="quick-btn">
                      <text class="quick-text">é€‰æ‹©</text>
                    </view>
                  </picker>
                </view>
              </view>
            </view>
            <view class="field-row">
              <view class="field-item">
                <view class="field-label">
                  <text class="label-text">äº‹å‘æ—¶é—´</text>
                  <text class="label-required">*</text>
                </view>
                <view class="field-input-group">
                  <input class="field-input required"
                         placeholder="å¦‚ï¼š09:25"
                         value="{{reportData.basicInfo.times.event}}"
                         data-field="reportData.basicInfo.times.event"
                         bind:input="onFieldInput"
                         type="text" />
                  <picker mode="time"
                          value="{{reportData.basicInfo.times.event}}"
                          bind:change="onTimeChange"
                          data-field="reportData.basicInfo.times.event"
                          class="large-time-picker">
                    <view class="quick-btn">
                      <text class="quick-text">é€‰æ‹©</text>
                    </view>
                  </picker>
                </view>
              </view>
            </view>
          </view>
        </view>

        <!-- æœºç»„ä¿¡æ¯ -->
        <view class="form-section">
          <view class="section-header">
            <text class="section-title">ğŸ‘¨â€âœˆï¸ æœºç»„ä¿¡æ¯</text>
          </view>
          <view class="field-group">
            <!-- Left Seat: Name + Qualification + Role -->
            <view class="field-row dual">
              <view class="field-item">
                <input class="field-input required"
                       placeholder="å·¦åº§å§“å"
                       value="{{reportData.basicInfo.crew.leftSeat}}"
                       data-field="reportData.basicInfo.crew.leftSeat"
                       bind:input="onFieldInput" />
              </view>
              <view class="field-item">
                <input class="field-input"
                       placeholder="èµ„è´¨"
                       value="{{reportData.basicInfo.crew.leftSeatQualification}}"
                       data-field="reportData.basicInfo.crew.leftSeatQualification"
                       bind:input="onFieldInput" />
                <view class="quick-btn" data-type="qualifications" data-field="reportData.basicInfo.crew.leftSeatQualification" bind:tap="showQuickInputModal">
                  <text class="quick-text">å¿«é€‰</text>
                </view>
              </view>
            </view>

            <!-- Left Seat Role Selection -->
            <view class="field-row">
              <view class="role-selector">
                <text class="role-label">å·¦åº§è§’è‰²ï¼š</text>
                <radio-group class="radio-group" bind:change="onLeftSeatRoleChange">
                  <label class="radio-item">
                    <radio value="PF" checked="{{reportData.basicInfo.crew.leftSeatRole === 'PF'}}" color="#1989fa"/>
                    <text class="radio-text">PF</text>
                  </label>
                  <label class="radio-item">
                    <radio value="PM" checked="{{reportData.basicInfo.crew.leftSeatRole === 'PM'}}" color="#1989fa"/>
                    <text class="radio-text">PM</text>
                  </label>
                </radio-group>
              </view>
            </view>

            <!-- Right Seat: Name + Qualification + Role -->
            <view class="field-row dual">
              <view class="field-item">
                <input class="field-input required"
                       placeholder="å³åº§å§“å"
                       value="{{reportData.basicInfo.crew.rightSeat}}"
                       data-field="reportData.basicInfo.crew.rightSeat"
                       bind:input="onFieldInput" />
              </view>
              <view class="field-item">
                <input class="field-input"
                       placeholder="èµ„è´¨"
                       value="{{reportData.basicInfo.crew.rightSeatQualification}}"
                       data-field="reportData.basicInfo.crew.rightSeatQualification"
                       bind:input="onFieldInput" />
                <view class="quick-btn" data-type="qualifications" data-field="reportData.basicInfo.crew.rightSeatQualification" bind:tap="showQuickInputModal">
                  <text class="quick-text">å¿«é€‰</text>
                </view>
              </view>
            </view>

            <!-- Right Seat Role Selection -->
            <view class="field-row">
              <view class="role-selector">
                <text class="role-label">å³åº§è§’è‰²ï¼š</text>
                <radio-group class="radio-group" bind:change="onRightSeatRoleChange">
                  <label class="radio-item">
                    <radio value="PF" checked="{{reportData.basicInfo.crew.rightSeatRole === 'PF'}}" color="#1989fa"/>
                    <text class="radio-text">PF</text>
                  </label>
                  <label class="radio-item">
                    <radio value="PM" checked="{{reportData.basicInfo.crew.rightSeatRole === 'PM'}}" color="#1989fa"/>
                    <text class="radio-text">PM</text>
                  </label>
                </radio-group>
              </view>
            </view>

            <!-- Observer: Name + Qualification + Role -->
            <view class="field-row dual">
              <view class="field-item">
                <input class="field-input"
                       placeholder="è§‚å¯Ÿå‘˜å§“åï¼ˆå¯é€‰ï¼‰"
                       value="{{reportData.basicInfo.crew.observer}}"
                       data-field="reportData.basicInfo.crew.observer"
                       bind:input="onFieldInput" />
              </view>
              <view class="field-item">
                <input class="field-input"
                       placeholder="èµ„è´¨ï¼ˆå¯é€‰ï¼‰"
                       value="{{reportData.basicInfo.crew.observerQualification}}"
                       data-field="reportData.basicInfo.crew.observerQualification"
                       bind:input="onFieldInput" />
                <view class="quick-btn" data-type="qualifications" data-field="reportData.basicInfo.crew.observerQualification" bind:tap="showQuickInputModal">
                  <text class="quick-text">å¿«é€‰</text>
                </view>
              </view>
            </view>

            <!-- Observer Role Selection (if observer exists) -->
            <view class="field-row" wx:if="{{reportData.basicInfo.crew.observer}}">
              <view class="role-selector">
                <text class="role-label">è§‚å¯Ÿåº§è§’è‰²ï¼š</text>
                <radio-group class="radio-group" bind:change="onObserverRoleChange">
                  <label class="radio-item">
                    <radio value="PF" checked="{{reportData.basicInfo.crew.observerRole === 'PF'}}" color="#1989fa"/>
                    <text class="radio-text">PF</text>
                  </label>
                  <label class="radio-item">
                    <radio value="PM" checked="{{reportData.basicInfo.crew.observerRole === 'PM'}}" color="#1989fa"/>
                    <text class="radio-text">PM</text>
                  </label>
                </radio-group>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- ç¬¬äºŒæ­¥ï¼šäº‹ä»¶ç±»å‹ -->
    <view class="step-panel" wx:if="{{currentStep === 1}}">
      <view class="panel-header">
        <view class="panel-icon">ğŸ“‹</view>
        <view class="panel-title">
          <text class="title">äº‹ä»¶ç±»å‹</text>
          <text class="subtitle">é€‰æ‹©äº‹ä»¶ç±»å‹</text>
        </view>
      </view>

      <view class="form-sections">
        <!-- é€‰æ‹©çš„äº‹ä»¶ç±»å‹æ˜¾ç¤º -->
        <view class="form-section" wx:if="{{reportData.eventType.title}}">
          <view class="selected-event-type">
            <view class="selected-label">å·²é€‰æ‹©ï¼š</view>
            <view class="selected-info">
              <text class="selected-title">{{reportData.eventType.title}}</text>
              <text class="selected-category">{{reportData.eventType.category}}</text>
            </view>
          </view>
        </view>

        <!-- äº‹ä»¶åˆ†ç±»é€‰æ‹© -->
        <view class="form-section">
          <view class="section-header">
            <text class="section-title">ğŸ“‚ é€‰æ‹©äº‹ä»¶åˆ†ç±»</text>
          </view>
          <view class="category-tabs">
            <view class="category-tab {{eventTypesData.selectedCategory === item ? 'active' : ''}}"
                  wx:for="{{eventTypesData.categories}}" wx:key="*this"
                  data-category="{{item}}"
                  bind:tap="selectCategory">
              <text class="category-text">{{item}}</text>
            </view>
          </view>
        </view>

        <!-- äº‹ä»¶ç±»å‹åˆ—è¡¨ -->
        <view class="form-section" wx:if="{{eventTypesData.selectedCategory}}">
          <view class="section-header">
            <text class="section-title">ğŸ“ é€‰æ‹©äº‹ä»¶ç±»å‹</text>
            <text class="section-subtitle">{{eventTypesData.filteredEventTypes.length}}ä¸ªäº‹ä»¶ç±»å‹</text>
          </view>
          <view class="event-types-grid">
            <view class="event-type-card {{reportData.eventType.title === item.title ? 'selected' : ''}}"
                  wx:for="{{eventTypesData.filteredEventTypes}}" wx:key="title"
                  data-title="{{item.title}}"
                  data-category="{{item.category}}"
                  bind:tap="selectEventType">
              <view class="card-icon">ğŸ“Œ</view>
              <text class="card-title">{{item.title}}</text>
              <view class="card-check" wx:if="{{reportData.eventType.title === item.title}}">âœ“</view>
            </view>
          </view>
        </view>

        <!-- æç¤ºä¿¡æ¯ -->
        <view class="form-section" wx:if="{{!eventTypesData.selectedCategory}}">
          <view class="empty-hint">
            <text class="hint-icon">ğŸ‘†</text>
            <text class="hint-text">è¯·å…ˆé€‰æ‹©äº‹ä»¶åˆ†ç±»</text>
          </view>
        </view>
      </view>
    </view>

    <!-- ç¬¬ä¸‰æ­¥ï¼šäº‹ä»¶è¯¦æƒ… -->
    <view class="step-panel" wx:if="{{currentStep === 2}}">
      <view class="panel-header">
        <view class="panel-icon">ğŸ“</view>
        <view class="panel-title">
          <text class="title">äº‹ä»¶è¯¦æƒ…</text>
          <text class="subtitle">å¡«å†™äº‹ä»¶è¯¦ç»†ä¿¡æ¯</text>
        </view>
      </view>

      <view class="form-sections">
        <!-- é€šç”¨å­—æ®µ -->
        <view class="form-section">
          <view class="section-header">
            <text class="section-title">ğŸ“Œ é€šç”¨ä¿¡æ¯ï¼ˆå¿…å¡«ï¼‰</text>
            <text class="section-subtitle">æ‰€æœ‰äº‹ä»¶ç±»å‹éƒ½éœ€è¦å¡«å†™</text>
          </view>

          <view class="field-group">
            <!-- æ‰€åœ¨åŒºåŸŸ/æœºåœº/è·‘é“ -->
            <view class="field-row">
              <view class="field-label">
                <text class="label-text">æ‰€åœ¨åŒºåŸŸ/æœºåœº/è·‘é“ï¼ˆå¯é€‰ï¼‰</text>
              </view>
              <textarea class="field-textarea"
                        placeholder="å¦‚ï¼šåŒ—äº¬åŒºåŸŸç®¡åˆ¶ä¸­å¿ƒã€é¦–éƒ½æœºåœº36Lè·‘é“"
                        value="{{reportData.eventDetails.commonFields.location}}"
                        data-field="reportData.eventDetails.commonFields.location"
                        bind:input="onFieldInput"
                        maxlength="200"
                        auto-height />
            </view>

            <!-- é£è¡Œé˜¶æ®µ -->
            <view class="field-row">
              <view class="field-label">
                <text class="label-text">é£è¡Œé˜¶æ®µ</text>
                <text class="label-required">*</text>
              </view>
              <view class="field-input-group">
                <input class="field-input required"
                       placeholder="å¦‚ï¼šå·¡èˆªé˜¶æ®µã€è¿›è¿‘é˜¶æ®µ"
                       value="{{reportData.eventDetails.commonFields.phase}}"
                       data-field="reportData.eventDetails.commonFields.phase"
                       bind:input="onFieldInput" />
                <view class="quick-btn" data-type="flightPhases" data-field="reportData.eventDetails.commonFields.phase" bind:tap="showQuickInputModal">
                  <text class="quick-text">å¿«é€‰</text>
                </view>
              </view>
            </view>

            <!-- å¤©æ°”æƒ…å†µï¼ˆå¯é€‰ï¼‰ -->
            <view class="field-row">
              <view class="field-label">
                <text class="label-text">å¤©æ°”æƒ…å†µï¼ˆå¯é€‰ï¼‰</text>
              </view>
              <view class="field-input-group">
                <input class="field-input"
                       placeholder="å¦‚ï¼šVMCã€IMCã€æ™´æœ—"
                       value="{{reportData.eventDetails.commonFields.weather}}"
                       data-field="reportData.eventDetails.commonFields.weather"
                       bind:input="onFieldInput" />
                <view class="quick-btn" data-type="weatherConditions" data-field="reportData.eventDetails.commonFields.weather" bind:tap="showQuickInputModal">
                  <text class="quick-text">å¿«é€‰</text>
                </view>
              </view>
            </view>

            <!-- æœºç»„å¤„ç½®æƒ…å†µ -->
            <view class="field-row">
              <view class="field-label">
                <text class="label-text">æœºç»„å¤„ç½®æƒ…å†µ</text>
                <text class="label-required">*</text>
              </view>
              <textarea class="field-textarea required"
                        placeholder="æè¿°æœºç»„é‡‡å–çš„å¤„ç½®æªæ–½å’Œæ“ä½œ"
                        value="{{reportData.eventDetails.commonFields.crewAction}}"
                        data-field="reportData.eventDetails.commonFields.crewAction"
                        bind:input="onFieldInput"
                        maxlength="300"
                        auto-height />
            </view>

            <!-- åç»­è¿è¡Œæƒ…å†µ -->
            <view class="field-row">
              <view class="field-label">
                <text class="label-text">åç»­è¿è¡Œæƒ…å†µ</text>
                <text class="label-required">*</text>
              </view>
              <textarea class="field-textarea required"
                        placeholder="å¦‚ï¼šåç»­è¿è¡Œæ­£å¸¸"
                        value="{{reportData.eventDetails.commonFields.followUp}}"
                        data-field="reportData.eventDetails.commonFields.followUp"
                        bind:input="onFieldInput"
                        maxlength="300"
                        auto-height />
            </view>
          </view>
        </view>

        <!-- ç‰¹å®šå­—æ®µï¼ˆæ ¹æ®äº‹ä»¶ç±»å‹ï¼‰ -->
        <view class="form-section" wx:if="{{reportData.eventType.title && reportData.eventDetails.specificFieldsArray.length > 0}}">
          <view class="section-header">
            <text class="section-title">ğŸ” {{reportData.eventType.title}} - ç‰¹å®šä¿¡æ¯</text>
            <text class="section-subtitle">ä»¥ä¸‹å­—æ®µä¸ºé€‰å¡«ï¼Œè¯·æ ¹æ®å®é™…æƒ…å†µå¡«å†™</text>
          </view>

          <view class="field-group">
            <view class="field-row" wx:for="{{reportData.eventDetails.specificFieldsArray}}" wx:key="key">
              <view class="field-label">
                <text class="label-text">{{item.label}}ï¼ˆå¯é€‰ï¼‰</text>
              </view>
              <textarea class="field-textarea"
                        placeholder="{{item.placeholder}}"
                        value="{{reportData.eventDetails.specificFields[item.key]}}"
                        data-field="reportData.eventDetails.specificFields.{{item.key}}"
                        bind:input="onFieldInput"
                        maxlength="300"
                        auto-height />
            </view>
          </view>
        </view>

        <!-- æç¤ºï¼šæœªé€‰æ‹©äº‹ä»¶ç±»å‹ -->
        <view class="form-section" wx:if="{{!reportData.eventType.title}}">
          <view class="empty-hint">
            <text class="hint-icon">âš ï¸</text>
            <text class="hint-text">è¯·å…ˆåœ¨ä¸Šä¸€æ­¥é€‰æ‹©äº‹ä»¶ç±»å‹</text>
          </view>
        </view>
      </view>
    </view>

    <!-- ç¬¬å››æ­¥ï¼šç¡®è®¤æäº¤ -->
    <view class="step-panel" wx:if="{{currentStep === 3}}">
      <view class="panel-header">
        <view class="panel-icon">âœ…</view>
        <view class="panel-title">
          <text class="title">ç¡®è®¤æäº¤</text>
          <text class="subtitle">æ£€æŸ¥å¹¶ç”ŸæˆæŠ¥å‘Š</text>
        </view>
      </view>

      <view class="summary-sections">
        <!-- åŸºæœ¬ä¿¡æ¯æ‘˜è¦ -->
        <view class="summary-card">
          <view class="summary-header">
            <text class="summary-title">âœˆï¸ èˆªç­ä¿¡æ¯</text>
          </view>
          <view class="summary-content">
            <view class="summary-item">
              <text class="summary-label">éƒ¨é—¨ï¼š</text>
              <text class="summary-value">{{reportData.basicInfo.department}}</text>
            </view>
            <view class="summary-item">
              <text class="summary-label">èˆªç­ï¼š</text>
              <text class="summary-value">{{reportData.basicInfo.aircraftType}}/{{reportData.basicInfo.aircraftReg}} {{reportData.basicInfo.flightNumber}}</text>
            </view>
            <view class="summary-item" wx:if="{{reportData.basicInfo.route.departure || reportData.basicInfo.route.arrival}}">
              <text class="summary-label">èˆªçº¿ï¼š</text>
              <text class="summary-value">{{reportData.basicInfo.route.departure}} - {{reportData.basicInfo.route.arrival}}</text>
            </view>
            <view class="summary-item">
              <text class="summary-label">æœºç»„ï¼š</text>
              <text class="summary-value">å·¦åº§{{reportData.basicInfo.crew.leftSeatRole}} {{reportData.basicInfo.crew.leftSeat}}ï¼Œå³åº§{{reportData.basicInfo.crew.rightSeatRole}} {{reportData.basicInfo.crew.rightSeat}}</text>
            </view>
          </view>
        </view>

        <!-- äº‹ä»¶ä¿¡æ¯æ‘˜è¦ -->
        <view class="summary-card">
          <view class="summary-header">
            <text class="summary-title">ğŸ“‹ äº‹ä»¶ä¿¡æ¯</text>
          </view>
          <view class="summary-content">
            <view class="summary-item">
              <text class="summary-label">äº‹ä»¶ç±»å‹ï¼š</text>
              <text class="summary-value highlight">{{reportData.eventType.title}}</text>
            </view>
            <view class="summary-item">
              <text class="summary-label">äº‹å‘ä½ç½®ï¼š</text>
              <text class="summary-value">{{reportData.eventDetails.commonFields.location}}</text>
            </view>
            <view class="summary-item">
              <text class="summary-label">é£è¡Œé˜¶æ®µï¼š</text>
              <text class="summary-value">{{reportData.eventDetails.commonFields.phase}}</text>
            </view>
            <view class="summary-item">
              <text class="summary-label">äº‹å‘æ—¶é—´ï¼š</text>
              <text class="summary-value">{{reportData.basicInfo.times.event}}</text>
            </view>
          </view>
        </view>

        <!-- ç”ŸæˆæŠ¥å‘ŠæŒ‰é’® -->
        <view class="action-buttons final">
          <view class="btn-primary full-width" bind:tap="generateReport">
            <text class="btn-text">ğŸ“„ ç”ŸæˆæŠ¥å‘Š</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨å¯¼èˆªæŒ‰é’® -->
  <view class="navigation-buttons">
    <view class="btn-secondary {{currentStep === 0 ? 'disabled' : ''}}"
          wx:if="{{currentStep > 0}}" bind:tap="prevStep">
      <text class="btn-text">â† ä¸Šä¸€æ­¥</text>
    </view>

    <view class="btn-primary {{currentStep === 3 ? 'disabled' : ''}}"
          wx:if="{{currentStep < 3}}" bind:tap="nextStep">
      <text class="btn-text">ä¸‹ä¸€æ­¥ â†’</text>
    </view>
  </view>

  <!-- å¿«æ·è¾“å…¥å¼¹çª— -->
  <van-popup
    show="{{ showQuickInput }}"
    position="bottom"
    bind:close="closeQuickInput"
    round="{{ true }}"
    safe-area-inset-bottom="{{ true }}"
  >
    <view class="quick-input-container">
      <view class="quick-header">
        <text class="quick-title">å¿«æ·é€‰æ‹©</text>
      </view>

      <view class="quick-content">
        <!-- èµ„è´¨é€‰æ‹© -->
        <view class="quick-options" wx:if="{{quickInputType === 'qualifications'}}">
          <view class="quick-option"
                wx:for="{{quickInputs.qualifications}}" wx:key="index"
                data-value="{{item}}"
                bind:tap="selectQuickInput">
            <text class="option-text">{{item}}</text>
          </view>
        </view>

        <!-- åˆ†éƒ¨é€‰æ‹© -->
        <view class="quick-options" wx:if="{{quickInputType === 'departments'}}">
          <view class="quick-option"
                wx:for="{{quickInputs.departments}}" wx:key="index"
                data-value="{{item}}"
                bind:tap="selectQuickInput">
            <text class="option-text">{{item}}</text>
          </view>
        </view>

        <!-- æœºå‹é€‰æ‹© -->
        <view class="quick-options" wx:if="{{quickInputType === 'aircraftTypes'}}">
          <view class="quick-option"
                wx:for="{{quickInputs.aircraftTypes}}" wx:key="index"
                data-value="{{item}}"
                bind:tap="selectQuickInput">
            <text class="option-text">{{item}}</text>
          </view>
        </view>

        <!-- é£è¡Œé˜¶æ®µé€‰æ‹© -->
        <view class="quick-options" wx:if="{{quickInputType === 'flightPhases'}}">
          <view class="quick-option"
                wx:for="{{quickInputs.flightPhases}}" wx:key="index"
                data-value="{{item}}"
                bind:tap="selectQuickInput">
            <text class="option-text">{{item}}</text>
          </view>
        </view>

        <!-- å¤©æ°”æ¡ä»¶é€‰æ‹© -->
        <view class="quick-options" wx:if="{{quickInputType === 'weatherConditions'}}">
          <view class="quick-option"
                wx:for="{{quickInputs.weatherConditions}}" wx:key="index"
                data-value="{{item}}"
                bind:tap="selectQuickInput">
            <text class="option-text">{{item}}</text>
          </view>
        </view>
      </view>
    </view>
  </van-popup>

  <!-- æŠ¥å‘Šæ˜¾ç¤ºå¼¹çª— -->
  <van-popup
    show="{{ showReportModal }}"
    position="bottom"
    bind:close="closeReportModal"
    round="{{ true }}"
    safe-area-inset-bottom="{{ true }}"
    custom-style="height: 85vh;"
  >
    <view class="report-popup-container">
      <view class="report-header">
        <view class="popup-handle"></view>
        <view class="header-content">
          <view class="header-icon">
            <text class="emoji-large">ğŸ“„</text>
          </view>
          <view class="header-text">
            <text class="popup-title">äº‹ä»¶ä¿¡æ¯æŠ¥å‘Š</text>
            <text class="popup-subtitle">ç”Ÿæˆçš„è§„èŒƒæŠ¥å‘Šå†…å®¹</text>
          </view>
        </view>
      </view>

      <scroll-view class="report-content" scroll-y="{{ true }}" enhanced="{{ true }}">
        <view class="report-text" user-select>{{generatedReport}}</view>
      </scroll-view>

      <view class="report-footer">
        <view class="footer-buttons">
          <view class="btn-secondary" bind:tap="closeReportModal">
            <text class="btn-text">å…³é—­</text>
          </view>
          <view class="btn-primary" bind:tap="copyReport">
            <text class="btn-text">ğŸ“‹ å¤åˆ¶å†…å®¹</text>
          </view>
        </view>
      </view>
    </view>
  </van-popup>

  <!-- æ¨ªå¹…å¹¿å‘Š -->
  <view wx:if="{{ !isAdFree }}" class="ad-banner-container">
    <ad unit-id="adunit-4e68875624a88762" ad-type="banner" ad-intervals="30"></ad>
  </view>

  <!-- åº•éƒ¨å®‰å…¨è·ç¦» -->
  <view class="bottom-safe-area"></view>
</view>
