<!-- SNOWTAMè§£ç å™¨ - å›ºå®šæ ¼å¼è¾“å…¥ç•Œé¢ -->
<view class="container">

  <!-- è¾“å…¥è§†å›¾ -->
  <block wx:if="{{currentView === 'input'}}">

    <!-- è¾“å…¥æ¨¡å¼åˆ‡æ¢ -->
    <view class="mode-switcher">
      <view class="mode-btn {{inputMode === 'manual' ? 'active' : ''}}" bindtap="switchMode" data-mode="manual">
        <text class="mode-icon">âŒ¨ï¸</text>
        <text class="mode-text">æ‰‹åŠ¨è¾“å…¥</text>
      </view>
      <view class="mode-btn {{inputMode === 'paste' ? 'active' : ''}}" bindtap="switchMode" data-mode="paste">
        <text class="mode-icon">ğŸ“‹</text>
        <text class="mode-text">ç²˜è´´è§£æ</text>
      </view>
    </view>

    <!-- ç²˜è´´è§£ææ¨¡å¼ -->
    <block wx:if="{{inputMode === 'paste'}}">
      <view class="paste-section">
        <view class="paste-header">
          <text class="paste-title">ç²˜è´´SNOWTAMåŸæ–‡</text>
          <text class="paste-hint">æ”¯æŒGRFæ ¼å¼çš„é›ªæƒ…é€šå‘Šæ–‡æœ¬</text>
        </view>
        
        <textarea 
          class="paste-input" 
          placeholder="ç²˜è´´SNOWTAMåŸæ–‡ï¼Œä¾‹å¦‚ï¼š&#10;A)ZBAA B)12081200 C)09L D)5/5/5 E)100/100/100 F)NR/NR/03 G)WET/WET/WET&#10;&#10;æˆ–ç®€åŒ–æ ¼å¼ï¼š&#10;09L 5/5/5 100/100/100 NR/NR/03 WET/WET/WET"
          value="{{pasteText}}"
          bindinput="onPasteInput"
          maxlength="500"
          auto-height
        />
        
        <view class="paste-actions">
          <button class="btn btn-clear-paste" bindtap="clearPasteText">æ¸…ç©º</button>
          <button class="btn btn-parse {{pasteText ? '' : 'disabled'}}" bindtap="parseSNOWTAM" disabled="{{!pasteText}}">
            ğŸ” è§£æ
          </button>
        </view>

        <!-- è§£ææç¤º/é”™è¯¯ä¿¡æ¯ -->
        <view class="parse-result" wx:if="{{parseMessage}}">
          <view class="parse-message {{parseStatus}}">
            <text class="parse-icon">{{parseStatus === 'success' ? 'âœ…' : parseStatus === 'error' ? 'âŒ' : 'â„¹ï¸'}}</text>
            <text class="parse-text">{{parseMessage}}</text>
          </view>
        </view>

        <!-- æ ¼å¼è¯´æ˜ -->
        <view class="format-guide">
          <view class="guide-title">ğŸ“– æ”¯æŒçš„æ ¼å¼</view>
          <view class="guide-item">
            <text class="guide-label">å®Œæ•´GRFæ ¼å¼ï¼š</text>
            <text class="guide-example">A)ZBAA B)æ—¥æœŸæ—¶é—´ C)è·‘é“ D)RWYCC E)è¦†ç›–ç‡ F)æ·±åº¦ G)è¡¨é¢çŠ¶å†µ</text>
          </view>
          <view class="guide-item">
            <text class="guide-label">ç®€åŒ–æ ¼å¼ï¼š</text>
            <text class="guide-example">09L 5/5/5 100/100/100 NR/NR/03 WET/WET/WET</text>
          </view>
          <view class="guide-item">
            <text class="guide-label">RWYCCï¼š</text>
            <text class="guide-example">0-6 (0=æ¹¿å†°, 6=å¹²ç‡¥)</text>
          </view>
        </view>

        <!-- æ ¼å­å¹¿å‘Š -->
        <view class="ad-grid-container" wx:if="{{ !isAdFree }}">
          <ad unit-id="adunit-3a1bf3800fa937a2" ad-type="grid" grid-opacity="1.0" grid-count="3"></ad>
        </view>
      </view>
    </block>

    <!-- æ‰‹åŠ¨è¾“å…¥æ¨¡å¼ï¼ˆåŸæœ‰ç•Œé¢ï¼‰ -->
    <block wx:else>
    <!-- å›ºå®šæ ¼å¼è¾“å…¥åŒºåŸŸ -->
    <view class="fixed-input-section">
      <view class="format-hint">{{formatHint}}</view>

      <!-- å•è¡Œå›ºå®šæ ¼å¼æ˜¾ç¤º -->
      <view class="fixed-format-display" bindtap="handleDisplayClick">
        <text wx:for="{{displayChars}}"
              wx:key="index"
              data-index="{{item.index}}"
              class="{{item.className}}">
          {{item.char}}
        </text>
      </view>

      <!-- å½“å‰ä½ç½®æç¤º -->
      <view class="input-hint">{{currentHint}}</view>
    </view>

    <!-- åŠ¨æ€é”®ç›˜ -->
    <view class="keyboard-section">
      <view class="keyboard-title">{{keyboardTitle}}</view>

      <!-- ç»Ÿä¸€çš„é”®ç›˜æ˜¾ç¤º -->
      <view class="keyboard-grid {{keyboardClass}}">
        <view wx:for="{{keyboardKeys}}" wx:key="char"
              class="key key-{{currentKeyboard}} {{item.char === ' ' ? 'key-empty' : ''}} {{currentKeyboard === 'rwycc' ? 'key-rwycc-' + item.char : ''}}"
              bindtap="inputChar"
              data-char="{{item.char}}">
          <block wx:if="{{currentKeyboard === 'rwycc'}}">
            <text class="rwycc-num">{{item.display}}</text>
            <text class="rwycc-desc">{{item.desc}}</text>
          </block>
          <block wx:else>
            {{item.display}}
          </block>
        </view>
      </view>

      <!-- æ§åˆ¶æŒ‰é’® -->
      <view class="control-buttons">
        <button class="btn btn-delete" bindtap="deleteChar">âŒ« åˆ é™¤</button>
        <button class="btn btn-clear" bindtap="clearAll">æ¸…é™¤å…¨éƒ¨</button>
        <button class="btn btn-decode {{canDecode ? '' : 'disabled'}} {{isComplete ? 'complete-pulse' : ''}}"
                bindtap="decodeSNOWTAM"
                disabled="{{!canDecode}}">
          è§£ç 
        </button>
      </view>
    </view>

    <!-- æ ¼å­å¹¿å‘Š -->
    <view class="ad-grid-container" wx:if="{{ !isAdFree }}">
      <ad unit-id="adunit-3a1bf3800fa937a2" ad-type="grid" grid-opacity="1.0" grid-count="3"></ad>
    </view>

    </block>
    <!-- æ‰‹åŠ¨è¾“å…¥æ¨¡å¼ç»“æŸ -->

  </block>

  <!-- ç»“æœè§†å›¾ -->
  <block wx:if="{{currentView === 'result'}}">

    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <view class="result-header">
      <view class="result-nav">
        <view class="nav-back" bindtap="backToInput">
          <text>â† è¿”å›</text>
        </view>
        <view class="nav-title">è§£ç ç»“æœ</view>
        <view class="nav-new" bindtap="newDecode">
          <text>æ–°å»º</text>
        </view>
      </view>
    </view>

    <!-- è§£ç ç»“æœå†…å®¹ -->
    <scroll-view class="result-content" scroll-y>

      <!-- è·‘é“ä¿¡æ¯ -->
      <view class="result-section">
        <view class="section-header">
          <text class="section-icon">ğŸ›¬</text>
          <text class="section-title">è·‘é“ä¿¡æ¯</text>
        </view>
        <view class="section-body">
          <view class="info-item">
            <text class="info-label">è·‘é“ï¼š</text>
            <text class="info-value">{{analysis.runway}}</text>
          </view>
          <view class="info-item">
            <text class="info-label">åŸå§‹è¾“å…¥ï¼š</text>
            <text class="info-value code">{{analysis.originalCode}}</text>
          </view>
        </view>
      </view>

      <!-- æ€»ä½“æ€§èƒ½è¯„ä¼° -->
      <view class="result-section" wx:if="{{analysis.performanceAssessment}}">
        <view class="section-header">
          <text class="section-icon">ğŸ“Š</text>
          <text class="section-title">æ€§èƒ½è¯„ä¼°</text>
        </view>
        <view class="section-body">
          <view class="assessment-card assessment-{{analysis.performanceAssessment.level}}">
            <view class="assessment-metrics">
              <view class="metric">
                <text class="metric-label">æœ€ä½RWYCCï¼š</text>
                <text class="metric-value">{{analysis.performanceAssessment.minCode}}</text>
              </view>
              <view class="metric">
                <text class="metric-label">ä½ç½®ï¼š</text>
                <text class="metric-value">{{analysis.performanceAssessment.minSegment}}</text>
              </view>
            </view>
            <view class="assessment-recommendation">
              {{analysis.performanceAssessment.recommendation}}
            </view>
          </view>
        </view>
      </view>

      <!-- è·‘é“ä¸‰æ®µè¯¦ç»†çŠ¶å†µ -->
      <view class="result-section">
        <view class="section-header">
          <text class="section-icon">ğŸ“‹</text>
          <text class="section-title">è·‘é“ä¸‰æ®µçŠ¶å†µ</text>
        </view>
        <view class="section-body">
          <view wx:for="{{analysis.segments}}" wx:key="name" class="segment-card">
            <view class="segment-header">
              <text class="segment-name">{{item.name}}</text>
              <view class="segment-rwycc" style="background: {{item.rwycc.color}}">
                RWYCC: {{item.rwycc.name}}
              </view>
            </view>

            <view class="segment-details">
              <view class="detail-row">
                <text class="detail-label">åˆ¹è½¦æ•ˆåº”ï¼š</text>
                <text class="detail-value">{{item.rwycc.description}}</text>
              </view>
              <view class="detail-row">
                <text class="detail-label">æ±¡æŸ“è¦†ç›–ï¼š</text>
                <text class="detail-value">{{item.coverage.description}}</text>
              </view>
              <view class="detail-row">
                <text class="detail-label">æ±¡æŸ“æ·±åº¦ï¼š</text>
                <text class="detail-value">{{item.depth.description}}</text>
              </view>
              <view class="detail-row">
                <text class="detail-label">è¡¨é¢çŠ¶å†µï¼š</text>
                <text class="detail-value">{{item.surface.description}}</text>
              </view>
              <view class="performance-badge" style="background: {{item.performance.color}}">
                {{item.performance.description}}
              </view>
            </view>
          </view>
        </view>
      </view>

      <!-- è­¦å‘Šä¿¡æ¯ -->
      <view class="result-section" wx:if="{{analysis.warnings && analysis.warnings.length > 0}}">
        <view class="section-header">
          <text class="section-icon">âš ï¸</text>
          <text class="section-title">è­¦å‘Šæç¤º</text>
        </view>
        <view class="section-body">
          <view wx:for="{{analysis.warnings}}" wx:key="message"
                class="warning-item warning-{{item.type}}">
            <text class="warning-icon">
              <block wx:if="{{item.type === 'DANGER'}}">ğŸ”´</block>
              <block wx:elif="{{item.type === 'CRITICAL'}}">â›”</block>
              <block wx:elif="{{item.type === 'WARNING'}}">ğŸŸ¡</block>
              <block wx:else>â„¹ï¸</block>
            </text>
            <text class="warning-text">{{item.message}}</text>
          </view>
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="action-buttons">
        <button class="btn btn-new" bindtap="newDecode">æ–°å»ºè§£ç </button>
      </view>

      <!-- æ ¼å­å¹¿å‘Š -->
      <view class="ad-grid-container" wx:if="{{ !isAdFree }}">
        <ad unit-id="adunit-3a1bf3800fa937a2" ad-type="grid" grid-opacity="1.0" grid-count="3"></ad>
      </view>

    </scroll-view>

  </block>

</view>