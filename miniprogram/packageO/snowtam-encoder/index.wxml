<!-- SNOWTAMè§£ç å™¨ - å›ºå®šæ ¼å¼è¾“å…¥ç•Œé¢ -->
<view class="container">

  <!-- è¾“å…¥è§†å›¾ -->
  <block wx:if="{{currentView === 'input'}}">

    <!-- å›ºå®šæ ¼å¼è¾“å…¥åŒºåŸŸ -->
    <view class="fixed-input-section">
      <view class="format-hint">{{formatHint}}</view>

      <!-- å•è¡Œå›ºå®šæ ¼å¼æ˜¾ç¤º -->
      <view class="fixed-format-display" bindtap="handleDisplayClick">
        <text wx:for="{{displayChars}}"
              wx:key="index"
              data-index="{{item.index}}"
              class="{{item.className}}">
          {{item.char}}
        </text>
      </view>

      <!-- å½“å‰ä½ç½®æç¤º -->
      <view class="input-hint">{{currentHint}}</view>
    </view>

    <!-- åŠ¨æ€é”®ç›˜ -->
    <view class="keyboard-section">
      <view class="keyboard-title">{{keyboardTitle}}</view>

      <!-- ç»Ÿä¸€çš„é”®ç›˜æ˜¾ç¤º -->
      <view class="keyboard-grid {{keyboardClass}}">
        <view wx:for="{{keyboardKeys}}" wx:key="char"
              class="key key-{{currentKeyboard}} {{item.char === ' ' ? 'key-empty' : ''}} {{currentKeyboard === 'rwycc' ? 'key-rwycc-' + item.char : ''}}"
              bindtap="inputChar"
              data-char="{{item.char}}">
          <block wx:if="{{currentKeyboard === 'rwycc'}}">
            <text class="rwycc-num">{{item.display}}</text>
            <text class="rwycc-desc">{{item.desc}}</text>
          </block>
          <block wx:else>
            {{item.display}}
          </block>
        </view>
      </view>

      <!-- æ§åˆ¶æŒ‰é’® -->
      <view class="control-buttons">
        <button class="btn btn-delete" bindtap="deleteChar">âŒ« åˆ é™¤</button>
        <button class="btn btn-clear" bindtap="clearAll">æ¸…é™¤å…¨éƒ¨</button>
        <button class="btn btn-decode {{canDecode ? '' : 'disabled'}} {{isComplete ? 'complete-pulse' : ''}}"
                bindtap="decodeSNOWTAM"
                disabled="{{!canDecode}}">
          è§£ç 
        </button>
      </view>
    </view>

  </block>

  <!-- ç»“æœè§†å›¾ -->
  <block wx:if="{{currentView === 'result'}}">

    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <view class="result-header">
      <view class="result-nav">
        <view class="nav-back" bindtap="backToInput">
          <text>â† è¿”å›</text>
        </view>
        <view class="nav-title">è§£ç ç»“æœ</view>
        <view class="nav-new" bindtap="newDecode">
          <text>æ–°å»º</text>
        </view>
      </view>
    </view>

    <!-- è§£ç ç»“æœå†…å®¹ -->
    <scroll-view class="result-content" scroll-y>

      <!-- è·‘é“ä¿¡æ¯ -->
      <view class="result-section">
        <view class="section-header">
          <text class="section-icon">ğŸ›¬</text>
          <text class="section-title">è·‘é“ä¿¡æ¯</text>
        </view>
        <view class="section-body">
          <view class="info-item">
            <text class="info-label">è·‘é“ï¼š</text>
            <text class="info-value">{{analysis.runway}}</text>
          </view>
          <view class="info-item">
            <text class="info-label">åŸå§‹è¾“å…¥ï¼š</text>
            <text class="info-value code">{{analysis.originalCode}}</text>
          </view>
        </view>
      </view>

      <!-- æ€»ä½“æ€§èƒ½è¯„ä¼° -->
      <view class="result-section" wx:if="{{analysis.performanceAssessment}}">
        <view class="section-header">
          <text class="section-icon">ğŸ“Š</text>
          <text class="section-title">æ€§èƒ½è¯„ä¼°</text>
        </view>
        <view class="section-body">
          <view class="assessment-card assessment-{{analysis.performanceAssessment.level}}">
            <view class="assessment-metrics">
              <view class="metric">
                <text class="metric-label">æœ€ä½RWYCCï¼š</text>
                <text class="metric-value">{{analysis.performanceAssessment.minCode}}</text>
              </view>
              <view class="metric">
                <text class="metric-label">ä½ç½®ï¼š</text>
                <text class="metric-value">{{analysis.performanceAssessment.minSegment}}</text>
              </view>
            </view>
            <view class="assessment-recommendation">
              {{analysis.performanceAssessment.recommendation}}
            </view>
          </view>
        </view>
      </view>

      <!-- è·‘é“ä¸‰æ®µè¯¦ç»†çŠ¶å†µ -->
      <view class="result-section">
        <view class="section-header">
          <text class="section-icon">ğŸ“‹</text>
          <text class="section-title">è·‘é“ä¸‰æ®µçŠ¶å†µ</text>
        </view>
        <view class="section-body">
          <view wx:for="{{analysis.segments}}" wx:key="name" class="segment-card">
            <view class="segment-header">
              <text class="segment-name">{{item.name}}</text>
              <view class="segment-rwycc" style="background: {{item.rwycc.color}}">
                RWYCC: {{item.rwycc.name}}
              </view>
            </view>

            <view class="segment-details">
              <view class="detail-row">
                <text class="detail-label">åˆ¹è½¦æ•ˆåº”ï¼š</text>
                <text class="detail-value">{{item.rwycc.description}}</text>
              </view>
              <view class="detail-row">
                <text class="detail-label">æ±¡æŸ“è¦†ç›–ï¼š</text>
                <text class="detail-value">{{item.coverage.description}}</text>
              </view>
              <view class="detail-row">
                <text class="detail-label">æ±¡æŸ“æ·±åº¦ï¼š</text>
                <text class="detail-value">{{item.depth.description}}</text>
              </view>
              <view class="detail-row">
                <text class="detail-label">è¡¨é¢çŠ¶å†µï¼š</text>
                <text class="detail-value">{{item.surface.description}}</text>
              </view>
              <view class="performance-badge" style="background: {{item.performance.color}}">
                {{item.performance.description}}
              </view>
            </view>
          </view>
        </view>
      </view>

      <!-- è­¦å‘Šä¿¡æ¯ -->
      <view class="result-section" wx:if="{{analysis.warnings && analysis.warnings.length > 0}}">
        <view class="section-header">
          <text class="section-icon">âš ï¸</text>
          <text class="section-title">è­¦å‘Šæç¤º</text>
        </view>
        <view class="section-body">
          <view wx:for="{{analysis.warnings}}" wx:key="message"
                class="warning-item warning-{{item.type}}">
            <text class="warning-icon">
              <block wx:if="{{item.type === 'DANGER'}}">ğŸ”´</block>
              <block wx:elif="{{item.type === 'CRITICAL'}}">â›”</block>
              <block wx:elif="{{item.type === 'WARNING'}}">ğŸŸ¡</block>
              <block wx:else>â„¹ï¸</block>
            </text>
            <text class="warning-text">{{item.message}}</text>
          </view>
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="action-buttons">
        <button class="btn btn-new" bindtap="newDecode">æ–°å»ºè§£ç </button>
      </view>

    </scroll-view>

  </block>

</view>