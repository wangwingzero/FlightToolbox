<view class="container">
  <!-- 美化的页面标题 -->
  <view class="page-header">
    <view class="header-title">
      <text class="title-icon">❄️</text>
      <text class="title-text">SNOWTAM 雪情通告编码器</text>
    </view>
    <view class="header-subtitle">专业飞行员工具 - 分步引导式雪情通告生成</view>
  </view>

  <!-- GRF格式步骤指示器 -->
  <view class="step-section">
    <view class="section-title">📊 性能计算部分（必填）</view>
    <view class="step-indicator">
      <!-- 步骤1: 机场代码 -->
      <view class="step-item {{ currentStep >= 1 ? (currentStep === 1 ? 'active' : 'completed') : '' }} clickable" bind:tap="goToStep" data-step="1">
        <view class="step-number">A</view>
        <view class="step-label">机场</view>
      </view>
      <view class="step-line {{ currentStep > 1 ? 'completed' : '' }}"></view>
      
      <!-- 步骤2: 评估时间 -->
      <view class="step-item {{ currentStep >= 2 ? (currentStep === 2 ? 'active' : 'completed') : '' }} clickable" bind:tap="goToStep" data-step="2">
        <view class="step-number">B</view>
        <view class="step-label">时间</view>
      </view>
      <view class="step-line {{ currentStep > 2 ? 'completed' : '' }}"></view>
      
      <!-- 步骤3: 跑道代号 -->
      <view class="step-item {{ currentStep >= 3 ? (currentStep === 3 ? 'active' : 'completed') : '' }} clickable" bind:tap="goToStep" data-step="3">
        <view class="step-number">C</view>
        <view class="step-label">跑道</view>
      </view>
      <view class="step-line {{ currentStep > 3 ? 'completed' : '' }}"></view>
      
      <!-- 步骤4: 跑道状况代码 -->
      <view class="step-item {{ currentStep >= 4 ? (currentStep === 4 ? 'active' : 'completed') : '' }} clickable" bind:tap="goToStep" data-step="4">
        <view class="step-number">D</view>
        <view class="step-label">RWYCC</view>
      </view>
      <view class="step-line {{ currentStep > 4 ? 'completed' : '' }}"></view>
      
      <!-- 步骤5: 污染物覆盖百分比 -->
      <view class="step-item {{ currentStep >= 5 ? (currentStep === 5 ? 'active' : 'completed') : '' }} clickable" bind:tap="goToStep" data-step="5">
        <view class="step-number">E</view>
        <view class="step-label">覆盖率</view>
      </view>
    </view>

    <!-- 性能计算部分第二行 -->
    <view class="step-indicator">
      <!-- 步骤6: 松散污染物深度 -->
      <view class="step-item {{ currentStep >= 6 ? (currentStep === 6 ? 'active' : 'completed') : '' }} clickable" bind:tap="goToStep" data-step="6">
        <view class="step-number">F</view>
        <view class="step-label">深度</view>
      </view>
      <view class="step-line {{ currentStep > 6 ? 'completed' : '' }}"></view>
      
      <!-- 步骤7: 污染物状况说明 -->
      <view class="step-item {{ currentStep >= 7 ? (currentStep === 7 ? 'active' : 'completed') : '' }} clickable" bind:tap="goToStep" data-step="7">
        <view class="step-number">G</view>
        <view class="step-label">状况说明</view>
      </view>
      <view class="step-line {{ currentStep > 7 ? 'completed' : '' }}"></view>
      
      <!-- 步骤8: 跑道宽度 -->
      <view class="step-item {{ currentStep >= 8 ? (currentStep === 8 ? 'active' : 'completed') : '' }} clickable" bind:tap="goToStep" data-step="8">
        <view class="step-number">H</view>
        <view class="step-label">宽度</view>
      </view>
      <view class="step-line {{ currentStep > 8 ? 'completed' : '' }}"></view>
      
      <!-- 步骤9: 跑道长度变短 -->
      <view class="step-item {{ currentStep >= 9 ? (currentStep === 9 ? 'active' : 'completed') : '' }} clickable" bind:tap="goToStep" data-step="9">
        <view class="step-number">I</view>
        <view class="step-label">长度变短</view>
      </view>
    </view>
  </view>

  <!-- 情景意识部分 -->
  <view class="step-section">
    <view class="section-title">🔍 情景意识部分（选填）</view>
    <view class="step-indicator">
      <!-- 步骤10: 情景意识部分 -->
      <view class="step-item {{ currentStep >= 10 ? (currentStep === 10 ? 'active' : 'completed') : '' }} clickable" bind:tap="goToStep" data-step="10">
        <view class="step-number">J-T</view>
        <view class="step-label">情景意识</view>
      </view>
      <view class="step-line {{ currentStep > 10 ? 'completed' : '' }}"></view>
      
      <!-- 步骤11: 生成结果 -->
      <view class="step-item {{ currentStep >= 11 ? (currentStep === 11 ? 'active' : 'completed') : '' }} clickable" bind:tap="goToStep" data-step="11">
        <view class="step-number">✓</view>
        <view class="step-label">结果</view>
      </view>
    </view>
  </view>

  <!-- 美化的实时预览区域 -->
  <view class="preview-section">
    <view class="preview-header">
      <view class="preview-title">🚀 实时SNOWTAM代码预览</view>
    </view>
    <view class="preview-code-container">
      <!-- 性能计算部分预览 -->
      <view class="preview-section-title">📊 性能计算部分</view>
      <view class="preview-code-parts">
        <text class="code-part {{ currentInputPart === 'location' ? 'active' : (snowtam.locationIndicator ? 'completed' : 'pending') }}">A){{ snowtam.locationIndicator || '____' }}</text>
        <text class="code-part {{ currentInputPart === 'datetime' ? 'active' : (snowtam.dateTime ? 'completed' : 'pending') }}"> B){{ snowtam.dateTime || '________' }}</text>
        <text class="code-part {{ currentInputPart === 'runway' ? 'active' : (snowtam.runway ? 'completed' : 'pending') }}"> C){{ snowtam.runway || '__' }}</text>
        <text class="code-part {{ currentInputPart === 'rwycc' ? 'active' : (snowtam.runwayConditionCode[0] || snowtam.runwayConditionCode[1] || snowtam.runwayConditionCode[2] ? 'completed' : 'pending') }}"> D){{ snowtam.runwayConditionCode[0] || '_' }}/{{ snowtam.runwayConditionCode[1] || '_' }}/{{ snowtam.runwayConditionCode[2] || '_' }}</text>
        <text class="code-part {{ currentInputPart === 'coverage' ? 'active' : (snowtam.contaminationCoverage[0] || snowtam.contaminationCoverage[1] || snowtam.contaminationCoverage[2] ? 'completed' : 'pending') }}"> E){{ snowtam.contaminationCoverage[0] || '__' }}/{{ snowtam.contaminationCoverage[1] || '__' }}/{{ snowtam.contaminationCoverage[2] || '__' }}</text>
      </view>
      <view class="preview-code-parts">
        <text class="code-part {{ currentInputPart === 'depth' ? 'active' : (snowtam.looseContaminationDepth[0] || snowtam.looseContaminationDepth[1] || snowtam.looseContaminationDepth[2] ? 'completed' : 'pending') }}"> F){{ snowtam.looseContaminationDepth[0] || '__' }}/{{ snowtam.looseContaminationDepth[1] || '__' }}/{{ snowtam.looseContaminationDepth[2] || '__' }}</text>
        <text class="code-part {{ currentInputPart === 'description' ? 'active' : (snowtam.surfaceConditionDescription[0] || snowtam.surfaceConditionDescription[1] || snowtam.surfaceConditionDescription[2] ? 'completed' : 'pending') }}"> G){{ snowtam.surfaceConditionDescription[0] || '__' }}/{{ snowtam.surfaceConditionDescription[1] || '__' }}/{{ snowtam.surfaceConditionDescription[2] || '__' }}</text>
        <text class="code-part {{ currentInputPart === 'width' ? 'active' : (snowtam.runwayWidth ? 'completed' : 'pending') }}"> H){{ snowtam.runwayWidth || '__' }}</text>
        <text class="code-part {{ currentInputPart === 'reduction' ? 'active' : (snowtam.runwayLengthReduction ? 'completed' : 'pending') }}"> I){{ snowtam.runwayLengthReduction || '__' }}</text>
      </view>
      
      <!-- 情景意识部分预览 -->
      <view class="preview-section-title">🔍 情景意识部分（选填）</view>
      <view class="preview-code-parts situational-parts">
        <text class="code-part-small">J) K) L) M) N) O) P) R) S) T)</text>
      </view>
      <view class="current-input-hint">
        <text class="hint-icon">👆</text>
        <text class="hint-text" wx:if="{{ currentStep === 1 }}">输入机场ICAO代码</text>
        <text class="hint-text" wx:elif="{{ currentStep === 2 }}">输入评估日期时间（北京时间）</text>
        <text class="hint-text" wx:elif="{{ currentStep === 3 }}">选择跑道代号（较小编号）</text>
        <text class="hint-text" wx:elif="{{ currentStep === 4 }}">选择跑道状况代码(RWYCC 0-6)</text>
        <text class="hint-text" wx:elif="{{ currentStep === 5 }}">选择污染物覆盖百分比</text>
        <text class="hint-text" wx:elif="{{ currentStep === 6 }}">输入松散污染物深度</text>
        <text class="hint-text" wx:elif="{{ currentStep === 7 }}">选择污染物状况说明</text>
        <text class="hint-text" wx:elif="{{ currentStep === 8 }}">输入跑道宽度限制</text>
        <text class="hint-text" wx:elif="{{ currentStep === 9 }}">输入跑道长度变短</text>
        <text class="hint-text" wx:elif="{{ currentStep === 10 }}">填写情景意识信息</text>
        <text class="hint-text" wx:else>查看生成的SNOWTAM</text>
      </view>
    </view>
  </view>

  <!-- 步骤内容 -->
  <view class="step-content">
    <!-- 第一步：机场代码 -->
    <view class="step-card" wx:if="{{ currentStep === 1 }}">
      <view class="step-title">
        <text class="step-icon">🏢</text>
        <text>第一步：输入机场代码</text>
      </view>
      <view class="step-description">输入四位字母的ICAO机场代码</view>
      
      <!-- 机场代码输入区域 -->
      <view class="runway-input-section">
        <input
          class="runway-input"
          value="{{ snowtam.locationIndicator }}"
          placeholder="输入ICAO代码 (如: ZBAA, ZSSS, ZYHB)"
          bindinput="onLocationInput"
        />
      </view>

      <!-- 字母键盘区域 -->
      <view class="letter-keyboard">
        <view class="keyboard-row">
          <view class="key-button" wx:for="{{ letterKeyboard.slice(0, 7) }}" wx:key="index" bind:tap="inputLocationChar" data-value="{{ item }}">{{ item }}</view>
        </view>
        <view class="keyboard-row">
          <view class="key-button" wx:for="{{ letterKeyboard.slice(7, 14) }}" wx:key="index" bind:tap="inputLocationChar" data-value="{{ item }}">{{ item }}</view>
        </view>
        <view class="keyboard-row">
          <view class="key-button" wx:for="{{ letterKeyboard.slice(14, 21) }}" wx:key="index" bind:tap="inputLocationChar" data-value="{{ item }}">{{ item }}</view>
        </view>
        <view class="keyboard-row">
          <view class="key-button" wx:for="{{ letterKeyboard.slice(21, 26) }}" wx:key="index" bind:tap="inputLocationChar" data-value="{{ item }}">{{ item }}</view>
          <view class="key-button special" bind:tap="clearLocationInput">清除</view>
          <view class="key-button special" bind:tap="deleteLocationChar">删除</view>
        </view>
      </view>

      <!-- 显示已选择的机场 -->
      <view class="selected-display" wx:if="{{ snowtam.locationIndicator }}">
        <view class="selected-label">已输入：</view>
        <view class="selected-value">{{ snowtam.locationIndicator }}</view>
      </view>

      <!-- 常用机场快捷按钮 -->
      <view class="airport-shortcuts">
        <view class="shortcut-title">常用机场</view>
        <view class="shortcuts-grid">
          <view class="shortcut-button" bind:tap="setAirportCode" data-value="ZBAA">ZBAA 北京首都</view>
          <view class="shortcut-button" bind:tap="setAirportCode" data-value="ZSSS">ZSSS 上海浦东</view>
          <view class="shortcut-button" bind:tap="setAirportCode" data-value="ZGSZ">ZGSZ 深圳宝安</view>
          <view class="shortcut-button" bind:tap="setAirportCode" data-value="ZYHB">ZYHB 哈尔滨太平</view>
        </view>
      </view>
    </view>

    <!-- 第二步：日期时间 -->
    <view class="step-card" wx:if="{{ currentStep === 2 }}">
      <view class="step-title">
        <text class="step-icon">🕐</text>
        <text>第二步：输入观测日期时间</text>
      </view>
      <view class="step-description">格式：MMDDHHMM（月月日日小时小时分分）</view>
      
      <!-- 日期时间输入区域 -->
      <view class="runway-input-section">
        <input
          class="runway-input"
          value="{{ snowtam.dateTime }}"
          placeholder="输入日期时间 (如: 12081200)"
          bindinput="onDateTimeInput"
        />
      </view>

      <!-- 数字键盘区域 -->
      <view class="number-keyboard">
        <view class="keyboard-row">
          <view class="key-button" bind:tap="inputDateTimeNumber" data-value="0">0</view>
          <view class="key-button" bind:tap="inputDateTimeNumber" data-value="1">1</view>
          <view class="key-button" bind:tap="inputDateTimeNumber" data-value="2">2</view>
        </view>
        <view class="keyboard-row">
          <view class="key-button" bind:tap="inputDateTimeNumber" data-value="3">3</view>
          <view class="key-button" bind:tap="inputDateTimeNumber" data-value="4">4</view>
          <view class="key-button" bind:tap="inputDateTimeNumber" data-value="5">5</view>
        </view>
        <view class="keyboard-row">
          <view class="key-button" bind:tap="inputDateTimeNumber" data-value="6">6</view>
          <view class="key-button" bind:tap="inputDateTimeNumber" data-value="7">7</view>
          <view class="key-button" bind:tap="inputDateTimeNumber" data-value="8">8</view>
        </view>
        <view class="keyboard-row">
          <view class="key-button" bind:tap="inputDateTimeNumber" data-value="9">9</view>
          <view class="key-button special" bind:tap="clearDateTimeInput">清除</view>
          <view class="key-button special" bind:tap="deleteDateTimeChar">删除</view>
        </view>
      </view>

      <!-- 显示已输入的时间 -->
      <view class="selected-display" wx:if="{{ snowtam.dateTime }}">
        <view class="selected-label">已输入：</view>
        <view class="selected-value">{{ snowtam.dateTimeDisplay || snowtam.dateTime }}</view>
      </view>

      <!-- 常用时间快捷按钮 -->
      <view class="time-shortcuts">
        <view class="shortcut-title">⏰ 快捷时间</view>
        <view class="shortcuts-grid">
          <view class="shortcut-button" bind:tap="setCurrentTime">当前时间</view>
          <view class="shortcut-button" bind:tap="setTimeOption" data-value="next-hour">下一小时</view>
          <view class="shortcut-button" bind:tap="setTimeOption" data-value="6am-today">今日06:00</view>
          <view class="shortcut-button" bind:tap="setTimeOption" data-value="12pm-today">今日12:00</view>
        </view>
      </view>

      <!-- 时间输入提示 -->
      <view class="time-format-help">
        <view class="help-title">📝 格式说明</view>
        <view class="help-content">
          <view class="help-item">MM - 月份（01-12）</view>
          <view class="help-item">DD - 日期（01-31）</view>
          <view class="help-item">HH - 小时（00-23）</view>
          <view class="help-item">MM - 分钟（00-59）</view>
          <view class="help-example">示例：12081200 = 12月8日12:00</view>
        </view>
      </view>
    </view>

    <!-- 第三步：跑道选择 -->
    <view class="step-card" wx:if="{{ currentStep === 3 }}">
      <view class="step-title">
        <text class="step-icon">🛬</text>
        <text>第三步：选择跑道</text>
      </view>
      <view class="step-description">输入跑道编号或选择特殊选项</view>
      
      <!-- 跑道输入区域 -->
      <view class="runway-input-section">
        <input
          class="runway-input"
          value="{{ snowtam.runway }}"
          placeholder="输入跑道编号 (如: 27, 14L, 99)"
          bindinput="onRunwayInput"
        />
      </view>

      <!-- 数字键盘区域 -->
      <view class="number-keyboard">
        <view class="keyboard-row">
          <view class="key-button" bind:tap="inputRunwayNumber" data-value="0">0</view>
          <view class="key-button" bind:tap="inputRunwayNumber" data-value="1">1</view>
          <view class="key-button" bind:tap="inputRunwayNumber" data-value="2">2</view>
        </view>
        <view class="keyboard-row">
          <view class="key-button" bind:tap="inputRunwayNumber" data-value="3">3</view>
          <view class="key-button" bind:tap="inputRunwayNumber" data-value="4">4</view>
          <view class="key-button" bind:tap="inputRunwayNumber" data-value="5">5</view>
        </view>
        <view class="keyboard-row">
          <view class="key-button" bind:tap="inputRunwayNumber" data-value="6">6</view>
          <view class="key-button" bind:tap="inputRunwayNumber" data-value="7">7</view>
          <view class="key-button" bind:tap="inputRunwayNumber" data-value="8">8</view>
        </view>
        <view class="keyboard-row">
          <view class="key-button" bind:tap="inputRunwayNumber" data-value="9">9</view>
          <view class="key-button special" bind:tap="clearRunwayInput">清除</view>
          <view class="key-button special" bind:tap="deleteRunwayChar">删除</view>
        </view>
      </view>

      <!-- 特殊选项 -->
      <view class="special-options">
        <view class="option-row">
          <view class="option-button" bind:tap="selectRunwayOption" data-value="L">L (左)</view>
          <view class="option-button" bind:tap="selectRunwayOption" data-value="R">R (右)</view>
          <view class="option-button" bind:tap="selectRunwayOption" data-value="C">C (中)</view>
        </view>
        <view class="option-row">
          <view class="option-button wide" bind:tap="selectRunwayOption" data-value="99">99 (所有跑道)</view>
          <view class="option-button wide" bind:tap="selectRunwayOption" data-value="88">88 (重复报告)</view>
        </view>
      </view>

      <!-- 显示已选择的跑道 -->
      <view class="selected-display" wx:if="{{ snowtam.runway }}">
        <view class="selected-label">已选择：</view>
        <view class="selected-value">跑道 {{ snowtam.runway }}</view>
      </view>
    </view>

    <!-- 第四步：跑道状况代码(RWYCC) -->
    <view class="step-card" wx:if="{{ currentStep === 4 }}">
      <view class="step-title">
        <text class="step-icon">📊</text>
        <text>第四步：选择跑道状况代码(RWYCC)</text>
      </view>
      <view class="step-description">为跑道每三分之一段选择状况代码(0-6)</view>
      
      <!-- RWYCC代码说明 -->
      <view class="rwycc-help">
        <view class="help-title">跑道状况代码说明</view>
        <view class="rwycc-grid">
          <view class="rwycc-item">
            <view class="rwycc-code">6</view>
            <view class="rwycc-desc">干</view>
          </view>
          <view class="rwycc-item">
            <view class="rwycc-code">5</view>
            <view class="rwycc-desc">霜/湿/雪浆≤3mm</view>
          </view>
          <view class="rwycc-item">
            <view class="rwycc-code">4</view>
            <view class="rwycc-desc">压实雪(≤-15°C)</view>
          </view>
          <view class="rwycc-item">
            <view class="rwycc-code">3</view>
            <view class="rwycc-desc">湿滑/干雪>3mm</view>
          </view>
          <view class="rwycc-item">
            <view class="rwycc-code">2</view>
            <view class="rwycc-desc">积水>3mm/雪浆>3mm</view>
          </view>
          <view class="rwycc-item">
            <view class="rwycc-code">1</view>
            <view class="rwycc-desc">冰</view>
          </view>
          <view class="rwycc-item">
            <view class="rwycc-code">0</view>
            <view class="rwycc-desc">湿冰/压实雪上有水</view>
          </view>
        </view>
      </view>

      <!-- 分段选择器 -->
      <view class="segment-selector">
        <view class="segment-title">选择跑道段：</view>
        <view class="segment-buttons">
          <view class="segment-button {{ currentRWYCCSegment === 0 ? 'active' : '' }}" bind:tap="selectRWYCCSegment" data-segment="0">接地段(1/3)</view>
          <view class="segment-button {{ currentRWYCCSegment === 1 ? 'active' : '' }}" bind:tap="selectRWYCCSegment" data-segment="1">中间段(1/3)</view>
          <view class="segment-button {{ currentRWYCCSegment === 2 ? 'active' : '' }}" bind:tap="selectRWYCCSegment" data-segment="2">跑道末段(1/3)</view>
        </view>
      </view>

      <!-- RWYCC选择按钮 -->
      <view class="rwycc-selection">
        <view class="selection-title">为{{ ['接地段', '中间段', '跑道末段'][currentRWYCCSegment] }}选择状况代码：</view>
        <view class="rwycc-buttons">
          <view class="rwycc-button {{ snowtam.runwayConditionCode[currentRWYCCSegment] === '6' ? 'selected' : '' }}" bind:tap="selectRWYCC" data-code="6" data-segment="{{ currentRWYCCSegment }}">
            <view class="button-code">6</view>
            <view class="button-desc">干</view>
          </view>
          <view class="rwycc-button {{ snowtam.runwayConditionCode[currentRWYCCSegment] === '5' ? 'selected' : '' }}" bind:tap="selectRWYCC" data-code="5" data-segment="{{ currentRWYCCSegment }}">
            <view class="button-code">5</view>
            <view class="button-desc">霜/湿</view>
          </view>
          <view class="rwycc-button {{ snowtam.runwayConditionCode[currentRWYCCSegment] === '4' ? 'selected' : '' }}" bind:tap="selectRWYCC" data-code="4" data-segment="{{ currentRWYCCSegment }}">
            <view class="button-code">4</view>
            <view class="button-desc">压实雪</view>
          </view>
          <view class="rwycc-button {{ snowtam.runwayConditionCode[currentRWYCCSegment] === '3' ? 'selected' : '' }}" bind:tap="selectRWYCC" data-code="3" data-segment="{{ currentRWYCCSegment }}">
            <view class="button-code">3</view>
            <view class="button-desc">湿滑</view>
          </view>
          <view class="rwycc-button {{ snowtam.runwayConditionCode[currentRWYCCSegment] === '2' ? 'selected' : '' }}" bind:tap="selectRWYCC" data-code="2" data-segment="{{ currentRWYCCSegment }}">
            <view class="button-code">2</view>
            <view class="button-desc">积水/雪浆</view>
          </view>
          <view class="rwycc-button {{ snowtam.runwayConditionCode[currentRWYCCSegment] === '1' ? 'selected' : '' }}" bind:tap="selectRWYCC" data-code="1" data-segment="{{ currentRWYCCSegment }}">
            <view class="button-code">1</view>
            <view class="button-desc">冰</view>
          </view>
          <view class="rwycc-button {{ snowtam.runwayConditionCode[currentRWYCCSegment] === '0' ? 'selected' : '' }}" bind:tap="selectRWYCC" data-code="0" data-segment="{{ currentRWYCCSegment }}">
            <view class="button-code">0</view>
            <view class="button-desc">湿冰</view>
          </view>
        </view>
      </view>


      <!-- 快捷选择示例 -->
      <view class="quick-examples">
        <view class="example-title">常用组合：</view>
        <view class="example-buttons">
          <view class="example-button" bind:tap="setRWYCCExample" data-example="6,6,6">全段干燥 (6/6/6)</view>
          <view class="example-button" bind:tap="setRWYCCExample" data-example="5,5,5">全段湿润 (5/5/5)</view>
          <view class="example-button" bind:tap="setRWYCCExample" data-example="3,2,1">渐变恶化 (3/2/1)</view>
        </view>
      </view>

      <!-- 显示已选择的RWYCC -->
      <view class="selected-display" wx:if="{{ snowtam.runwayConditionCode[0] || snowtam.runwayConditionCode[1] || snowtam.runwayConditionCode[2] }}">
        <view class="selected-label">已选择RWYCC：</view>
        <view class="selected-value">{{ snowtam.runwayConditionCode[0] || '_' }}/{{ snowtam.runwayConditionCode[1] || '_' }}/{{ snowtam.runwayConditionCode[2] || '_' }}</view>
      </view>

      <!-- 显示已输入的清洁区域 -->
      <view class="selected-display" wx:if="{{ snowtam.clearedRunway }}">
        <view class="selected-label">已输入：</view>
        <view class="selected-value">{{ snowtam.clearedRunwayDisplay || snowtam.clearedRunway }}</view>
      </view>
    </view>

    <!-- 第五步：污染物覆盖百分比 -->
    <view class="step-card" wx:if="{{ currentStep === 5 }}">
      <view class="step-title">
        <text class="step-icon">📊</text>
        <text>第五步：选择污染物覆盖百分比</text>
      </view>
      <view class="step-description">按跑道头1/3、中间段1/3、跑道末段1/3分别选择覆盖百分比</view>
      
      <!-- 覆盖率说明 -->
      <view class="coverage-help">
        <view class="help-title">覆盖百分比说明</view>
        <view class="coverage-grid">
          <view class="coverage-item">
            <view class="coverage-code">无</view>
            <view class="coverage-desc">道面干燥或覆盖&lt;10%</view>
          </view>
          <view class="coverage-item">
            <view class="coverage-code">25</view>
            <view class="coverage-desc">覆盖10%-25%</view>
          </view>
          <view class="coverage-item">
            <view class="coverage-code">50</view>
            <view class="coverage-desc">覆盖26%-50%</view>
          </view>
          <view class="coverage-item">
            <view class="coverage-code">75</view>
            <view class="coverage-desc">覆盖51%-75%</view>
          </view>
          <view class="coverage-item">
            <view class="coverage-code">100</view>
            <view class="coverage-desc">覆盖76%-100%</view>
          </view>
        </view>
      </view>

      <!-- 跑道分段示意图 -->
      <view class="runway-segments">
        <view class="segment-item {{ snowtam.contaminationCoverage[0] ? 'selected' : '' }}">
          <view class="segment-label">接地段 1/3</view>
          <view class="segment-value">{{ snowtam.contaminationCoverage[0] || '未选择' }}</view>
        </view>
        <view class="segment-item {{ snowtam.contaminationCoverage[1] ? 'selected' : '' }}">
          <view class="segment-label">中间段 1/3</view>
          <view class="segment-value">{{ snowtam.contaminationCoverage[1] || '未选择' }}</view>
        </view>
        <view class="segment-item {{ snowtam.contaminationCoverage[2] ? 'selected' : '' }}">
          <view class="segment-label">跑道末段 1/3</view>
          <view class="segment-value">{{ snowtam.contaminationCoverage[2] || '未选择' }}</view>
        </view>
      </view>

      <!-- 分段选择器 -->
      <view class="segment-selector">
        <view class="segment-title">选择跑道段：</view>
        <view class="segment-buttons">
          <view class="segment-button {{ currentCoverageSegment === 0 ? 'active' : '' }}" bind:tap="selectCoverageSegment" data-segment="0">接地段(1/3)</view>
          <view class="segment-button {{ currentCoverageSegment === 1 ? 'active' : '' }}" bind:tap="selectCoverageSegment" data-segment="1">中间段(1/3)</view>
          <view class="segment-button {{ currentCoverageSegment === 2 ? 'active' : '' }}" bind:tap="selectCoverageSegment" data-segment="2">跑道末段(1/3)</view>
        </view>
      </view>

      <!-- 覆盖率选择按钮 -->
      <view class="coverage-selection">
        <view class="selection-title">为{{ ['接地段', '中间段', '跑道末段'][currentCoverageSegment] }}选择覆盖百分比：</view>
        <view class="coverage-buttons">
          <view class="coverage-button {{ snowtam.contaminationCoverage[currentCoverageSegment] === '无' ? 'selected' : '' }}" bind:tap="selectCoverage" data-coverage="无" data-segment="{{ currentCoverageSegment }}">
            <view class="button-code">无</view>
            <view class="button-desc">干燥/&lt;10%</view>
          </view>
          <view class="coverage-button {{ snowtam.contaminationCoverage[currentCoverageSegment] === '25' ? 'selected' : '' }}" bind:tap="selectCoverage" data-coverage="25" data-segment="{{ currentCoverageSegment }}">
            <view class="button-code">25</view>
            <view class="button-desc">10%-25%</view>
          </view>
          <view class="coverage-button {{ snowtam.contaminationCoverage[currentCoverageSegment] === '50' ? 'selected' : '' }}" bind:tap="selectCoverage" data-coverage="50" data-segment="{{ currentCoverageSegment }}">
            <view class="button-code">50</view>
            <view class="button-desc">26%-50%</view>
          </view>
          <view class="coverage-button {{ snowtam.contaminationCoverage[currentCoverageSegment] === '75' ? 'selected' : '' }}" bind:tap="selectCoverage" data-coverage="75" data-segment="{{ currentCoverageSegment }}">
            <view class="button-code">75</view>
            <view class="button-desc">51%-75%</view>
          </view>
          <view class="coverage-button {{ snowtam.contaminationCoverage[currentCoverageSegment] === '100' ? 'selected' : '' }}" bind:tap="selectCoverage" data-coverage="100" data-segment="{{ currentCoverageSegment }}">
            <view class="button-code">100</view>
            <view class="button-desc">76%-100%</view>
          </view>
        </view>
      </view>

      <!-- 快捷选择示例 -->
      <view class="quick-examples">
        <view class="example-title">常用组合：</view>
        <view class="example-buttons">
          <view class="example-button" bind:tap="setCoverageExample" data-example="100,100,100">全段覆盖 (100/100/100)</view>
          <view class="example-button" bind:tap="setCoverageExample" data-example="无,无,无">全段干燥 (无/无/无)</view>
          <view class="example-button" bind:tap="setCoverageExample" data-example="75,50,25">渐变减少 (75/50/25)</view>
        </view>
      </view>

      <!-- 显示已选择的覆盖率 -->
      <view class="selected-display" wx:if="{{ snowtam.contaminationCoverage[0] || snowtam.contaminationCoverage[1] || snowtam.contaminationCoverage[2] }}">
        <view class="selected-label">已选择覆盖率：</view>
        <view class="selected-value">{{ snowtam.contaminationCoverage[0] || '_' }}/{{ snowtam.contaminationCoverage[1] || '_' }}/{{ snowtam.contaminationCoverage[2] || '_' }}</view>
      </view>
    </view>

    <!-- 第六步：松散污染物深度 -->
    <view class="step-card" wx:if="{{ currentStep === 6 }}">
      <view class="step-title">
        <text class="step-icon">📐</text>
        <text>第六步：输入松散污染物深度</text>
      </view>
      <view class="step-description">只在污染物类型为干雪、湿雪、雪浆和积水时提供深度信息（毫米）</view>
      
      <!-- 深度说明 -->
      <view class="depth-help">
        <view class="help-title">深度标准说明</view>
        <view class="depth-note">
          • 积水：≥4毫米才报告（3毫米及以下视为'湿'）<br/>
          • 雪浆/湿雪/干雪：≥3毫米才报告<br/>
          • 如深度小于通报最低值，填入'无'
        </view>
      </view>

      <!-- 跑道分段示意图 -->
      <view class="runway-segments">
        <view class="segment-item {{ snowtam.looseContaminationDepth[0] ? 'selected' : '' }}">
          <view class="segment-label">接地段深度</view>
          <view class="segment-value">{{ snowtam.looseContaminationDepth[0] || '未设置' }}</view>
        </view>
        <view class="segment-item {{ snowtam.looseContaminationDepth[1] ? 'selected' : '' }}">
          <view class="segment-label">中间段深度</view>
          <view class="segment-value">{{ snowtam.looseContaminationDepth[1] || '未设置' }}</view>
        </view>
        <view class="segment-item {{ snowtam.looseContaminationDepth[2] ? 'selected' : '' }}">
          <view class="segment-label">跑道末段深度</view>
          <view class="segment-value">{{ snowtam.looseContaminationDepth[2] || '未设置' }}</view>
        </view>
      </view>

      <!-- 分段选择器 -->
      <view class="segment-selector">
        <view class="segment-title">选择跑道段：</view>
        <view class="segment-buttons">
          <view class="segment-button {{ currentDepthSegment === 0 ? 'active' : '' }}" bind:tap="selectDepthSegment" data-segment="0">接地段(1/3)</view>
          <view class="segment-button {{ currentDepthSegment === 1 ? 'active' : '' }}" bind:tap="selectDepthSegment" data-segment="1">中间段(1/3)</view>
          <view class="segment-button {{ currentDepthSegment === 2 ? 'active' : '' }}" bind:tap="selectDepthSegment" data-segment="2">跑道末段(1/3)</view>
        </view>
      </view>

      <!-- 深度输入区域 -->
      <view class="depth-input">
        <view class="input-title">为{{ ['接地段', '中间段', '跑道末段'][currentDepthSegment] }}输入深度：</view>
        <view class="current-input">
          <text>当前输入：{{ snowtam.looseContaminationDepth[currentDepthSegment] || '无' }} mm</text>
        </view>
      </view>

      <!-- 数字键盘区域 -->
      <view class="number-keyboard">
        <view class="keyboard-row">
          <view class="key-button" bind:tap="inputDepthNumber" data-value="0" data-segment="{{ currentDepthSegment || 0 }}">0</view>
          <view class="key-button" bind:tap="inputDepthNumber" data-value="1" data-segment="{{ currentDepthSegment || 0 }}">1</view>
          <view class="key-button" bind:tap="inputDepthNumber" data-value="2" data-segment="{{ currentDepthSegment || 0 }}">2</view>
        </view>
        <view class="keyboard-row">
          <view class="key-button" bind:tap="inputDepthNumber" data-value="3" data-segment="{{ currentDepthSegment || 0 }}">3</view>
          <view class="key-button" bind:tap="inputDepthNumber" data-value="4" data-segment="{{ currentDepthSegment || 0 }}">4</view>
          <view class="key-button" bind:tap="inputDepthNumber" data-value="5" data-segment="{{ currentDepthSegment || 0 }}">5</view>
        </view>
        <view class="keyboard-row">
          <view class="key-button" bind:tap="inputDepthNumber" data-value="6" data-segment="{{ currentDepthSegment || 0 }}">6</view>
          <view class="key-button" bind:tap="inputDepthNumber" data-value="7" data-segment="{{ currentDepthSegment || 0 }}">7</view>
          <view class="key-button" bind:tap="inputDepthNumber" data-value="8" data-segment="{{ currentDepthSegment || 0 }}">8</view>
        </view>
        <view class="keyboard-row">
          <view class="key-button" bind:tap="inputDepthNumber" data-value="9" data-segment="{{ currentDepthSegment || 0 }}">9</view>
          <view class="key-button special" bind:tap="clearDepthInput" data-segment="{{ currentDepthSegment || 0 }}">清除</view>
          <view class="key-button special" bind:tap="deleteDepthChar" data-segment="{{ currentDepthSegment || 0 }}">删除</view>
        </view>
      </view>

      <!-- 快捷选择选项 -->
      <view class="quick-depth-options">
        <view class="option-row">
          <view class="option-button" bind:tap="selectDepthOption" data-value="无" data-segment="{{ currentDepthSegment || 0 }}">无 - 不适用或&lt;最低值</view>
          <view class="option-button" bind:tap="selectDepthOption" data-value="03" data-segment="{{ currentDepthSegment || 0 }}">03 - 3毫米</view>
        </view>
        <view class="option-row">
          <view class="option-button" bind:tap="selectDepthOption" data-value="04" data-segment="{{ currentDepthSegment || 0 }}">04 - 4毫米</view>
          <view class="option-button" bind:tap="selectDepthOption" data-value="05" data-segment="{{ currentDepthSegment || 0 }}">05 - 5毫米</view>
        </view>
      </view>

      <!-- 快捷示例 -->
      <view class="quick-examples">
        <view class="example-title">常用组合：</view>
        <view class="example-buttons">
          <view class="example-button" bind:tap="setDepthExample" data-example="04,06,09">轻微积累 (04/06/09)</view>
          <view class="example-button" bind:tap="setDepthExample" data-example="无,无,无">不适用 (无/无/无)</view>
          <view class="example-button" bind:tap="setDepthExample" data-example="15,20,25">中等积累 (15/20/25)</view>
        </view>
      </view>

      <!-- 显示已选择的深度 -->
      <view class="selected-display" wx:if="{{ snowtam.looseContaminationDepth[0] || snowtam.looseContaminationDepth[1] || snowtam.looseContaminationDepth[2] }}">
        <view class="selected-label">已设置深度：</view>
        <view class="selected-value">{{ snowtam.looseContaminationDepth[0] || '_' }}/{{ snowtam.looseContaminationDepth[1] || '_' }}/{{ snowtam.looseContaminationDepth[2] || '_' }} mm</view>
      </view>
    </view>

    <!-- 第七步：污染物状况说明 -->
    <view class="step-card" wx:if="{{ currentStep === 7 }}">
      <view class="step-title">
        <text class="step-icon">🌨️</text>
        <text>第七步：选择污染物状况说明</text>
      </view>
      <view class="step-description">按跑道头1/3、中间段1/3、跑道末段1/3分别选择污染物类型</view>
      
      <!-- 跑道分段示意图 -->
      <view class="runway-segments">
        <view class="segment-item {{ snowtam.surfaceConditionDescription[0] ? 'selected' : '' }}">
          <view class="segment-label">接地段状况</view>
          <view class="segment-value">{{ snowtam.surfaceConditionDescription[0] || '未设置' }}</view>
        </view>
        <view class="segment-item {{ snowtam.surfaceConditionDescription[1] ? 'selected' : '' }}">
          <view class="segment-label">中间段状况</view>
          <view class="segment-value">{{ snowtam.surfaceConditionDescription[1] || '未设置' }}</view>
        </view>
        <view class="segment-item {{ snowtam.surfaceConditionDescription[2] ? 'selected' : '' }}">
          <view class="segment-label">跑道末段状况</view>
          <view class="segment-value">{{ snowtam.surfaceConditionDescription[2] || '未设置' }}</view>
        </view>
      </view>

      <!-- 分段选择器 -->
      <view class="segment-selector">
        <view class="segment-title">选择跑道段：</view>
        <view class="segment-buttons">
          <view class="segment-button {{ currentDescriptionSegment === 0 ? 'active' : '' }}" bind:tap="selectDescriptionSegment" data-segment="0">接地段(1/3)</view>
          <view class="segment-button {{ currentDescriptionSegment === 1 ? 'active' : '' }}" bind:tap="selectDescriptionSegment" data-segment="1">中间段(1/3)</view>
          <view class="segment-button {{ currentDescriptionSegment === 2 ? 'active' : '' }}" bind:tap="selectDescriptionSegment" data-segment="2">跑道末段(1/3)</view>
        </view>
      </view>

      <!-- 污染物类型选择网格 -->
      <view class="contamination-selection">
        <view class="selection-title">为{{ ['接地段', '中间段', '跑道末段'][currentDescriptionSegment] }}选择污染物类型：</view>
        
        <!-- 基本状态 -->
        <view class="contamination-category">
          <view class="category-title">基本状态</view>
          <view class="contamination-buttons">
            <view class="contamination-button {{ snowtam.surfaceConditionDescription[currentDescriptionSegment] === '干' ? 'selected' : '' }}" bind:tap="selectSurfaceCondition" data-condition="干" data-segment="{{ currentDescriptionSegment }}">干</view>
            <view class="contamination-button {{ snowtam.surfaceConditionDescription[currentDescriptionSegment] === '霜' ? 'selected' : '' }}" bind:tap="selectSurfaceCondition" data-condition="霜" data-segment="{{ currentDescriptionSegment }}">霜</view>
            <view class="contamination-button {{ snowtam.surfaceConditionDescription[currentDescriptionSegment] === '湿' ? 'selected' : '' }}" bind:tap="selectSurfaceCondition" data-condition="湿" data-segment="{{ currentDescriptionSegment }}">湿</view>
            <view class="contamination-button {{ snowtam.surfaceConditionDescription[currentDescriptionSegment] === '湿滑' ? 'selected' : '' }}" bind:tap="selectSurfaceCondition" data-condition="湿滑" data-segment="{{ currentDescriptionSegment }}">湿滑</view>
          </view>
        </view>

        <!-- 雪类型 -->
        <view class="contamination-category">
          <view class="category-title">雪类型</view>
          <view class="contamination-buttons">
            <view class="contamination-button {{ snowtam.surfaceConditionDescription[currentDescriptionSegment] === '干雪' ? 'selected' : '' }}" bind:tap="selectSurfaceCondition" data-condition="干雪" data-segment="{{ currentDescriptionSegment }}">干雪</view>
            <view class="contamination-button {{ snowtam.surfaceConditionDescription[currentDescriptionSegment] === '湿雪' ? 'selected' : '' }}" bind:tap="selectSurfaceCondition" data-condition="湿雪" data-segment="{{ currentDescriptionSegment }}">湿雪</view>
            <view class="contamination-button {{ snowtam.surfaceConditionDescription[currentDescriptionSegment] === '雪浆' ? 'selected' : '' }}" bind:tap="selectSurfaceCondition" data-condition="雪浆" data-segment="{{ currentDescriptionSegment }}">雪浆</view>
            <view class="contamination-button {{ snowtam.surfaceConditionDescription[currentDescriptionSegment] === '压实的雪' ? 'selected' : '' }}" bind:tap="selectSurfaceCondition" data-condition="压实的雪" data-segment="{{ currentDescriptionSegment }}">压实的雪</view>
          </view>
        </view>

        <!-- 复合状态 -->
        <view class="contamination-category">
          <view class="category-title">复合状态</view>
          <view class="contamination-buttons">
            <view class="contamination-button {{ snowtam.surfaceConditionDescription[currentDescriptionSegment] === '压实的雪面上有干雪' ? 'selected' : '' }}" bind:tap="selectSurfaceCondition" data-condition="压实的雪面上有干雪" data-segment="{{ currentDescriptionSegment }}">压实雪上干雪</view>
            <view class="contamination-button {{ snowtam.surfaceConditionDescription[currentDescriptionSegment] === '压实的雪面上有湿雪' ? 'selected' : '' }}" bind:tap="selectSurfaceCondition" data-condition="压实的雪面上有湿雪" data-segment="{{ currentDescriptionSegment }}">压实雪上湿雪</view>
            <view class="contamination-button {{ snowtam.surfaceConditionDescription[currentDescriptionSegment] === '压实的雪面上有水' ? 'selected' : '' }}" bind:tap="selectSurfaceCondition" data-condition="压实的雪面上有水" data-segment="{{ currentDescriptionSegment }}">压实雪上有水</view>
          </view>
        </view>

        <!-- 冰类型 -->
        <view class="contamination-category">
          <view class="category-title">冰类型</view>
          <view class="contamination-buttons">
            <view class="contamination-button {{ snowtam.surfaceConditionDescription[currentDescriptionSegment] === '冰' ? 'selected' : '' }}" bind:tap="selectSurfaceCondition" data-condition="冰" data-segment="{{ currentDescriptionSegment }}">冰</view>
            <view class="contamination-button {{ snowtam.surfaceConditionDescription[currentDescriptionSegment] === '湿冰' ? 'selected' : '' }}" bind:tap="selectSurfaceCondition" data-condition="湿冰" data-segment="{{ currentDescriptionSegment }}">湿冰</view>
            <view class="contamination-button {{ snowtam.surfaceConditionDescription[currentDescriptionSegment] === '冰面上有干雪' ? 'selected' : '' }}" bind:tap="selectSurfaceCondition" data-condition="冰面上有干雪" data-segment="{{ currentDescriptionSegment }}">冰上干雪</view>
            <view class="contamination-button {{ snowtam.surfaceConditionDescription[currentDescriptionSegment] === '冰面上有湿雪' ? 'selected' : '' }}" bind:tap="selectSurfaceCondition" data-condition="冰面上有湿雪" data-segment="{{ currentDescriptionSegment }}">冰上湿雪</view>
          </view>
        </view>

        <!-- 水和其他 -->
        <view class="contamination-category">
          <view class="category-title">其他状态</view>
          <view class="contamination-buttons">
            <view class="contamination-button {{ snowtam.surfaceConditionDescription[currentDescriptionSegment] === '积水' ? 'selected' : '' }}" bind:tap="selectSurfaceCondition" data-condition="积水" data-segment="{{ currentDescriptionSegment }}">积水</view>
            <view class="contamination-button {{ snowtam.surfaceConditionDescription[currentDescriptionSegment] === '无' ? 'selected' : '' }}" bind:tap="selectSurfaceCondition" data-condition="无" data-segment="{{ currentDescriptionSegment }}">无(覆盖&lt;10%)</view>
          </view>
        </view>
      </view>

      <!-- 快捷选择示例 -->
      <view class="quick-examples">
        <view class="example-title">常用组合：</view>
        <view class="example-buttons">
          <view class="example-button" bind:tap="setSurfaceConditionExample" data-example="湿雪,雪浆,积水">恶化组合</view>
          <view class="example-button" bind:tap="setSurfaceConditionExample" data-example="干,干,干">全段干燥</view>
          <view class="example-button" bind:tap="setSurfaceConditionExample" data-example="压实的雪,压实的雪面上有干雪,冰">典型冬季</view>
        </view>
      </view>

      <!-- 显示已选择的状况说明 -->
      <view class="selected-display" wx:if="{{ snowtam.surfaceConditionDescription[0] || snowtam.surfaceConditionDescription[1] || snowtam.surfaceConditionDescription[2] }}">
        <view class="selected-label">已选择状况：</view>
        <view class="selected-value">{{ snowtam.surfaceConditionDescription[0] || '_' }}/{{ snowtam.surfaceConditionDescription[1] || '_' }}/{{ snowtam.surfaceConditionDescription[2] || '_' }}</view>
      </view>
    </view>

    <!-- 第八步：跑道宽度 -->
    <view class="step-card" wx:if="{{ currentStep === 8 }}">
      <view class="step-title">
        <text class="step-icon">📐</text>
        <text>第八步：跑道宽度(H)</text>
      </view>
      <view class="step-description">如果跑道状况代码适用宽度小于公布的跑道宽度时填写（选填）</view>
      
      <!-- 说明文字 -->
      <view class="width-note">
        <text class="note-icon">💡</text>
        <text>注意：只有当跑道状况代码适用宽度小于公布跑道宽度时才需要填写此项。</text>
      </view>

      <!-- 快捷示例 -->
      <view class="quick-examples">
        <view class="example-title">常用宽度：</view>
        <view class="example-buttons">
          <view class="example-button" bind:tap="setRunwayWidth" data-width="">不填写（全宽度适用）</view>
          <view class="example-button" bind:tap="setRunwayWidth" data-width="40">40米宽度</view>
          <view class="example-button" bind:tap="setRunwayWidth" data-width="45">45米宽度</view>
          <view class="example-button" bind:tap="setRunwayWidth" data-width="60">60米宽度</view>
        </view>
      </view>
      
      <!-- 数字键盘区域 -->
      <view class="number-keyboard">
        <view class="keyboard-row">
          <view class="key-button" bind:tap="inputWidthNumber" data-value="0">0</view>
          <view class="key-button" bind:tap="inputWidthNumber" data-value="1">1</view>
          <view class="key-button" bind:tap="inputWidthNumber" data-value="2">2</view>
        </view>
        <view class="keyboard-row">
          <view class="key-button" bind:tap="inputWidthNumber" data-value="3">3</view>
          <view class="key-button" bind:tap="inputWidthNumber" data-value="4">4</view>
          <view class="key-button" bind:tap="inputWidthNumber" data-value="5">5</view>
        </view>
        <view class="keyboard-row">
          <view class="key-button" bind:tap="inputWidthNumber" data-value="6">6</view>
          <view class="key-button" bind:tap="inputWidthNumber" data-value="7">7</view>
          <view class="key-button" bind:tap="inputWidthNumber" data-value="8">8</view>
        </view>
        <view class="keyboard-row">
          <view class="key-button" bind:tap="inputWidthNumber" data-value="9">9</view>
          <view class="key-button special" bind:tap="clearWidthInput">清除</view>
          <view class="key-button special" bind:tap="deleteWidthChar">删除</view>
        </view>
      </view>

      <!-- 显示已输入的跑道宽度 -->
      <view class="selected-display" wx:if="{{ snowtam.runwayWidth }}">
        <view class="selected-label">已设置宽度：</view>
        <view class="selected-value">{{ snowtam.runwayWidth }}米</view>
      </view>
      <view class="selected-display" wx:else>
        <view class="selected-label">当前状态：</view>
        <view class="selected-value">未填写（全宽度适用）</view>
      </view>
    </view>

    <!-- 第九步：跑道长度变短 -->
    <view class="step-card" wx:if="{{ currentStep === 9 }}">
      <view class="step-title">
        <text class="step-icon">📏</text>
        <text>第九步：跑道长度变短(I)</text>
      </view>
      <view class="step-description">当跑道可用长度因雪情减少时填写（选填）</view>
      
      <!-- 说明文字 -->
      <view class="length-note">
        <text class="note-icon">💡</text>
        <text>注意：只有当跑道可用长度因雪情减少时才需要填写此项。格式：跑道号 变短至长度</text>
      </view>

      <!-- 快捷示例 -->
      <view class="quick-examples">
        <view class="example-title">常用格式：</view>
        <view class="example-buttons">
          <view class="example-button" bind:tap="setRunwayLengthReduction" data-reduction="">不填写（长度无变化）</view>
          <view class="example-button" bind:tap="setRunwayLengthReduction" data-reduction="01L 变短至3600">01L 变短至3600米</view>
          <view class="example-button" bind:tap="setRunwayLengthReduction" data-reduction="16R 变短至2800">16R 变短至2800米</view>
        </view>
      </view>

      <!-- 手动输入区域 -->
      <view class="manual-input">
        <view class="input-title">或手动输入：</view>
        <view class="input-row">
          <view class="input-label">跑道号：</view>
          <view class="runway-input">
            <input class="runway-input-field" placeholder="如01L" bindinput="onRunwayNumberInput" value="{{ tempRunwayNumber }}" />
          </view>
        </view>
        <view class="input-row">
          <view class="input-label">变短至（米）：</view>
          <view class="length-input">
            <input class="length-input-field" type="number" placeholder="如3600" bindinput="onRunwayLengthInput" value="{{ tempRunwayLength }}" />
          </view>
        </view>
        <view class="input-buttons">
          <view class="confirm-button" bind:tap="confirmRunwayLengthReduction">确认设置</view>
          <view class="clear-button" bind:tap="clearRunwayLengthReduction">清除</view>
        </view>
      </view>

      <!-- 显示已设置的跑道长度变短 -->
      <view class="selected-display" wx:if="{{ snowtam.runwayLengthReduction }}">
        <view class="selected-label">已设置：</view>
        <view class="selected-value">{{ snowtam.runwayLengthReduction }}</view>
      </view>
      <view class="selected-display" wx:else>
        <view class="selected-label">当前状态：</view>
        <view class="selected-value">未填写（长度无变化）</view>
      </view>
    </view>

    <!-- 第十步：情景意识部分学习指南 -->
    <view class="step-card" wx:if="{{ currentStep === 10 }}">
      <view class="step-title">
        <text class="step-icon">📚</text>
        <text>第十步：情景意识部分(J-T)学习指南</text>
      </view>
      <view class="step-description">了解SNOWTAM情景意识部分的英文表达和中文含义</view>
      
      <!-- 总体说明 -->
      <view class="guide-intro">
        <view class="intro-header">
          <text class="intro-icon">💡</text>
          <text class="intro-title">什么是情景意识部分？</text>
        </view>
        <view class="intro-content">
          <text>情景意识部分(J-T项)为可选填项，用于提供额外的机场雪情信息，帮助飞行员全面了解机场状况。这部分使用英文简写代码，需要飞行员熟练掌握。</text>
        </view>
      </view>

      <!-- 各项详细说明 -->
      <view class="guide-sections">
        
        <!-- J项：吹积雪堆 -->
        <view class="guide-item">
          <view class="guide-header">
            <text class="guide-code">J)</text>
            <text class="guide-title">Drifting Snow Banks (吹积雪堆)</text>
          </view>
          <view class="guide-content">
            <view class="guide-description">
              <text class="desc-text">指跑道上由风吹形成的雪堆，可能影响飞机滑跑</text>
            </view>
            <view class="guide-examples">
              <view class="example-title">常用表达：</view>
              <view class="example-item">
                <text class="example-en">RWY 01L DRIFTING SNOW BANKS</text>
                <text class="example-cn">跑道01L有吹积雪堆</text>
              </view>
              <view class="example-item">
                <text class="example-en">ALL RWYS DRIFTING SNOW BANKS</text>
                <text class="example-cn">所有跑道都有吹积雪堆</text>
              </view>
            </view>
          </view>
        </view>

        <!-- K项：散沙 -->
        <view class="guide-item">
          <view class="guide-header">
            <text class="guide-code">K)</text>
            <text class="guide-title">Loose Sand (散沙)</text>
          </view>
          <view class="guide-content">
            <view class="guide-description">
              <text class="desc-text">用于沙漠地区机场，指跑道上的散沙覆盖</text>
            </view>
            <view class="guide-examples">
              <view class="example-title">常用表达：</view>
              <view class="example-item">
                <text class="example-en">RWY 09 LOOSE SAND</text>
                <text class="example-cn">跑道09有散沙</text>
              </view>
              <view class="example-item">
                <text class="example-en">NIL</text>
                <text class="example-cn">无散沙</text>
              </view>
            </view>
          </view>
        </view>

        <!-- L项：化学处理 -->
        <view class="guide-item">
          <view class="guide-header">
            <text class="guide-code">L)</text>
            <text class="guide-title">Chemical Treatment (化学处理)</text>
          </view>
          <view class="guide-content">
            <view class="guide-description">
              <text class="desc-text">指跑道进行的除冰剂或防冰剂处理</text>
            </view>
            <view class="guide-examples">
              <view class="example-title">常用表达：</view>
              <view class="example-item">
                <text class="example-en">RWY 01L TREATED</text>
                <text class="example-cn">跑道01L已处理</text>
              </view>
              <view class="example-item">
                <text class="example-en">ALL RWYS TREATED WITH DE-ICING FLUID</text>
                <text class="example-cn">所有跑道都用除冰液处理</text>
              </view>
              <view class="example-item">
                <text class="example-en">RWY 16R SAND APPLIED</text>
                <text class="example-cn">跑道16R已撒砂</text>
              </view>
            </view>
          </view>
        </view>

        <!-- M项：跑道雪堤 -->
        <view class="guide-item">
          <view class="guide-header">
            <text class="guide-code">M)</text>
            <text class="guide-title">Runway Snow Banks (跑道雪堤)</text>
          </view>
          <view class="guide-content">
            <view class="guide-description">
              <text class="desc-text">指跑道边缘堆积的雪堤，可能影响飞机偏出跑道时的安全</text>
            </view>
            <view class="guide-examples">
              <view class="example-title">常用表达：</view>
              <view class="example-item">
                <text class="example-en">RWY 01L LFT 30M</text>
                <text class="example-cn">跑道01L左侧30米处有雪堤</text>
              </view>
              <view class="example-item">
                <text class="example-en">RWY 16R BOTH 25M</text>
                <text class="example-cn">跑道16R两侧25米处有雪堤</text>
              </view>
              <view class="example-item">
                <text class="example-en">RWY 09 RGT 40M</text>
                <text class="example-cn">跑道09右侧40米处有雪堤</text>
              </view>
            </view>
            <view class="guide-note">
              <text class="note-icon">📝</text>
              <text class="note-text">LFT=左侧, RGT=右侧, BOTH=两侧, 数字表示距跑道中线距离(米)</text>
            </view>
          </view>
        </view>

        <!-- N项：滑行道雪堤 -->
        <view class="guide-item">
          <view class="guide-header">
            <text class="guide-code">N)</text>
            <text class="guide-title">Taxiway Snow Banks (滑行道雪堤)</text>
          </view>
          <view class="guide-content">
            <view class="guide-description">
              <text class="desc-text">指滑行道上的雪堤情况</text>
            </view>
            <view class="guide-examples">
              <view class="example-title">常用表达：</view>
              <view class="example-item">
                <text class="example-en">TWY A SNOW BANKS</text>
                <text class="example-cn">滑行道A有雪堤</text>
              </view>
              <view class="example-item">
                <text class="example-en">ALL TWYS SNOW BANKS</text>
                <text class="example-cn">所有滑行道都有雪堤</text>
              </view>
            </view>
          </view>
        </view>

        <!-- O项：跑道附近雪堤 -->
        <view class="guide-item">
          <view class="guide-header">
            <text class="guide-code">O)</text>
            <text class="guide-title">Adjacent Snow Banks (跑道附近雪堤)</text>
          </view>
          <view class="guide-content">
            <view class="guide-description">
              <text class="desc-text">指跑道附近区域的雪堤，可能影响航空器机动</text>
            </view>
            <view class="guide-examples">
              <view class="example-title">常用表达：</view>
              <view class="example-item">
                <text class="example-en">RWY 01L ADJ SNOW BANKS</text>
                <text class="example-cn">跑道01L附近有雪堤</text>
              </view>
              <view class="example-item">
                <text class="example-en">ALL RWYS ADJ SNOW BANKS</text>
                <text class="example-cn">所有跑道附近都有雪堤</text>
              </view>
            </view>
            <view class="guide-note">
              <text class="note-icon">📝</text>
              <text class="note-text">ADJ = Adjacent (附近的)</text>
            </view>
          </view>
        </view>

        <!-- P项：滑行道状况 -->
        <view class="guide-item">
          <view class="guide-header">
            <text class="guide-code">P)</text>
            <text class="guide-title">Taxiway Conditions (滑行道状况)</text>
          </view>
          <view class="guide-content">
            <view class="guide-description">
              <text class="desc-text">报告滑行道的不良状况</text>
            </view>
            <view class="guide-examples">
              <view class="example-title">常用表达：</view>
              <view class="example-item">
                <text class="example-en">TWY A POOR</text>
                <text class="example-cn">滑行道A状况差</text>
              </view>
              <view class="example-item">
                <text class="example-en">ALL TWYS POOR</text>
                <text class="example-cn">所有滑行道状况差</text>
              </view>
              <view class="example-item">
                <text class="example-en">TWY B C POOR</text>
                <text class="example-cn">滑行道B、C状况差</text>
              </view>
            </view>
            <view class="guide-note">
              <text class="note-icon">📝</text>
              <text class="note-text">POOR = 状况差，只在状况差时才报告</text>
            </view>
          </view>
        </view>

        <!-- R项：机坪状况 -->
        <view class="guide-item">
          <view class="guide-header">
            <text class="guide-code">R)</text>
            <text class="guide-title">Apron Conditions (机坪状况)</text>
          </view>
          <view class="guide-content">
            <view class="guide-description">
              <text class="desc-text">报告机坪(停机坪)的不良状况</text>
            </view>
            <view class="guide-examples">
              <view class="example-title">常用表达：</view>
              <view class="example-item">
                <text class="example-en">APRON 1 POOR</text>
                <text class="example-cn">1号机坪状况差</text>
              </view>
              <view class="example-item">
                <text class="example-en">ALL APRONS POOR</text>
                <text class="example-cn">所有机坪状况差</text>
              </view>
              <view class="example-item">
                <text class="example-en">TERMINAL APRON POOR</text>
                <text class="example-cn">航站楼机坪状况差</text>
              </view>
            </view>
          </view>
        </view>

        <!-- S项：测定的摩擦系数 -->
        <view class="guide-item">
          <view class="guide-header">
            <text class="guide-code">S)</text>
            <text class="guide-title">Measured Friction (测定的摩擦系数)</text>
          </view>
          <view class="guide-content">
            <view class="guide-description">
              <text class="desc-text">由航空情报部门填写的实测摩擦系数值(机场管理机构通常不填)</text>
            </view>
            <view class="guide-examples">
              <view class="example-title">常用表达：</view>
              <view class="example-item">
                <text class="example-en">0.25</text>
                <text class="example-cn">摩擦系数0.25</text>
              </view>
              <view class="example-item">
                <text class="example-en">0.30</text>
                <text class="example-cn">摩擦系数0.30</text>
              </view>
              <view class="example-item">
                <text class="example-en">NIL</text>
                <text class="example-cn">未测定</text>
              </view>
            </view>
            <view class="guide-note">
              <text class="note-icon">📝</text>
              <text class="note-text">数值范围0.00-1.00，数值越小摩擦力越差</text>
            </view>
          </view>
        </view>

        <!-- T项：明语说明 -->
        <view class="guide-item">
          <view class="guide-header">
            <text class="guide-code">T)</text>
            <text class="guide-title">Plain Language (明语说明)</text>
          </view>
          <view class="guide-content">
            <view class="guide-description">
              <text class="desc-text">用简明英语提供补充信息</text>
            </view>
            <view class="guide-examples">
              <view class="example-title">常用表达：</view>
              <view class="example-item">
                <text class="example-en">RWY 01L TOUCHDOWN AREA TREATED</text>
                <text class="example-cn">跑道01L接地区已处理</text>
              </view>
              <view class="example-item">
                <text class="example-en">RWY CENTERLINE LIGHTS OBSCURED BY SNOW</text>
                <text class="example-cn">跑道中线灯被雪遮挡</text>
              </view>
              <view class="example-item">
                <text class="example-en">CAUTION SEVERE SNOW CONDITIONS</text>
                <text class="example-cn">注意严重雪情</text>
              </view>
              <view class="example-item">
                <text class="example-en">SNOW REMOVAL IN PROGRESS</text>
                <text class="example-cn">正在清雪作业</text>
              </view>
            </view>
          </view>
        </view>
      </view>

      <!-- 实用技巧 -->
      <view class="guide-tips">
        <view class="tips-header">
          <text class="tips-icon">💡</text>
          <text class="tips-title">实用记忆技巧</text>
        </view>
        <view class="tips-content">
          <view class="tip-item">
            <text class="tip-number">1.</text>
            <text class="tip-text">RWY = Runway (跑道), TWY = Taxiway (滑行道)</text>
          </view>
          <view class="tip-item">
            <text class="tip-number">2.</text>
            <text class="tip-text">LFT = Left (左), RGT = Right (右), BOTH = 两侧</text>
          </view>
          <view class="tip-item">
            <text class="tip-number">3.</text>
            <text class="tip-text">POOR = 差, TREATED = 已处理, NIL = 无/未报告</text>
          </view>
          <view class="tip-item">
            <text class="tip-number">4.</text>
            <text class="tip-text">ALL = 所有, ADJ = Adjacent (附近)</text>
          </view>
          <view class="tip-item">
            <text class="tip-number">5.</text>
            <text class="tip-text">情景意识部分多数情况下留空，只在有特殊情况时填写</text>
          </view>
        </view>
      </view>

      <!-- 完成提示 -->
      <view class="completion-note">
        <view class="completion-header">
          <text class="completion-icon">✅</text>
          <text class="completion-title">学习完成</text>
        </view>
        <view class="completion-content">
          <text>您已了解SNOWTAM情景意识部分的所有项目。在实际工作中，这部分通常留空，只在有特殊雪情时才需要填写相应项目。</text>
        </view>
      </view>
    </view>

    <!-- 第十一步：生成结果 -->
    <view wx:if="{{ currentStep === 11 }}">
      <!-- 成功标题 -->
      <view class="success-header">
        <view class="success-icon">🎉</view>
        <view class="success-title">SNOWTAM雪情通告生成成功</view>
        <view class="success-subtitle">专业级机场雪情报告</view>
      </view>

      <!-- 生成的代码卡片 -->
      <view class="generated-code-card">
        <view class="code-card-header">
          <text class="code-icon">💎</text>
          <text class="code-title">生成的SNOWTAM代码</text>
        </view>
        <view class="code-display-area">
          <view class="code-container">
            <text class="final-code">{{ generatedCode }}</text>
          </view>
        </view>
      </view>

      <!-- 解析详情 -->
      <view class="decode-details" wx:if="{{ snowtam.result && snowtam.result.sections }}">
        <view class="details-header">
          <text class="details-icon">🔍</text>
          <text class="details-title">解析详情</text>
        </view>
        <view class="sections-container">
          <view class="result-section-card" wx:for="{{ snowtam.result.sections }}" wx:key="label">
            <view class="section-badge">
              <text class="section-code">{{ item.value }}</text>
            </view>
            <view class="section-content">
              <view class="section-label">{{ item.label }}</view>
              <view class="section-description">{{ item.description }}</view>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 步骤导航按钮 -->
  <view class="step-navigation" wx:if="{{ currentStep < 11 }}">
    <van-button type="default" size="large" bind:click="prevStep" disabled="{{ currentStep === 1 }}" custom-style="flex: 1; margin-right: 10rpx;">
      ⬅️ 上一步
    </van-button>
    <van-button type="primary" size="large" bind:click="nextStep" custom-style="flex: 2;">
      {{ currentStep === 10 ? '🚀 生成雪情通告' : '下一步 ➡️' }}
    </van-button>
  </view>

  <!-- 重新开始按钮 -->
  <view class="restart-section" wx:if="{{ currentStep === 11 }}">
    <van-button type="danger" size="large" bind:click="restart" custom-style="width: 100%; display: flex; justify-content: center;">
      🔄 重新开始
    </van-button>
  </view>

  <!-- 美化的示例引导 -->
  <van-collapse value="{{ activeCollapseItems }}" bind:change="onCollapseChange">
    <van-collapse-item title="📖 示例雪情通告" name="examples" icon="guide-o">
      <view class="examples-content">
        <view class="examples-grid">
          <view class="example-card" wx:for="{{ examples }}" wx:key="code" bind:tap="fillExample" data-code="{{ item.code }}">
            <view class="example-header">
              <view class="example-code">
                <text class="code-display">{{ item.code }}</text>
                <text class="tap-hint">点击快速填充</text>
              </view>
            </view>
            <view class="example-explanation">{{ item.explanation }}</view>
            <view class="example-category">{{ item.category }}</view>
          </view>
        </view>
      </view>
    </van-collapse-item>

    <van-collapse-item title="📝 格式说明" name="format" icon="info-o">
      <view class="help-content">
        <view class="format-explanation">
          <view class="format-title">
            <text class="format-icon">🔤</text>
            <text class="format-text">SNOWTAM格式详解</text>
          </view>
          <view class="format-breakdown">
            <view class="format-item">
              <view class="format-code">A)</view>
              <view class="format-desc">
                <text class="desc-title">机场位置指示器</text>
                <text class="desc-detail">四字母ICAO机场代码 (如: ZBAA, ZSSS)</text>
              </view>
            </view>
            <view class="format-item">
              <view class="format-code">B)</view>
              <view class="format-desc">
                <text class="desc-title">日期时间</text>
                <text class="desc-detail">MMDDHHMM格式 (如: 12081200 = 12月8日12:00)</text>
              </view>
            </view>
            <view class="format-item">
              <view class="format-code">C)</view>
              <view class="format-desc">
                <text class="desc-title">跑道</text>
                <text class="desc-detail">跑道编号 (如: 01L, 27R, 99=所有跑道)</text>
              </view>
            </view>
            <view class="format-item">
              <view class="format-code">D)</view>
              <view class="format-desc">
                <text class="desc-title">清洁区域</text>
                <text class="desc-detail">长度宽度 (如: 3600045 = 3600m×45m, NIL=无)</text>
              </view>
            </view>
            <view class="format-item">
              <view class="format-code">E)</view>
              <view class="format-desc">
                <text class="desc-title">沉积物</text>
                <text class="desc-detail">头/中/跑道末段类型 (0=干燥, 4=干雪, 5=湿雪, 7=冰等)</text>
              </view>
            </view>
            <view class="format-item">
              <view class="format-code">F)</view>
              <view class="format-desc">
                <text class="desc-title">深度</text>
                <text class="desc-detail">头/中/跑道末段深度 (毫米数, 92-98=厘米数, //=无法测量)</text>
              </view>
            </view>
            <view class="format-item">
              <view class="format-code">G)</view>
              <view class="format-desc">
                <text class="desc-title">摩擦/刹车</text>
                <text class="desc-detail">头/中/跑道末段摩擦系数或刹车效应 (00-90=系数, 91-95=效应)</text>
              </view>
            </view>
            <view class="format-item">
              <view class="format-code">H)</view>
              <view class="format-desc">
                <text class="desc-title">雪堤</text>
                <text class="desc-detail">左右雪堤高度 (如: L25R30 = 左25cm右30cm, NIL=无)</text>
              </view>
            </view>
            <view class="format-item">
              <view class="format-code">I)</view>
              <view class="format-desc">
                <text class="desc-title">跑道灯光</text>
                <text class="desc-detail">灯光状态 (YES=正常, NO=故障, POOR=可见度差)</text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </van-collapse-item>
  </van-collapse>
</view>