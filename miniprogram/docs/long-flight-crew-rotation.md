# 长航线换班功能设计文档

## 功能概述
为执行长航线任务的飞行员提供换班时间计算工具，自动计算各个换班时段的起止时间，帮助机组合理安排休息和值勤时间。

## 用户需求分析

### 典型使用场景
- **长程国际航线**：如北京-纽约、上海-伦敦等超过8小时的航线
- **多套机组配置**：通常配备2-3套飞行员进行轮换值勤
- **复杂时间计算**：需要考虑起飞后稳定、着陆前准备等关键时段

### 用户输入参数
1. **起飞时间**：航班实际起飞时间
2. **总飞行时间**：预计总飞行时长（小时:分钟）
3. **起飞后开始换班时间**：起飞后多长时间开始第一次换班
4. **着陆前结束换班时间**：着陆前多长时间结束最后一次换班
5. **机组套数**：参与轮换的飞行员套数（2-5套，默认2套）
6. **换班间隔**：每次换班的时长

## 功能设计

### 计算逻辑

#### 基础时间节点
```
起飞时间: T0
着陆时间: T0 + 总飞行时间
换班开始时间: T0 + 起飞后开始换班时间  
换班结束时间: 着陆时间 - 着陆前结束换班时间
可换班总时长: 换班结束时间 - 换班开始时间
```

#### 换班时段分配
**2套机组模式**:
- 第1套：起飞 → 换班开始
- 第2套：换班开始 → 换班结束  
- 第1套：换班结束 → 着陆

**多套机组模式**:
- 根据机组套数（2-5套）平均分配换班时段
- 第1套始终负责起飞和着陆阶段
- 中间时段按套数平均分配给各套机组

### 界面设计

#### 输入区域
```
┌─ 航班基本信息 ─────────────────┐
│ 起飞时间: [日期选择] [时间选择]     │
│ 飞行时间: [__时] [__分]           │
│ 机组套数: [2] 套 (2-5套可选)      │
└──────────────────────────────┘

┌─ 换班时间设置 ─────────────────┐
│ 起飞后开始换班: [__时] [__分]     │
│ 着陆前结束换班: [__时] [__分]     │
│ 换班间隔时长: [__时] [__分]       │
└──────────────────────────────┘
```

#### 结果显示
```
┌─ 换班时间表 ───────────────────┐
│ 🛫 起飞时间: 2025-01-15 08:00   │
│ 🛬 着陆时间: 2025-01-15 22:30   │
│ ⏱️ 总飞行时间: 14小时30分        │
│                                │
│ 📋 值勤安排:                   │
│ 第1套机组: 08:00 - 10:00 (2h)  │
│ 第2套机组: 10:00 - 15:00 (5h)  │
│ 第3套机组: 15:00 - 20:00 (5h)  │
│ 第1套机组: 20:00 - 22:30 (2.5h)│
│                                │
│ 💤 休息时间:                   │
│ 第1套: 5小时 (10:00-15:00)     │
│ 第2套: 7.5小时 (15:00-22:30)   │
│ 第3套: 10小时 (20:00-次日06:00) │
└──────────────────────────────┘
```

## 技术实现

### 数据结构
```typescript
interface FlightRotationData {
  // 输入参数
  departureTime: Date
  flightDuration: { hours: number, minutes: number }
  crewCount: number // 2-5套
  rotationStartAfter: { hours: number, minutes: number }
  rotationEndBefore: { hours: number, minutes: number }
  rotationInterval: { hours: number, minutes: number }
  
  // 计算结果
  arrivalTime: Date
  rotationStartTime: Date
  rotationEndTime: Date
  dutySchedule: DutyPeriod[]
  restSchedule: RestPeriod[]
}

interface DutyPeriod {
  crewNumber: number
  startTime: Date
  endTime: Date
  duration: { hours: number, minutes: number }
  phase: 'takeoff' | 'cruise' | 'landing'
}

interface RestPeriod {
  crewNumber: number
  startTime: Date
  endTime: Date
  duration: { hours: number, minutes: number }
}
```

### 核心算法
```typescript
class CrewRotationCalculator {
  // 计算换班时间表
  calculateRotation(input: FlightRotationInput): FlightRotationData
  
  // 时间加减运算
  addTime(baseTime: Date, hours: number, minutes: number): Date
  
  // 计算时间差
  getTimeDifference(start: Date, end: Date): { hours: number, minutes: number }
  
  // 格式化时间显示
  formatTime(date: Date): string
  
  // 验证输入参数
  validateInput(input: FlightRotationInput): boolean
}
```

## 用户体验优化

### 智能默认值
- **起飞后开始换班**: 20分钟（起飞后稳定阶段）
- **着陆前结束换班**: 60分钟（准备着陆阶段）
- **换班间隔**: 3-4小时（根据总飞行时间自动调整）
- **机组套数**: 2套（用户可选择2-5套）

### 错误处理
- 换班时间不足时的提示和建议
- 不合理时间设置的警告
- 跨日期航班的正确显示

### 导出功能
- 换班时间表截图保存
- 复制文本格式的时间安排
- 分享给其他机组成员

## 使用说明

### 计算说明
- 此工具仅进行时间计算，不涉及具体法规要求
- 所有时间均为统一时间标准，不区分时区
- 建议结合实际情况调整换班安排

## 扩展功能设想

### 高级功能
1. **模板保存**：保存常用航线的换班模板
2. **历史记录**：记录之前的换班安排  
3. **团队同步**：与其他机组成员共享换班安排

### 集成功能
1. **报告生成**：生成值勤时间报告
2. **数据导出**：导出换班时间表

## 开发优先级

### Phase 1 (核心功能)
- [ ] 基础换班时间计算
- [ ] 2-5套机组模式支持
- [ ] 时间表显示和格式化

### Phase 2 (用户体验)
- [ ] 智能默认值和输入验证
- [ ] 错误提示和建议
- [ ] 结果导出和分享

### Phase 3 (高级功能)  
- [ ] 模板和历史记录
- [ ] 团队协作功能

## 注意事项

### 使用提醒
- 此工具仅用于时间计算，供参考使用
- 实际换班安排请结合具体情况调整

### 数据隐私
- 所有计算在本地进行，不上传航班信息
- 用户数据仅存储在设备本地
- 可选择性保存历史记录

---

**文档版本**: v1.0  
**创建日期**: 2025-01-24  
**最后更新**: 2025-01-24  
**作者**: FlightToolbox开发团队 