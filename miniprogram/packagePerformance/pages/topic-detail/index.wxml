<view class="container page-content">
  <view wx:if="{{ loading }}" class="loading-container">
    <van-loading type="spinner" size="48rpx" color="#10b981">加载中...</van-loading>
  </view>
  <view wx:else>
    <view class="header">
      <view class="title-row" wx:if="{{ type === 'quick' }}">
        <text class="title">{{ item.name_zh }}</text>
        <van-tag wx:if="{{ item.type === 'concept' }}" size="small" color="#e5e7eb" text-color="#111827" round>概念</van-tag>
        <van-tag wx:if="{{ item.type === 'formula' }}" size="small" color="#e5e7eb" text-color="#111827" round>公式</van-tag>
        <van-tag wx:if="{{ item.type === 'procedure' }}" size="small" color="#e5e7eb" text-color="#111827" round>说明</van-tag>
        <van-tag wx:if="{{ item.type === 'regulation' }}" size="small" color="#e5e7eb" text-color="#111827" round>规章</van-tag>
      </view>
      <view class="title-row" wx:if="{{ type === 'topic' }}">
        <text class="code">{{ item.code }}</text>
        <text class="title">{{ item.title_zh }}</text>
        <van-tag size="small" color="#e5e7eb" text-color="#111827" round>主题</van-tag>
      </view>
      <text class="subtitle" wx:if="{{ type === 'quick' }}">{{ item.name_en }}</text>
      <text class="subtitle" wx:if="{{ type === 'topic' }}">{{ item.title_en }}</text>
    </view>

    <view class="section" wx:if="{{ type === 'subsection' }}">
      <view class="section-title">小节</view>
      <view class="section-content">
        <view class="subsection-header">
          <text class="code">{{ item.code }}</text>
          <text class="title">{{ item.title_zh }}</text>
        </view>
        <text class="subtitle">{{ item.title_en }}</text>
      </view>
    </view>

    <view class="section" wx:if="{{ type === 'subsection' && item.topics && item.topics.length > 0 }}">
      <view class="section-title">主题列表</view>
      <view class="topics-list">
        <view class="topic-row" wx:for="{{ item.topics }}" wx:key="id" wx:for-item="t" bindtap="onTopicTap" data-topic="{{ t }}">
          <text class="topic-code">{{ t.code }}</text>
          <text class="topic-title">{{ t.title_zh }}</text>
        </view>
      </view>
    </view>

    <view class="section" wx:if="{{ !htmlContent && type === 'quick' && item.summary }}">
      <view class="section-title">摘要</view>
      <view class="section-content">{{ item.summary }}</view>
    </view>

    <view class="section" wx:if="{{ !htmlContent && type === 'quick' && item.formulas && item.formulas.length > 0 }}">
      <view class="section-title">公式</view>
      <view class="formula-list">
        <text class="formula" wx:for="{{ item.formulas }}" wx:key="*this">{{ item }}</text>
      </view>
    </view>

    <view class="section" wx:if="{{ !htmlContent && type === 'topic' && item.content }}">
      <view class="section-title">内容</view>
      <view class="section-content">{{ item.content }}</view>
    </view>

    <view class="section" wx:if="{{ !htmlContent && type === 'topic' && item.keywords && item.keywords.length > 0 }}">
      <view class="section-title">关键词</view>
      <view class="chip-list">
        <van-tag wx:for="{{ item.keywords }}" wx:key="*this" size="small" color="#e5e7eb" text-color="#111827" round>{{ item }}</van-tag>
      </view>
    </view>

    <view class="section" wx:if="{{ !htmlContent && type === 'topic' && item.regulations && item.regulations.length > 0 }}">
      <view class="section-title">规章</view>
      <view class="chip-list">
        <van-tag wx:for="{{ item.regulations }}" wx:key="*this" size="small" color="#e5e7eb" text-color="#111827" round>{{ item }}</van-tag>
      </view>
    </view>

    <view class="section" wx:if="{{ htmlContent }}">
      <view class="section-title">内容</view>
      <mp-html content="{{ htmlContent }}" plugins="{{ plugins }}" tag-style="{{ tagStyle }}" />
    </view>

    <view class="section" wx:if="{{ sourceText }}">
      <view class="section-title">来源</view>
      <view class="section-content">{{ sourceText }}</view>
    </view>
  </view>
</view>
