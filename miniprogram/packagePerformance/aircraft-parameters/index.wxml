<view class="container page-content">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <view class="header-icon">âœˆï¸</view>
    <view class="header-title">é£æœºå‚æ•°æŸ¥è¯¢</view>
    <view class="header-subtitle">ä¸“ä¸šèˆªç©ºå™¨æ€§èƒ½æ•°æ®åº“ Â· {{aircraftList.length}}æ¬¾ä¸»æµæœºå‹</view>
  </view>

  <!-- åˆ†ç±»é€‰æ‹© -->
  <view class="category-section" wx:if="{{ showCategoryList }}">
    <view class="section-title">é€‰æ‹©åˆ¶é€ å•†åˆ†ç±»</view>
    <view class="category-grid">
      <block wx:for="{{ categories }}" wx:key="id">
        <view
          class="category-card"
          bind:tap="selectCategory"
          data-id="{{ item.id }}"
          style="border-color: {{item.color}};"
        >
          <view class="category-icon">{{ item.icon }}</view>
          <view class="category-name">{{ item.name }}</view>
          <view class="category-count" style="color: {{item.color}};">{{ item.count }}æ¬¾æœºå‹</view>
        </view>
      </block>
    </view>
  </view>

  <!-- æœºå‹åˆ—è¡¨è§†å›¾ -->
  <view class="list-section" wx:if="{{ !showCategoryList }}">
    <!-- è¿”å›æŒ‰é’® -->
    <view class="back-button" bind:tap="backToCategories">
      <van-icon name="arrow-left" size="20" />
      <text>è¿”å›åˆ†ç±»</text>
    </view>

    <!-- å½“å‰åˆ†ç±»æ ‡é¢˜ -->
    <view class="current-category-header">
      <view class="current-category-title">
        <block wx:for="{{ categories }}" wx:key="id" wx:if="{{ item.id === selectedCategory }}">
          <text class="category-icon-small">{{ item.icon }}</text>
          <text>{{ item.name }}æœºå‹</text>
        </block>
      </view>
      <view class="current-category-count">å…± {{ filteredList.length }} æ¬¾</view>
    </view>

      <!-- æœºå‹åˆ—è¡¨ -->
    <view class="aircraft-list">
      <block wx:for="{{ filteredList }}" wx:key="model" wx:for-index="idx">
        <view
          class="aircraft-item"
          bind:tap="selectAircraft"
          data-index="{{ idx }}"
        >
          <view class="aircraft-header">
            <view class="aircraft-model">{{ item.model }}</view>
            <view class="aircraft-code">{{ item.icaoAerodromeReferenceCode }}</view>
          </view>
          <view class="aircraft-info">
            <view class="info-item">
              <view class="info-icon">âš–ï¸</view>
              <view class="info-content">
                <view class="label">æœ€å¤§èµ·é£é‡é‡</view>
                <view class="value">{{ item.mtow }}</view>
              </view>
            </view>
            <view class="info-item">
              <view class="info-icon">ğŸŒ</view>
              <view class="info-content">
                <view class="label">èˆªç¨‹</view>
                <view class="value">{{ item.range }}</view>
              </view>
            </view>
            <view class="info-item">
              <view class="info-icon">ğŸ‘¥</view>
              <view class="info-content">
                <view class="label">åº§ä½æ•°</view>
                <view class="value">{{ item.typicalSeating }}</view>
              </view>
            </view>
          </view>
          <view class="aircraft-footer">
            <view class="view-details">æŸ¥çœ‹è¯¦æƒ… â†’</view>
          </view>
        </view>
      </block>
    </view>
  </view>

  <!-- è¯¦æƒ…å¼¹çª— -->
  <van-popup
    show="{{ showDetail }}"
    position="bottom"
    round
    bind:close="closeDetail"
    custom-style="height: 85vh;"
  >
    <view class="detail-popup" wx:if="{{ selectedAircraft }}">
      <view class="detail-header">
        <view class="detail-header-content">
          <view class="detail-icon">âœˆï¸</view>
          <view class="detail-title-group">
            <view class="detail-title">{{ selectedAircraft.model }}</view>
            <view class="detail-subtitle">{{ selectedAircraft.manufacturer }} Â· {{ selectedAircraft.icaoAerodromeReferenceCode }}</view>
          </view>
        </view>
        <view class="close-button" bind:tap="closeDetail">
          <van-icon name="cross" size="20" color="#ef4444" />
        </view>
      </view>
      
      <scroll-view class="detail-content" scroll-y enhanced show-scrollbar="{{ false }}" style="height: calc(85vh - 140rpx); padding-bottom: 60rpx;">
        <!-- åŸºæœ¬å°ºå¯¸ -->
        <view class="param-section">
          <view class="section-title">ğŸ“ åŸºæœ¬å°ºå¯¸</view>
          <view class="param-grid">
            <view class="param-item">
              <text class="param-label">æ€»é•¿åº¦</text>
              <text class="param-value">{{ selectedAircraft.overallLength || 'æš‚æ— æ•°æ®' }}</text>
            </view>
            <view class="param-item">
              <text class="param-label">ç¿¼å±•</text>
              <text class="param-value">{{ selectedAircraft.wingspan || 'æš‚æ— æ•°æ®' }}</text>
            </view>
            <view class="param-item">
              <text class="param-label">æ€»é«˜åº¦</text>
              <text class="param-value">{{ selectedAircraft.overallHeight || 'æš‚æ— æ•°æ®' }}</text>
            </view>
            <view class="param-item">
              <text class="param-label">æœºèº«å®½åº¦</text>
              <text class="param-value">{{ selectedAircraft.fuselageWidth || 'æš‚æ— æ•°æ®' }}</text>
            </view>
          </view>
        </view>

        <!-- èµ·è½æ¶å‚æ•° -->
        <view class="param-section">
          <view class="section-title">ğŸ› èµ·è½æ¶å‚æ•°</view>
          <view class="param-grid">
            <view class="param-item">
              <text class="param-label">ä¸»èµ·è½æ¶è½®è·</text>
              <text class="param-value">{{ selectedAircraft.mainGearTrack || 'æš‚æ— æ•°æ®' }}</text>
            </view>
            <view class="param-item">
              <text class="param-label">å‰åè½®è·</text>
              <text class="param-value">{{ selectedAircraft.wheelbase || 'æš‚æ— æ•°æ®' }}</text>
            </view>
          </view>
        </view>

        <!-- é‡é‡å‚æ•° -->
        <view class="param-section">
          <view class="section-title">âš–ï¸ é‡é‡å‚æ•°</view>
          <view class="param-grid">
            <view class="param-item">
              <text class="param-label">æœ€å¤§èµ·é£é‡é‡</text>
              <text class="param-value">{{ selectedAircraft.mtow || 'æš‚æ— æ•°æ®' }}</text>
            </view>
            <view class="param-item">
              <text class="param-label">æœ€å¤§ç€é™†é‡é‡</text>
              <text class="param-value">{{ selectedAircraft.mlw || 'æš‚æ— æ•°æ®' }}</text>
            </view>
            <view class="param-item">
              <text class="param-label">æœ€å¤§é›¶ç‡ƒé‡é‡</text>
              <text class="param-value">{{ selectedAircraft.mzfw || 'æš‚æ— æ•°æ®' }}</text>
            </view>
          </view>
        </view>

        <!-- æ€§èƒ½å‚æ•° -->
        <view class="param-section">
          <view class="section-title">ğŸš€ æ€§èƒ½å‚æ•°</view>
          <view class="param-grid">
            <view class="param-item">
              <text class="param-label">å…¸å‹åº§ä½æ•°</text>
              <text class="param-value">{{ selectedAircraft.typicalSeating || 'æš‚æ— æ•°æ®' }}</text>
            </view>
            <view class="param-item">
              <text class="param-label">æœ€å¤§åº§ä½æ•°</text>
              <text class="param-value">{{ selectedAircraft.maxSeating || 'æš‚æ— æ•°æ®' }}</text>
            </view>
            <view class="param-item">
              <text class="param-label">èˆªç¨‹</text>
              <text class="param-value">{{ selectedAircraft.range || 'æš‚æ— æ•°æ®' }}</text>
            </view>
            <view class="param-item">
              <text class="param-label">ICAOæœºåœºå‚è€ƒä»£ç </text>
              <text class="param-value">{{ selectedAircraft.icaoAerodromeReferenceCode || 'æš‚æ— æ•°æ®' }}</text>
            </view>
          </view>
        </view>

      </scroll-view>
    </view>
  </van-popup>

</view>

<van-toast id="van-toast" />