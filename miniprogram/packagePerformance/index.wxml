<!--
  é£æœºæ€§èƒ½ - åˆ†åŒ…é¦–é¡µ
  åŠŸèƒ½ï¼šç« èŠ‚æµè§ˆã€æœç´¢
-->

<view class="container page-content">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{ loading }}" class="loading-container">
    <van-loading type="spinner" size="48rpx" color="#6366f1">åŠ è½½ä¸­...</van-loading>
  </view>

  <!-- ä¸»å†…å®¹ -->
  <view wx:else>
    <!-- æœç´¢æ¡† -->
    <view class="search-section">
      <view class="premium-search-box">
        <van-icon name="search" size="20px" color="#6366f1" />
        <input
          class="premium-search-input"
          value="{{ searchValue }}"
          placeholder="æœç´¢æ¦‚å¿µã€å…¬å¼ã€è¯´æ˜ã€è§„ç« ..."
          bindinput="onSearchInput"
          bindconfirm="onSearchConfirm"
        />
        <van-icon wx:if="{{ searchValue }}" name="clear" size="18px" color="#999" bind:tap="onClearSearch" />
      </view>

    <view class="quick-lookup-entry" bindtap="onQuickLookup">
      <view class="entry-icon">ğŸ”</view>
      <view class="entry-text">å¿«é€ŸæŸ¥è¯¢ï¼ˆæ¦‚å¿µÂ·å…¬å¼Â·è¯´æ˜Â·è§„ç« ï¼‰</view>
    </view>
    </view>

    <!-- æ–‡æ¡£ä¿¡æ¯å¡ç‰‡ -->
    <view class="doc-info-card">
      <view class="doc-icon">ğŸ“˜</view>
      <view class="doc-content">
        <view class="doc-title">{{ metadata.title_zh }}</view>
        <view class="doc-subtitle">{{ metadata.title_en }}</view>
        <view class="doc-meta">
          <text>{{ metadata.source }}</text>
          <text class="doc-divider">Â·</text>
          <text>{{ metadata.version }}</text>
          <text class="doc-divider">Â·</text>
          <text>{{ metadata.year }}</text>
        </view>
      </view>
    </view>

    <!-- ç« èŠ‚åˆ—è¡¨ -->
    <view class="sections-container">
      <block wx:for="{{ sections }}" wx:key="id">
        <view class="section-card" bind:tap="onSectionTap" data-section="{{ item }}">
          <!-- ç« èŠ‚å¤´éƒ¨ -->
          <view class="section-header">
            <view class="section-icon">{{ item.icon }}</view>
            <view class="section-title-wrapper">
              <view class="section-code">{{ item.code }}.</view>
              <view class="section-title">{{ item.title_zh }}</view>
            </view>
          </view>

          <!-- è‹±æ–‡æ ‡é¢˜ -->
          <view class="section-title-en">{{ item.title_en }}</view>

          <!-- æè¿° -->
          <view class="section-description">{{ item.description }}</view>

          <!-- ç»Ÿè®¡ä¿¡æ¯ -->
          <view class="section-stats">
            <van-tag size="small" round color="rgba(255,255,255,0.16)" text-color="#ffffff">{{ item.subsections.length }} å°èŠ‚</van-tag>
          </view>
        </view>

        <!-- åœ¨ç¬¬2ä¸ªç« èŠ‚åæ’å…¥å¹¿å‘Šï¼ˆç´¢å¼•ä¸º1ï¼Œä»0å¼€å§‹ï¼‰ -->
        <view wx:if="{{ index === 1 }}" class="ad-banner-container">
          <ad unit-id="adunit-3b2e78fbdab16389" ad-type="banner" ad-intervals="30"></ad>
        </view>
      </block>
    </view>

    <!-- é™„å½•åŒºåŸŸ -->
    <view class="appendices-section">
      <!-- åˆ†éš”çº¿ -->
      <view class="section-divider">
        <text class="divider-text">é™„å½• APPENDICES</text>
      </view>

      <!-- é™„å½•ç½‘æ ¼ -->
      <view class="appendices-grid">
        <view wx:for="{{ appendices }}" wx:key="id" wx:for-item="appendix" class="appendix-card" bind:tap="onAppendixTap" data-appendix="{{ appendix }}">
          <view class="appendix-icon">{{ appendix.icon }}</view>
          <view class="appendix-title">{{ appendix.title_zh }}</view>
          <view class="appendix-code">{{ appendix.code }}</view>
          
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€æç¤ºï¼ˆæ— ç« èŠ‚æ•°æ®æ—¶ï¼‰ -->
    <view wx:if="{{ !sections || sections.length === 0 }}" class="empty-state">
      <view class="empty-block">
        <image class="empty-img" src="{{ emptyImgSrc }}" binderror="onEmptyImgError" mode="aspectFit" />
        <view class="empty-text">æš‚æ— æ•°æ®</view>
      </view>
    </view>
  </view>
</view>
