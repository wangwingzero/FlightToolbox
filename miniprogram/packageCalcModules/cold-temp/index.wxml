<view class="container">
  <!-- 冰雪主题动画背景 -->
  <view class="animated-bg">
    <view class="snowflake snowflake1"></view>
    <view class="snowflake snowflake2"></view>
    <view class="snowflake snowflake3"></view>
    <view class="snowflake snowflake4"></view>
    <view class="snowflake snowflake5"></view>
    <view class="cold-wind"></view>
  </view>

  <!-- 主要内容区域 -->
  <view class="main-content">
    <!-- 基础参数卡片 -->
    <view class="input-card">
      <view class="card-header">
        <view class="card-title">🌡️ 基础参数</view>
        <view class="card-desc">机场标高、温度和高度参数</view>
      </view>
      <view class="input-grid">
        <view class="input-item required">
          <view class="input-header">
            <view class="input-icon elevation-icon">🏢</view>
            <view class="input-info">
              <text class="input-label">机场标高</text>
              <text class="input-unit">英尺 (ft)</text>
            </view>
            <view class="required-badge">必填</view>
          </view>
          <van-field
            value="{{ coldTemp.airportElevation }}"
            placeholder="例如：1000"
            type="digit"
            bind:change="onColdTempAirportElevationChange"
            input-align="center"
            class="custom-input"
          />
        </view>
        
        <view class="input-item required">
          <view class="input-header">
            <view class="input-icon temp-icon">🌡️</view>
            <view class="input-info">
              <text class="input-label">机场温度</text>
              <text class="input-unit">摄氏度 (°C)</text>
            </view>
            <view class="required-badge">必填</view>
          </view>
          <van-field
            value="{{ coldTemp.airportTemperature }}"
            placeholder="例如：-15"
            type="text"
            confirm-type="done"
            bind:input="onNumberInput"
            bind:change="onColdTempAirportTemperatureChange"
            input-align="center"
            class="custom-input"
            data-field="airportTemperature"
          />
        </view>
        
        <view class="input-item required">
          <view class="input-header">
            <view class="input-icon da-icon">🛬</view>
            <view class="input-info">
              <text class="input-label">DA/MDA高度</text>
              <text class="input-unit">英尺 (ft)</text>
            </view>
            <view class="required-badge">必填</view>
          </view>
          <van-field
            value="{{ coldTemp.daAltitude }}"
            placeholder="例如：1500"
            type="digit"
            bind:change="onColdTempDaAltitudeChange"
            input-align="center"
            class="custom-input"
          />
        </view>
      </view>
    </view>

    <!-- 横幅广告 -->
    <view wx:if="{{ !isAdFree && nativeAdEnabled }}" class="ad-banner-container">
      <ad unit-id="adunit-3a1bf3800fa937a2" ad-type="banner" ad-intervals="30"></ad>
    </view>

    <!-- 高度参数卡片 -->
    <view class="altitude-card">
      <view class="card-header">
        <view class="card-title">✈️ 高度参数</view>
        <view class="card-desc">可选的高度修正参数（可多选）</view>
      </view>
      <view class="altitude-grid">
        <view class="altitude-item" data-type="if">
          <view class="altitude-header">
            <view class="altitude-icon if-icon">📍</view>
            <view class="altitude-label">IF高度</view>
          </view>
          <van-field
            value="{{ coldTemp.ifAltitude }}"
            placeholder="选填"
            type="digit"
            bind:change="onColdTempIfAltitudeChange"
            input-align="center"
            class="altitude-input"
          />
        </view>
        
        <view class="altitude-item" data-type="faf">
          <view class="altitude-header">
            <view class="altitude-icon faf-icon">🎯</view>
            <view class="altitude-label">FAF高度</view>
          </view>
          <van-field
            value="{{ coldTemp.fafAltitude }}"
            placeholder="选填"
            type="digit"
            bind:change="onColdTempFafAltitudeChange"
            input-align="center"
            class="altitude-input"
          />
        </view>
        
        <view class="altitude-item" data-type="missed">
          <view class="altitude-header">
            <view class="altitude-icon missed-icon">🔄</view>
            <view class="altitude-label">复飞高度</view>
          </view>
          <van-field
            value="{{ coldTemp.missedAltitude }}"
            placeholder="选填"
            type="digit"
            bind:change="onColdTempMissedAltitudeChange"
            input-align="center"
            class="altitude-input"
          />
        </view>
        
        <view class="altitude-item" data-type="other">
          <view class="altitude-header">
            <view class="altitude-icon other-icon">📏</view>
            <view class="altitude-label">其他高度</view>
          </view>
          <van-field
            value="{{ coldTemp.otherAltitude }}"
            placeholder="选填"
            type="digit"
            bind:change="onColdTempOtherAltitudeChange"
            input-align="center"
            class="altitude-input"
          />
        </view>
      </view>
    </view>

    <!-- FAF特殊设置卡片 -->
    <view class="faf-card">
      <view class="card-header">
        <view class="card-title">🛪 FAF特殊设置</view>
        <view class="card-desc">启用FAF点特殊计算功能</view>
      </view>
      <view class="faf-toggle">
        <view class="toggle-content">
          <view class="toggle-info">
            <view class="toggle-title">FAF点计算</view>
            <view class="toggle-desc">启用后需要输入FAF到跑道头的距离</view>
          </view>
          <van-switch 
            checked="{{ coldTemp.isFafPoint }}" 
            bind:change="onColdTempFafPointChange"
            active-color="#4facfe"
          />
        </view>
        <view wx:if="{{ coldTemp.isFafPoint }}" class="faf-distance">
          <view class="distance-header">
            <view class="distance-icon">📏</view>
            <view class="distance-label">FAF距离</view>
          </view>
          <van-field
            value="{{ coldTemp.fafDistance }}"
            placeholder="输入距离值"
            type="digit"
            bind:change="onColdTempFafDistanceChange"
            input-align="center"
            class="distance-input"
          >
            <view slot="right-icon" class="distance-unit">海里</view>
          </van-field>
        </view>
      </view>
    </view>

    <!-- 操作按钮 -->
    <view class="action-section">
      <view class="primary-action" bind:tap="calculateColdTemp">
        <view class="action-icon">❄️</view>
        <view class="action-text">计算修正</view>
      </view>
      <view class="secondary-action" bind:tap="clearColdTemp">
        <view class="action-icon">🗑️</view>
        <view class="action-text">清空重置</view>
      </view>
    </view>

    <!-- 计算结果卡片 -->
    <view wx:if="{{ coldTemp.result }}" class="result-card" id="result-section">
      <view class="card-header">
        <view class="card-title">❄️ 修正结果</view>
        <view class="card-desc">基于低温条件的高度修正计算</view>
      </view>

      <!-- 多个高度的修正结果 -->
      <view wx:for="{{ coldTemp.result.results }}" wx:key="type" class="altitude-result">
        <view class="altitude-result-header">
          <view class="altitude-result-icon">
            <text wx:if="{{ item.type === 'if' }}">🔵</text>
            <text wx:if="{{ item.type === 'faf' }}">🟡</text>
            <text wx:if="{{ item.type === 'da' }}">🎯</text>
            <text wx:if="{{ item.type === 'missed' }}">🔴</text>
            <text wx:if="{{ item.type === 'other' }}">⚪</text>
          </view>
          <view class="altitude-result-title">{{ item.name }}</view>
        </view>

        <view class="altitude-result-grid">
          <view class="altitude-result-item">
            <view class="altitude-result-label">原始高度</view>
            <view class="altitude-result-value">{{ item.originalFeet }} ft</view>
          </view>
          <view class="altitude-result-item">
            <view class="altitude-result-label">修正值</view>
            <view class="altitude-result-value">{{ item.correctionFeet >= 0 ? '+' : '' }}{{ item.correctionFeet }} ft</view>
          </view>
          <view class="altitude-result-item">
            <view class="altitude-result-label">修正后高度</view>
            <view class="altitude-result-value highlight">{{ item.correctedFeet }} ft</view>
          </view>
        </view>

        <!-- FPA特殊结果 -->
        <view wx:if="{{ item.vpaInfo }}" class="fpa-result">
          <view class="fpa-result-header">
            <view class="fpa-result-icon">✈️</view>
            <view class="fpa-result-title">FPA修正分析</view>
          </view>
          <view class="fpa-result-grid">
            <view class="fpa-result-item">
              <view class="fpa-result-label">设计FPA</view>
              <view class="fpa-result-value">{{ item.vpaInfo.designedVpa }}°</view>
            </view>
            <view class="fpa-result-item">
              <view class="fpa-result-label">修正后FPA</view>
              <view class="fpa-result-value">{{ item.vpaInfo.actualVpa }}°</view>
            </view>
            <view class="fpa-result-item">
              <view class="fpa-result-label">FPA变化</view>
              <view class="fpa-result-value {{ item.vpaInfo.vpaChange > 0 ? 'increase' : item.vpaInfo.vpaChange < 0 ? 'decrease' : 'no-change' }}">
                {{ item.vpaInfo.vpaChange > 0 ? '+' : '' }}{{ item.vpaInfo.vpaChange }}°
              </view>
            </view>
          </view>
          <view class="fpa-warning">
            <view class="fpa-warning-icon">⚠️</view>
            <view class="fpa-warning-text">{{ item.vpaInfo.warningMessage }}</view>
          </view>
        </view>
      </view>

      <!-- 通用信息 -->
      <view class="general-info">
        <view class="general-info-header">
          <view class="general-info-icon">📊</view>
          <view class="general-info-title">通用信息</view>
        </view>
        <view class="general-info-grid">
          <view class="general-info-item">
            <view class="general-info-label">ISA温度</view>
            <view class="general-info-value">{{ coldTemp.result.isaTempC }}°C</view>
          </view>
          <view class="general-info-item">
            <view class="general-info-label">温度偏差</view>
            <view class="general-info-value">{{ coldTemp.result.tempDeviationC }}°C</view>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>