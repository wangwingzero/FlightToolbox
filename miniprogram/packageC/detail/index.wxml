<view class="container page-content">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{ loading }}" class="loading-container">
    <van-loading type="spinner" size="32px">æ­£åœ¨åŠ è½½æœºåœºä¿¡æ¯...</van-loading>
  </view>
  
  <!-- æœºåœºè¯¦æƒ…å†…å®¹ -->
  <view wx:elif="{{ airport }}" class="airport-detail">
    
    <!-- æœºåœºåŸºæœ¬ä¿¡æ¯ -->
    <view class="airport-header">
      <view class="airport-codes">
        <view class="main-code">{{ airport.ICAOCode }}</view>
        <view wx:if="{{ airport.IATACode }}" class="sub-code">{{ airport.IATACode }}</view>
      </view>
      
      <view class="airport-names">
        <view class="chinese-name">{{ airport.ShortName }}</view>
        <view wx:if="{{ airport.EnglishName }}" class="english-name">{{ airport.EnglishName }}</view>
      </view>
      
      <view class="airport-location">
        <view class="country">ğŸ“ {{ airport.CountryName }}</view>
      </view>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="action-buttons">
      <van-button 
        type="primary" 
        size="small" 
        bind:click="onCopyCode"
        data-code="{{ airport.ICAOCode }}"
        data-type="ICAO"
      >
        å¤åˆ¶ICAO
      </van-button>
      
      <van-button 
        wx:if="{{ airport.IATACode }}"
        type="default" 
        size="small" 
        bind:click="onCopyCode"
        data-code="{{ airport.IATACode }}"
        data-type="IATA"
      >
        å¤åˆ¶IATA
      </van-button>
      
      <van-button 
        wx:if="{{ coordinates.latitude && coordinates.longitude }}"
        type="info" 
        size="small" 
        bind:click="onShowInMap"
      >
        åœ°å›¾æŸ¥çœ‹
      </van-button>
    </view>

    <!-- è¯¦ç»†ä¿¡æ¯å¡ç‰‡ -->
    <view class="info-cards">
      
      <!-- ä»£ç ä¿¡æ¯ -->
      <view class="info-card">
        <view class="card-title">ğŸ·ï¸ æœºåœºä»£ç </view>
        <view class="card-content">
          <view class="info-row">
            <view class="info-label">ICAOä»£ç ï¼š</view>
            <view class="info-value code-value">{{ airport.ICAOCode }}</view>
          </view>
          <view wx:if="{{ airport.IATACode }}" class="info-row">
            <view class="info-label">IATAä»£ç ï¼š</view>
            <view class="info-value code-value">{{ airport.IATACode }}</view>
          </view>
          <view class="info-row">
            <view class="info-label">æœºåœºåç§°ï¼š</view>
            <view class="info-value">{{ airport.ShortName }}</view>
          </view>
          <view wx:if="{{ airport.EnglishName }}" class="info-row">
            <view class="info-label">è‹±æ–‡åç§°ï¼š</view>
            <view class="info-value">{{ airport.EnglishName }}</view>
          </view>
        </view>
      </view>

      <!-- åœ°ç†ä¿¡æ¯ -->
      <view wx:if="{{ coordinates.latitude || coordinates.longitude }}" class="info-card">
        <view class="card-title">ğŸŒ åœ°ç†ä½ç½®</view>
        <view class="card-content">
          <view class="info-row">
            <view class="info-label">æ‰€åœ¨å›½å®¶ï¼š</view>
            <view class="info-value">{{ airport.CountryName }}</view>
          </view>
          <view wx:if="{{ coordinates.latitude }}" class="info-row">
            <view class="info-label">çº¬åº¦ï¼š</view>
            <view class="info-value coord-value">
              {{ coordinates.latitude }}Â° ({{ coordinates.formatted.latitude }})
            </view>
          </view>
          <view wx:if="{{ coordinates.longitude }}" class="info-row">
            <view class="info-label">ç»åº¦ï¼š</view>
            <view class="info-value coord-value">
              {{ coordinates.longitude }}Â° ({{ coordinates.formatted.longitude }})
            </view>
          </view>
          <view wx:if="{{ coordinates.latitude && coordinates.longitude }}" class="coordinate-actions">
            <van-button type="default" size="mini" bind:click="onCopyCoordinates">
              å¤åˆ¶åæ ‡
            </van-button>
          </view>
        </view>
      </view>

      <!-- åœ°å›¾æ˜¾ç¤º -->
      <view wx:if="{{ showMap }}" class="info-card">
        <view class="card-title">ğŸ—ºï¸ ä½ç½®åœ°å›¾</view>
        <view class="card-content">
          <map
            class="airport-map"
            latitude="{{ mapCenter.latitude }}"
            longitude="{{ mapCenter.longitude }}"
            markers="{{ markers }}"
            scale="10"
            show-location
            enable-zoom
            enable-scroll
            enable-rotate
            enable-satellite
          ></map>
        </view>
      </view>

    </view>

    <!-- ç›¸å…³æœºåœº -->
    <view wx:if="{{ nearbyAirports.length > 0 }}" class="related-section">
      <view class="section-title">ğŸ›¬ é™„è¿‘æœºåœº (500kmå†…)</view>
      <view class="related-airports">
        <view 
          wx:for="{{ nearbyAirports }}" 
          wx:key="ICAOCode"
          class="related-airport-item"
          bind:tap="onRelatedAirportTap"
          data-airport="{{ item }}"
        >
          <view class="related-codes">
            <view class="related-icao">{{ item.ICAOCode }}</view>
            <view wx:if="{{ item.IATACode }}" class="related-iata">{{ item.IATACode }}</view>
          </view>
          <view class="related-info">
            <view class="related-name">{{ item.ShortName }}</view>
            <view class="related-distance">{{ item.distance }}km</view>
          </view>
        </view>
      </view>
    </view>

    <view wx:if="{{ sameCountryAirports.length > 0 }}" class="related-section">
      <view class="section-title">ğŸ  åŒå›½å®¶æœºåœº</view>
      <view class="related-airports">
        <view 
          wx:for="{{ sameCountryAirports }}" 
          wx:key="ICAOCode"
          class="related-airport-item"
          bind:tap="onRelatedAirportTap"
          data-airport="{{ item }}"
        >
          <view class="related-codes">
            <view class="related-icao">{{ item.ICAOCode }}</view>
            <view wx:if="{{ item.IATACode }}" class="related-iata">{{ item.IATACode }}</view>
          </view>
          <view class="related-info">
            <view class="related-name">{{ item.ShortName }}</view>
            <view wx:if="{{ item.EnglishName }}" class="related-english">{{ item.EnglishName }}</view>
          </view>
        </view>
      </view>
    </view>

    <!-- è¿”å›æŒ‰é’® -->
    <view class="bottom-actions">
      <van-button type="primary" block bind:click="onBackToSearch">
        è¿”å›æœç´¢
      </van-button>
    </view>

  </view>

  <!-- é”™è¯¯çŠ¶æ€ -->
  <view wx:else class="error-container">
    <view class="error-icon">âŒ</view>
    <view class="error-text">æœºåœºä¿¡æ¯åŠ è½½å¤±è´¥</view>
    <view class="error-actions">
      <van-button type="primary" bind:click="onBackToSearch">è¿”å›æœç´¢</van-button>
    </view>
  </view>

</view>

<van-toast id="van-toast" />