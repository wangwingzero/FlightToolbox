<view class="container page-content">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{ loading }}" class="loading-container">
    <van-loading type="spinner" size="32px">æ­£åœ¨åŠ è½½æœºåœºä¿¡æ¯...</van-loading>
  </view>
  
  <!-- æœºåœºè¯¦æƒ…å†…å®¹ -->
  <view wx:elif="{{ airport }}" class="airport-detail">
    
    <!-- æœºåœºç»¼åˆä¿¡æ¯å¡ç‰‡ -->
    <view class="airport-header-premium">
      <!-- è£…é¥°æ€§èƒŒæ™¯å…ƒç´  -->
      <view class="header-decoration">
        <view class="decoration-circle circle-1"></view>
        <view class="decoration-circle circle-2"></view>
        <view class="decoration-circle circle-3"></view>
      </view>
      
      <!-- é¡¶éƒ¨ä»£ç æ˜¾ç¤º -->
      <view class="header-codes-section">
        <view class="codes-display">
          <view class="primary-code">{{ airport.ICAOCode }}</view>
          <view wx:if="{{ airport.IATACode }}" class="secondary-code">/ {{ airport.IATACode }}</view>
        </view>
      </view>

      <!-- ä¸»ä¿¡æ¯åŒºåŸŸ -->
      <view class="header-main-info">
        <view class="airport-name-primary">{{ airport.ShortName }}</view>
        <view wx:if="{{ airport.EnglishName }}" class="airport-name-secondary">{{ airport.EnglishName }}</view>
      </view>

      <!-- ä½ç½®ä¿¡æ¯è¡Œ -->
      <view class="header-location-info">
        <view class="location-item">
          <text class="location-icon">ğŸ“</text>
          <text class="location-text">{{ airport.CountryName }}</text>
        </view>
        <view wx:if="{{ coordinates.latitude && coordinates.longitude }}" class="location-item">
          <text class="location-icon">ğŸŒ</text>
          <text class="location-text">{{ coordinates.formatted.latitude }}, {{ coordinates.formatted.longitude }}</text>
        </view>
        <!-- æ ‡é«˜ä¿¡æ¯ -->
        <view wx:if="{{ airport.Elevation !== null && airport.Elevation !== undefined }}" class="location-item">
          <text class="location-icon">â›°ï¸</text>
          <text class="location-text">æ ‡é«˜: {{ airport.Elevation }}ft</text>
        </view>
      </view>

      <!-- æŸ¥çœ‹å®Œæ•´åœ°å›¾æŒ‰é’® -->
      <view wx:if="{{ coordinates.latitude && coordinates.longitude }}" class="map-action-section">
        <view class="map-action-btn" bind:tap="onShowInMap">
          <text class="map-btn-icon">ğŸ—ºï¸</text>
          <text class="map-btn-text">æŸ¥çœ‹å®Œæ•´åœ°å›¾</text>
        </view>
      </view>
    </view>


    <!-- è¯¦ç»†ä¿¡æ¯å¡ç‰‡ -->
    <view class="info-cards">

      <!-- åœ°å›¾æ˜¾ç¤º -->
      <view wx:if="{{ showMap }}" class="info-card">
        <view class="card-title">ğŸ—ºï¸ ä½ç½®åœ°å›¾</view>
        <view class="card-content">
          <map
            class="airport-map"
            latitude="{{ mapCenter.latitude }}"
            longitude="{{ mapCenter.longitude }}"
            markers="{{ markers }}"
            scale="10"
            show-location
            enable-zoom
            enable-scroll
            enable-rotate
            enable-satellite
          ></map>
        </view>
      </view>

    </view>

    <!-- ç›¸å…³æœºåœº -->
    <view wx:if="{{ nearbyAirports.length > 0 }}" class="related-section">
      <view class="section-title">ğŸ›¬ é™„è¿‘æœºåœº (500kmå†…)</view>
      <view class="related-airports">
        <view 
          wx:for="{{ nearbyAirports }}" 
          wx:key="ICAOCode"
          class="related-airport-item"
          bind:tap="onRelatedAirportTap"
          data-airport="{{ item }}"
        >
          <view class="related-codes">
            <view class="related-icao">{{ item.ICAOCode }}</view>
            <view wx:if="{{ item.IATACode }}" class="related-iata">{{ item.IATACode }}</view>
          </view>
          <view class="related-info">
            <view class="related-name">{{ item.ShortName }}</view>
            <view class="related-distance">{{ item.distance }}km</view>
          </view>
        </view>
      </view>
    </view>

    <view wx:if="{{ sameCountryAirports.length > 0 }}" class="related-section">
      <view class="section-title">ğŸ  åŒå›½å®¶/åœ°åŒºæœºåœº</view>
      <view class="related-airports">
        <view 
          wx:for="{{ sameCountryAirports }}" 
          wx:key="ICAOCode"
          class="related-airport-item"
          bind:tap="onRelatedAirportTap"
          data-airport="{{ item }}"
        >
          <view class="related-codes">
            <view class="related-icao">{{ item.ICAOCode }}</view>
            <view wx:if="{{ item.IATACode }}" class="related-iata">{{ item.IATACode }}</view>
          </view>
          <view class="related-info">
            <view class="related-name">{{ item.ShortName }}</view>
            <view wx:if="{{ item.EnglishName }}" class="related-english">{{ item.EnglishName }}</view>
          </view>
        </view>
      </view>
    </view>

    <!-- è¿”å›æŒ‰é’® -->
    <view class="bottom-actions">
      <van-button type="primary" block bind:click="onBackToSearch">
        è¿”å›æœç´¢
      </van-button>
    </view>

  </view>

  <!-- é”™è¯¯çŠ¶æ€ -->
  <view wx:else class="error-container">
    <view class="error-icon">âŒ</view>
    <view class="error-text">æœºåœºä¿¡æ¯åŠ è½½å¤±è´¥</view>
    <view class="error-actions">
      <van-button type="primary" bind:click="onBackToSearch">è¿”å›æœç´¢</van-button>
    </view>
  </view>

</view>

<van-toast id="van-toast" />