<view class="container page-content">
  <!-- åˆ†ç±»èœå• -->
  <view class="category-tabs-container">
    <scroll-view class="category-tabs-scroll" scroll-x scroll-with-animation enhanced>
      <view class="category-tabs-wrapper">
        <view
          wx:for="{{ quickFilters }}"
          wx:key="value"
          class="category-tab-item {{ currentQuickFilter === item.value ? 'active' : '' }}"
          bind:tap="onQuickFilterTap"
          data-filter="{{ item }}"
        >
          <view class="category-badge">{{ item.count }}</view>
          <view class="category-title">{{ item.label }}</view>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- ä¼˜é›…æœç´¢åŒºåŸŸ -->
  <view class="elegant-search-container">
    <!-- èƒŒæ™¯è£…é¥° -->
    <view class="search-bg-decoration">
      <view class="decoration-circle circle-1"></view>
      <view class="decoration-circle circle-2"></view>
      <view class="decoration-circle circle-3"></view>
    </view>

    <!-- ä¸»æœç´¢æ¡† -->
    <view class="main-search-wrapper">
      <view class="premium-search-box {{ searchFocused ? 'focused' : '' }}">
        <view class="search-icon-wrapper">
          <van-icon name="search" size="20px" color="#6366f1" />
        </view>
        
        <input 
          class="premium-search-input"
          value="{{ searchKeyword }}"
          placeholder="è¾“å…¥æœºåœºä»£ç ã€åç§°æˆ–åŸå¸‚åç§°"
          placeholder-class="premium-search-placeholder"
          bindinput="onSearchInput"
          bindfocus="onSearchFocus"
          bindblur="onSearchBlur"
          confirm-type="search"
          bindconfirm="onSearchConfirm"
        />
        
        <view wx:if="{{ searchKeyword }}" class="search-clear-btn" bind:tap="onClearSearch">
          <van-icon name="clear" size="18px" color="#9ca3af" />
        </view>
        
        <view wx:if="{{ searchLoading }}" class="search-loading-indicator">
          <van-loading type="spinner" size="18px" color="#6366f1" />
        </view>
      </view>
      
      <!-- æœç´¢çŠ¶æ€æç¤º -->
      <view wx:if="{{ isSearchMode }}" class="search-status-elegant">
        <view class="status-indicator">
          <view class="pulse-dot"></view>
        </view>
        <text class="status-text-elegant">æ­£åœ¨ä¸ºæ‚¨æœç´¢å…¨çƒæœºåœºæ•°æ®...</text>
      </view>
    </view>
    
    <!-- æœç´¢å»ºè®®å¡ç‰‡ -->
    <view wx:if="{{ showSuggestions }}" class="suggestions-card">
      <view class="suggestions-header-elegant">
        <view class="suggestions-title-elegant">
          <van-icon name="fire" size="16px" color="#f59e0b" />
          <text>çƒ­é—¨æœç´¢</text>
        </view>
        <view class="suggestions-close-elegant" bind:tap="onCloseSuggestions">
          <van-icon name="cross" size="16px" color="#9ca3af" />
        </view>
      </view>
      
      <view class="suggestions-content-elegant">
        <view 
          wx:for="{{ searchSuggestions }}" 
          wx:key="keyword"
          class="suggestion-item-elegant"
          bind:tap="onSuggestionTap"
          data-suggestion="{{ item }}"
        >
          <view class="suggestion-icon-elegant">
            <van-icon name="location" size="16px" color="#6366f1" />
          </view>
          <view class="suggestion-content-wrapper">
            <text class="suggestion-code-elegant">{{ item.keyword }}</text>
            <text class="suggestion-name-elegant">{{ item.display }}</text>
          </view>
          <view class="suggestion-arrow-elegant">
            <van-icon name="arrow" size="14px" color="#d1d5db" />
          </view>
        </view>
      </view>
    </view>
    
    <!-- å®æ—¶æœç´¢ç»“æœé¢„è§ˆå¡ç‰‡ -->
    <view wx:if="{{ realtimeResults.length > 0 && searchKeyword && !showSuggestions }}" class="results-preview-card">
      <view class="preview-header-elegant">
        <text class="preview-title-elegant">æ‰¾åˆ° {{ realtimeResults.length }} ä¸ªåŒ¹é…ç»“æœ</text>
        <view class="preview-close-elegant" bind:tap="onClosePreview">
          <van-icon name="arrow-up" size="16px" color="#9ca3af" />
        </view>
      </view>
      
      <view class="preview-content-elegant">
        <view 
          wx:for="{{ realtimeResults.slice(0, 3) }}" 
          wx:key="ICAOCode"
          class="preview-item-elegant"
          bind:tap="onAirportTap"
          data-airport="{{ item }}"
        >
          <view class="preview-codes-elegant">
            <text class="preview-icao-elegant">{{ item.ICAOCode }}</text>
            <text wx:if="{{ item.IATACode }}" class="preview-iata-elegant">{{ item.IATACode }}</text>
          </view>
          <view class="preview-info-elegant">
            <text class="preview-name-elegant">{{ item.ShortName }}</text>
            <text class="preview-country-elegant">{{ item.CountryName }}</text>
            <text wx:if="{{ item.Elevation }}" class="preview-elevation-elegant">â›°ï¸ {{ item.Elevation }}ft</text>
          </view>
          <view class="preview-arrow-elegant">
            <van-icon name="arrow" size="14px" color="#d1d5db" />
          </view>
        </view>
        
        <view wx:if="{{ realtimeResults.length > 3 }}" class="preview-more-elegant" bind:tap="onViewAllResults">
          <text class="more-text">æŸ¥çœ‹å…¨éƒ¨ {{ realtimeResults.length }} ä¸ªç»“æœ</text>
          <van-icon name="arrow" size="14px" color="#6366f1" />
        </view>
      </view>
    </view>
  </view>


  <!-- æœç´¢ç»“æœç»Ÿè®¡ -->
  <view wx:if="{{ isSearchMode }}" class="search-stats-elegant">
    <view class="stats-content">
      <van-icon name="success" size="14px" color="#10b981" />
      <text class="stats-text">æ‰¾åˆ° {{ filteredAirports.length || displayedAirports.length }}{{ hasMoreData ? '+' : '' }} ä¸ªç»“æœ</text>
    </view>
  </view>

  <!-- æœºåœºåˆ—è¡¨ -->
  <view class="airport-list">
    <view wx:if="{{ searchLoading }}" class="loading-container">
      <view class="loading-content">
        <van-loading type="spinner" size="24px" color="#1989fa" />
        <text class="loading-text">{{ searchConfig.searchingText || 'æœç´¢ä¸­...' }}</text>
      </view>
    </view>

    <view wx:elif="{{ displayedAirports.length === 0 && !loading }}" class="empty-container">
      <view class="empty-icon">ğŸ”</view>
      <view class="empty-text">{{ isSearchMode ? 'æœªæ‰¾åˆ°åŒ¹é…çš„æœºåœº' : 'æš‚æ— æœºåœºæ•°æ®' }}</view>
      <view class="empty-tips">å°è¯•ä½¿ç”¨ä¸åŒçš„å…³é”®è¯æœç´¢</view>
    </view>

    <view wx:else>
      <block wx:for="{{ displayedAirports }}" wx:key="ICAOCode" wx:for-index="idx">
        <view class="airport-item">
          <!-- åœ°å›¾æŒ‰é’® -->
          <view wx:if="{{ item.Latitude && item.Longitude }}" class="map-btn-container">
            <view class="map-btn" bind:tap="onShowAirportInMap" data-airport="{{ item }}">
              <text class="map-btn-icon">ğŸ—ºï¸</text>
              <text class="map-btn-text">æŸ¥çœ‹å®Œæ•´åœ°å›¾</text>
            </view>
          </view>

          <view class="airport-main" bind:tap="onAirportTap" data-airport="{{ item }}">
            <view class="airport-codes">
              <view class="icao-code">{{ item.ICAOCode }}</view>
              <view wx:if="{{ item.IATACode }}" class="iata-code">{{ item.IATACode }}</view>
            </view>

            <view class="airport-info">
              <view class="airport-name">
                <text class="name-chinese">{{ item.ShortName }}</text>
                <text wx:if="{{ item.EnglishName }}" class="name-english">{{ item.EnglishName }}</text>
              </view>

              <view class="airport-location">
                <view class="country">ğŸ“ {{ item.CountryName }}</view>
                <view wx:if="{{ item.Latitude && item.Longitude }}" class="coordinates">
                  {{ item.LatitudeDisplay }}Â°, {{ item.LongitudeDisplay }}Â°
                </view>
                <view wx:if="{{ item.Elevation }}" class="elevation">
                  â›°ï¸ æ ‡é«˜: {{ item.Elevation }}ft
                </view>
              </view>
            </view>
          </view>

          <!-- æœç´¢åŒ¹é…æ ‡è¯† -->
          <view wx:if="{{ item.matchScore }}" class="match-indicator">
            <van-tag type="primary" size="mini">åŒ¹é…åº¦: {{ item.matchScore }}</van-tag>
          </view>
        </view>

        <!-- ç¬¬ä¸€ä¸ªç»“æœåæ’å…¥æ¨ªå¹…å¹¿å‘Š -->
        <view wx:if="{{ idx === 0 }}" class="ad-banner-container">
          <ad unit-id="adunit-d7a3b71f5ce0afca" ad-type="banner" ad-intervals="30"
              bindload="onAdLoad" binderror="onAdError"></ad>
        </view>
      </block>
    </view>
  </view>

  <!-- åŠ è½½æ›´å¤š -->
  <view wx:if="{{ hasMoreData && displayedAirports.length > 0 }}" class="load-more-container">
    <van-button
      type="default"
      size="small"
      loading="{{ loading }}"
      bind:click="onLoadMore"
      block
    >
      {{ loading ? 'åŠ è½½ä¸­...' : 'åŠ è½½æ›´å¤š' }}
    </van-button>
  </view>

  <!-- é¡µé¢åº•éƒ¨æ¨ªå¹…å¹¿å‘Š -->
  <view class="ad-banner-container">
    <ad unit-id="adunit-3a1bf3800fa937a2" ad-type="banner" ad-intervals="30"
        bindload="onAdLoad" binderror="onAdError"></ad>
  </view>
</view>

<van-toast id="van-toast" />