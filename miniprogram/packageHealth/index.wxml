<view class="container page-content" data-theme="{{ isDarkMode ? 'dark' : 'light' }}">
  <!-- é€‰é¡¹å¡ -->
  <van-tabs active="{{ activeTab }}" bind:change="onTabChange" sticky>
    <van-tab title="å…¨éƒ¨" name="all"></van-tab>
    <van-tab title="ä½“èƒ½" name="fitness"></van-tab>
    <van-tab title="å¬åŠ›" name="hearing"></van-tab>
    <van-tab title="è§†åŠ›" name="vision"></van-tab>
    <van-tab title="ä½“æ£€æ ‡å‡†" name="medical"></van-tab>
  </van-tabs>

  <!-- æœç´¢æ¡† -->
  <view class="search-section health-search">
    <van-search
      value="{{ searchValue }}"
      placeholder="{{ searchPlaceholder }}"
      bind:change="onSearchChange"
      bind:clear="onSearchClear"
      shape="round"
    />
  </view>

  <!-- å¥åº·ç®¡ç†åˆ—è¡¨ -->
  <view class="parameters-section">
    <view wx:if="{{ displayData.length > 0 }}" class="context7-content-container">
      <view class="context7-card-wrapper">
        <view 
          wx:for="{{ displayData }}"
          wx:key="nameEn"
          wx:for-index="idx"
          class="context7-item-card health-item-card"
          bind:tap="showParameterDetail"
          data-index="{{ idx }}"
        >
          <view class="item-card-header">
            <view class="item-primary">
              <text class="item-name-zh">{{ item.nameZh }}</text>
              <view class="item-badges">
                <view class="context7-badge category-badge" data-category="{{ item.category }}">
                  <van-icon name="bookmark" size="12px" />
                  <text>{{ item.categoryName }}</text>
                </view>
                <view wx:if="{{ item.type === 'comprehensive' }}" class="context7-badge type-badge">
                  <van-icon name="completed" size="12px" />
                  <text>å®Œæ•´æ–‡æ¡£</text>
                </view>
              </view>
            </view>
            <view class="item-secondary">
              <text class="item-name-en">{{ item.nameEn }}</text>
            </view>
          </view>
          
          <view class="item-card-content">
            <view class="item-definition">{{ item.definition }}</view>
          </view>
          
          <view class="item-card-footer">
            <view class="item-meta">
              <van-icon name="info-o" size="14px" />
              <text>ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…</text>
            </view>
            <view class="item-arrow">
              <van-icon name="arrow" size="16px" />
            </view>
          </view>
        </view>
      </view>
    </view>
    
    <!-- æ— æœç´¢ç»“æœ -->
    <view wx:else class="no-results">
      <view class="no-results-icon">ğŸ”</view>
      <view class="no-results-text">æœªæ‰¾åˆ°ç›¸å…³å†…å®¹</view>
      <view class="no-results-tip">è¯·å°è¯•å…¶ä»–å…³é”®è¯æˆ–åˆ‡æ¢åˆ†ç±»</view>
    </view>
  </view>

  <!-- ç»Ÿè®¡ä¿¡æ¯ -->
  <view wx:if="{{ activeTab === 'all' && !searchValue }}" class="stats-section">
    <view class="stats-item">
      <text class="stats-number">{{ totalCount }}</text>
      <text class="stats-label">ä¸ªæ¡ç›®</text>
    </view>
    <view class="stats-item">
      <text class="stats-number">4</text>
      <text class="stats-label">ä¸ªåˆ†ç±»</text>
    </view>
  </view>
</view>

<!-- è¯¦æƒ…å¼¹çª— -->
<van-popup
  show="{{ showDetailPopup }}"
  position="bottom"
  round
  closeable
  close-icon="close"
  bind:close="closeDetailPopup"
  custom-style="height: 80%; max-height: 80vh;"
>
  <view class="detail-popup" wx:if="{{ selectedParameter && selectedParameter.nameZh }}">
    <view class="popup-header">
      <view class="popup-header-content">
        <view class="popup-title">{{ selectedParameter.nameZh || 'å¥åº·è¯¦æƒ…' }}</view>
        <view class="popup-subtitle">{{ selectedParameter.nameEn || '' }}</view>
      </view>
      <view class="popup-close-btn" bind:tap="closeDetailPopup">
        <van-icon name="cross" size="20px" color="white" />
      </view>
    </view>
    
    <scroll-view class="popup-content" scroll-y enhanced>
      <view class="detail-section">
        <view class="detail-label">å†…å®¹æ¦‚è¿°</view>
        <view class="detail-content">{{ selectedParameter.definition || 'æš‚æ— å†…å®¹' }}</view>
      </view>
      
      <!-- å¦‚æœæ˜¯å®Œæ•´æ–‡æ¡£ç±»å‹ï¼Œæ˜¾ç¤ºæ›´å¤šè¯¦ç»†ä¿¡æ¯ -->
      <view wx:if="{{ selectedParameter.type === 'comprehensive' && selectedParameter.fullData }}" class="detail-section">
        <view class="detail-label">æ–‡æ¡£ä¿¡æ¯</view>
        <view class="detail-content">
          <view wx:if="{{ selectedParameter.fullData.publicationInfo }}" class="publication-info">
            <view class="publication-item">
              <text class="publication-label">å‡ºç‰ˆç‰©:</text>
              <text class="publication-value">{{ selectedParameter.fullData.publicationInfo.publication }}</text>
            </view>
            <view class="publication-item">
              <text class="publication-label">ç¼–åˆ¶æ–¹:</text>
              <text class="publication-value">{{ selectedParameter.fullData.publicationInfo.preparedBy }}</text>
            </view>
          </view>
        </view>
      </view>
      
      <!-- å¦‚æœæ˜¯ç« èŠ‚ç±»å‹ï¼Œæ˜¾ç¤ºç« èŠ‚å†…å®¹ -->
      <view wx:if="{{ selectedParameter.type === 'section' && selectedParameter.fullData }}" class="detail-section">
        <view class="detail-label">è¯¦ç»†å†…å®¹</view>
        <view class="detail-content section-content">
          <view wx:if="{{ selectedParameter.fullData.content }}" class="section-text">
            {{ selectedParameter.fullData.content }}
          </view>
          
          <!-- æ˜¾ç¤ºè¦ç‚¹åˆ—è¡¨ -->
          <view wx:if="{{ selectedParameter.fullData.points }}" class="points-list">
            <view wx:for="{{ selectedParameter.fullData.points }}" wx:key="*this" class="point-item">
              â€¢ {{ item }}
            </view>
          </view>
          
          <!-- æ˜¾ç¤ºç»„ä»¶åˆ—è¡¨ -->
          <view wx:if="{{ selectedParameter.fullData.components }}" class="components-list">
            <view wx:for="{{ selectedParameter.fullData.components }}" wx:key="name" class="component-item">
              <view class="component-name">{{ item.name }}</view>
              <view class="component-description">{{ item.description }}</view>
              <view wx:if="{{ item.examples }}" class="component-examples">
                <view class="examples-title">ç¤ºä¾‹ï¼š</view>
                <view wx:for="{{ item.examples }}" wx:for-item="example" wx:key="*this" class="example-item">
                  â€¢ {{ example }}
                </view>
              </view>
            </view>
          </view>
        </view>
      </view>
      
      <!-- å¦‚æœæ˜¯ä½“æ£€æ ‡å‡†ç±»å‹ï¼Œæ˜¾ç¤ºæ ‡å‡†è¯¦æƒ… -->
      <view wx:if="{{ selectedParameter.type === 'standard' && selectedParameter.fullData }}" class="detail-section">
        <view class="detail-label">ä½“æ£€æ ‡å‡†è¯¦æƒ…</view>
        <view class="detail-content standard-content">
          <view wx:if="{{ selectedParameter.fullData.category }}" class="standard-category">
            <text class="category-label">ç±»åˆ«ï¼š</text>
            <text class="category-value">{{ selectedParameter.fullData.category }}</text>
            <text wx:if="{{ selectedParameter.fullData.subCategory }}" class="subcategory-value"> - {{ selectedParameter.fullData.subCategory }}</text>
          </view>
          
          <view wx:if="{{ selectedParameter.fullData.id }}" class="standard-id">
            <text class="id-label">ç¼–å·ï¼š</text>
            <text class="id-value">{{ selectedParameter.fullData.id }}</text>
          </view>
          
          <!-- æ˜¾ç¤ºæ ‡å‡†æ¡ä»¶ -->
          <view wx:if="{{ selectedParameter.fullData.standard }}" class="standard-conditions">
            <!-- å¦‚æœæ˜¯æ•°ç»„å½¢å¼çš„å¤šä¸ªæ ‡å‡† -->
            <view wx:if="{{ selectedParameter.fullData.standard.length }}" class="multiple-standards">
              <view wx:for="{{ selectedParameter.fullData.standard }}" wx:key="assessment" class="standard-item">
                <view class="assessment-title assessment-{{ item.assessment === 'åˆæ ¼' ? 'qualified' : item.assessment === 'ä¸åˆæ ¼' ? 'unqualified' : 'conditional' }}">
                  {{ item.assessment }}
                </view>
                <view class="conditions-list">
                  <view wx:for="{{ item.conditions }}" wx:for-item="condition" wx:key="*this" class="condition-item">
                    â€¢ {{ condition }}
                  </view>
                </view>
                <view wx:if="{{ item.notes }}" class="standard-notes">
                  <text class="notes-label">å¤‡æ³¨ï¼š</text>
                  <text class="notes-text">{{ item.notes }}</text>
                </view>
              </view>
            </view>
            
            <!-- å¦‚æœæ˜¯å•ä¸ªæ ‡å‡† -->
            <view wx:else class="single-standard">
              <view class="assessment-title assessment-{{ selectedParameter.fullData.standard.assessment === 'åˆæ ¼' ? 'qualified' : selectedParameter.fullData.standard.assessment === 'ä¸åˆæ ¼' ? 'unqualified' : 'conditional' }}">
                {{ selectedParameter.fullData.standard.assessment }}
              </view>
              <view class="conditions-list">
                <view wx:for="{{ selectedParameter.fullData.standard.conditions }}" wx:key="*this" class="condition-item">
                  â€¢ {{ item }}
                </view>
              </view>
              <view wx:if="{{ selectedParameter.fullData.standard.notes }}" class="standard-notes">
                <text class="notes-label">å¤‡æ³¨ï¼š</text>
                <text class="notes-text">{{ selectedParameter.fullData.standard.notes }}</text>
              </view>
            </view>
          </view>
        </view>
      </view>
      
      <view wx:if="{{ !selectedParameter.fullData }}" class="detail-section">
        <view class="detail-label">è¯´æ˜</view>
        <view class="detail-content">è¯¥å†…å®¹æš‚æ— è¯¦ç»†ä¿¡æ¯ã€‚</view>
      </view>
    </scroll-view>
  </view>
  
  <view wx:else class="detail-popup">
    <view class="popup-header">
      <view class="popup-title">åŠ è½½ä¸­...</view>
    </view>
    <view class="popup-content">
      <view class="detail-section">
        <view class="detail-content">æ­£åœ¨åŠ è½½å¥åº·è¯¦æƒ…...</view>
      </view>
    </view>
  </view>
</van-popup>

<van-toast id="van-toast" />