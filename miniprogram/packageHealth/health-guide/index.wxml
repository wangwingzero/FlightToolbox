<view class="container page-content">
  <!-- åˆ†ç±»èœå• -->
  <view class="category-tabs-container">
    <scroll-view class="category-tabs-scroll" scroll-x scroll-with-animation enhanced>
      <view class="category-tabs-wrapper">
        <view 
          wx:for="{{ categoryList }}" 
          wx:key="name"
          class="category-tab-item {{ activeTab === item.name ? 'active' : '' }}"
          bind:tap="onTabChange"
          data-name="{{ item.name }}"
        >
          <view class="category-badge">{{ item.count }}</view>
          <view class="category-title">{{ item.title }}</view>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- æœç´¢æ¡† -->
  <view class="search-section health-search">
    <van-search
      value="{{ searchKeyword }}"
      placeholder="{{ searchPlaceholder }}"
      bind:change="onSearchChange"
      bind:clear="onSearchClear"
      shape="round"
    />
  </view>

  <!-- å¥åº·æŒ‡å—åˆ—è¡¨ -->
  <view class="guides-section">
    <view wx:if="{{ displayedGuides.length > 0 }}" class="context7-content-container">
      <view class="context7-card-wrapper">
        <view 
          wx:for="{{ displayedGuides }}"
          wx:key="id"
          wx:for-index="idx"
          class="context7-item-card health-guide-card"
          bind:tap="showGuideDetail"
          data-index="{{ idx }}"
        >
          <view class="item-card-header">
            <view class="item-primary">
              <text class="item-name-zh">{{ item.name_zh }}</text>
              <view class="item-badges">
                <view class="context7-badge category-badge" data-category="{{ item.category }}">
                  <van-icon name="bookmark-o" size="12px" />
                  <text>{{ item.category }}</text>
                </view>
                <view class="publication-badge">
                  <text>{{ item.publication }}</text>
                </view>
              </view>
            </view>
            <view class="item-secondary">
              <text class="item-name-en">{{ item.name_en }}</text>
            </view>
          </view>
          
          <view class="item-card-content">
            <view class="item-summary">
              {{ item.summary }}
            </view>
            <view wx:if="{{ item.type === 'comprehensive' }}" class="item-highlight">
              <van-icon name="star-o" size="14px" />
              <text>æƒå¨å®Œæ•´æŒ‡å—</text>
            </view>
            <view class="item-source">
              <view class="source-label">æ•°æ®æ¥æº:</view>
              <view class="source-text">{{ item.source }}</view>
            </view>
          </view>
          
          <view class="item-card-footer">
            <view class="item-meta">
              <van-icon name="info-o" size="14px" />
              <text>ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…</text>
            </view>
            <view class="item-arrow">
              <van-icon name="arrow" size="16px" />
            </view>
          </view>
        </view>
      </view>
      
      <!-- åŠ è½½æ›´å¤šæŒ‰é’® -->
      <view wx:if="{{ hasMore }}" class="load-more-container">
        <button 
          class="load-more-btn {{ loading ? 'loading' : '' }}" 
          bind:tap="loadMoreGuides"
          disabled="{{ loading }}"
        >
          <view wx:if="{{ loading }}" class="loading-icon">
            <van-loading size="20px" color="#22c55e" />
          </view>
          <text class="load-more-text">{{ loading ? 'åŠ è½½ä¸­...' : 'åŠ è½½æ›´å¤š' }}</text>
        </button>
        <view class="remaining-count">
          è¿˜æœ‰ {{ filteredGuides.length - displayedGuides.length }} æ¡æ•°æ®
        </view>
      </view>
    </view>
    
    <!-- æ— æœç´¢ç»“æœ -->
    <view wx:else class="no-results">
      <view class="no-results-animation">
        <view class="no-results-icon">ğŸ”</view>
        <view class="no-results-sparkles">âœ¨</view>
      </view>
      <view class="no-results-text">æœªæ‰¾åˆ°ç›¸å…³å¥åº·ç®¡ç†</view>
      <view class="no-results-tip">è¯·å°è¯•å…¶ä»–å…³é”®è¯æˆ–åˆ‡æ¢åˆ†ç±»æŸ¥çœ‹</view>
      <view class="no-results-suggestions">
        <text>å»ºè®®æœç´¢ï¼šç–²åŠ³ã€ç¼ºæ°§ã€è§†åŠ›ã€å¬åŠ›</text>
      </view>
    </view>
  </view>

  <!-- ç»Ÿè®¡ä¿¡æ¯ -->
  <view wx:if="{{ activeTab === 'å…¨éƒ¨' && !searchKeyword }}" class="stats-section">
    <view class="stats-card">
      <view class="stats-item">
        <view class="stats-icon">ğŸ“š</view>
        <view class="stats-content">
          <text class="stats-number">{{ displayedGuides.length }}</text>
          <text class="stats-label">å·²æ˜¾ç¤º</text>
        </view>
      </view>
      <view class="stats-item">
        <view class="stats-icon">ğŸ“Š</view>
        <view class="stats-content">
          <text class="stats-number">{{ totalCount }}</text>
          <text class="stats-label">æ€»æŒ‡å—</text>
        </view>
      </view>
      <view class="stats-item">
        <view class="stats-icon">ğŸ·ï¸</view>
        <view class="stats-content">
          <text class="stats-number">{{ categories.length - 1 }}</text>
          <text class="stats-label">åˆ†ç±»æ ‡ç­¾</text>
        </view>
      </view>
      <view class="stats-item">
        <view class="stats-icon">âš•ï¸</view>
        <view class="stats-content">
          <text class="stats-number">{{ comprehensiveCount }}</text>
          <text class="stats-label">å®Œæ•´æŒ‡å—</text>
        </view>
      </view>
    </view>
    <view class="stats-description">
      <text>æ¶µç›–é£è¡Œä½“èƒ½ã€å¬åŠ›é˜²æŠ¤ã€è§†åŠ›ä¿æŠ¤ã€èˆªç©ºç”Ÿç†ã€é£è¡Œå®‰å…¨ç­‰å…¨æ–¹ä½å¥åº·ç®¡ç†çŸ¥è¯†æŒ‡å—</text>
    </view>
  </view>
</view>

<!-- è¯¦æƒ…å¼¹çª— -->
<van-popup
  show="{{ showDetailPopup }}"
  position="bottom"
  round
  closeable
  close-icon="close"
  bind:close="closeDetailPopup"
  custom-style="height: 85%; max-height: 85vh; border-radius: 32rpx 32rpx 0 0;"
>
  <view class="detail-popup" wx:if="{{ selectedGuide && selectedGuide.name_zh }}">
    <view class="popup-header">
      <view class="popup-header-decoration"></view>
      <view class="popup-main-content">
        <view class="popup-title">{{ selectedGuide.name_zh || 'æŒ‡å—è¯¦æƒ…' }}</view>
        <view class="popup-subtitle">{{ selectedGuide.name_en || '' }}</view>
        <view class="popup-badges">
          <view class="popup-category-badge">
            <van-icon name="bookmark-o" size="10px" />
            <text>{{ selectedGuide.category }}</text>
          </view>
        </view>
      </view>
      <view class="popup-close-btn" bind:tap="closeDetailPopup">
        <van-icon name="cross" size="16px" color="white" />
      </view>
    </view>
    
    <scroll-view class="popup-content" scroll-y enable-flex enhanced show-scrollbar="{{ false }}" style="height: calc(85vh - 140rpx);">
      <!-- åŸºæœ¬ä¿¡æ¯å¡ç‰‡ -->
      <view class="info-cards">
        <view class="info-card">
          <view class="info-icon">ğŸ·ï¸</view>
          <view class="info-content">
            <view class="info-label">åˆ†ç±»</view>
            <view class="info-value">{{ selectedGuide.category }}</view>
          </view>
        </view>
        <view class="info-card">
          <view class="info-icon">ğŸ“š</view>
          <view class="info-content">
            <view class="info-label">æ¥æº</view>
            <view class="info-value">{{ selectedGuide.source }}</view>
          </view>
        </view>
        <view class="info-card">
          <view class="info-icon">ğŸ“‹</view>
          <view class="info-content">
            <view class="info-label">å‚è€ƒæ–‡çŒ®</view>
            <view class="info-value">{{ selectedGuide.publication }}</view>
          </view>
        </view>
      </view>
      
      <!-- è¯¦ç»†å†…å®¹ -->
      <view class="detail-section">
        <view class="section-header">
          <view class="section-icon">ğŸ“</view>
          <view class="section-title">è¯¦ç»†å†…å®¹</view>
        </view>
        <view class="detail-content">
          <!-- é€šç”¨å†…å®¹æ˜¾ç¤º -->
          <view class="content-display">
            <!-- ä¸»è¦å†…å®¹ -->
            <view wx:if="{{ selectedGuide.fullContent.content }}" class="content-paragraph">
              {{ selectedGuide.fullContent.content }}
            </view>
            
            <!-- å…³é”®æ¦‚å¿µ -->
            <view wx:if="{{ selectedGuide.fullContent.key_concepts && selectedGuide.fullContent.key_concepts.length > 0 }}" class="concepts-section">
              <view class="subsection-title">å…³é”®æ¦‚å¿µ</view>
              <view wx:for="{{ selectedGuide.fullContent.key_concepts }}" wx:key="index" class="concept-item">
                â€¢ {{ item }}
              </view>
            </view>
            
            <!-- è¦ç‚¹åˆ—è¡¨ -->
            <view wx:if="{{ selectedGuide.fullContent.points && selectedGuide.fullContent.points.length > 0 }}" class="points-section">
              <view class="subsection-title">è¦ç‚¹</view>
              <view wx:for="{{ selectedGuide.fullContent.points }}" wx:key="index" class="point-item">
                â€¢ {{ item }}
              </view>
            </view>
            
            <!-- ç»„æˆéƒ¨åˆ† -->
            <view wx:if="{{ selectedGuide.fullContent.components && selectedGuide.fullContent.components.length > 0 }}" class="components-section">
              <view class="subsection-title">ä¸»è¦ç»„æˆéƒ¨åˆ†</view>
              <view wx:for="{{ selectedGuide.fullContent.components }}" wx:key="name" class="component-item">
                <view class="component-name">{{ item.name }}</view>
                <view class="component-description">{{ item.description }}</view>
                <view wx:if="{{ item.examples && item.examples.length > 0 }}" class="component-examples">
                  <view class="examples-title">ç¤ºä¾‹ï¼š</view>
                  <view wx:for="{{ item.examples }}" wx:key="index" class="example-item">â€¢ {{ item }}</view>
                </view>
              </view>
            </view>
            
            <!-- å­ç« èŠ‚ -->
            <view wx:if="{{ selectedGuide.fullContent.subsections && selectedGuide.fullContent.subsections.length > 0 }}" class="subsections">
              <view wx:for="{{ selectedGuide.fullContent.subsections }}" wx:key="title" class="subsection-item">
                <view class="subsection-title">{{ item.title }}</view>
                <view class="subsection-content">{{ item.content }}</view>
              </view>
            </view>
            
            <!-- ææ–™ä¿¡æ¯ -->
            <view wx:if="{{ selectedGuide.fullContent.materials && selectedGuide.fullContent.materials.length > 0 }}" class="materials-section">
              <view class="subsection-title">ææ–™ä¿¡æ¯</view>
              <view wx:for="{{ selectedGuide.fullContent.materials }}" wx:key="name" class="material-item">
                <view class="material-name">{{ item.name }}</view>
                <view class="material-description">{{ item.description }}</view>
              </view>
            </view>
            
            <!-- è¡¨æ ¼æ•°æ® -->
            <view wx:if="{{ selectedGuide.fullContent.table && selectedGuide.fullContent.table.headers }}" class="table-section">
              <view class="table-title">{{ selectedGuide.fullContent.table.title || 'æ•°æ®è¡¨æ ¼' }}</view>
              <view class="table-wrapper">
                <view class="table-header">
                  <view wx:for="{{ selectedGuide.fullContent.table.headers }}" wx:key="index" class="table-cell header-cell">
                    {{ item }}
                  </view>
                </view>
                <view wx:for="{{ selectedGuide.fullContent.table.rows }}" wx:key="index" class="table-row">
                  <view wx:for="{{ item }}" wx:key="*this" class="table-cell">
                    {{ item }}
                  </view>
                </view>
              </view>
            </view>
          </view>
        </view>
      </view>
    </scroll-view>
  </view>
  
  <view wx:else class="detail-popup">
    <view class="popup-header">
      <view class="popup-title">åŠ è½½ä¸­...</view>
    </view>
    <view class="popup-content">
      <view class="detail-section">
        <view class="detail-content">æ­£åœ¨åŠ è½½æŒ‡å—è¯¦æƒ…...</view>
      </view>
    </view>
  </view>
</van-popup>

<van-toast id="van-toast" />