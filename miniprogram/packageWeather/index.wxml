<view class="container">
  <!-- 头部区域 -->
  <view class="header">
    <view class="title">天气报文·摩擦系数·雪情通告</view>
    <view class="subtitle">METAR · TAF · SIGMET · AIRMET · Advisory</view>
  </view>

  <!-- 快速体验示例卡片 -->
  <view class="examples-card">
    <view class="examples-title">
      <text class="examples-icon">💡</text>
      <view class="examples-title-text">
        <text>点击示例快速体验</text>
        <text class="examples-subtitle">可粘贴整条报文，也可以只输入单个要素（如 FEW020CB、R99/421594、09L 5/5/5 100/100/100 NR/NR/03 WET/WET/WET）</text>
      </view>
    </view>
    <scroll-view class="examples-scroll" scroll-x enhanced show-scrollbar="{{false}}">
      <view class="examples-list">
        <view class="example-chip" bindtap="onExampleTap" hover-class="none" data-example="METAR ZBAA 301200Z 02003MPS 9999 FEW040 17/08 Q1018">
          <text class="chip-label">METAR</text>
          <text class="chip-text">标准报文</text>
        </view>
        <view class="example-chip" bindtap="onExampleTap" hover-class="none" data-example="R36/421594">
          <text class="chip-label">RODEX</text>
          <text class="chip-text">欧洲摩擦系数</text>
        </view>
        <view class="example-chip" bindtap="onExampleTap" hover-class="none" data-example="09L 5/5/5 100/100/100 NR/NR/03 WET/WET/WET">
          <text class="chip-label">GRF</text>
          <text class="chip-text">RWYCC 跑道状态</text>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- 报文输入区域 -->
  <view class="input-card">
    <view class="input-header">
      <view class="input-icon">✈️</view>
      <text class="input-title">输入报文</text>
      <text class="char-count" wx:if="{{rawInput.length > 0}}">{{rawInput.length}} 字符</text>
    </view>

    <textarea
      class="message-input"
      placeholder="粘贴整条航空气象报文，或直接输入单个要素（如 FEW020CB、R36/421594、09L 5/5/5...）"
      placeholder-class="input-placeholder"
      auto-height
      maxlength="-1"
      value="{{rawInput}}"
      bindinput="onInputChange"
      bindfocus="onInputFocus"
      bindblur="onInputBlur"
    />

    <view class="error-badge" wx:if="{{errorMessage}}">
      <text class="badge-icon">⚠️</text>
      <text>{{errorMessage}}</text>
    </view>

    <view class="actions">
      <button class="btn-clear" bindtap="handleClear" hover-class="none" wx:if="{{rawInput && !loading}}">
        <text>清空</text>
      </button>
      <button class="btn-decode" bindtap="handleDecode" hover-class="none" disabled="{{!rawInput || loading}}">
        <text>{{loading ? '解码中...' : '解码报文'}}</text>
      </button>
    </view>
  </view>

  <!-- 时间显示模式切换 -->
  <view class="time-toggle">
    <view
      class="time-chip {{timeMode === 'local' ? 'time-chip-active' : ''}}"
      data-mode="local"
      bindtap="onTimeModeTap"
      hover-class="none"
    >
      北京时间
    </view>
    <view
      class="time-chip {{timeMode === 'utc' ? 'time-chip-active' : ''}}"
      data-mode="utc"
      bindtap="onTimeModeTap"
      hover-class="none"
    >
      UTC
    </view>
  </view>

  <!-- 加载提示 -->
  <view class="loading-overlay" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">正在解码报文...</text>
  </view>

  <!-- 解码结果展示 -->
  <view class="result-section" wx:if="{{analysis}}">
    <block wx:for="{{analysis.sections}}" wx:key="id">
      <view class="info-card {{item.id === 'raw' ? 'raw-message-card' : ''}}" hover-class="none">
        <view class="card-header">
          <view class="card-icon">{{item.icon || '📄'}}</view>
          <text class="card-title">{{item.title}}</text>
        </view>
        <view class="card-content">
          <block wx:for="{{item.items}}" wx:key="label" wx:for-item="field">
            <view class="info-row">
              <text class="info-label">{{field.label}}</text>
              <text class="info-value" user-select>{{field.value}}</text>
            </view>
          </block>
        </view>
      </view>
    </block>
  </view>

  <!-- 广告 -->
  <view class="ad-container" wx:if="{{!isAdFree && nativeAdEnabled}}">
    <ad unit-id="adunit-3a1bf3800fa937a2" ad-type="banner" ad-intervals="30"></ad>
  </view>
</view>
