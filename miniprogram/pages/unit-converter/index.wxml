<view class="container">
  <van-tabs active="{{ activeTab }}" bind:change="onTabChange" color="#ff4444" line-width="40px">
    <!-- 距离换算 -->
    <van-tab title="距离" name="distance">
      <van-cell-group title="距离换算">
        <van-field
          value="{{ distanceValues.meter }}"
          label="米 (m)"
          placeholder="请输入数值"
          type="digit"
          bind:change="onDistanceInput"
          data-unit="meter"
          input-align="right"
        />
        <van-field
          value="{{ distanceValues.kilometer }}"
          label="千米 (km)"
          placeholder="请输入数值"
          type="digit"
          bind:change="onDistanceInput"
          data-unit="kilometer"
          input-align="right"
        />
        <van-field
          value="{{ distanceValues.nauticalMile }}"
          label="海里 (nm)"
          placeholder="请输入数值"
          type="digit"
          bind:change="onDistanceInput"
          data-unit="nauticalMile"
          input-align="right"
        />
        <van-field
          value="{{ distanceValues.mile }}"
          label="英里 (mi)"
          placeholder="请输入数值"
          type="digit"
          bind:change="onDistanceInput"
          data-unit="mile"
          input-align="right"
        />
        <van-field
          value="{{ distanceValues.foot }}"
          label="英尺 (ft)"
          placeholder="请输入数值"
          type="digit"
          bind:change="onDistanceInput"
          data-unit="foot"
          input-align="right"
        />
        <van-field
          value="{{ distanceValues.inch }}"
          label="英寸 (in)"
          placeholder="请输入数值"
          type="digit"
          bind:change="onDistanceInput"
          data-unit="inch"
          input-align="right"
        />
        <van-cell>
          <van-button type="primary" block bind:click="convertDistance">换算</van-button>
        </van-cell>
        <van-cell>
          <van-button type="default" block bind:click="clearDistance">清空</van-button>
        </van-cell>
      </van-cell-group>
    </van-tab>

    <!-- 侧风计算 -->
    <van-tab title="侧风" name="crosswind">
      <van-cell-group title="侧风分量计算">
        <van-field
          value="{{ crosswindTrueAirspeed }}"
          label="真空速 (TAS)"
          placeholder="请输入真空速"
          type="digit"
          bind:change="onCrosswindTrueAirspeedChange"
        >
          <view slot="right-icon">节</view>
        </van-field>
        
        <van-field
          value="{{ crosswindHeading }}"
          label="航向"
          placeholder="请输入航向"
          type="digit"
          bind:change="onCrosswindHeadingChange"
        >
          <view slot="right-icon">度</view>
        </van-field>
        
        <van-field
          value="{{ crosswindDirection }}"
          label="风向"
          placeholder="请输入风向"
          type="digit"
          bind:change="onCrosswindDirectionChange"
        >
          <view slot="right-icon">度</view>
        </van-field>
        
        <van-field
          value="{{ crosswindSpeed }}"
          label="风速"
          placeholder="请输入风速"
          type="digit"
          bind:change="onCrosswindSpeedChange"
        >
          <view slot="right-icon">节</view>
        </van-field>
        
        <van-cell>
          <van-button type="primary" bind:click="calculateCrosswind" block>
            计算侧风
          </van-button>
        </van-cell>
        
        <van-cell wx:if="{{ crosswindComponent !== '' }}" title="侧风分量" value="{{ crosswindDisplayText }}" />
        <van-cell wx:if="{{ headwindComponent !== '' }}" title="顶风分量" value="{{ headwindDisplayText }}" />
        <van-cell wx:if="{{ driftAngle }}" title="偏流角" value="{{ driftAngle }}°" />
        <van-cell wx:if="{{ groundSpeed }}" title="地速" value="{{ groundSpeed }} 节" />
        <van-cell wx:if="{{ track }}" title="航迹" value="{{ track }}°" />
        
        <!-- 360度罗盘显示 -->
        <view wx:if="{{ crosswindComponent }}" class="wind-compass">
          <view class="compass-title">风向罗盘</view>
          <view class="compass-container">
            <view class="compass-circle">
              <!-- 度数刻度 -->
              <view class="compass-degrees">
                <text class="degree-mark north">{{ crosswindHeading || '000' }}</text>
                <text class="degree-mark east">{{ ((parseInt(crosswindHeading) || 0) + 90) % 360 || '090' }}</text>
                <text class="degree-mark south">{{ ((parseInt(crosswindHeading) || 0) + 180) % 360 || '180' }}</text>
                <text class="degree-mark west">{{ ((parseInt(crosswindHeading) || 0) + 270) % 360 || '270' }}</text>
              </view>
              
              <!-- 航向指针 -->
              <view class="heading-indicator" style="transform: translate(-50%, -100%) rotate({{headingAngle}}deg);">
                <view class="heading-line"></view>
                <view class="heading-arrow"></view>
              </view>
              
              <!-- 风向指针 -->
              <view class="wind-arrow" style="transform: translate(-50%, -100%) rotate({{windAngle}}deg);">
                <view class="arrow-line"></view>
                <view class="arrow-head"></view>
              </view>
              
              <!-- 航迹指针 -->
              <view class="track-indicator" style="transform: translate(-50%, -100%) rotate({{track}}deg);">
                <view class="track-line"></view>
                <view class="track-arrow"></view>
              </view>
            </view>
          </view>
          
          <!-- 指针图例 -->
          <view wx:if="{{ crosswindComponent }}" class="compass-legend">
            <view class="legend-item">
              <view class="legend-color heading-color"></view>
              <text class="legend-text">航向</text>
            </view>
            <view class="legend-item">
              <view class="legend-color wind-color"></view>
              <text class="legend-text">风向</text>
            </view>
            <view class="legend-item">
              <view class="legend-color track-color"></view>
              <text class="legend-text">航迹</text>
            </view>
          </view>
        </view>
      </van-cell-group>
    </van-tab>

    <!-- 梯度计算 -->
    <van-tab title="梯度" name="gradient">
      <!-- 输入参数区域 -->
      <van-cell-group title="输入参数">
        <van-field
          value="{{ gradientInput }}"
          label="梯度"
          placeholder="请输入梯度"
          type="digit"
          bind:change="onGradientInputChange"
        >
          <view slot="right-icon">%</view>
        </van-field>
        
        <van-field
          value="{{ groundSpeedInput }}"
          label="地速"
          placeholder="请输入地速"
          type="digit"
          bind:change="onGroundSpeedInputChange"
        >
          <view slot="right-icon">节</view>
        </van-field>
        
        <van-field
          value="{{ verticalSpeedInput }}"
          label="升降率"
          placeholder="请输入升降率"
          type="digit"
          bind:change="onVerticalSpeedInputChange"
        >
          <view slot="right-icon">ft/min</view>
        </van-field>
        
        <van-field
          value="{{ angleInput }}"
          label="角度"
          placeholder="请输入角度"
          type="digit"
          bind:change="onAngleInputChange"
        >
          <view slot="right-icon">度</view>
        </van-field>
      </van-cell-group>
      
      <!-- 操作区域 -->
      <van-cell-group title="操作">
        <van-cell>
          <van-button type="primary" block bind:click="convertGradient">
            换算
          </van-button>
        </van-cell>
        <van-cell>
          <van-button type="default" block bind:click="clearGradient">
            清空
          </van-button>
        </van-cell>
      </van-cell-group>
      
      <!-- 计算结果区域 -->
      <van-cell-group title="计算结果" wx:if="{{ gradientResult || verticalSpeedResult || angleResult }}">
        <van-cell wx:if="{{ gradientResult }}" title="梯度" value="{{ gradientResult }}%" />
        <van-cell wx:if="{{ verticalSpeedResult }}" title="升降率" value="{{ verticalSpeedResult }} ft/min" />
        <van-cell wx:if="{{ angleResult }}" title="角度" value="{{ angleResult }}°" />
      </van-cell-group>
    </van-tab>

    <!-- 速度换算 -->
    <van-tab title="速度" name="speed">
      <van-cell-group title="速度换算">
        <van-field
          value="{{ speedValues.meterPerSecond }}"
          label="米/秒 (m/s)"
          placeholder="请输入数值"
          type="digit"
          bind:change="onSpeedInput"
          data-unit="meterPerSecond"
          input-align="right"
        />
        <van-field
          value="{{ speedValues.kilometerPerHour }}"
          label="千米/时 (km/h)"
          placeholder="请输入数值"
          type="digit"
          bind:change="onSpeedInput"
          data-unit="kilometerPerHour"
          input-align="right"
        />
        <van-field
          value="{{ speedValues.knot }}"
          label="海里/时 (kn)"
          placeholder="请输入数值"
          type="digit"
          bind:change="onSpeedInput"
          data-unit="knot"
          input-align="right"
        />
        <van-cell>
          <van-button type="primary" block bind:click="convertSpeed">换算</van-button>
        </van-cell>
        <van-cell>
          <van-button type="default" block bind:click="clearSpeed">清空</van-button>
        </van-cell>
      </van-cell-group>
    </van-tab>

    <!-- 转弯半径计算 -->
    <van-tab title="转弯" name="turn">
      <van-cell-group title="转弯半径计算">
        <van-field
          value="{{ turnBankAngle }}"
          label="坡度角"
          placeholder="请输入坡度角"
          type="digit"
          bind:change="onTurnBankAngleChange"
        >
          <view slot="right-icon">度</view>
        </van-field>
        
        <van-field
          value="{{ turnGroundSpeed }}"
          label="地速"
          placeholder="请输入地速"
          type="digit"
          bind:change="onTurnGroundSpeedChange"
        >
          <view slot="right-icon">节</view>
        </van-field>
        
        <van-cell>
          <van-button type="primary" bind:click="calculateTurnRadius" block>
            计算转弯半径
          </van-button>
        </van-cell>
        
        <van-cell wx:if="{{ turnRadiusMeters }}" title="转弯半径" value="{{ turnRadiusMeters }} 米" />
        <van-cell wx:if="{{ turnRadiusFeet }}" title="转弯半径" value="{{ turnRadiusFeet }} 英尺" />
        <van-cell wx:if="{{ turnRadiusNauticalMiles }}" title="转弯半径" value="{{ turnRadiusNauticalMiles }} 海里" />
        <van-cell wx:if="{{ turnRate }}" title="转弯率" value="{{ turnRate }} 度/秒" />
        <van-cell wx:if="{{ turnTime360 }}" title="360°转弯时间" value="{{ turnTime360 }} 秒" />
      </van-cell-group>
    </van-tab>

    <!-- ISA计算 -->
    <van-tab title="ISA" name="isa">
      <van-cell-group title="ISA标准大气温度计算">
        <van-field
          value="{{ isaAltitude }}"
          label="高度"
          placeholder="请输入高度"
          type="digit"
          bind:change="onIsaAltitudeChange"
        >
          <view slot="right-icon">英尺</view>
        </van-field>
        
        <van-field
          value="{{ isaOAT }}"
          label="外界空气温度"
          placeholder="请输入OAT（可选）"
          type="digit"
          bind:change="onIsaOATChange"
        >
          <view slot="right-icon">°C</view>
        </van-field>
        
        <van-cell>
          <van-button type="primary" bind:click="calculateISA" block>
            计算ISA温度
          </van-button>
        </van-cell>
        
        <van-cell wx:if="{{ isaStandardTemp }}" title="ISA标准温度" value="{{ isaStandardTemp }}°C" />
        <van-cell wx:if="{{ isaDeviation }}" title="温度偏差" value="{{ isaDeviation }}" />
      </van-cell-group>
    </van-tab>

    <!-- 温度换算 -->
    <van-tab title="温度" name="temperature">
      <van-cell-group title="温度换算">
        <van-field
          value="{{ temperatureValues.celsius }}"
          label="摄氏度 (°C)"
          placeholder="请输入数值"
          type="digit"
          bind:change="onTemperatureInput"
          data-unit="celsius"
          input-align="right"
        />
        <van-field
          value="{{ temperatureValues.fahrenheit }}"
          label="华氏度 (°F)"
          placeholder="请输入数值"
          type="digit"
          bind:change="onTemperatureInput"
          data-unit="fahrenheit"
          input-align="right"
        />
        <van-field
          value="{{ temperatureValues.kelvin }}"
          label="开尔文 (K)"
          placeholder="请输入数值"
          type="digit"
          bind:change="onTemperatureInput"
          data-unit="kelvin"
          input-align="right"
        />
        <van-cell>
          <van-button type="primary" block bind:click="convertTemperature">换算</van-button>
        </van-cell>
        <van-cell>
          <van-button type="default" block bind:click="clearTemperature">清空</van-button>
        </van-cell>
      </van-cell-group>
    </van-tab>

    <!-- 重量换算 -->
    <van-tab title="重量" name="weight">
      <van-cell-group title="重量换算">
        <van-field
          value="{{ weightValues.gram }}"
          label="克 (g)"
          placeholder="请输入数值"
          type="digit"
          bind:change="onWeightInput"
          data-unit="gram"
          input-align="right"
        />
        <van-field
          value="{{ weightValues.kilogram }}"
          label="千克 (kg)"
          placeholder="请输入数值"
          type="digit"
          bind:change="onWeightInput"
          data-unit="kilogram"
          input-align="right"
        />
        <van-field
          value="{{ weightValues.pound }}"
          label="磅 (lb)"
          placeholder="请输入数值"
          type="digit"
          bind:change="onWeightInput"
          data-unit="pound"
          input-align="right"
        />
        <van-cell>
          <van-button type="primary" block bind:click="convertWeight">换算</van-button>
        </van-cell>
        <van-cell>
          <van-button type="default" block bind:click="clearWeight">清空</van-button>
        </van-cell>
      </van-cell-group>
    </van-tab>
  </van-tabs>
</view>

<van-toast id="van-toast" /> 