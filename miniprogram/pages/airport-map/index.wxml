<view class="airport-map-container">
  <!-- 返回按钮 -->
  <view class="back-button" bindtap="navigateBack">
    <van-icon name="arrow-left" size="24px" color="#fff" />
  </view>

  <!-- 加载状态 -->
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading-content">
      <van-loading type="spinner" size="24px" color="#1890ff">{{loadingStatus}}</van-loading>
      <view wx:if="{{loadingProgress > 0}}" class="progress-container">
        <view class="progress-bar">
          <view class="progress-fill" style="width: {{loadingProgress}}%;"></view>
        </view>
        <text class="progress-text">{{loadingProgress}}%</text>
      </view>
    </view>
  </view>

  <!-- 地图容器 -->
  <view wx:else class="map-container">
    <!-- 选中位置标记 -->
    <view wx:if="{{selectedLocation}}" class="selected-location-info">
      <van-icon name="location" size="16px" color="#1890ff" />
      <text class="location-name">{{selectedLocation.name || selectedLocation.address || '已选择位置'}}</text>
    </view>
    <map
      id="airportMap"
      class="airport-map"
      longitude="{{mapCenter.lng}}"
      latitude="{{mapCenter.lat}}"
      scale="{{mapScale}}"
      markers="{{markers}}"
      show-location="{{showCurrentLocation}}"
      enable-3D="{{enable3D}}"
      enable-zoom="{{true}}"
      enable-scroll="{{true}}"
      enable-satellite="{{enableSatellite}}"
      bindmarkertap="onMarkerTap"
      bindregionchange="onRegionChange"
      bindupdated="onMapUpdated"
    >
    </map>
  </view>

  <!-- 底部优雅按钮组 -->
  <view class="bottom-button-group">
    <view class="elegant-button search-button" bindtap="chooseLocation">
      <van-icon name="aim" size="20px" color="#fff" />
      <text class="button-label">搜索地点</text>
    </view>
    <view class="elegant-button location-button" bindtap="moveToCurrentLocation">
      <van-icon name="location" size="20px" color="#fff" />
      <text class="button-label">当前位置</text>
    </view>
    <view class="elegant-button satellite-button" bindtap="toggleSatellite">
      <van-icon name="{{enableSatellite ? 'photo-o' : 'apps-o'}}" size="20px" color="#fff" />
      <text class="button-label">{{enableSatellite ? '普通地图' : '卫星图'}}</text>
    </view>
    <view class="elegant-button labels-button" bindtap="toggleAirportLabels">
      <van-icon name="{{showAirportLabels ? 'label' : 'label-o'}}" size="20px" color="#fff" />
      <text class="button-label">{{showAirportLabels ? '隐藏名称' : '显示名称'}}</text>
    </view>
  </view>

  <view wx:if="{{footprintMode}}" class="footprint-panel">
    <view class="footprint-header">
      <text class="footprint-title">机场足迹</text>
      <text class="footprint-subtitle">
        {{ footprintStats ? ('已打卡 ' + footprintStats.totalCount + ' 个机场') : '还没有机场打卡记录' }}
      </text>
      <view wx:if="{{footprintStats}}" class="footprint-summary">
        <text class="summary-text">第一次：{{ footprintStats.firstDateText }}</text>
        <text class="summary-text">最近一次：{{ footprintStats.lastDateText }}</text>
      </view>
    </view>

    <scroll-view wx:if="{{footprintList && footprintList.length}}" scroll-y="true" class="footprint-list">
      <view wx:for="{{footprintList}}" wx:key="{{item.icao || item.iata}}" class="footprint-item">
        <view class="footprint-row">
          <text class="airport-name">{{item.name}}</text>
          <text class="airport-code">{{item.icao || item.iata}}</text>
        </view>
        <view class="footprint-row-meta">
          <text class="airport-country">{{item.country}}</text>
          <text class="visit-date">{{item.dateText}}</text>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- 机场信息弹窗 -->
  <view wx:if="{{selectedAirport}}" class="airport-info-popup" bindtap="closeAirportInfo">
    <view class="popup-content" catchtap="stopPropagation">
      <view class="popup-header">
        <text class="airport-code">{{selectedAirport.ICAOCode}}</text>
        <text class="airport-iata">{{selectedAirport.IATACode}}</text>
        <van-icon name="cross" size="20px" bindtap="closeAirportInfo" class="close-button" />
      </view>
      
      <view class="popup-body">
        <view class="info-row">
          <text class="label">机场名称:</text>
          <text class="value">{{selectedAirport.ShortName}}</text>
        </view>
        <view class="info-row">
          <text class="label">英文名称:</text>
          <text class="value">{{selectedAirport.EnglishName}}</text>
        </view>
        <view class="info-row">
          <text class="label">所在国家:</text>
          <text class="value">{{selectedAirport.CountryName}}</text>
        </view>
        <view class="info-row">
          <text class="label">海拔高度:</text>
          <text class="value">{{selectedAirport.Elevation}} ft</text>
        </view>
        <view class="info-row">
          <text class="label">坐标位置:</text>
          <text class="value">{{selectedAirport.Latitude}}, {{selectedAirport.Longitude}}</text>
        </view>
      </view>
      
      <view class="popup-actions">
        <van-button 
          size="small" 
          type="primary" 
          bind:click="navigateToAirport"
        >
          导航到此机场
        </van-button>
      </view>
    </view>
  </view>
</view>