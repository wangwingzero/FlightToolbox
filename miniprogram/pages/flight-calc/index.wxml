<view class="container">
  <van-tabs active="{{ activeTab }}" bind:change="onTabChange" color="#ff4444" line-width="40px">
    <!-- 下降率计算 -->
    <van-tab title="下降率" name="descent">
      <van-cell-group title="下降率计算">
        <van-field
          value="{{ currentAltitude }}"
          label="当前高度"
          placeholder="请输入当前高度"
          type="digit"
          bind:change="onCurrentAltitudeChange"
        >
          <view slot="right-icon">英尺</view>
        </van-field>
        
        <van-field
          value="{{ targetAltitude }}"
          label="目标高度"
          placeholder="请输入目标高度"
          type="digit"
          bind:change="onTargetAltitudeChange"
        >
          <view slot="right-icon">英尺</view>
        </van-field>
        
        <van-field
          value="{{ distanceNM }}"
          label="相距距离"
          placeholder="请输入距离"
          type="digit"
          bind:change="onDistanceNMChange"
        >
          <view slot="right-icon">海里</view>
        </van-field>
        
        <van-field
          value="{{ currentGroundSpeed }}"
          label="当前地速"
          placeholder="请输入地速"
          type="digit"
          bind:change="onCurrentGroundSpeedChange"
        >
          <view slot="right-icon">节</view>
        </van-field>
        
        <van-cell class="button-cell">
          <van-button type="primary" bind:click="calculateDescentRate" block>
            计算下降率
          </van-button>
        </van-cell>
        
        <van-cell class="button-cell">
          <van-button type="default" bind:click="clearDescentRate" block>
            清空
          </van-button>
        </van-cell>
      </van-cell-group>

      <van-cell-group wx:if="{{ descentRate }}" title="计算结果">
        <van-cell title="所需下降率" value="{{ descentRate }} 英尺/分钟" />
        <van-cell title="下降角度" value="{{ descentAngle }}°" />
        <van-cell title="下降时间" value="{{ timeToDescend }} 分钟" />
        <van-cell title="下降梯度" value="{{ descentGradient }}%" />
      </van-cell-group>
    </van-tab>

    <!-- 下滑线计算 -->
    <van-tab title="下滑线" name="glideslope">
      <van-cell-group title="下滑线计算">
        <van-field
          value="{{ glideslopeAngle }}"
          label="下滑角"
          placeholder="请输入下滑角"
          type="digit"
          bind:change="onGlideslopeAngleChange"
        >
          <view slot="right-icon">度</view>
        </van-field>
        
        <van-field
          value="{{ distanceFromThreshold }}"
          label="距离跑道头"
          placeholder="请输入距离"
          type="digit"
          bind:change="onDistanceFromThresholdChange"
        >
          <view slot="right-icon">海里</view>
        </van-field>
        
        <van-field
          value="{{ airportElevation }}"
          label="机场标高"
          placeholder="默认0英尺 (海平面)"
          type="digit"
          bind:change="onAirportElevationChange"
        >
          <view slot="right-icon">英尺</view>
        </van-field>
        
        <van-cell class="button-cell">
          <van-button type="primary" bind:click="calculateGlideslope" block>
            计算下滑线高度
          </van-button>
        </van-cell>
        
        <van-cell class="button-cell">
          <van-button type="default" bind:click="clearGlideslope" block>
            清空
          </van-button>
        </van-cell>
      </van-cell-group>

      <van-cell-group wx:if="{{ glideslopeAltitude }}" title="计算结果">
        <van-cell title="QNH高度（带标高）" value="{{ glideslopeAbsoluteAltitude }} 英尺" />
        <van-cell title="AGL高度（不带标高）" value="{{ glideslopeAltitude }} 英尺" />
      </van-cell-group>

      <van-cell-group wx:if="{{ glideslopeError }}" title="错误信息">
        <van-cell title="计算错误" value="{{ glideslopeError }}" />
      </van-cell-group>
    </van-tab>

    <!-- 侧风计算 -->
    <van-tab title="侧风" name="crosswind">
      <van-cell-group title="侧风分量计算">
        <van-field
          value="{{ crosswindTrueAirspeed }}"
          label="真空速 (TAS)"
          placeholder="请输入真空速"
          type="digit"
          bind:change="onCrosswindTrueAirspeedChange"
        >
          <view slot="right-icon">节</view>
        </van-field>
        
        <van-field
          value="{{ crosswindHeading }}"
          label="航向"
          placeholder="请输入航向"
          type="digit"
          bind:change="onCrosswindHeadingChange"
        >
          <view slot="right-icon">度</view>
        </van-field>
        
        <van-field
          value="{{ crosswindDirection }}"
          label="风向"
          placeholder="请输入风向"
          type="digit"
          bind:change="onCrosswindDirectionChange"
        >
          <view slot="right-icon">度</view>
        </van-field>
        
        <van-field
          value="{{ crosswindSpeed }}"
          label="风速"
          placeholder="请输入风速"
          type="digit"
          bind:change="onCrosswindSpeedChange"
        >
          <view slot="right-icon">节</view>
        </van-field>
        
        <van-cell class="button-cell">
          <van-button type="primary" bind:click="calculateCrosswind" block>
            计算侧风
          </van-button>
        </van-cell>
        
        <van-cell class="button-cell">
          <van-button type="default" bind:click="clearCrosswind" block>
            清空
          </van-button>
        </van-cell>
        
        <van-cell wx:if="{{ crosswindComponent !== '' }}" title="侧风分量" value="{{ crosswindDisplayText }}" />
        <van-cell wx:if="{{ headwindComponent !== '' }}" title="顶风分量" value="{{ headwindDisplayText }}" />
        <van-cell wx:if="{{ driftAngle }}" title="偏流角" value="{{ driftAngle }}°" />
        <van-cell wx:if="{{ groundSpeed }}" title="地速" value="{{ groundSpeed }} 节" />
        <van-cell wx:if="{{ track }}" title="航迹" value="{{ track }}°" />
        
        <!-- 360度罗盘显示 -->
        <view wx:if="{{ crosswindComponent }}" class="wind-compass">
          <view class="compass-title">风向罗盘</view>
          <view class="compass-container">
            <view class="compass-circle">
              <!-- 度数刻度 -->
              <view class="compass-degrees">
                <text class="degree-mark north">{{ crosswindHeading || '000' }}</text>
                <text class="degree-mark east">{{ ((parseInt(crosswindHeading) || 0) + 90) % 360 || '090' }}</text>
                <text class="degree-mark south">{{ ((parseInt(crosswindHeading) || 0) + 180) % 360 || '180' }}</text>
                <text class="degree-mark west">{{ ((parseInt(crosswindHeading) || 0) + 270) % 360 || '270' }}</text>
              </view>
              
              <!-- 航向指针 -->
              <view class="heading-indicator" style="transform: translate(-50%, -100%) rotate({{headingAngle}}deg);">
                <view class="heading-line"></view>
                <view class="heading-arrow"></view>
              </view>
              
              <!-- 风向指针 -->
              <view class="wind-arrow" style="transform: translate(-50%, -100%) rotate({{windAngle}}deg);">
                <view class="arrow-line"></view>
                <view class="arrow-head"></view>
              </view>
              
              <!-- 航迹指针 -->
              <view class="track-indicator" style="transform: translate(-50%, -100%) rotate({{track}}deg);">
                <view class="track-line"></view>
                <view class="track-arrow"></view>
              </view>
            </view>
          </view>
          
          <!-- 指针图例 -->
          <view wx:if="{{ crosswindComponent }}" class="compass-legend">
            <view class="legend-item">
              <view class="legend-color heading-color"></view>
              <text class="legend-text">航向</text>
            </view>
            <view class="legend-item">
              <view class="legend-color wind-color"></view>
              <text class="legend-text">风向</text>
            </view>
            <view class="legend-item">
              <view class="legend-color track-color"></view>
              <text class="legend-text">航迹</text>
            </view>
          </view>
        </view>
      </van-cell-group>
    </van-tab>

    <!-- 转弯半径计算 -->
    <van-tab title="转弯" name="turn">
      <van-cell-group title="转弯半径计算">
        <van-field
          value="{{ turnBankAngle }}"
          label="坡度角"
          placeholder="请输入坡度角"
          type="digit"
          bind:change="onTurnBankAngleChange"
        >
          <view slot="right-icon">度</view>
        </van-field>
        
        <van-field
          value="{{ turnGroundSpeed }}"
          label="地速"
          placeholder="请输入地速"
          type="digit"
          bind:change="onTurnGroundSpeedChange"
        >
          <view slot="right-icon">节</view>
        </van-field>
        
        <van-cell class="button-cell">
          <van-button type="primary" bind:click="calculateTurnRadius" block>
            计算转弯半径
          </van-button>
        </van-cell>
        
        <van-cell class="button-cell">
          <van-button type="default" bind:click="clearTurn" block>
            清空
          </van-button>
        </van-cell>
        
        <van-cell wx:if="{{ turnRadiusMeters }}" title="转弯半径" value="{{ turnRadiusMeters }} 米" />
        <van-cell wx:if="{{ turnRadiusFeet }}" title="转弯半径" value="{{ turnRadiusFeet }} 英尺" />
        <van-cell wx:if="{{ turnRadiusNauticalMiles }}" title="转弯半径" value="{{ turnRadiusNauticalMiles }} 海里" />
        <van-cell wx:if="{{ turnRate }}" title="转弯率" value="{{ turnRate }} 度/秒" />
        <van-cell wx:if="{{ turnTime360 }}" title="360°转弯时间" value="{{ turnTime360 }} 秒" />
      </van-cell-group>
    </van-tab>

    <!-- 绕飞耗油计算 -->
    <van-tab title="绕飞耗油" name="detour">
      <van-cell-group title="绕飞耗油计算">
        <van-field
          value="{{ detourDistance }}"
          label="偏离航路距离"
          placeholder="例如: 50"
          type="digit"
          bind:change="onDetourDistanceChange"
        >
          <view slot="right-icon">海里</view>
        </van-field>
        
        <van-field
          value="{{ detourGroundSpeed }}"
          label="地速"
          placeholder="例如: 450"
          type="digit"
          bind:change="onDetourGroundSpeedChange"
        >
          <view slot="right-icon">节</view>
        </van-field>
        
        <van-field
          value="{{ detourFuelConsumption }}"
          label="油耗"
          placeholder="例如: 2500"
          type="digit"
          bind:change="onDetourFuelConsumptionChange"
        >
          <view slot="right-icon">KG/H</view>
        </van-field>
        
        <van-cell class="button-cell">
          <van-button type="primary" bind:click="calculateDetourFuel" block>
            计算绕飞耗油
          </van-button>
        </van-cell>
        
        <van-cell class="button-cell">
          <van-button type="default" bind:click="clearDetourFuel" block>
            清空
          </van-button>
        </van-cell>
        
        <van-cell wx:if="{{ detourTimeResult }}" title="绕飞时间" value="{{ detourTimeResult }}" />
        <van-cell wx:if="{{ detourFuelResult }}" title="额外燃油消耗" value="{{ detourFuelResult }}" />
        
        <van-cell wx:if="{{ detourCalculationDetails }}" title="计算详情" label="{{ detourCalculationDetails }}" />
        
        <van-cell wx:if="{{ detourError }}" title="错误信息" value="{{ detourError }}" />
      </van-cell-group>
    </van-tab>
  </van-tabs>
</view> 