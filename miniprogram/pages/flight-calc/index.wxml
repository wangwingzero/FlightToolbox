<view class="container" data-theme="{{ isDarkMode ? 'dark' : 'light' }}">
  <van-tabs active="{{ activeTab }}" bind:change="onTabChange" color="#ff4444" line-width="40px">
    <!-- ‰∏ãÈôçÁéáËÆ°ÁÆó -->
    <van-tab title="‰∏ãÈôçÁéá" name="descent">
      <!-- üéØ Âü∫‰∫éContext7ÊúÄ‰Ω≥ÂÆûË∑µÔºöÂú®Ê†áÈ¢ò‰∏ãÊñπÊòæÁ§∫ÂπøÂëä -->
      <view wx:if="{{ showAd && !userPreferences.reduceAds }}" class="calculator-ad-container">
        <ad-template 
          unit-id="{{ adUnitId }}"
          ad-type="custom"
          context="calculator"
          bind:adload="onAdLoad"
          bind:aderror="onAdError"
        />
      </view>
      
      <van-cell-group title="‰∏ãÈôçÁéáËÆ°ÁÆó">
        <van-field
          value="{{ currentAltitude }}"
          label="ÂΩìÂâçÈ´òÂ∫¶"
          placeholder="ËØ∑ËæìÂÖ•ÂΩìÂâçÈ´òÂ∫¶"
          type="digit"
          bind:change="onCurrentAltitudeChange"
        >
          <view slot="right-icon">Ëã±Â∞∫</view>
        </van-field>
        
        <van-field
          value="{{ targetAltitude }}"
          label="ÁõÆÊ†áÈ´òÂ∫¶"
          placeholder="ËØ∑ËæìÂÖ•ÁõÆÊ†áÈ´òÂ∫¶"
          type="digit"
          bind:change="onTargetAltitudeChange"
        >
          <view slot="right-icon">Ëã±Â∞∫</view>
        </van-field>
        
        <van-field
          value="{{ distanceNM }}"
          label="Áõ∏Ë∑ùË∑ùÁ¶ª"
          placeholder="ËØ∑ËæìÂÖ•Ë∑ùÁ¶ª"
          type="digit"
          bind:change="onDistanceNMChange"
        >
          <view slot="right-icon">Êµ∑Èáå</view>
        </van-field>
        
        <van-field
          value="{{ currentGroundSpeed }}"
          label="ÂΩìÂâçÂú∞ÈÄü"
          placeholder="ËØ∑ËæìÂÖ•Âú∞ÈÄü"
          type="digit"
          bind:change="onCurrentGroundSpeedChange"
        >
          <view slot="right-icon">ËäÇ</view>
        </van-field>
        
        <van-cell class="button-cell">
          <van-button type="primary" bind:click="calculateDescentRate" block>
            ËÆ°ÁÆó‰∏ãÈôçÁéá
          </van-button>
        </van-cell>
        
        <van-cell class="button-cell">
          <van-button type="default" bind:click="clearDescentRate" block>
            Ê∏ÖÁ©∫
          </van-button>
        </van-cell>
      </van-cell-group>

      <van-cell-group wx:if="{{ descentRate }}" title="ËÆ°ÁÆóÁªìÊûú">
        <van-cell title="ÊâÄÈúÄ‰∏ãÈôçÁéá" value="{{ descentRate }} Ëã±Â∞∫/ÂàÜÈíü" />
        <van-cell title="‰∏ãÈôçËßíÂ∫¶" value="{{ descentAngle }}¬∞" />
        <van-cell title="‰∏ãÈôçÊó∂Èó¥" value="{{ timeToDescend }} ÂàÜÈíü" />
        <van-cell title="‰∏ãÈôçÊ¢ØÂ∫¶" value="{{ descentGradient }}%" />
      </van-cell-group>
    </van-tab>

    <!-- ‰∏ãÊªëÁ∫øËÆ°ÁÆó -->
    <van-tab title="‰∏ãÊªëÁ∫ø" name="glideslope">
      <!-- üéØ Âü∫‰∫éContext7ÊúÄ‰Ω≥ÂÆûË∑µÔºöÂú®Ê†áÈ¢ò‰∏ãÊñπÊòæÁ§∫ÂπøÂëä -->
      <view wx:if="{{ showAd && !userPreferences.reduceAds }}" class="calculator-ad-container">
        <ad-template 
          unit-id="{{ adUnitId }}"
          ad-type="custom"
          context="calculator"
          bind:adload="onAdLoad"
          bind:aderror="onAdError"
        />
      </view>
      
      <van-cell-group title="‰∏ãÊªëÁ∫øËÆ°ÁÆó">
        <van-field
          value="{{ glideslopeAngle }}"
          label="‰∏ãÊªëËßí"
          placeholder="ËØ∑ËæìÂÖ•‰∏ãÊªëËßí"
          type="digit"
          bind:change="onGlideslopeAngleChange"
        >
          <view slot="right-icon">Â∫¶</view>
        </van-field>
        
        <van-field
          value="{{ distanceFromThreshold }}"
          label="Ë∑ùÁ¶ªË∑ëÈÅìÂ§¥"
          placeholder="ËØ∑ËæìÂÖ•Ë∑ùÁ¶ª"
          type="digit"
          bind:change="onDistanceFromThresholdChange"
        >
          <view slot="right-icon">Êµ∑Èáå</view>
        </van-field>
        
        <van-field
          value="{{ airportElevation }}"
          label="Êú∫Âú∫Ê†áÈ´ò"
          placeholder="ÈªòËÆ§0Ëã±Â∞∫ (Êµ∑Âπ≥Èù¢)"
          type="digit"
          bind:change="onAirportElevationChange"
        >
          <view slot="right-icon">Ëã±Â∞∫</view>
        </van-field>
        
        <van-cell class="button-cell">
          <van-button type="primary" bind:click="calculateGlideslope" block>
            ËÆ°ÁÆó‰∏ãÊªëÁ∫øÈ´òÂ∫¶
          </van-button>
        </van-cell>
        
        <van-cell class="button-cell">
          <van-button type="default" bind:click="clearGlideslope" block>
            Ê∏ÖÁ©∫
          </van-button>
        </van-cell>
      </van-cell-group>

      <van-cell-group wx:if="{{ glideslopeAltitude }}" title="ËÆ°ÁÆóÁªìÊûú">
        <van-cell title="QNHÈ´òÂ∫¶ÔºàÂ∏¶Ê†áÈ´òÔºâ" value="{{ glideslopeAbsoluteAltitude }} Ëã±Â∞∫" />
        <van-cell title="AGLÈ´òÂ∫¶Ôºà‰∏çÂ∏¶Ê†áÈ´òÔºâ" value="{{ glideslopeAltitude }} Ëã±Â∞∫" />
      </van-cell-group>

      <van-cell-group wx:if="{{ glideslopeError }}" title="ÈîôËØØ‰ø°ÊÅØ">
        <van-cell title="ËÆ°ÁÆóÈîôËØØ" value="{{ glideslopeError }}" />
      </van-cell-group>
    </van-tab>

    <!-- ‰æßÈ£éËÆ°ÁÆó -->
    <van-tab title="‰æßÈ£é" name="crosswind">
      <!-- üéØ Âü∫‰∫éContext7ÊúÄ‰Ω≥ÂÆûË∑µÔºöÂú®Ê†áÈ¢ò‰∏ãÊñπÊòæÁ§∫ÂπøÂëä -->
      <view wx:if="{{ showAd && !userPreferences.reduceAds }}" class="calculator-ad-container">
        <ad-template 
          unit-id="{{ adUnitId }}"
          ad-type="custom"
          context="calculator"
          bind:adload="onAdLoad"
          bind:aderror="onAdError"
        />
      </view>
      
      <van-cell-group title="‰æßÈ£éÂàÜÈáèËÆ°ÁÆó">
        <van-field
          value="{{ crosswindTrueAirspeed }}"
          label="ÁúüÁ©∫ÈÄü (TAS)"
          placeholder="ËØ∑ËæìÂÖ•ÁúüÁ©∫ÈÄü"
          type="digit"
          bind:change="onCrosswindTrueAirspeedChange"
        >
          <view slot="right-icon">ËäÇ</view>
        </van-field>
        
        <van-field
          value="{{ crosswindHeading }}"
          label="Ëà™Âêë"
          placeholder="ËØ∑ËæìÂÖ•Ëà™Âêë"
          type="digit"
          bind:change="onCrosswindHeadingChange"
        >
          <view slot="right-icon">Â∫¶</view>
        </van-field>
        
        <van-field
          value="{{ crosswindDirection }}"
          label="È£éÂêë"
          placeholder="ËØ∑ËæìÂÖ•È£éÂêë"
          type="digit"
          bind:change="onCrosswindDirectionChange"
        >
          <view slot="right-icon">Â∫¶</view>
        </van-field>
        
        <van-field
          value="{{ crosswindSpeed }}"
          label="È£éÈÄü"
          placeholder="ËØ∑ËæìÂÖ•È£éÈÄü"
          type="digit"
          bind:change="onCrosswindSpeedChange"
        >
          <view slot="right-icon">ËäÇ</view>
        </van-field>
        
        <van-cell class="button-cell">
          <van-button type="primary" bind:click="calculateCrosswind" block>
            ËÆ°ÁÆó‰æßÈ£é
          </van-button>
        </van-cell>
        
        <van-cell class="button-cell">
          <van-button type="default" bind:click="clearCrosswind" block>
            Ê∏ÖÁ©∫
          </van-button>
        </van-cell>
        
        <van-cell wx:if="{{ crosswindComponent !== '' }}" title="‰æßÈ£éÂàÜÈáè" value="{{ crosswindDisplayText }}" />
        <van-cell wx:if="{{ headwindComponent !== '' }}" title="È°∂È£éÂàÜÈáè" value="{{ headwindDisplayText }}" />
        <van-cell wx:if="{{ driftAngle }}" title="ÂÅèÊµÅËßí" value="{{ driftAngle }}¬∞" />
        <van-cell wx:if="{{ groundSpeed }}" title="Âú∞ÈÄü" value="{{ groundSpeed }} ËäÇ" />
        <van-cell wx:if="{{ track }}" title="Ëà™Ëøπ" value="{{ track }}¬∞" />
        
        <!-- 360Â∫¶ÁΩóÁõòÊòæÁ§∫ -->
        <view wx:if="{{ crosswindComponent }}" class="wind-compass">
          <view class="compass-title">È£éÂêëÁΩóÁõò</view>
          <view class="compass-container">
            <view class="compass-circle">
              <!-- Â∫¶Êï∞ÂàªÂ∫¶ -->
              <view class="compass-degrees">
                <text class="degree-mark north">{{ compassNorth }}</text>
                <text class="degree-mark east">{{ compassEast }}</text>
                <text class="degree-mark south">{{ compassSouth }}</text>
                <text class="degree-mark west">{{ compassWest }}</text>
              </view>
              
              <!-- Ëà™ÂêëÊåáÈíà -->
              <view class="heading-indicator" style="transform: translate(-50%, -100%) rotate({{headingAngle}}deg);">
                <view class="heading-line"></view>
                <view class="heading-arrow"></view>
              </view>
              
              <!-- È£éÂêëÊåáÈíà -->
              <view class="wind-arrow" style="transform: translate(-50%, -100%) rotate({{windAngle}}deg);">
                <view class="arrow-line"></view>
                <view class="arrow-head"></view>
              </view>
              
              <!-- Ëà™ËøπÊåáÈíà -->
              <view class="track-indicator" style="transform: translate(-50%, -100%) rotate({{trackAngle}}deg);">
                <view class="track-line"></view>
                <view class="track-arrow"></view>
              </view>
            </view>
          </view>
          
          <!-- ÊåáÈíàÂõæ‰æã -->
          <view wx:if="{{ crosswindComponent }}" class="compass-legend">
            <view class="legend-item">
              <view class="legend-color heading-color"></view>
              <text class="legend-text">Ëà™Âêë</text>
            </view>
            <view class="legend-item">
              <view class="legend-color wind-color"></view>
              <text class="legend-text">È£éÂêë</text>
            </view>
            <view class="legend-item">
              <view class="legend-color track-color"></view>
              <text class="legend-text">Ëà™Ëøπ</text>
            </view>
          </view>
        </view>
      </van-cell-group>
    </van-tab>

    <!-- ËΩ¨ÂºØÂçäÂæÑËÆ°ÁÆó -->
    <van-tab title="ËΩ¨ÂºØ" name="turn">
      <!-- üéØ Âü∫‰∫éContext7ÊúÄ‰Ω≥ÂÆûË∑µÔºöÂú®Ê†áÈ¢ò‰∏ãÊñπÊòæÁ§∫ÂπøÂëä -->
      <view wx:if="{{ showAd && !userPreferences.reduceAds }}" class="calculator-ad-container">
        <ad-template 
          unit-id="{{ adUnitId }}"
          ad-type="custom"
          context="calculator"
          bind:adload="onAdLoad"
          bind:aderror="onAdError"
        />
      </view>
      
      <van-cell-group title="ËΩ¨ÂºØÂçäÂæÑËÆ°ÁÆó">
        <van-field
          value="{{ turnBankAngle }}"
          label="Âù°Â∫¶Ëßí"
          placeholder="ËØ∑ËæìÂÖ•Âù°Â∫¶Ëßí"
          type="digit"
          bind:change="onTurnBankAngleChange"
        >
          <view slot="right-icon">Â∫¶</view>
        </van-field>
        
        <van-field
          value="{{ turnGroundSpeed }}"
          label="Âú∞ÈÄü"
          placeholder="ËØ∑ËæìÂÖ•Âú∞ÈÄü"
          type="digit"
          bind:change="onTurnGroundSpeedChange"
        >
          <view slot="right-icon">ËäÇ</view>
        </van-field>
        
        <van-cell class="button-cell">
          <van-button type="primary" bind:click="calculateTurnRadius" block>
            ËÆ°ÁÆóËΩ¨ÂºØÂçäÂæÑ
          </van-button>
        </van-cell>
        
        <van-cell class="button-cell">
          <van-button type="default" bind:click="clearTurn" block>
            Ê∏ÖÁ©∫
          </van-button>
        </van-cell>
        
        <van-cell wx:if="{{ turnRadiusMeters }}" title="ËΩ¨ÂºØÂçäÂæÑ" value="{{ turnRadiusMeters }} Á±≥" />
        <van-cell wx:if="{{ turnRadiusFeet }}" title="ËΩ¨ÂºØÂçäÂæÑ" value="{{ turnRadiusFeet }} Ëã±Â∞∫" />
        <van-cell wx:if="{{ turnRadiusNauticalMiles }}" title="ËΩ¨ÂºØÂçäÂæÑ" value="{{ turnRadiusNauticalMiles }} Êµ∑Èáå" />
        <van-cell wx:if="{{ turnRate }}" title="ËΩ¨ÂºØÁéá" value="{{ turnRate }} Â∫¶/Áßí" />
        <van-cell wx:if="{{ turnTime360 }}" title="360¬∞ËΩ¨ÂºØÊó∂Èó¥" value="{{ turnTime360 }} Áßí" />
      </van-cell-group>
    </van-tab>

    <!-- ÁªïÈ£ûËÄóÊ≤πËÆ°ÁÆó -->
    <van-tab title="ÁªïÈ£ûËÄóÊ≤π" name="detour">
      <!-- üéØ Âü∫‰∫éContext7ÊúÄ‰Ω≥ÂÆûË∑µÔºöÂú®Ê†áÈ¢ò‰∏ãÊñπÊòæÁ§∫ÂπøÂëä -->
      <view wx:if="{{ showAd && !userPreferences.reduceAds }}" class="calculator-ad-container">
        <ad-template 
          unit-id="{{ adUnitId }}"
          ad-type="custom"
          context="calculator"
          bind:adload="onAdLoad"
          bind:aderror="onAdError"
        />
      </view>
      
      <van-cell-group title="ÁªïÈ£ûËÄóÊ≤πËÆ°ÁÆó">
        <van-field
          value="{{ detourDistance }}"
          label="Áî≥ËØ∑ÂÅèÁ¶ªËà™Ë∑ØÂ§öÂ∞ëÊµ∑Èáå"
          placeholder="‰æãÂ¶Ç: 30"
          type="digit"
          bind:change="onDetourDistanceChange"
        >
          <view slot="right-icon">Êµ∑Èáå</view>
        </van-field>
        
        <van-field
          value="{{ detourDepartureAngle }}"
          label="ÂÅèËà™ËßíÂ∫¶"
          placeholder="‰æãÂ¶Ç: 30"
          type="digit"
          bind:change="onDetourDepartureAngleChange"
        >
          <view slot="right-icon">Â∫¶</view>
        </van-field>
        
        <van-field
          value="{{ detourReturnAngle }}"
          label="ËøîÂõûËßíÂ∫¶"
          placeholder="‰æãÂ¶Ç: 30"
          type="digit"
          bind:change="onDetourReturnAngleChange"
        >
          <view slot="right-icon">Â∫¶</view>
        </van-field>
        
        <van-field
          value="{{ detourGroundSpeed }}"
          label="Âú∞ÈÄü"
          placeholder="‰æãÂ¶Ç: 450"
          type="digit"
          bind:change="onDetourGroundSpeedChange"
        >
          <view slot="right-icon">ËäÇ</view>
        </van-field>
        
        <van-field
          value="{{ detourFuelConsumption }}"
          label="Ê≤πËÄó"
          placeholder="‰æãÂ¶Ç: 2500"
          type="digit"
          bind:change="onDetourFuelConsumptionChange"
        >
          <view slot="right-icon">KG/H</view>
        </van-field>
        
        <van-cell class="button-cell">
          <van-button type="primary" bind:click="calculateDetourFuel" block>
            ËÆ°ÁÆóÁªïÈ£ûËÄóÊ≤π
          </van-button>
        </van-cell>
        
        <van-cell class="button-cell">
          <van-button type="default" bind:click="clearDetourFuel" block>
            Ê∏ÖÁ©∫
          </van-button>
        </van-cell>
        
        <!-- üéØ Âü∫‰∫éContext7ÊúÄ‰Ω≥ÂÆûË∑µÔºöÂá†‰ΩïËÆ°ÁÆóÁªìÊûúÂ±ïÁ§∫ -->
        <van-cell wx:if="{{ detourTimeResult }}" title="È¢ùÂ§ñÈ£ûË°åÊó∂Èó¥" value="{{ detourTimeResult }}" />
        <van-cell wx:if="{{ detourFuelResult }}" title="È¢ùÂ§ñÁáÉÊ≤πÊ∂àËÄó" value="{{ detourFuelResult }}" />
        <van-cell wx:if="{{ detourActualDistance }}" title="ÂÆûÈôÖÂ§öÈ£ûË∑ùÁ¶ª" value="{{ detourActualDistance }} Êµ∑Èáå" />
        
        <van-cell wx:if="{{ detourCalculationDetails }}" title="ËÆ°ÁÆóËØ¶ÊÉÖ" label="{{ detourCalculationDetails }}" />
        
        <van-cell wx:if="{{ detourError }}" title="ÈîôËØØ‰ø°ÊÅØ" value="{{ detourError }}" />
        
        <!-- üéØ Âü∫‰∫éContext7ÊúÄ‰Ω≥ÂÆûË∑µÔºöËÆ°ÁÆóËØ¥Êòé -->
        <van-cell wx:if="{{ !detourTimeResult && !detourError }}" title="ËÆ°ÁÆóËØ¥Êòé" 
          label="ÈááÁî®Ê≠£Á°ÆÁöÑÂá†‰ΩïÂ≠¶ÂéüÁêÜÔºöÁî≥ËØ∑ÂÅèÁ¶ªËà™Ë∑ØË∑ùÁ¶ªÊòØÊåáÂÅèÁ¶ªÂéüËà™Ë∑ØÁöÑÊúÄÁü≠Ë∑ùÁ¶ªÔºåÂÅèËà™ËßíÂ∫¶ÂíåËøîÂõûËßíÂ∫¶ÂÜ≥ÂÆö‰∫ÜÂÆûÈôÖÈ£ûË°åË∑ØÂæÑ„ÄÇÁõ∏ÊØîÁÆÄÂçïÁöÑÂæÄËøîËÆ°ÁÆóÔºåÊ≠§ÊñπÊ≥ïÊõ¥Êé•ËøëÁúüÂÆûÁªïÈ£ûÊÉÖÂÜµ„ÄÇ" />
      </van-cell-group>
    </van-tab>
  </van-tabs>
</view> 