<view class="detail-container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <view class="header-title">{{ categoryTitle }}</view>
    <view class="header-subtitle">è¯¦ç»†è§„èŒƒå†…å®¹</view>
  </view>


  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{ loading }}" class="loading-container">
    <van-loading type="spinner" size="24px">åŠ è½½ä¸­...</van-loading>
  </view>

  <!-- å†…å®¹åŒºåŸŸ -->
  <view wx:else class="content-container">
    <!-- ç« èŠ‚åˆ—è¡¨ -->
    <view wx:for="{{ filteredData }}" wx:key="id" class="section-container">
      <!-- ç« èŠ‚æ ‡é¢˜ -->
      <view class="section-header" bind:tap="selectSection" data-section="{{ item.id }}">
        <view class="section-icon">{{ item.icon }}</view>
        <view class="section-title">{{ item.title }}</view>
        <view class="section-arrow {{ currentSection === item.id ? 'expanded' : '' }}">â–¼</view>
      </view>

      <!-- ç« èŠ‚å†…å®¹ -->
      <view wx:if="{{ currentSection === item.id }}" class="section-content">
        
        <!-- æ–‡æœ¬ç±»å‹ -->
        <view wx:if="{{ item.type === 'text' }}" class="text-content">
          <view wx:for="{{ item.content }}" wx:key="index" class="text-item" bind:tap="copyContent" data-content="{{ item }}">
            {{ item }}
          </view>
        </view>

        <!-- åˆ—è¡¨ç±»å‹ -->
        <view wx:if="{{ item.type === 'list' }}" class="list-content">
          <view wx:for="{{ item.content }}" wx:key="index" class="list-item" bind:tap="copyContent" data-content="{{ item }}">
            <view class="list-number">{{ index + 1 }}</view>
            <view class="list-text">{{ item }}</view>
          </view>
        </view>

        <!-- é€šè¯ç»“æ„ç±»å‹ -->
        <view wx:if="{{ item.type === 'structure' }}" class="structure-content">
          <view wx:for="{{ item.content }}" wx:key="scenario" class="structure-item">
            <view class="structure-scenario">{{ item.scenario }}</view>
            <view class="structure-party">{{ item.party }}</view>
            <view class="structure-format" bind:tap="copyContent" data-content="{{ item.structure_zh }}">
              <text class="format-label">ä¸­æ–‡ï¼š</text>
              <text class="format-text">{{ item.structure_zh }}</text>
            </view>
            <view wx:if="{{ item.structure_en }}" class="structure-format" bind:tap="copyContent" data-content="{{ item.structure_en }}">
              <text class="format-label">è‹±æ–‡ï¼š</text>
              <text class="format-text">{{ item.structure_en }}</text>
            </view>
            <view wx:if="{{ item.note }}" class="structure-note">
              <text class="note-label">æ³¨æ„ï¼š</text>
              <text class="note-text">{{ item.note }}</text>
            </view>
          </view>
        </view>

        <!-- æ•°å­—å‘éŸ³ç±»å‹ -->
        <view wx:if="{{ item.type === 'numbers' }}" class="numbers-content">
          <!-- æ ‡å‡†æ•°å­—è¡¨ -->
          <view wx:if="{{ item.content.standard }}" class="numbers-section">
            <view class="subsection-title">æ ‡å‡†æ•°å­—å‘éŸ³</view>
            <view wx:if="{{ item.content.standard.note }}" class="note-text">{{ item.content.standard.note }}</view>
            <view class="numbers-table">
              <view wx:for="{{ item.content.standard.table }}" wx:key="digit" class="number-row">
                <view class="number-digit">{{ item.digit }}</view>
                <view class="number-zh" bind:tap="copyContent" data-content="{{ item.pronunciation_zh }}">{{ item.pronunciation_zh }}</view>
                <view class="number-en" bind:tap="copyContent" data-content="{{ item.pronunciation_en }}">{{ item.pronunciation_en }}</view>
              </view>
            </view>
          </view>

          <!-- æ•°å­—ç»„åˆ -->
          <view wx:if="{{ item.content.combinations }}" class="numbers-section">
            <view class="subsection-title">æ•°å­—ç»„åˆè¯»æ³•</view>
            <view class="rule-text">{{ item.content.combinations.rule_zh }}</view>
            <view class="rule-text">{{ item.content.combinations.rule_en }}</view>
            <view class="examples-container">
              <view wx:for="{{ item.content.combinations.examples }}" wx:key="number" class="example-item">
                <view class="example-number">{{ item.number }}</view>
                <view class="example-reading" bind:tap="copyContent" data-content="{{ item.reading_zh }}">
                  <text class="reading-label">ä¸­æ–‡ï¼š</text>{{ item.reading_zh }}
                </view>
                <view class="example-reading" bind:tap="copyContent" data-content="{{ item.reading_en }}">
                  <text class="reading-label">è‹±æ–‡ï¼š</text>{{ item.reading_en }}
                </view>
              </view>
            </view>
          </view>
        </view>

        <!-- ICAOå­—æ¯è¡¨ç±»å‹ -->
        <view wx:if="{{ item.type === 'alphabet' }}" class="alphabet-content">
          <view wx:if="{{ item.content.note }}" class="note-text">{{ item.content.note }}</view>
          <view class="alphabet-table">
            <view wx:for="{{ item.content.table }}" wx:key="letter" class="alphabet-row">
              <view class="alphabet-letter">{{ item.letter }}</view>
              <view class="alphabet-word" bind:tap="copyContent" data-content="{{ item.word }}">{{ item.word }}</view>
              <view class="alphabet-pronunciation" bind:tap="copyContent" data-content="{{ item.pronunciation }}">{{ item.pronunciation }}</view>
            </view>
          </view>
        </view>

        <!-- æ ‡å‡†ç”¨è¯­ç±»å‹ -->
        <view wx:if="{{ item.type === 'phrases' }}" class="phrases-content">
          <view wx:for="{{ item.content }}" wx:key="phrase" class="phrase-item">
            <view class="phrase-header">
              <view class="phrase-en" bind:tap="copyContent" data-content="{{ item.phrase }}">{{ item.phrase }}</view>
              <view class="phrase-zh" bind:tap="copyContent" data-content="{{ item.meaning_zh }}">{{ item.meaning_zh }}</view>
            </view>
            <view wx:if="{{ item.definition_zh }}" class="phrase-definition" bind:tap="copyContent" data-content="{{ item.definition_zh }}">
              <text class="definition-label">å®šä¹‰ï¼š</text>{{ item.definition_zh }}
            </view>
            <view wx:if="{{ item.definition_en }}" class="phrase-definition" bind:tap="copyContent" data-content="{{ item.definition_en }}">
              <text class="definition-label">Definition:</text>{{ item.definition_en }}
            </view>
            <view wx:if="{{ item.note }}" class="phrase-note">
              <text class="note-label">æ³¨æ„ï¼š</text>{{ item.note }}
            </view>
            <view wx:if="{{ item.details }}" class="phrase-details">
              <view wx:for="{{ item.details }}" wx:for-item="detail" wx:key="context" class="detail-item">
                <view class="detail-context">{{ detail.context_zh || detail.context }}</view>
                <view class="detail-usage" bind:tap="copyContent" data-content="{{ detail.usage_zh }}">{{ detail.usage_zh }}</view>
              </view>
            </view>
          </view>
        </view>

        <!-- ç‰¹æ®Šè¯»æ³•ç±»å‹ -->
        <view wx:if="{{ item.type === 'special' }}" class="special-content">
          <!-- é«˜åº¦è¯»æ³• -->
          <view wx:if="{{ item.content.altitude }}" class="special-section">
            <view class="subsection-title">é«˜åº¦è¯»æ³•</view>
            
            <!-- å…¬åˆ¶é«˜åº¦ -->
            <view wx:if="{{ item.content.altitude.metricSystem }}" class="metric-section">
              <view class="metric-title">å…¬åˆ¶é«˜åº¦</view>
              <view class="metric-description">{{ item.content.altitude.metricSystem.description }}</view>
              <view wx:if="{{ item.content.altitude.metricSystem.note }}" class="metric-note">{{ item.content.altitude.metricSystem.note }}</view>
              <view class="altitude-table">
                <view wx:for="{{ item.content.altitude.metricSystem.levels }}" wx:key="altitude" class="altitude-row">
                  <view class="altitude-value">{{ item.altitude }}</view>
                  <view class="altitude-reading" bind:tap="copyContent" data-content="{{ item.reading_zh }}">{{ item.reading_zh }}</view>
                  <view class="altitude-reading" bind:tap="copyContent" data-content="{{ item.reading_en }}">{{ item.reading_en }}</view>
                </view>
              </view>
            </view>

            <!-- è‹±åˆ¶é«˜åº¦ -->
            <view wx:if="{{ item.content.altitude.imperialSystem }}" class="imperial-section">
              <view class="imperial-title">è‹±åˆ¶é«˜åº¦</view>
              <view class="imperial-description">{{ item.content.altitude.imperialSystem.description_zh }}</view>
              <view class="examples-container">
                <view wx:for="{{ item.content.altitude.imperialSystem.examples }}" wx:key="altitude" class="example-item">
                  <view class="example-altitude">{{ item.altitude }}</view>
                  <view class="example-reading" bind:tap="copyContent" data-content="{{ item.reading_zh }}">
                    <text class="reading-label">ä¸­æ–‡ï¼š</text>{{ item.reading_zh }}
                  </view>
                  <view class="example-reading" bind:tap="copyContent" data-content="{{ item.reading_en }}">
                    <text class="reading-label">è‹±æ–‡ï¼š</text>{{ item.reading_en }}
                  </view>
                </view>
              </view>
            </view>
          </view>

          <!-- å…¶ä»–ç‰¹æ®Šè¯»æ³• -->
          <view wx:for="{{ item.content }}" wx:for-item="specialItem" wx:for-index="specialKey" wx:key="specialKey" wx:if="{{ specialKey !== 'altitude' }}" class="special-section">
            <view class="subsection-title">{{ specialKey }}</view>
            <!-- è¿™é‡Œå¯ä»¥æ ¹æ®ä¸åŒçš„ç‰¹æ®Šè¯»æ³•ç±»å‹è¿›è¡Œæ¸²æŸ“ -->
            <view class="generic-content">
              <text>{{ specialItem }}</text>
            </view>
          </view>
        </view>

        <!-- ç®¡åˆ¶å•ä½å‘¼å·ç±»å‹ -->
        <view wx:if="{{ item.type === 'controller' }}" class="controller-content">
          <view wx:if="{{ item.content.description }}" class="description-text">{{ item.content.description }}</view>
          <view wx:if="{{ item.content.suffixes }}" class="suffixes-table">
            <view class="table-header">
              <view class="header-cell">æœåŠ¡ç±»å‹</view>
              <view class="header-cell">ä¸­æ–‡åç¼€</view>
              <view class="header-cell">è‹±æ–‡åç¼€</view>
            </view>
            <view wx:for="{{ item.content.suffixes }}" wx:key="service_en" class="suffix-row">
              <view class="suffix-service">{{ item.service_zh }}</view>
              <view class="suffix-zh" bind:tap="copyContent" data-content="{{ item.suffix_zh }}">{{ item.suffix_zh }}</view>
              <view class="suffix-en" bind:tap="copyContent" data-content="{{ item.suffix_en }}">{{ item.suffix_en }}</view>
            </view>
          </view>
        </view>

        <!-- èˆªç©ºå™¨å‘¼å·ç±»å‹ -->
        <view wx:if="{{ item.type === 'aircraft' }}" class="aircraft-content">
          <view wx:for="{{ item.content.types }}" wx:key="type" class="aircraft-type">
            <view class="type-title">{{ item.type }}</view>
            <view class="type-description">{{ item.description_zh }}</view>
            <view wx:if="{{ item.example1 }}" class="type-example" bind:tap="copyContent" data-content="{{ item.example1 }}">
              {{ item.example1 }}
            </view>
            <view wx:if="{{ item.example2_zh }}" class="type-example" bind:tap="copyContent" data-content="{{ item.example2_zh }}">
              {{ item.example2_zh }}
            </view>
            <view wx:if="{{ item.examples }}" class="examples-container">
              <view wx:for="{{ item.examples }}" wx:for-item="example" wx:key="callsign" class="example-item">
                <view class="example-callsign">{{ example.callsign }}</view>
                <view class="example-reading" bind:tap="copyContent" data-content="{{ example.reading_zh }}">
                  <text class="reading-label">ä¸­æ–‡ï¼š</text>{{ example.reading_zh }}
                </view>
                <view class="example-reading" bind:tap="copyContent" data-content="{{ example.reading_en }}">
                  <text class="reading-label">è‹±æ–‡ï¼š</text>{{ example.reading_en }}
                </view>
              </view>
            </view>
          </view>
        </view>

        <!-- å¤©æ°”æŠ¥æ–‡ç±»å‹ -->
        <view wx:if="{{ item.type === 'weather' }}" class="weather-content">
          <view wx:if="{{ item.content.formats }}" class="formats-container">
            <view wx:for="{{ item.content.formats }}" wx:key="type" class="format-item">
              <view class="format-type">{{ item.type }}</view>
              <view class="format-zh" bind:tap="copyContent" data-content="{{ item.format_zh }}">
                <text class="format-label">ä¸­æ–‡æ ¼å¼ï¼š</text>{{ item.format_zh }}
              </view>
              <view class="format-en" bind:tap="copyContent" data-content="{{ item.format_en }}">
                <text class="format-label">è‹±æ–‡æ ¼å¼ï¼š</text>{{ item.format_en }}
              </view>
            </view>
          </view>
          <view wx:if="{{ item.content.note }}" class="weather-note">{{ item.content.note }}</view>
        </view>

        <!-- é€šç”¨å†…å®¹ç±»å‹ -->
        <view wx:if="{{ item.type === 'generic' }}" class="generic-content">
          <text>{{ item.content }}</text>
        </view>

      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:if="{{ filteredData.length === 0 }}" class="empty-state">
      <view class="empty-icon">ğŸ”</view>
      <view class="empty-text">æ²¡æœ‰æ‰¾åˆ°ç›¸å…³å†…å®¹</view>
      <view class="empty-hint">è¯·å°è¯•å…¶ä»–å…³é”®è¯</view>
    </view>
  </view>
</view>

<van-toast id="van-toast" />