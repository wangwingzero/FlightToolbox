<view class="audio-player-page">
  <!-- é¡µé¢å¤´éƒ¨ - æ¸å˜èƒŒæ™¯ -->
  <view class="page-header">
    <view class="header-title">ğŸ§ èˆªçº¿å½•éŸ³å­¦ä¹ </view>
    <view class="header-subtitle">{{ regionName }} Â· {{ categoryName }}</view>
    <view class="header-progress">
      <text class="progress-text">ç¬¬ {{ clipIndex + 1 }} / {{ allClips.length }} æ®µ</text>
    </view>
  </view>

  <!-- ä¸»æ’­æ”¾å™¨å¡ç‰‡ - æµ®åŠ¨æ•ˆæœ -->
  <view class="main-player-card">
    <!-- å½•éŸ³ä¿¡æ¯å±•ç¤º -->
    <view class="audio-info">
      <view class="audio-number-badge">NO.{{ clipIndex + 1 }}</view>
      <view class="audio-label">{{ currentClip.label }}</view>
      
      <!-- å¯ç‚¹å‡»çš„å½•éŸ³æ–‡æœ¬åŒºåŸŸ -->
      <view class="audio-transcript" bind:tap="toggleTranscript" hover-class="none">
        <view wx:if="{{ !showTranscript }}" class="transcript-hint">
          <text class="hint-icon">ğŸ“</text>
          <text class="hint-text">ç‚¹å‡»æŸ¥çœ‹å½•éŸ³æ–‡æœ¬</text>
        </view>
        <view wx:else class="transcript-content">
          {{ currentClip.full_transcript }}
        </view>
      </view>
    </view>

    <!-- è¿›åº¦æ¡åŒºåŸŸ - Apple Music é£æ ¼ -->
    <view class="progress-section">
      <view class="progress-bar-wrapper">
        <view class="progress-bar">
          <view class="progress-fill" style="width: {{ audioProgress }}%">
            <view class="progress-dot"></view>
          </view>
        </view>
      </view>
      <view class="time-display">
        <text class="current-time">{{ currentTimeText }}</text>
        <text class="total-time">{{ totalTimeText }}</text>
      </view>
    </view>

    <!-- ä¸»æ§åˆ¶åŒº - åœ†å½¢æŒ‰é’® -->
    <view class="main-controls">
      <!-- ä¸Šä¸€æ®µæŒ‰é’® -->
      <view class="control-button secondary" bind:tap="previousClip" hover-class="none">
        <view class="button-icon">â®</view>
      </view>

      <!-- æ’­æ”¾/æš‚åœæŒ‰é’® -->
      <view class="control-button primary {{ isPlaying ? 'playing' : 'paused' }}" bind:tap="togglePlayPause" hover-class="none">
        <view class="button-icon play-icon">{{ isPlaying ? 'â¸' : 'â–¶ï¸' }}</view>
      </view>

      <!-- ä¸‹ä¸€æ®µæŒ‰é’® -->
      <view class="control-button secondary" bind:tap="nextClip" hover-class="none">
        <view class="button-icon">â­</view>
      </view>
    </view>
  </view>

  <!-- åŠŸèƒ½å¡ç‰‡åŒºåŸŸ -->
  <view class="function-cards">
    <!-- å­¦ä¹ çŠ¶æ€å¡ç‰‡ -->
    <view class="function-card {{ currentClip.isLearned ? 'learned' : 'unlearned' }}" bind:tap="toggleCurrentClipLearned" hover-class="none">
      <view class="card-icon">{{ currentClip.isLearned ? 'âœ“' : 'â—‹' }}</view>
      <view class="card-content">
        <view class="card-title">{{ currentClip.isLearned ? 'å·²å­¦ä¼š' : 'å¾…å­¦ä¹ ' }}</view>
        <view class="card-hint">ç‚¹å‡»æ ‡è®°çŠ¶æ€</view>
      </view>
    </view>

    <!-- å¾ªç¯æ’­æ”¾å¡ç‰‡ -->
    <view class="function-card {{ isLooping ? 'active' : '' }}" bind:tap="toggleLoop" hover-class="none">
      <view class="card-icon">ğŸ”</view>
      <view class="card-content">
        <view class="card-title">{{ isLooping ? 'å¾ªç¯å¼€å¯' : 'å•æ¬¡æ’­æ”¾' }}</view>
        <view class="card-hint">ç‚¹å‡»åˆ‡æ¢æ¨¡å¼</view>
      </view>
    </view>
  </view>

  <!-- æ’­æ”¾è®¾ç½®åŒºåŸŸ -->
  <view class="settings-card">
    <view class="settings-header">
      <text class="settings-title">ğŸ”Š æ’­æ”¾è®¾ç½®</text>
    </view>

    <!-- éŸ³é‡æ§åˆ¶ -->
    <view class="setting-item">
      <view class="setting-label">
        <text class="label-text">éŸ³é‡</text>
        <text class="label-value">{{ volume }}%</text>
      </view>
      <slider 
        class="volume-slider"
        value="{{ volume }}" 
        min="0" 
        max="100" 
        block-size="24"
        bind:change="onVolumeChange"
        activeColor="#5856D6"
        backgroundColor="#E5E5EA"
      />
    </view>
  </view>

  <!-- å½•éŸ³åˆ—è¡¨ -->
  <view class="playlist-card">
    <view class="playlist-header">
      <text class="playlist-title">å½•éŸ³åˆ—è¡¨</text>
      <text class="playlist-count">{{ allClips.length }}</text>
    </view>
    <scroll-view class="playlist-content" scroll-y enhanced show-scrollbar="{{false}}">
      <view wx:for="{{ allClips }}" wx:key="index" 
            class="playlist-item {{ clipIndex === index ? 'playing' : '' }} {{ item.isLearned ? 'learned' : '' }}" 
            bind:tap="selectClip" 
            data-index="{{ index }}"
            hover-class="none">
        <view class="item-number">{{ index + 1 }}</view>
        <view class="item-info">
          <view class="item-label">{{ item.label }}</view>
          <view class="item-preview">{{ item.isLearned ? item.full_transcript : 'ç‚¹å‡»å­¦ä¹ ' }}</view>
        </view>
        <view class="item-status">
          <view class="status-badge {{ item.isLearned ? 'learned' : 'unlearned' }}">
            {{ item.isLearned ? 'âœ“' : '' }}
          </view>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- æ¨ªå¹…å¹¿å‘Š -->
  <view wx:if="{{ !isAdFree }}" class="ad-section">
    <ad unit-id="adunit-3a1bf3800fa937a2" ad-type="banner" ad-intervals="30"></ad>
  </view>

  <!-- åº•éƒ¨å®‰å…¨åŒºåŸŸ -->
  <view class="safe-area-bottom"></view>
</view>

<van-toast id="van-toast" />