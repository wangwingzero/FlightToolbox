<view class="container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <view class="header-title">ğŸ§ å½•éŸ³æ’­æ”¾</view>
    <view class="header-subtitle">{{ regionName }} - {{ categoryName }}</view>
  </view>

  <!-- å½•éŸ³ä¿¡æ¯å¡ç‰‡ -->
  <view class="audio-info-card">
    <view class="info-header">
      <view class="clip-number-large">{{ clipIndex + 1 }}</view>
      <view class="learned-status-large" bind:tap="toggleCurrentClipLearned">
        {{ currentClip.isLearned ? 'âœ… å·²å­¦ä¼š' : 'âŒ æœªå­¦ä¼š' }}
      </view>
    </view>
    
    <view class="info-content">
      <view class="clip-label-large">{{ currentClip.label }}</view>
      <view class="clip-title-large">{{ currentClip.isLearned ? currentClip.full_transcript : '???' }}</view>
      <view class="clip-subtitle-large">{{ currentClip.isLearned ? currentClip.translation_cn : 'è¯·å…ˆå­¦ä¹ è¿™æ®µå½•éŸ³' }}</view>
    </view>
  </view>


  <!-- æ’­æ”¾å™¨æ§åˆ¶é¢æ¿ -->
  <view class="player-controls">
    <!-- éŸ³é¢‘è¿›åº¦æ¡ -->
    <view class="audio-progress">
      <view class="progress-bar">
        <view class="progress-fill" style="width: {{ audioProgress }}%"></view>
      </view>
      <view class="progress-time">
        <text class="current-time">{{ currentTimeText }}</text>
        <text class="total-time">{{ totalTimeText }}</text>
      </view>
    </view>

    <!-- æ’­æ”¾æ§åˆ¶æŒ‰é’® -->
    <view class="control-buttons">
      <view class="control-btn" bind:tap="previousClip">â®ï¸</view>
      <view class="control-btn play-pause-large" bind:tap="togglePlayPause">
        {{ isPlaying ? 'â¸ï¸' : 'â–¶ï¸' }}
      </view>
      <view class="control-btn" bind:tap="nextClip">â­ï¸</view>
      <view class="control-btn {{ isLooping ? 'active' : '' }}" bind:tap="toggleLoop">ğŸ”</view>
    </view>

    <!-- éŸ³é‡æ§åˆ¶ -->
    <view class="volume-control">
      <view class="volume-label">ğŸ”Š éŸ³é‡ {{ volume }}%</view>
      <slider 
        value="{{ volume }}" 
        min="0" 
        max="100" 
        bind:change="onVolumeChange"
        activeColor="#3B82F6"
        backgroundColor="#E5E7EB"
      />
    </view>

    <!-- åŠŸèƒ½å¼€å…³ -->
    <view class="feature-controls">
      <!-- å­—å¹•æ˜¾ç¤ºæ§åˆ¶ -->
      <view class="control-item">
        <view class="control-label">å­—å¹•æ˜¾ç¤º</view>
        <switch 
          checked="{{ showSubtitles }}" 
          bind:change="toggleSubtitles"
          color="#3B82F6"
        />
      </view>

    </view>

    <!-- è¯­è¨€é€‰æ‹© -->
    <view wx:if="{{ showSubtitles }}" class="language-selector">
      <view 
        class="lang-btn {{ subtitleLang === 'en' ? 'active' : '' }}" 
        bind:tap="selectSubtitleLang" 
        data-lang="en"
      >English</view>
      <view 
        class="lang-btn {{ subtitleLang === 'cn' ? 'active' : '' }}" 
        bind:tap="selectSubtitleLang" 
        data-lang="cn"
      >ä¸­æ–‡</view>
    </view>
  </view>

  <!-- å­—å¹•æ˜¾ç¤ºåŒºåŸŸ -->
  <view wx:if="{{ showSubtitles }}" class="subtitle-display">
    <view class="subtitle-text">
      {{ subtitleLang === 'en' ? currentClip.full_transcript : currentClip.translation_cn }}
    </view>
  </view>

  <!-- å½•éŸ³åˆ—è¡¨é¢„è§ˆ -->
  <view class="clips-preview">
    <view class="preview-header">
      <view class="preview-title">å½•éŸ³åˆ—è¡¨ ({{ allClips.length }})</view>
    </view>
    <view class="clips-list">
      <view wx:for="{{ allClips }}" wx:key="index" 
            class="clip-preview-item {{ clipIndex === index ? 'active' : '' }}" 
            bind:tap="selectClip" 
            data-index="{{ index }}">
        <view class="preview-number">{{ index + 1 }}</view>
        <view class="preview-content">
          <view class="preview-label">{{ item.label }}</view>
          <view class="preview-title">{{ item.isLearned ? item.full_transcript : '???' }}</view>
        </view>
        <view class="preview-status">
          {{ item.isLearned ? 'âœ…' : 'âŒ' }}
        </view>
      </view>
    </view>
  </view>

</view>

<van-toast id="van-toast" />