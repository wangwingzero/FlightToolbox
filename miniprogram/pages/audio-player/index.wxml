<view class="audio-player-page">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <view class="header-title">èˆªçº¿å½•éŸ³å­¦ä¹ </view>
    <view class="header-subtitle">{{ regionName }} - {{ categoryName }}</view>
    <view class="header-progress">
      <text class="progress-text">ç¬¬ {{ clipIndex + 1 }} / {{ allClips.length }} æ®µ</text>
    </view>
  </view>

  <!-- ä¸»æ’­æ”¾å™¨å¡ç‰‡ -->
  <view class="main-player-card">
    <!-- å½•éŸ³ä¿¡æ¯å±•ç¤º - å¯ç‚¹å‡»æ˜¾ç¤ºå­—å¹• -->
    <view class="audio-info">
      <view class="audio-number-badge">NO.{{ clipIndex + 1 }}</view>
      <view class="audio-label">{{ currentClip.label }}</view>
      
      <!-- å¯ç‚¹å‡»çš„å½•éŸ³æ–‡æœ¬åŒºåŸŸ -->
      <view class="audio-transcript" bind:tap="toggleTranscript">
        <view wx:if="{{ !showTranscript }}" class="transcript-hint">
          <text class="hint-icon">ğŸ‘†</text>
          <text class="hint-text">ç‚¹å‡»æ­¤å¤„æŸ¥çœ‹å½•éŸ³æ–‡æœ¬</text>
        </view>
        <view wx:else class="transcript-content">
          {{ currentClip.full_transcript }}
        </view>
      </view>
    </view>

    <!-- è¿›åº¦æ¡åŒºåŸŸ -->
    <view class="progress-section">
      <view class="progress-bar-wrapper">
        <view class="progress-bar">
          <view class="progress-fill" style="width: {{ audioProgress }}%">
            <view class="progress-dot"></view>
          </view>
        </view>
      </view>
      <view class="time-display">
        <text class="current-time">{{ currentTimeText }}</text>
        <text class="total-time">{{ totalTimeText }}</text>
      </view>
    </view>

    <!-- ä¸»æ§åˆ¶åŒº -->
    <view class="main-controls">
      <!-- ä¸Šä¸€é¦–æŒ‰é’® -->
      <view class="control-button secondary" bind:tap="previousClip">
        <view class="button-icon">â—€</view>
        <view class="button-label">ä¸Šä¸€æ®µ</view>
      </view>

      <!-- æ’­æ”¾/æš‚åœæŒ‰é’® -->
      <view class="control-button primary {{ isPlaying ? 'playing' : 'paused' }}" bind:tap="togglePlayPause">
        <view class="button-icon play-icon">{{ isPlaying ? 'âšâš' : 'â–¶' }}</view>
        <view class="button-label">{{ isPlaying ? 'æš‚åœ' : 'æ’­æ”¾' }}</view>
      </view>

      <!-- ä¸‹ä¸€é¦–æŒ‰é’® -->
      <view class="control-button secondary" bind:tap="nextClip">
        <view class="button-icon">â–¶</view>
        <view class="button-label">ä¸‹ä¸€æ®µ</view>
      </view>
    </view>
  </view>

  <!-- åŠŸèƒ½å¡ç‰‡åŒºåŸŸ -->
  <view class="function-cards">
    <!-- å­¦ä¹ çŠ¶æ€å¡ç‰‡ -->
    <view class="function-card {{ currentClip.isLearned ? 'learned' : 'unlearned' }}" bind:tap="toggleCurrentClipLearned">
      <view class="card-icon">{{ currentClip.isLearned ? 'âœ“' : 'â—‹' }}</view>
      <view class="card-content">
        <view class="card-title">{{ currentClip.isLearned ? 'å·²å­¦ä¼š' : 'æœªå­¦ä¼š' }}</view>
        <view class="card-hint">ç‚¹å‡»åˆ‡æ¢å­¦ä¹ çŠ¶æ€</view>
      </view>
    </view>

    <!-- å¾ªç¯æ’­æ”¾å¡ç‰‡ -->
    <view class="function-card {{ isLooping ? 'active' : '' }}" bind:tap="toggleLoop">
      <view class="card-icon">ğŸ”</view>
      <view class="card-content">
        <view class="card-title">{{ isLooping ? 'å¾ªç¯å·²å¼€å¯' : 'å•æ¬¡æ’­æ”¾' }}</view>
        <view class="card-hint">ç‚¹å‡»åˆ‡æ¢å¾ªç¯æ¨¡å¼</view>
      </view>
    </view>
  </view>

  <!-- é«˜çº§è®¾ç½®åŒºåŸŸ -->
  <view class="settings-card">
    <view class="settings-header">
      <text class="settings-title">æ’­æ”¾è®¾ç½®</text>
    </view>

    <!-- éŸ³é‡æ§åˆ¶ -->
    <view class="setting-item">
      <view class="setting-label">
        <text class="label-icon">ğŸ”Š</text>
        <text class="label-text">éŸ³é‡</text>
        <text class="label-value">{{ volume }}%</text>
      </view>
      <slider 
        class="volume-slider"
        value="{{ volume }}" 
        min="0" 
        max="100" 
        block-size="20"
        bind:change="onVolumeChange"
        activeColor="#3B82F6"
        backgroundColor="#E5E7EB"
      />
    </view>
  </view>

  <!-- å½•éŸ³åˆ—è¡¨ -->
  <view class="playlist-card">
    <view class="playlist-header">
      <text class="playlist-title">ğŸ“‹ å½•éŸ³åˆ—è¡¨</text>
      <text class="playlist-count">å…± {{ allClips.length }} æ®µ</text>
    </view>
    <view class="playlist-content">
      <view wx:for="{{ allClips }}" wx:key="index" 
            class="playlist-item {{ clipIndex === index ? 'playing' : '' }} {{ item.isLearned ? 'learned' : '' }}" 
            bind:tap="selectClip" 
            data-index="{{ index }}">
        <view class="item-number">{{ index + 1 }}</view>
        <view class="item-info">
          <view class="item-label">{{ item.label }}</view>
          <view class="item-preview">{{ item.isLearned ? item.full_transcript : 'æœªå­¦ä¹ ' }}</view>
        </view>
        <view class="item-status">
          <view class="status-badge {{ item.isLearned ? 'learned' : 'unlearned' }}">
            {{ item.isLearned ? 'âœ“' : 'â—‹' }}
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æ¨ªå¹…å¹¿å‘Š -->
  <view wx:if="{{ !isAdFree }}" class="ad-section">
    <ad unit-id="adunit-d6c8a55bd3cb4fd1" ad-intervals="30" bindload="adLoad" binderror="adError" bindclose="adClose"></ad>
  </view>

  <!-- åº•éƒ¨å®‰å…¨åŒºåŸŸ -->
  <view class="safe-area-bottom"></view>
</view>

<van-toast id="van-toast" />