<view class="container" data-theme="{{ isDarkMode ? 'dark' : 'light' }}">
  <!-- é€‰é¡¹å¡ -->
  <van-tabs active="{{ activeTab }}" bind:change="onTabChange" sticky>
    <van-tab title="ç¼©å†™" name="abbreviations"></van-tab>
    <van-tab title="å®šä¹‰" name="definitions"></van-tab>
    <van-tab title="æœºåœº" name="airports"></van-tab>
    <van-tab title="é€šä¿¡" name="communications"></van-tab>
    <van-tab title="è§„ç« " name="normative"></van-tab>
  </van-tabs>

  <!-- ç¼©å†™é¡µé¢ -->
  <view wx:if="{{ activeTab === 'abbreviations' }}">
    <!-- æœç´¢æ¡† -->
    <view class="search-section abbreviations-search">
      <van-search
        value="{{ searchValue }}"
        placeholder="æœç´¢ç®€ç¼©å­—æˆ–ä¸­è‹±æ–‡å«ä¹‰"
        bind:search="onSearch"
        bind:change="onSearchChange"
        bind:clear="onSearchClear"
        use-action-slot
      >
        <view slot="action" bind:tap="onSearch">
          <van-button type="primary" size="small" class="search-action-button">æœç´¢</van-button>
        </view>
      </van-search>
    </view>

    <!-- ğŸ¯ åŸºäºContext7æœ€ä½³å®è·µï¼šé¡¶éƒ¨å¹¿å‘Šä½ï¼ˆæœç´¢æ ä¸‹æ–¹ï¼‰ -->
    <view wx:if="{{ showTopAd && !userPreferences.reduceAds }}" class="ad-section top-ad">
      <text class="ad-label">å¹¿å‘Š</text>
      <ad-template 
        unit-id="{{ topAdUnitId }}"
        ad-type="custom"
        data-ad-type="Top"
        data-ad-unit-id="{{ topAdUnitId }}"
        bind:adload="onAdLoad"
        bind:aderror="onAdError"
      />
    </view>

    <!-- ç¬¬ä¸€çº§ï¼šå­—æ¯åˆ†ç»„åˆ—è¡¨ -->
    <view wx:if="{{ showAbbreviationGroups }}" class="letter-groups-section">
      <view class="section-title">
        <van-icon name="apps" size="16px" />
        æŒ‰é¦–å­—æ¯æµè§ˆ
      </view>
      
      <!-- åŠ¨æ€æ˜¾ç¤ºå­—æ¯åˆ†ç»„ï¼Œæ”¯æŒSå’ŒTä¹‹é—´æ’å…¥å¹¿å‘Š -->
      <block wx:for="{{ abbreviationGroups }}" wx:key="letter">
        <!-- æ˜¾ç¤ºå­—æ¯å®¹å™¨ -->
        <view 
          class="custom-letter-item abbreviation-letter-item"
          data-letter="{{ item.letter }}"
          bind:tap="onAbbreviationLetterTap"
        >
          <view class="letter-icon-large">{{ item.letter }}</view>
          <view class="letter-content">
            <view class="letter-title">å­—æ¯ {{ item.letter }}</view>
            <view class="letter-subtitle">{{ item.count }}æ¡ç¼©å†™</view>
          </view>
          <view class="letter-count">{{ item.count }}æ¡</view>
          <view class="letter-arrow">
            <van-icon name="arrow" size="16px" />
          </view>
        </view>

        <!-- ğŸ¯ åŸºäºContext7æœ€ä½³å®è·µï¼šåœ¨å­—æ¯Råæ’å…¥å¹¿å‘Šï¼ˆRå’ŒSä¹‹é—´ï¼‰ -->
        <view wx:if="{{ item.letter === 'R' && showRSMiddleAd && !userPreferences.reduceAds }}" class="ad-section rs-middle-ad">
          <text class="ad-label">å¹¿å‘Š</text>
          <ad-template 
            unit-id="{{ rsMiddleAdUnitId }}"
            ad-type="custom"
            data-ad-type="RSMiddle"
            data-ad-unit-id="{{ rsMiddleAdUnitId }}"
            bind:adload="onAdLoad"
            bind:aderror="onAdError"
          />
        </view>

        <!-- ğŸ¯ åŸºäºContext7æœ€ä½³å®è·µï¼šåœ¨å­—æ¯Såæ’å…¥å¹¿å‘Šï¼ˆSå’ŒTä¹‹é—´ï¼‰ -->
        <view wx:if="{{ item.letter === 'S' && showSTMiddleAd && !userPreferences.reduceAds }}" class="ad-section st-middle-ad">
          <text class="ad-label">å¹¿å‘Š</text>
          <ad-template 
            unit-id="{{ stMiddleAdUnitId }}"
            ad-type="custom"
            data-ad-type="STMiddle"
            data-ad-unit-id="{{ stMiddleAdUnitId }}"
            bind:adload="onAdLoad"
            bind:aderror="onAdError"
          />
        </view>
      </block>

      <!-- ç»Ÿè®¡ä¿¡æ¯ -->
      <view class="stats-section">
        <view class="stats-item">
          <text class="stats-number">{{ abbreviationsList.length }}</text>
          <text class="stats-label">æ¡ç¼©å†™</text>
        </view>
        <view class="stats-item">
          <text class="stats-number">{{ abbreviationGroups.length }}</text>
          <text class="stats-label">ä¸ªå­—æ¯ç»„</text>
        </view>
      </view>

      <!-- ğŸ¯ åŸºäºContext7æœ€ä½³å®è·µï¼šå­—æ¯åˆ†ç»„é¡µé¢å¹¿å‘Šï¼ˆç¬¬ä¸€çº§ï¼‰ -->
      <view wx:if="{{ showLetterGroupsAd && !userPreferences.reduceAds }}" class="ad-section letter-groups-ad">
        <text class="ad-label">å¹¿å‘Š</text>
        <ad-template 
          unit-id="{{ letterGroupsAdUnitId }}"
          ad-type="custom"
          data-ad-type="LetterGroups"
          data-ad-unit-id="{{ letterGroupsAdUnitId }}"
          bind:adload="onAdLoad"
          bind:aderror="onAdError"
        />
      </view>
    </view>

    <!-- ç¬¬äºŒçº§ï¼šå…·ä½“æ¡ç›®åˆ—è¡¨ -->
    <view wx:if="{{ showAbbreviationItems }}" class="items-section context7-secondary-page">
      <!-- Context7é£æ ¼çš„å¯¼èˆªæ  -->
      <view class="context7-nav-header">
        <view class="nav-back-button" bindtap="backToAbbreviationGroups">
          <van-icon name="arrow-left" size="20px" />
          <text class="nav-back-text">è¿”å›</text>
        </view>
        <view class="nav-title">
          <text class="nav-title-main">å­—æ¯ {{ selectedAbbreviationLetter }}</text>
                          <text class="nav-title-sub">{{ currentLetterAbbreviations.length }}æ¡ç¼©å†™</text>
        </view>
        <view class="nav-actions">
          <van-icon name="search" size="18px" class="nav-action-icon" />
        </view>
      </view>



      <!-- æ¡ç›®åˆ—è¡¨ -->
      <view class="context7-content-container">
        <view class="context7-card-wrapper">
          <view 
            wx:for="{{ currentLetterAbbreviations }}"
            wx:key="id"
            class="context7-item-card abbreviation-item-card"
            bind:click="showAbbreviationDetail"
            data-item="{{ item }}"
          >
            <!-- ğŸ¯ åŸºäºContext7æœ€ä½³å®è·µï¼šåœ¨åˆ—è¡¨ä¸­é—´æ’å…¥å¹¿å‘Šï¼ˆæ¯8ä¸ªæ¡ç›®åï¼‰ -->
            <view wx:if="{{ (index + 1) % 8 === 0 && showMiddleAd && !userPreferences.reduceAds }}" class="ad-section middle-ad">
              <text class="ad-label">å¹¿å‘Š</text>
              <ad-template 
                unit-id="{{ middleAdUnitId }}"
                ad-type="custom"
                data-ad-type="Middle"
                data-ad-unit-id="{{ middleAdUnitId }}"
                bind:adload="onAdLoad"
                bind:aderror="onAdError"
              />
            </view>
            <view class="item-card-header">
              <view class="item-primary">
                <text class="item-abbreviation">{{ item.abbreviation }}</text>
                <view class="item-badges">
                  <view class="context7-badge icao-content" wx:if="{{ item.icao_code }}">
                    <van-icon name="bookmark" size="12px" />
                    <text>ICAO</text>
                  </view>
                  <view class="context7-badge iata-content" wx:if="{{ item.iata_code }}">
                    <van-icon name="certificate" size="12px" />
                    <text>IATA</text>
                  </view>
                </view>
              </view>
              <van-icon name="arrow" size="16px" class="item-arrow" />
            </view>
            <view class="item-card-content">
              <text class="item-english">{{ item.english_full }}</text>
              <text class="item-chinese">{{ item.chinese_translation }}</text>
            </view>
            <view class="item-card-footer">
              <view class="item-meta">
                <van-icon name="notes" size="12px" />
                <text class="meta-text">{{ item.is_icao ? 'æ¥æºï¼šICAO' : 'æ¥æºï¼šæœºå‹æ‰‹å†Œ' }}</text>
              </view>
            </view>
          </view>
        </view>


      </view>
    </view>

    <!-- æœç´¢ç»“æœåˆ—è¡¨ -->
    <view wx:if="{{ !showAbbreviationGroups && !showAbbreviationItems && searchValue }}" class="search-results-section">
      <van-cell-group wx:if="{{ filteredList.length > 0 }}" title="æœç´¢ç»“æœ ({{ filteredList.length }}æ¡ç®€ç¼©å­—)">
        <van-cell
          wx:for="{{ filteredList }}"
          wx:key="id"
          title="{{ item.abbreviation }}"
          label="{{ item.english_full }} - {{ item.chinese_translation }}"
          border="{{ false }}"
          class="abbreviation-cell"
          bind:click="showAbbreviationDetail"
          data-item="{{ item }}"
          is-link
        >
          <view slot="right-icon">
            <van-tag 
              wx:if="{{ item.icao_code }}"
              type="primary" 
              size="medium"
            >
              ICAO
            </van-tag>
            <van-tag 
              wx:if="{{ item.iata_code }}"
              type="success" 
              size="medium"
            >
              IATA
            </van-tag>
          </view>
        </van-cell>
      </van-cell-group>

      <!-- ğŸ¯ åŸºäºContext7æœ€ä½³å®è·µï¼šåœ¨æœç´¢ç»“æœä¸‹æ–¹æ˜¾ç¤ºå¹¿å‘Š -->
      <view wx:if="{{ filteredList.length > 0 && showSearchResultsAd && !userPreferences.reduceAds }}" class="ad-section search-results-ad">
        <text class="ad-label">å¹¿å‘Š</text>
        <ad-template 
          unit-id="{{ searchResultsAdUnitId }}"
          ad-type="custom"
          data-ad-type="SearchResults"
          data-ad-unit-id="{{ searchResultsAdUnitId }}"
          bind:adload="onAdLoad"
          bind:aderror="onAdError"
        />
      </view>

      <!-- æœç´¢æ— ç»“æœ -->
      <van-empty
        wx:if="{{ filteredList.length === 0 && searchValue }}"
        description="æœªæ‰¾åˆ°ç›¸å…³ç®€ç¼©å­—"
      />
    </view>

    <!-- åŠ è½½çŠ¶æ€ -->
    <van-empty
      wx:if="{{ abbreviationGroups.length === 0 && !searchValue }}"
      description="åŠ è½½ä¸­..."
    />
  </view>

  <!-- å®šä¹‰é¡µé¢ -->
  <view wx:if="{{ activeTab === 'definitions' }}">
    <!-- æœç´¢æ¡† -->
    <view class="search-section definitions-search">
      <van-search
        value="{{ definitionSearchValue }}"
        placeholder="æœç´¢å®šä¹‰æˆ–æœ¯è¯­"
        bind:search="onDefinitionSearch"
        bind:change="onDefinitionSearchChange"
        bind:clear="onDefinitionSearchClear"
        use-action-slot
      >
        <view slot="action" bind:tap="onDefinitionSearch">
          <van-button type="primary" size="small" class="search-action-button">æœç´¢</van-button>
        </view>
      </van-search>
    </view>

    <!-- ğŸ¯ åŸºäºContext7æœ€ä½³å®è·µï¼šé¡¶éƒ¨å¹¿å‘Šä½ï¼ˆæœç´¢æ ä¸‹æ–¹ï¼‰ -->
    <view wx:if="{{ showTopAd && !userPreferences.reduceAds }}" class="ad-section top-ad">
      <text class="ad-label">å¹¿å‘Š</text>
      <ad-template 
        unit-id="{{ topAdUnitId }}"
        ad-type="custom"
        data-ad-type="Top"
        data-ad-unit-id="{{ topAdUnitId }}"
        bind:adload="onAdLoad"
        bind:aderror="onAdError"
      />
    </view>

    <!-- å­—æ¯åˆ†ç»„åˆ—è¡¨ -->
    <view wx:if="{{ showDefinitionGroups }}" class="letter-groups-section">
      <view class="section-title">æŒ‰æ‹¼éŸ³é¦–å­—æ¯æµè§ˆ</view>
      
      <!-- åŠ¨æ€æ˜¾ç¤ºå­—æ¯åˆ†ç»„ï¼Œæ”¯æŒIå’ŒJä¹‹é—´æ’å…¥å¹¿å‘Š -->
      <block wx:for="{{ definitionGroups }}" wx:key="letter">
        <!-- æ˜¾ç¤ºå­—æ¯å®¹å™¨ -->
        <view 
          class="custom-letter-item definition-letter-item"
          data-letter="{{ item.letter }}"
          bind:tap="onDefinitionLetterTap"
        >
          <view class="letter-icon-large">{{ item.letter }}</view>
          <view class="letter-content">
            <view class="letter-title">å­—æ¯ {{ item.letter }}</view>
            <view class="letter-subtitle">ä»¥ {{ item.letter }} å¼€å¤´çš„å®šä¹‰</view>
          </view>
          <view class="letter-count">{{ item.count }}æ¡</view>
          <view class="letter-arrow">></view>
        </view>

        <!-- ğŸ¯ åŸºäºContext7æœ€ä½³å®è·µï¼šåœ¨å­—æ¯Iåæ’å…¥å¹¿å‘Šï¼ˆIå’ŒJä¹‹é—´ï¼‰ -->
        <view wx:if="{{ item.letter === 'I' && showDefinitionIJMiddleAd && !userPreferences.reduceAds }}" class="ad-section definition-ij-middle-ad">
          <text class="ad-label">å¹¿å‘Š</text>
          <ad-template 
            unit-id="{{ definitionIJMiddleAdUnitId }}"
            ad-type="custom"
            data-ad-type="DefinitionIJMiddle"
            data-ad-unit-id="{{ definitionIJMiddleAdUnitId }}"
            bind:adload="onAdLoad"
            bind:aderror="onAdError"
          />
        </view>
      </block>

      <!-- ç»Ÿè®¡ä¿¡æ¯ -->
      <view class="stats-section">
        <view class="stats-item">
          <text class="stats-number">{{ definitionsList.length }}</text>
          <text class="stats-label">ä¸ªå®šä¹‰</text>
        </view>
        <view class="stats-item">
          <text class="stats-number">{{ definitionGroups.length }}</text>
          <text class="stats-label">ä¸ªå­—æ¯ç»„</text>
        </view>
      </view>

      <!-- ğŸ¯ åŸºäºContext7æœ€ä½³å®è·µï¼šå®šä¹‰é¡µé¢åº•éƒ¨å¹¿å‘Š -->
      <view wx:if="{{ showDefinitionBottomAd && !userPreferences.reduceAds }}" class="ad-section definition-bottom-ad">
        <text class="ad-label">å¹¿å‘Š</text>
        <ad-template 
          unit-id="{{ definitionBottomAdUnitId }}"
          ad-type="custom"
          data-ad-type="DefinitionBottom"
          data-ad-unit-id="{{ definitionBottomAdUnitId }}"
          bind:adload="onAdLoad"
          bind:aderror="onAdError"
        />
      </view>
    </view>

    <!-- å…·ä½“å­—æ¯ç»„çš„å®šä¹‰åˆ—è¡¨ - Context7é«˜ç«¯UXè®¾è®¡ -->
    <view wx:if="{{ !showDefinitionGroups && selectedDefinitionLetter }}" class="letter-detail-section context7-secondary-page">
      <!-- Context7é£æ ¼çš„è¿”å›å¯¼èˆªæ  -->
      <view class="context7-nav-header">
        <view class="nav-back-button" bindtap="backToDefinitionGroups">
          <van-icon name="arrow-left" size="20px" />
          <text class="nav-back-text">è¿”å›</text>
        </view>
        <view class="nav-title">
          <text class="nav-title-main">å­—æ¯ {{ selectedDefinitionLetter }}</text>
          <text class="nav-title-sub">{{ currentLetterDefinitions.length }}ä¸ªå®šä¹‰</text>
        </view>
        <view class="nav-actions">
          <van-icon name="search" size="18px" class="nav-action-icon" />
        </view>
      </view>

      <!-- Context7é£æ ¼çš„å†…å®¹å¡ç‰‡ -->
      <view class="context7-content-container">
        <view class="context7-card-wrapper">
          <view 
            wx:for="{{ currentLetterDefinitions }}"
            wx:key="id"
            class="context7-item-card definition-item-card"
            bind:click="showDefinitionDetail"
            data-item="{{ item }}"
          >
            <view class="item-card-header">
              <view class="item-primary">
                <!-- Context7æ ‡ç­¾ä¼˜åŒ– - æ¥æºä¿¡æ¯æ›´æ¸…æ™° -->
                <view class="item-badges">
                  <view class="item-source-tag">
                    <van-icon name="bookmark" size="12px" class="tag-icon" />
                    <text>{{ item.source }}</text>
                  </view>
                </view>
              </view>
              <van-icon name="arrow" size="16px" class="item-arrow" />
            </view>
            <view class="item-card-content">
              <!-- Context7ä¸­æ–‡ä¼˜å…ˆè®¾è®¡ - ä¸­æ–‡å®šä¹‰ä½œä¸ºä¸»è¦å†…å®¹ -->
              <text class="item-chinese-main">{{ item.chinese_name }}</text>
              <!-- è‹±æ–‡ä½œä¸ºæ¬¡è¦å¯¹ç…§ä¿¡æ¯ -->
              <text class="item-english-secondary">{{ item.english_name }}</text>
              <!-- è¯¦ç»†å®šä¹‰ç”¨é»„è‰²é«˜äº®çªå‡ºæ˜¾ç¤º -->
              <text class="item-definition-highlight" wx:if="{{ item.definition }}">{{ item.definition }}</text>
            </view>
            <view class="item-card-footer">
              <view class="item-meta">
                <van-icon name="notes" size="12px" />
                <text class="meta-text">ã€Šæ°‘èˆªæœ¯è¯­å®šä¹‰ï¼ˆè¯•è¡Œï¼‰ã€‹ï¼ˆæ°‘èˆªå‡½ã€”2025ã€•340å·ï¼‰</text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- æœç´¢ç»“æœåˆ—è¡¨ -->
    <view wx:if="{{ !showDefinitionGroups && definitionSearchValue }}" class="search-results-section">
      <van-cell-group wx:if="{{ filteredDefinitions.length > 0 }}" title="æœç´¢ç»“æœ ({{ filteredDefinitions.length }}ä¸ªå®šä¹‰)">
        <van-cell
          wx:for="{{ filteredDefinitions }}"
          wx:key="id"
          border="{{ false }}"
          class="definition-cell"
          bind:click="showDefinitionDetail"
          data-item="{{ item }}"
          is-link
        >
          <!-- Context7ä¸­æ–‡ä¼˜å…ˆæ ‡é¢˜ -->
          <view slot="title" class="definition-cell-title">
            <text class="chinese-title-main">{{ item.chinese_name }}</text>
          </view>
          <!-- è‹±æ–‡ä½œä¸ºæ ‡ç­¾æ˜¾ç¤º -->
          <view slot="label" class="definition-cell-label">
            <text class="english-subtitle">{{ item.english_name }}</text>
          </view>
          <view slot="right-icon">
            <van-tag 
              type="success" 
              size="medium"
            >
              {{ item.source }}
            </van-tag>
          </view>
        </van-cell>
      </van-cell-group>

      <!-- æœç´¢æ— ç»“æœ -->
      <van-empty
        wx:if="{{ filteredDefinitions.length === 0 && definitionSearchValue }}"
        description="æœªæ‰¾åˆ°ç›¸å…³å®šä¹‰"
      />
    </view>

    <!-- åŠ è½½çŠ¶æ€ -->
    <van-empty
      wx:if="{{ definitionGroups.length === 0 && !definitionSearchValue }}"
      description="åŠ è½½ä¸­..."
    />
  </view>

  <!-- æœºåœºé¡µé¢ -->
  <view wx:if="{{ activeTab === 'airports' }}">
    <!-- æœç´¢æ¡† -->
    <view class="search-section airports-search">
      <van-search
        value="{{ airportSearchValue }}"
        placeholder="æœç´¢æœºåœºä»£ç ã€åç§°æˆ–å›½å®¶"
        bind:search="onAirportSearch"
        bind:change="onAirportSearchChange"
        bind:clear="onAirportSearchClear"
        use-action-slot
      >
        <view slot="action" bind:tap="onAirportSearch">
          <van-button type="primary" size="small" class="search-action-button">æœç´¢</van-button>
        </view>
      </van-search>
    </view>

    <!-- ğŸ¯ åŸºäºContext7æœ€ä½³å®è·µï¼šé¡¶éƒ¨å¹¿å‘Šä½ï¼ˆæœç´¢æ ä¸‹æ–¹ï¼‰ -->
    <view wx:if="{{ showTopAd && !userPreferences.reduceAds }}" class="ad-section top-ad">
      <text class="ad-label">å¹¿å‘Š</text>
      <ad-template 
        unit-id="{{ topAdUnitId }}"
        ad-type="custom"
        data-ad-type="Top"
        data-ad-unit-id="{{ topAdUnitId }}"
        bind:adload="onAdLoad"
        bind:aderror="onAdError"
      />
    </view>

    <!-- æœºåœºå­—æ¯åˆ†ç»„åˆ—è¡¨ -->
    <view wx:if="{{ showAirportGroups }}" class="letter-groups-section">
      <view class="section-title">æŒ‰ICAOä»£ç é¦–å­—æ¯æµè§ˆ</view>
      
      <!-- åŠ¨æ€æ˜¾ç¤ºå­—æ¯åˆ†ç»„ï¼Œæ”¯æŒMå’ŒNä¹‹é—´æ’å…¥å¹¿å‘Š -->
      <block wx:for="{{ airportGroups }}" wx:key="letter">
        <!-- æ˜¾ç¤ºå­—æ¯å®¹å™¨ -->
        <view 
          class="custom-letter-item airport-letter-item"
          data-letter="{{ item.letter }}"
          bind:tap="onAirportLetterTap"
        >
          <view class="letter-icon-large">{{ item.letter }}</view>
          <view class="letter-content">
            <view class="letter-title">å­—æ¯ {{ item.letter }}</view>
            <view class="letter-subtitle">ä»¥ {{ item.letter }} å¼€å¤´çš„æœºåœº</view>
          </view>
          <view class="letter-count">{{ item.count }}ä¸ª</view>
          <view class="letter-arrow">></view>
        </view>

        <!-- ğŸ¯ åŸºäºContext7æœ€ä½³å®è·µï¼šåœ¨å­—æ¯Måæ’å…¥å¹¿å‘Šï¼ˆMå’ŒNä¹‹é—´ï¼‰ -->
        <view wx:if="{{ item.letter === 'M' && showAirportMNMiddleAd && !userPreferences.reduceAds }}" class="ad-section airport-mn-middle-ad">
          <text class="ad-label">å¹¿å‘Š</text>
          <ad-template 
            unit-id="{{ airportMNMiddleAdUnitId }}"
            ad-type="custom"
            data-ad-type="AirportMNMiddle"
            data-ad-unit-id="{{ airportMNMiddleAdUnitId }}"
            bind:adload="onAdLoad"
            bind:aderror="onAdError"
          />
        </view>
      </block>

      <!-- ç»Ÿè®¡ä¿¡æ¯ -->
      <view class="stats-section">
        <view class="stats-item">
          <text class="stats-number">{{ airportsList.length }}</text>
          <text class="stats-label">ä¸ªæœºåœº</text>
        </view>
        <view class="stats-item">
          <text class="stats-number">{{ airportGroups.length }}</text>
          <text class="stats-label">ä¸ªå­—æ¯ç»„</text>
        </view>
      </view>

      <!-- ğŸ¯ åŸºäºContext7æœ€ä½³å®è·µï¼šæœºåœºé¡µé¢åº•éƒ¨å¹¿å‘Š -->
      <view wx:if="{{ showAirportBottomAd && !userPreferences.reduceAds }}" class="ad-section airport-bottom-ad">
        <text class="ad-label">å¹¿å‘Š</text>
        <ad-template 
          unit-id="{{ airportBottomAdUnitId }}"
          ad-type="custom"
          data-ad-type="AirportBottom"
          data-ad-unit-id="{{ airportBottomAdUnitId }}"
          bind:adload="onAdLoad"
          bind:aderror="onAdError"
        />
      </view>
    </view>

    <!-- å…·ä½“å­—æ¯ç»„çš„æœºåœºåˆ—è¡¨ - Context7é«˜ç«¯UXè®¾è®¡ -->
    <view wx:if="{{ !showAirportGroups && selectedAirportLetter }}" class="letter-detail-section context7-secondary-page">
      <!-- Context7é£æ ¼çš„è¿”å›å¯¼èˆªæ  -->
      <view class="context7-nav-header">
        <view class="nav-back-button" bindtap="backToAirportGroups">
          <van-icon name="arrow-left" size="20px" />
          <text class="nav-back-text">è¿”å›</text>
        </view>
        <view class="nav-title">
          <text class="nav-title-main">å­—æ¯ {{ selectedAirportLetter }}</text>
          <text class="nav-title-sub">{{ currentLetterAirports.length }}ä¸ªæœºåœº</text>
        </view>
        <view class="nav-actions">
          <van-icon name="search" size="18px" class="nav-action-icon" />
        </view>
      </view>

      <!-- Context7é£æ ¼çš„å†…å®¹å¡ç‰‡ -->
      <view class="context7-content-container">
        <view class="context7-card-wrapper">
          <view 
            wx:for="{{ currentLetterAirports }}"
            wx:key="ICAOCode"
            class="context7-item-card airport-item-card"
            bind:click="showAirportDetail"
            data-item="{{ item }}"
          >
            <view class="item-card-header">
              <view class="item-primary">
                <text class="item-title">{{ item.ShortName }}</text>
                <view class="item-badges">
                  <view class="context7-badge country-badge">
                    <van-icon name="location" size="12px" />
                    <text>{{ item.CountryName }}</text>
                  </view>
                </view>
              </view>
              <van-icon name="arrow" size="16px" class="item-arrow" />
            </view>
            <view class="item-card-content">
              <text class="item-english">{{ item.EnglishName }}</text>
              <view class="airport-codes-grid">
                <view class="code-chip">
                  <text class="code-label">ICAO</text>
                  <text class="code-value">{{ item.ICAOCode }}</text>
                </view>
                <view class="code-chip">
                  <text class="code-label">IATA</text>
                  <text class="code-value">{{ item.IATACode }}</text>
                </view>
              </view>
            </view>
            <view class="item-card-footer">
              <view class="item-meta">
                <van-icon name="flight" size="12px" />
                <text class="meta-text">æœºåœºä¿¡æ¯</text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- æœç´¢ç»“æœåˆ—è¡¨ -->
    <view wx:if="{{ !showAirportGroups && airportSearchValue }}" class="search-results-section">
      <van-cell-group wx:if="{{ filteredAirports.length > 0 }}" title="æœç´¢ç»“æœ ({{ filteredAirports.length }}ä¸ªæœºåœº)">
        <van-cell
          wx:for="{{ filteredAirports }}"
          wx:key="ICAOCode"
          title="{{ item.ShortName }}"
          label="{{ item.EnglishName }}"
          border="{{ false }}"
          class="airport-cell"
          bind:click="showAirportDetail"
          data-item="{{ item }}"
          is-link
        >
          <view slot="value" class="airport-codes">
            <view class="code-item">
              <text class="code-label">ICAO:</text>
              <text class="code-value">{{ item.ICAOCode }}</text>
            </view>
            <view class="code-item">
              <text class="code-label">IATA:</text>
              <text class="code-value">{{ item.IATACode }}</text>
            </view>
          </view>
          <view slot="right-icon">
            <van-tag 
              type="warning" 
              size="medium"
            >
              {{ item.CountryName }}
            </van-tag>
          </view>
        </van-cell>
      </van-cell-group>

      <!-- æœç´¢æ— ç»“æœ -->
      <van-empty
        wx:if="{{ filteredAirports.length === 0 && airportSearchValue }}"
        description="æœªæ‰¾åˆ°ç›¸å…³æœºåœº"
      />
    </view>

    <!-- åŠ è½½çŠ¶æ€ -->
    <van-empty
      wx:if="{{ airportGroups.length === 0 && !airportSearchValue }}"
      description="åŠ è½½ä¸­..."
    />
  </view>

  <!-- é€šä¿¡é¡µé¢ -->
  <view wx:if="{{ activeTab === 'communications' }}">
    <!-- æœç´¢æ¡† -->
    <view class="search-section communications-search">
      <van-search
        value="{{ communicationSearchValue }}"
        placeholder="æœç´¢è‹±è¯­é€šä¿¡æˆ–ä¸­æ–‡å«ä¹‰"
        bind:search="onCommunicationSearch"
        bind:change="onCommunicationSearchChange"
        bind:clear="onCommunicationSearchClear"
        use-action-slot
      >
        <view slot="action" bind:tap="onCommunicationSearch">
          <van-button type="primary" size="small" class="search-action-button">æœç´¢</van-button>
        </view>
      </van-search>
    </view>

    <!-- ğŸ¯ åŸºäºContext7æœ€ä½³å®è·µï¼šé¡¶éƒ¨å¹¿å‘Šä½ï¼ˆæœç´¢æ ä¸‹æ–¹ï¼‰ -->
    <view wx:if="{{ showTopAd && !userPreferences.reduceAds }}" class="ad-section top-ad">
      <text class="ad-label">å¹¿å‘Š</text>
      <ad-template 
        unit-id="{{ topAdUnitId }}"
        ad-type="custom"
        data-ad-type="Top"
        data-ad-unit-id="{{ topAdUnitId }}"
        bind:adload="onAdLoad"
        bind:aderror="onAdError"
      />
    </view>

    <!-- å­—æ¯åˆ†ç»„åˆ—è¡¨ -->
    <view wx:if="{{ showCommunicationGroups }}" class="letter-groups-section">
      <view class="section-title">æŒ‰ç« èŠ‚æµè§ˆ</view>
      
      <!-- åŠ¨æ€æ˜¾ç¤ºç« èŠ‚åˆ†ç»„ï¼Œæ”¯æŒ"å…¶ä»–æœ¯è¯­"å’Œ"çˆ†ç‚¸ç‰©å¨èƒ"ä¹‹é—´æ’å…¥å¹¿å‘Š -->
      <block wx:for="{{ communicationGroups }}" wx:key="letter">
        <!-- æ˜¾ç¤ºç« èŠ‚å®¹å™¨ -->
        <view 
          class="custom-letter-item communication-letter-item"
          data-letter="{{ item.letter }}"
          bind:tap="onCommunicationLetterTap"
        >
          <view class="letter-icon-large">{{ item.letter }}</view>
          <view class="letter-content">
            <view class="letter-title">{{ item.chapterTitle }}</view>
            <view class="letter-subtitle">{{ item.isEmergency ? 'ç‰¹æƒ…åº”æ€¥è¯æ±‡' : 'ICAOè‹±è¯­900å¥' }}</view>
          </view>
          <view class="letter-count">{{ item.count }}å¥</view>
          <view class="letter-arrow">></view>
        </view>
        
        <!-- ğŸ¯ åŸºäºContext7æœ€ä½³å®è·µï¼šåœ¨"å…¶ä»–æœ¯è¯­"ç« èŠ‚åæ’å…¥å¹¿å‘Šï¼ˆä¸"çˆ†ç‚¸ç‰©å¨èƒ"ä¹‹é—´ï¼‰ -->
        <view wx:if="{{ item.letter === 'å…«' && showCommunicationMiddleAd && !userPreferences.reduceAds }}" class="ad-section communication-middle-ad">
          <text class="ad-label">å¹¿å‘Š</text>
          <ad-template 
            unit-id="{{ communicationMiddleAdUnitId }}"
            ad-type="custom"
            data-ad-type="CommunicationMiddle"
            data-ad-unit-id="{{ communicationMiddleAdUnitId }}"
            bind:adload="onAdLoad"
            bind:aderror="onAdError"
          />
        </view>
      </block>

      <!-- ç»Ÿè®¡ä¿¡æ¯ -->
      <view class="stats-section">
        <view class="stats-item">
          <text class="stats-number">{{ communicationsList.length }}</text>
          <text class="stats-label">é¡¹å†…å®¹</text>
        </view>
        <view class="stats-item">
          <text class="stats-number">{{ communicationGroups.length }}</text>
          <text class="stats-label">ä¸ªåˆ†ç±»</text>
        </view>
      </view>
      
      <!-- ğŸ¯ åŸºäºContext7æœ€ä½³å®è·µï¼šé€šä¿¡é¡µé¢åº•éƒ¨å¹¿å‘Š -->
      <view wx:if="{{ showCommunicationBottomAd && !userPreferences.reduceAds }}" class="ad-section communication-bottom-ad">
        <text class="ad-label">å¹¿å‘Š</text>
        <ad-template 
          unit-id="{{ communicationBottomAdUnitId }}"
          ad-type="custom"
          data-ad-type="CommunicationBottom"
          data-ad-unit-id="{{ communicationBottomAdUnitId }}"
          bind:adload="onAdLoad"
          bind:aderror="onAdError"
        />
      </view>
    </view>

    <!-- å…·ä½“å­—æ¯ç»„çš„é€šä¿¡åˆ—è¡¨ - Context7é«˜ç«¯UXè®¾è®¡ -->
    <view wx:if="{{ !showCommunicationGroups && selectedCommunicationLetter }}" class="letter-detail-section context7-secondary-page">
      <!-- Context7é£æ ¼çš„è¿”å›å¯¼èˆªæ  -->
      <view class="context7-nav-header">
        <view class="nav-back-button" bindtap="backToCommunicationGroups">
          <van-icon name="arrow-left" size="20px" />
          <text class="nav-back-text">è¿”å›</text>
        </view>
        <view class="nav-title">
          <text class="nav-title-main">{{ selectedChapterName }}</text>
          <text class="nav-title-sub">{{ currentLetterCommunications.length }}å¥</text>
        </view>
        <view class="nav-actions">
          <van-icon name="search" size="18px" class="nav-action-icon" />
        </view>
      </view>

      <!-- Context7é£æ ¼çš„å†…å®¹å¡ç‰‡ -->
      <view class="context7-content-container">
        <view class="context7-card-wrapper">
          <view 
            wx:for="{{ currentLetterCommunications }}"
            wx:key="id"
            class="context7-item-card communication-item-card"
            bind:click="showCommunicationDetail"
            data-item="{{ item }}"
          >
            <view class="item-card-header">
              <view class="item-primary">
                <text class="item-title">{{ item.english }}</text>
                <view class="item-badges">
                  <view class="context7-badge {{ item.section === 'ç‰¹æƒ…å¸¸ç”¨è¯æ±‡' ? 'emergency-badge' : 'icao-badge' }}">
                    <van-icon name="{{ item.section === 'ç‰¹æƒ…å¸¸ç”¨è¯æ±‡' ? 'warning' : 'certificate' }}" size="12px" />
                    <text>{{ item.section === 'ç‰¹æƒ…å¸¸ç”¨è¯æ±‡' ? 'ç‰¹æƒ…' : 'ICAO' }}</text>
                  </view>
                </view>
              </view>
              <van-icon name="arrow" size="16px" class="item-arrow" />
            </view>
            <view class="item-card-content">
              <text class="item-chinese">{{ item.chinese }}</text>
            </view>
            <view class="item-card-footer">
              <view class="item-meta">
                <van-icon name="voice" size="12px" />
                <text class="meta-text">æ ‡å‡†ç”¨è¯­</text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- æœç´¢ç»“æœåˆ—è¡¨ -->
    <view wx:if="{{ !showCommunicationGroups && communicationSearchValue }}" class="search-results-section">
      <van-cell-group wx:if="{{ filteredCommunications.length > 0 }}" title="æœç´¢ç»“æœ ({{ filteredCommunications.length }}å¥)">
        <van-cell
          wx:for="{{ filteredCommunications }}"
          wx:key="id"
          title="{{ item.english }}"
          label="{{ item.chinese }}"
          border="{{ false }}"
          class="communication-cell"
          bind:click="showCommunicationDetail"
          data-item="{{ item }}"
          is-link
        >
          <view slot="right-icon">
            <van-tag 
              type="{{ item.section === 'ç‰¹æƒ…å¸¸ç”¨è¯æ±‡' ? 'danger' : 'primary' }}" 
              size="medium"
            >
              {{ item.section === 'ç‰¹æƒ…å¸¸ç”¨è¯æ±‡' ? 'ç‰¹æƒ…' : 'ICAO' }}
            </van-tag>
          </view>
        </van-cell>
      </van-cell-group>

      <!-- æœç´¢æ— ç»“æœ -->
      <van-empty
        wx:if="{{ filteredCommunications.length === 0 && communicationSearchValue }}"
        description="æœªæ‰¾åˆ°ç›¸å…³é€šä¿¡ç”¨è¯­"
      />
    </view>

    <!-- åŠ è½½çŠ¶æ€ -->
    <view wx:if="{{ communicationsLoading }}" class="loading-section">
      <van-loading type="spinner" size="24px" text-size="14px">
        æ­£åœ¨åŠ è½½ICAOé€šä¿¡æ•°æ®...
      </van-loading>
    </view>
    
    <van-empty
      wx:if="{{ communicationGroups.length === 0 && !communicationSearchValue && !communicationsLoading }}"
      description="åŠ è½½ä¸­..."
    />
  </view>

  <!-- è§„ç« é¡µé¢ -->
  <view wx:if="{{ activeTab === 'normative' }}">
    <!-- æœç´¢æ¡† -->
    <view class="search-section normative-search">
      <van-search
        value="{{ normativeSearchValue }}"
        placeholder="æœç´¢è§„ç« åˆ¶åº¦æˆ–æ–‡æ¡£ç¼–å·"
        bind:search="onNormativeSearch"
        bind:change="onNormativeSearchChange"
        bind:clear="onNormativeSearchClear"
        use-action-slot
      >
        <view slot="action" bind:tap="onNormativeSearch">
          <van-button type="primary" size="small" class="search-action-button">æœç´¢</van-button>
        </view>
      </van-search>

      <!-- Framework7å®˜æ–¹æ¨èçš„Segmented Strongç­›é€‰æŒ‰é’® -->
      <view class="validity-filter-section">
        <view class="segmented segmented-strong">
          <button 
            class="button button-small-md {{ validityFilter === 'all' ? 'button-active' : '' }}" 
            data-filter="all" 
            bindtap="onValidityFilterChange">
            å…¨éƒ¨
          </button>
          <button 
            class="button button-small-md {{ validityFilter === 'valid' ? 'button-active' : '' }}" 
            data-filter="valid" 
            bindtap="onValidityFilterChange">
            æœ‰æ•ˆ
          </button>
          <button 
            class="button button-small-md {{ validityFilter === 'invalid' ? 'button-active' : '' }}" 
            data-filter="invalid" 
            bindtap="onValidityFilterChange">
            å¤±æ•ˆ
          </button>
          <span class="segmented-highlight"></span>
        </view>
        <view class="filter-stats" wx:if="{{ normativeSearchValue }}">
          ç­›é€‰ç»“æœ: {{ filteredNormativeDocuments.length }}æ¡ 
          <text class="filter-type">({{ validityFilter === 'all' ? 'å…¨éƒ¨' : (validityFilter === 'valid' ? 'æœ‰æ•ˆ' : 'å¤±æ•ˆ') }})</text>
        </view>
      </view>
    </view>

    <!-- ğŸ¯ åŸºäºContext7æœ€ä½³å®è·µï¼šé¡¶éƒ¨å¹¿å‘Šä½ï¼ˆæœç´¢æ ä¸‹æ–¹ï¼‰ -->
    <view wx:if="{{ showTopAd && !userPreferences.reduceAds }}" class="ad-section top-ad">
      <text class="ad-label">å¹¿å‘Š</text>
      <ad-template 
        unit-id="{{ topAdUnitId }}"
        ad-type="custom"
        data-ad-type="Top"
        data-ad-unit-id="{{ topAdUnitId }}"
        bind:adload="onAdLoad"
        bind:aderror="onAdError"
      />
    </view>

    <!-- è§„ç« åˆ†ç±»åˆ—è¡¨ -->
    <view wx:if="{{ showNormativeGroups }}" class="letter-groups-section">
      <view class="section-title">æŒ‰ç±»åˆ«æµè§ˆè§„ç« </view>
      <view 
        wx:for="{{ normativeGroups }}" 
        wx:key="normative_unique_key"
        class="custom-letter-item normative-letter-item"
        data-letter="{{ item.letter }}"
        bind:tap="onNormativeLetterTap"
      >
        <view class="letter-icon-large">{{ item.letter }}</view>
        <view class="letter-content">
          <view class="letter-title">{{ item.groupName }}</view>
          <view class="letter-subtitle">{{ item.description }}</view>
        </view>
        <view class="letter-right-info">
          <view class="letter-count">{{ item.count }}é¡¹</view>
          <view class="letter-arrow">></view>
        </view>
      </view>

      <!-- ç»Ÿè®¡ä¿¡æ¯ -->
      <view class="stats-section">
        <view class="stats-item">
          <text class="stats-number">{{ normativeDocuments.length }}</text>
          <text class="stats-label">é¡¹è§„ç« </text>
        </view>
        <view class="stats-item">
          <text class="stats-number">{{ normativeGroups.length }}</text>
          <text class="stats-label">ä¸ªåˆ†ç±»</text>
        </view>
      </view>
      
      <!-- ğŸ¯ åŸºäºContext7æœ€ä½³å®è·µï¼šè§„ç« é¡µé¢åº•éƒ¨å¹¿å‘Š -->
      <view wx:if="{{ showNormativeBottomAd && !userPreferences.reduceAds }}" class="ad-section normative-bottom-ad">
        <text class="ad-label">å¹¿å‘Š</text>
        <ad-template 
          unit-id="{{ normativeBottomAdUnitId }}"
          ad-type="custom"
          data-ad-type="NormativeBottom"
          data-ad-unit-id="{{ normativeBottomAdUnitId }}"
          bind:adload="onAdLoad"
          bind:aderror="onAdError"
        />
      </view>
    </view>

    <!-- å­ç±»åˆ«åˆ—è¡¨ - ç°ä»£åŒ–é‡æ„ç‰ˆ -->
    <view wx:if="{{ showNormativeCategoryDetail && !showNormativeDocumentList }}" class="normative-subcategories-section">
      <!-- é¡µé¢å¤´éƒ¨ -->
      <view class="normative-page-header">
        <view class="normative-breadcrumb">
          <view class="normative-breadcrumb-item" bindtap="onBackToNormativeCategories">
            <van-icon name="arrow-left" size="20px" />
            <text>è¿”å›åˆ†ç±»</text>
          </view>
          <text class="normative-breadcrumb-current">{{ selectedNormativeCategory }}</text>
        </view>
        <view class="normative-page-info">
          <text class="normative-page-title">é€‰æ‹©CCARéƒ¨å·</text>
          <text class="normative-page-subtitle">ç‚¹å‡»æŸ¥çœ‹å…·ä½“è§„èŒƒæ€§æ–‡ä»¶å¹¶å¤åˆ¶é“¾æ¥</text>
        </view>
        <view class="normative-copy-hint">
          <van-icon name="info-o" size="14px" />
          <text>å…±{{ normativeSubcategories.length }}ä¸ªéƒ¨å·ï¼Œç‚¹å‡»å³å¯æŸ¥çœ‹æ–‡ä»¶</text>
        </view>
      </view>
      
      <!-- å­ç±»åˆ«ç½‘æ ¼ -->
      <view class="normative-subcategories-grid">
        <view 
          class="normative-subcategory-card"
          wx:for="{{ normativeSubcategories }}"
          wx:key="unique_key"
          data-subcategory="{{ item.name }}"
          bind:tap="onNormativeSubcategoryTap"
        >
          <view class="normative-subcategory-header">
            <view class="normative-ccar-badge">
              <van-icon name="bookmark-o" size="16px" />
              <text>CCAR</text>
            </view>
            <view class="normative-file-count">
              <text>{{ item.count }}ä¸ªæ–‡ä»¶</text>
            </view>
          </view>
          
          <view class="normative-subcategory-body">
            <text class="normative-subcategory-name">{{ item.displayName || item.name }}</text>
            <view class="normative-subcategory-description">
              <text>ç‚¹å‡»æŸ¥çœ‹è¯¥éƒ¨å·ä¸‹çš„æ‰€æœ‰è§„èŒƒæ€§æ–‡ä»¶</text>
            </view>
          </view>
          
          <view class="normative-subcategory-footer">
            <view class="normative-action-indicator">
              <van-icon name="arrow" size="14px" />
              <text>æŸ¥çœ‹æ–‡ä»¶</text>
            </view>
          </view>
        </view>
      </view>
      
      <view class="normative-section-tip">
        <van-icon name="info-o" size="16px" />
        <text>CCARæ˜¯ä¸­å›½æ°‘ç”¨èˆªç©ºè§„ç« çš„ç®€ç§°ï¼Œæ¯ä¸ªéƒ¨å·å¯¹åº”ä¸åŒçš„ç®¡ç†é¢†åŸŸ</text>
      </view>
    </view>

    <!-- æ–‡æ¡£åˆ—è¡¨ - ç°ä»£åŒ–é‡æ„ç‰ˆï¼Œçªå‡ºå¤åˆ¶é“¾æ¥åŠŸèƒ½ -->
    <view wx:if="{{ showNormativeDocumentList }}" class="normative-documents-section">
      <!-- é¡µé¢å¤´éƒ¨ -->
      <view class="normative-page-header">
        <view class="normative-breadcrumb">
          <view class="normative-breadcrumb-item" bindtap="onBackToNormativeSubcategories">
            <van-icon name="arrow-left" size="20px" />
            <text>è¿”å›å­ç±»åˆ«</text>
          </view>
          <text class="normative-breadcrumb-current">{{ selectedNormativeSubcategory }}</text>
        </view>
        <view class="normative-page-info">
          <text class="normative-page-title">è§„èŒƒæ€§æ–‡ä»¶åˆ—è¡¨</text>
          <text class="normative-page-subtitle">ç‚¹å‡»ä»»æ„æ–‡ä»¶å¤åˆ¶é“¾æ¥åˆ°å‰ªè´´æ¿</text>
        </view>
        <view class="normative-copy-all-hint">
          <van-icon name="info-o" size="14px" />
          <text>å…±{{ normativeDocuments.length }}ä¸ªæ–‡ä»¶ï¼Œç‚¹å‡»å³å¯å¤åˆ¶é“¾æ¥</text>
        </view>
      </view>

      <!-- CCARè§„ç« ä¿¡æ¯å¡ç‰‡ - çªå‡ºå¤åˆ¶åŠŸèƒ½ -->
      <view 
        wx:if="{{ ccarRegulation }}" 
        class="normative-ccar-regulation-card clickable"
        bind:tap="onCopyRegulationLink"
        data-url="{{ ccarRegulation.url }}"
        data-title="{{ ccarRegulation.title }}"
        data-doc-number="{{ selectedNormativeSubcategory }}"
      >
        <view class="normative-ccar-header">
          <view class="normative-ccar-left">
            <van-icon name="medal" size="24px" class="normative-ccar-icon" />
            <view class="normative-ccar-title">{{ ccarRegulation.title }}</view>
          </view>
          <view class="normative-ccar-copy-badge">
            <van-icon name="link" size="18px" />
            <text>å¤åˆ¶é“¾æ¥</text>
          </view>
        </view>
        <view class="normative-ccar-content">
          <text class="normative-ccar-description">{{ ccarRegulation.description }}</text>
          <view class="normative-ccar-hint">
            <van-icon name="guide-o" size="14px" />
            <text>ç‚¹å‡»å¡ç‰‡ä»»æ„ä½ç½®å³å¯å¤åˆ¶CCARè§„ç« é“¾æ¥</text>
          </view>
        </view>
      </view>
      
      <!-- æ–‡æ¡£åˆ—è¡¨ -->
      <view class="normative-documents-list">
        <view 
          class="normative-document-card enhanced"
          wx:for="{{ normativeDocuments }}"
          wx:key="id"
          data-url="{{ item.url }}"
          bind:tap="onCopyRegulationLink"
          data-title="{{ item.title || (item.doc_number + ' - æœªçŸ¥æ ‡é¢˜') }}"
          data-doc-number="{{ item.doc_number }}"
        >
          <view class="normative-document-header">
            <view class="normative-document-type-badge">
              <van-icon name="description" size="14px" />
              <text>è§„èŒƒæ€§æ–‡ä»¶</text>
            </view>
            <view class="normative-copy-indicator prominent">
              <van-icon name="link" size="18px" />
              <text>å¤åˆ¶é“¾æ¥</text>
            </view>
          </view>
          
          <view class="normative-document-body">
            <text class="normative-document-title">{{ item.title || (item.doc_number + ' - æœªçŸ¥æ ‡é¢˜') }}</text>
            <view class="normative-document-info">
              <view class="normative-info-row" wx:if="{{ item.doc_number }}">
                <text class="normative-info-label">æ–‡å·:</text>
                <text class="normative-info-value doc-number">{{ item.doc_number }}</text>
              </view>
              <view class="normative-info-row" wx:if="{{ item.publish_date }}">
                <text class="normative-info-label">å‘å¸ƒæ—¥æœŸ:</text>
                <text class="normative-info-value">{{ item.publish_date }}</text>
              </view>
              <view class="normative-info-row">
                <text class="normative-info-label">åˆ†ç±»:</text>
                <text class="normative-info-value">{{ selectedNormativeCategory }} â†’ {{ selectedNormativeSubcategory }}</text>
              </view>
              <view class="normative-info-row" wx:if="{{ item.clean_office_unit }}">
                <text class="normative-info-label">åŠæ–‡å•ä½:</text>
                <text class="normative-info-value">{{ item.clean_office_unit }}</text>
              </view>
            </view>
          </view>
          
          <view class="normative-document-footer">
            <view class="normative-action-hint prominent">
              <van-icon name="guide-o" size="14px" />
              <text>ç‚¹å‡»å¤åˆ¶æ–‡æ¡£é“¾æ¥ï¼Œå¯åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€æŸ¥çœ‹</text>
            </view>
          </view>
        </view>
      </view>
      
      <view class="normative-documents-footer">
        <view class="normative-footer-stats">
          <van-icon name="chart-trending-o" size="16px" />
          <text>å·²æ˜¾ç¤º{{ normativeDocuments.length }}ä¸ª{{ selectedNormativeSubcategory }}ç›¸å…³æ–‡ä»¶</text>
        </view>
        <view class="normative-footer-tip">
          <van-icon name="bulb-o" size="16px" />
          <text>æç¤ºï¼šå¤åˆ¶çš„é“¾æ¥å¯ä»¥åˆ†äº«ç»™åŒäº‹æˆ–ä¿å­˜åˆ°æ”¶è—å¤¹</text>
        </view>
      </view>
    </view>

    <!-- å…·ä½“åˆ†ç±»çš„è§„ç« åˆ—è¡¨ - Context7é«˜ç«¯UXè®¾è®¡ -->
    <view wx:if="{{ !showNormativeGroups && selectedNormativeLetter }}" class="letter-detail-section context7-secondary-page">
      <!-- Context7é£æ ¼çš„è¿”å›å¯¼èˆªæ  -->
      <view class="context7-nav-header">
        <view class="nav-back-button" bindtap="backToNormativeGroups">
          <van-icon name="arrow-left" size="20px" />
          <text class="nav-back-text">è¿”å›</text>
        </view>
        <view class="nav-title">
          <text class="nav-title-main">{{ selectedNormativeCategoryName }}</text>
          <text class="nav-title-sub">{{ currentLetterNormatives.length }}é¡¹è§„ç« </text>
        </view>
        <view class="nav-actions">
          <van-icon name="search" size="18px" class="nav-action-icon" />
        </view>
      </view>

      <!-- Context7é£æ ¼çš„å†…å®¹å¡ç‰‡ -->
      <view class="context7-content-container">
        <view class="context7-card-wrapper">
          <view 
            wx:for="{{ currentLetterNormatives }}"
            wx:key="id"
            class="context7-item-card normative-item-card"
            bind:click="showNormativeDetail"
            data-item="{{ item }}"
          >
            <view class="item-card-header">
              <view class="item-primary">
                <text class="item-title">{{ item.docNumber }} {{ item.docTitle }}</text>
                <view class="item-badges">
                  <view class="context7-badge normative-badge">
                    <van-icon name="certificate" size="12px" />
                    <text>{{ item.docType || 'è§„ç« ' }}</text>
                  </view>
                  <view wx:if="{{ item.isEffective }}" class="context7-badge effective-badge">
                    <van-icon name="success" size="12px" />
                    <text>æœ‰æ•ˆ</text>
                  </view>
                </view>
              </view>
              <van-icon name="arrow" size="16px" class="item-arrow" />
            </view>
            <view class="item-card-content">
              <text class="item-doc-number">{{ item.docNumber }}</text>
              <view class="item-meta-info">
                <text class="item-publish-date">å‘å¸ƒæ—¥æœŸï¼š{{ item.publishDate }}</text>
                <text wx:if="{{ item.effectiveDate }}" class="item-effective-date">ç”Ÿæ•ˆæ—¥æœŸï¼š{{ item.effectiveDate }}</text>
              </view>
              <text wx:if="{{ item.summary }}" class="item-summary">{{ item.summary }}</text>
            </view>
            <view class="item-card-footer">
              <view class="item-meta">
                <van-icon name="bookmark" size="12px" />
                <text class="meta-text">è§„ç« åˆ¶åº¦</text>
              </view>
              <view class="item-status">
                <text class="status-text {{ item.isEffective ? 'status-effective' : 'status-inactive' }}">
                  {{ item.isEffective ? 'æœ‰æ•ˆ' : 'å·²å¤±æ•ˆ' }}
                </text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- æœç´¢ç»“æœåˆ—è¡¨ - ç°ä»£åŒ–é‡æ„ç‰ˆï¼Œçªå‡ºå¤åˆ¶é“¾æ¥åŠŸèƒ½ -->
    <view wx:if="{{ showNormativeSearch }}" class="normative-search-results">
      <!-- æœç´¢ç»“æœå¤´éƒ¨ -->
      <view class="normative-search-header">
        <view class="normative-search-info">
          <text class="normative-search-title">æœç´¢ç»“æœ</text>
          <text class="normative-search-count">{{ filteredNormativeDocuments.length }}æ¡æ–‡æ¡£</text>
        </view>
        <view class="normative-search-tip">
          <van-icon name="info-o" size="14px" />
          <text>ç‚¹å‡»å¤åˆ¶é“¾æ¥</text>
        </view>
      </view>
      
      <!-- æœç´¢ç»“æœåˆ—è¡¨ -->
      <view class="normative-search-list" wx:if="{{ filteredNormativeDocuments.length > 0 }}">
        <view 
          class="normative-document-card enhanced"
          wx:for="{{ filteredNormativeDocuments }}"
          wx:key="id"
          data-url="{{ item.url }}"
          bind:tap="onCopyRegulationLink"
          data-title="{{ item.title || (item.doc_number + ' - æœªçŸ¥æ ‡é¢˜') }}"
          data-doc-number="{{ item.doc_number }}"
        >
          <!-- CCARè§„ç« å¡ç‰‡æ ·å¼ -->
          <view 
            wx:if="{{ item.type === 'ccar' }}" 
            class="normative-ccar-regulation-card clickable"
            bind:tap="onCopyRegulationLink"
            data-url="{{ item.url }}"
            data-title="{{ item.title }}"
            data-doc-number="{{ item.doc_number }}"
          >
            <view class="normative-ccar-header">
              <view class="normative-ccar-left">
                <van-icon name="medal" size="24px" class="normative-ccar-icon" />
                <view class="normative-ccar-title">{{ item.title || item.doc_number }}</view>
              </view>
              <view class="normative-ccar-copy-badge">
                <van-icon name="link" size="18px" />
                <text>å¤åˆ¶é“¾æ¥</text>
              </view>
            </view>
            <view class="normative-ccar-content">
              <text class="normative-ccar-description">ä¸­å›½æ°‘ç”¨èˆªç©ºè§„ç« ç¬¬{{ item.doc_number.split('-')[1] }}éƒ¨</text>
              <view class="normative-ccar-hint">
                <van-icon name="guide-o" size="14px" />
                <text>ç‚¹å‡»å¡ç‰‡ä»»æ„ä½ç½®å³å¯å¤åˆ¶CCARè§„ç« é“¾æ¥</text>
              </view>
            </view>
          </view>

          <!-- è§„èŒƒæ€§æ–‡ä»¶å¡ç‰‡æ ·å¼ -->
          <view wx:if="{{ item.type !== 'ccar' }}">
            <view class="normative-document-header">
              <view class="normative-document-type-badge">
                <van-icon name="description" size="14px" />
                <text>è§„èŒƒæ€§æ–‡ä»¶</text>
              </view>
              <view class="normative-copy-indicator prominent">
                <van-icon name="link" size="18px" />
                <text>å¤åˆ¶é“¾æ¥</text>
              </view>
            </view>
            
            <view class="normative-document-body">
              <text class="normative-document-title">{{ item.title || (item.doc_number + ' - æœªçŸ¥æ ‡é¢˜') }}</text>
              <view class="normative-document-info">
                <view class="normative-info-row" wx:if="{{ item.doc_number }}">
                  <text class="normative-info-label">æ–‡å·:</text>
                  <text class="normative-info-value doc-number">{{ item.doc_number }}</text>
                </view>
                <view class="normative-info-row" wx:if="{{ item.publish_date }}">
                  <text class="normative-info-label">å‘å¸ƒæ—¥æœŸ:</text>
                  <text class="normative-info-value">{{ item.publish_date }}</text>
                </view>
                <view class="normative-info-row" wx:if="{{ item.category }}">
                  <text class="normative-info-label">åˆ†ç±»:</text>
                  <text class="normative-info-value">{{ item.category }} â†’ {{ item.subcategory }}</text>
                </view>
                <view class="normative-info-row" wx:if="{{ item.clean_office_unit }}">
                  <text class="normative-info-label">åŠæ–‡å•ä½:</text>
                  <text class="normative-info-value">{{ item.clean_office_unit }}</text>
                </view>
              </view>
            </view>
            
            <view class="normative-document-footer">
              <view class="normative-action-hint prominent">
                <van-icon name="guide-o" size="14px" />
                <text>ç‚¹å‡»å¤åˆ¶æ–‡æ¡£é“¾æ¥ï¼Œå¯åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€æŸ¥çœ‹</text>
              </view>
            </view>
          </view>
        </view>
      </view>
      
      <!-- æœç´¢æ— ç»“æœ -->
      <view class="normative-empty-state" wx:if="{{ filteredNormativeDocuments.length === 0 }}">
        <van-empty 
          description="æœªæ‰¾åˆ°ç›¸å…³è§„ç« åˆ¶åº¦" 
          image="search"
        >
          <view slot="description" class="normative-empty-tips">
            <text>æœªæ‰¾åˆ°ç›¸å…³è§„ç« åˆ¶åº¦</text>
            <text class="normative-empty-suggestion">â€¢ å°è¯•ä½¿ç”¨æ›´ç®€çŸ­çš„å…³é”®è¯</text>
            <text class="normative-empty-suggestion">â€¢ ä½¿ç”¨CCARæŸ¥è¯¢åŠŸèƒ½</text>
            <text class="normative-empty-suggestion">â€¢ æ£€æŸ¥å…³é”®è¯æ‹¼å†™</text>
          </view>
        </van-empty>
      </view>
    </view>

    <!-- åŠ è½½çŠ¶æ€ -->
    <van-empty
      wx:if="{{ normativeGroups.length === 0 && !normativeSearchValue }}"
      description="åŠ è½½ä¸­..."
    />
  </view>

</view>