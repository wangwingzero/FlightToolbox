<view class="container">
  <!-- 选项卡 -->
  <van-tabs active="{{ activeTab }}" bind:change="onTabChange" sticky>
    <van-tab title="缩写" name="abbreviations"></van-tab>
    <van-tab title="定义" name="definitions"></van-tab>
    <van-tab title="机场" name="airports"></van-tab>
    <van-tab title="通信" name="communications"></van-tab>
    <van-tab title="规章" name="normative"></van-tab>
  </van-tabs>

  <!-- 缩写页面 -->
  <view wx:if="{{ activeTab === 'abbreviations' }}">
    <!-- 搜索框 -->
    <view class="search-section abbreviations-search">
      <van-search
        value="{{ searchValue }}"
        placeholder="搜索简缩字或中英文含义"
        bind:search="onSearch"
        bind:change="onSearchChange"
        bind:clear="onSearchClear"
        use-action-slot
      >
        <view slot="action" bind:tap="onSearch">
          <van-button type="primary" size="small" class="search-action-button">搜索</van-button>
        </view>
      </van-search>
    </view>

    <!-- 第一级：字母分组列表 -->
    <view wx:if="{{ showAbbreviationGroups }}" class="letter-groups-section">
      <view class="section-title">
        <van-icon name="apps" size="16px" />
        按首字母浏览
      </view>
      <view 
        wx:for="{{ abbreviationGroups }}" 
        wx:key="letter"
        class="custom-letter-item abbreviation-letter-item"
        data-letter="{{ item.letter }}"
        bind:tap="onAbbreviationLetterTap"
      >
        <view class="letter-icon-large">{{ item.letter }}</view>
        <view class="letter-content">
          <view class="letter-title">字母 {{ item.letter }}</view>
          <view class="letter-subtitle">{{ item.count }}条缩写</view>
        </view>
        <view class="letter-count">{{ item.count }}条</view>
        <view class="letter-arrow">
          <van-icon name="arrow" size="16px" />
        </view>
      </view>

      <!-- 统计信息 -->
      <view class="stats-section">
        <view class="stats-item">
          <text class="stats-number">{{ abbreviationsList.length }}</text>
          <text class="stats-label">条缩写</text>
        </view>
        <view class="stats-item">
          <text class="stats-number">{{ abbreviationGroups.length }}</text>
          <text class="stats-label">个字母组</text>
        </view>

      </view>
    </view>

    <!-- 第二级：具体条目列表 -->
    <view wx:if="{{ showAbbreviationItems }}" class="items-section context7-secondary-page">
      <!-- Context7风格的导航栏 -->
      <view class="context7-nav-header">
        <view class="nav-back-button" bindtap="backToAbbreviationGroups">
          <van-icon name="arrow-left" size="20px" />
          <text class="nav-back-text">返回</text>
        </view>
        <view class="nav-title">
          <text class="nav-title-main">字母 {{ selectedAbbreviationLetter }}</text>
                          <text class="nav-title-sub">{{ currentLetterAbbreviations.length }}条缩写</text>
        </view>
        <view class="nav-actions">
          <van-icon name="search" size="18px" class="nav-action-icon" />
        </view>
      </view>

      <!-- 条目列表 -->
      <view class="context7-content-container">
        <view class="context7-card-wrapper">
          <view 
            wx:for="{{ currentLetterAbbreviations }}"
            wx:key="id"
            class="context7-item-card abbreviation-item-card"
            bind:click="showAbbreviationDetail"
            data-item="{{ item }}"
          >
            <view class="item-card-header">
              <view class="item-primary">
                <text class="item-abbreviation">{{ item.abbreviation }}</text>
                <view class="item-badges">
                  <view class="context7-badge icao-content" wx:if="{{ item.icao_code }}">
                    <van-icon name="bookmark" size="12px" />
                    <text>ICAO</text>
                  </view>
                  <view class="context7-badge iata-content" wx:if="{{ item.iata_code }}">
                    <van-icon name="certificate" size="12px" />
                    <text>IATA</text>
                  </view>
                </view>
              </view>
              <van-icon name="arrow" size="16px" class="item-arrow" />
            </view>
            <view class="item-card-content">
              <text class="item-english">{{ item.english_full }}</text>
              <text class="item-chinese">{{ item.chinese_translation }}</text>
            </view>
            <view class="item-card-footer">
              <view class="item-meta">
                <van-icon name="notes" size="12px" />
                <text class="meta-text">{{ item.is_icao ? '来源：ICAO' : '来源：机型手册' }}</text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- 搜索结果列表 -->
    <view wx:if="{{ !showAbbreviationGroups && !showAbbreviationItems && searchValue }}" class="search-results-section">
      <van-cell-group wx:if="{{ filteredList.length > 0 }}" title="搜索结果 ({{ filteredList.length }}条简缩字)">
        <van-cell
          wx:for="{{ filteredList }}"
          wx:key="id"
          title="{{ item.abbreviation }}"
          label="{{ item.english_full }} - {{ item.chinese_translation }}"
          border="{{ false }}"
          class="abbreviation-cell"
          bind:click="showAbbreviationDetail"
          data-item="{{ item }}"
          is-link
        >
          <view slot="right-icon">
            <van-tag 
              wx:if="{{ item.icao_code }}"
              type="primary" 
              size="medium"
            >
              ICAO
            </van-tag>
            <van-tag 
              wx:if="{{ item.iata_code }}"
              type="success" 
              size="medium"
            >
              IATA
            </van-tag>
          </view>
        </van-cell>
      </van-cell-group>

      <!-- 搜索无结果 -->
      <van-empty
        wx:if="{{ filteredList.length === 0 && searchValue }}"
        description="未找到相关简缩字"
      />
    </view>

    <!-- 加载状态 -->
    <van-empty
      wx:if="{{ abbreviationGroups.length === 0 && !searchValue }}"
      description="加载中..."
    />
  </view>

  <!-- 定义页面 -->
  <view wx:if="{{ activeTab === 'definitions' }}">
    <!-- 搜索框 -->
    <view class="search-section definitions-search">
      <van-search
        value="{{ definitionSearchValue }}"
        placeholder="搜索定义或术语"
        bind:search="onDefinitionSearch"
        bind:change="onDefinitionSearchChange"
        bind:clear="onDefinitionSearchClear"
        use-action-slot
      >
        <view slot="action" bind:tap="onDefinitionSearch">
          <van-button type="primary" size="small" class="search-action-button">搜索</van-button>
        </view>
      </van-search>
    </view>

    <!-- 字母分组列表 -->
    <view wx:if="{{ showDefinitionGroups }}" class="letter-groups-section">
      <view class="section-title">按拼音首字母浏览</view>
      <view 
        wx:for="{{ definitionGroups }}" 
        wx:key="letter"
        class="custom-letter-item definition-letter-item"
        data-letter="{{ item.letter }}"
        bind:tap="onDefinitionLetterTap"
      >
        <view class="letter-icon-large">{{ item.letter }}</view>
        <view class="letter-content">
          <view class="letter-title">字母 {{ item.letter }}</view>
          <view class="letter-subtitle">以 {{ item.letter }} 开头的定义</view>
        </view>
        <view class="letter-count">{{ item.count }}条</view>
        <view class="letter-arrow">></view>
      </view>

      <!-- 统计信息 -->
      <view class="stats-section">
        <view class="stats-item">
          <text class="stats-number">{{ definitionsList.length }}</text>
          <text class="stats-label">个定义</text>
        </view>
        <view class="stats-item">
          <text class="stats-number">{{ definitionGroups.length }}</text>
          <text class="stats-label">个字母组</text>
        </view>
      </view>
    </view>

    <!-- 具体字母组的定义列表 - Context7高端UX设计 -->
    <view wx:if="{{ !showDefinitionGroups && selectedDefinitionLetter }}" class="letter-detail-section context7-secondary-page">
      <!-- Context7风格的返回导航栏 -->
      <view class="context7-nav-header">
        <view class="nav-back-button" bindtap="backToDefinitionGroups">
          <van-icon name="arrow-left" size="20px" />
          <text class="nav-back-text">返回</text>
        </view>
        <view class="nav-title">
          <text class="nav-title-main">字母 {{ selectedDefinitionLetter }}</text>
          <text class="nav-title-sub">{{ currentLetterDefinitions.length }}个定义</text>
        </view>
        <view class="nav-actions">
          <van-icon name="search" size="18px" class="nav-action-icon" />
        </view>
      </view>

      <!-- Context7风格的内容卡片 -->
      <view class="context7-content-container">
        <view class="context7-card-wrapper">
          <view 
            wx:for="{{ currentLetterDefinitions }}"
            wx:key="id"
            class="context7-item-card definition-item-card"
            bind:click="showDefinitionDetail"
            data-item="{{ item }}"
          >
            <view class="item-card-header">
              <view class="item-primary">
                <!-- Context7标签优化 - 来源信息更清晰 -->
                <view class="item-badges">
                  <view class="item-source-tag">
                    <van-icon name="bookmark" size="12px" class="tag-icon" />
                    <text>{{ item.source }}</text>
                  </view>
                </view>
              </view>
              <van-icon name="arrow" size="16px" class="item-arrow" />
            </view>
            <view class="item-card-content">
              <!-- Context7中文优先设计 - 中文定义作为主要内容 -->
              <text class="item-chinese-main">{{ item.chinese_name }}</text>
              <!-- 英文作为次要对照信息 -->
              <text class="item-english-secondary">{{ item.english_name }}</text>
              <!-- 详细定义用黄色高亮突出显示 -->
              <text class="item-definition-highlight" wx:if="{{ item.definition }}">{{ item.definition }}</text>
            </view>
            <view class="item-card-footer">
              <view class="item-meta">
                <van-icon name="notes" size="12px" />
                <text class="meta-text">《民航术语定义（试行）》（民航函〔2025〕340号）</text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- 搜索结果列表 -->
    <view wx:if="{{ !showDefinitionGroups && definitionSearchValue }}" class="search-results-section">
      <van-cell-group wx:if="{{ filteredDefinitions.length > 0 }}" title="搜索结果 ({{ filteredDefinitions.length }}个定义)">
        <van-cell
          wx:for="{{ filteredDefinitions }}"
          wx:key="id"
          border="{{ false }}"
          class="definition-cell"
          bind:click="showDefinitionDetail"
          data-item="{{ item }}"
          is-link
        >
          <!-- Context7中文优先标题 -->
          <view slot="title" class="definition-cell-title">
            <text class="chinese-title-main">{{ item.chinese_name }}</text>
          </view>
          <!-- 英文作为标签显示 -->
          <view slot="label" class="definition-cell-label">
            <text class="english-subtitle">{{ item.english_name }}</text>
          </view>
          <view slot="right-icon">
            <van-tag 
              type="success" 
              size="medium"
            >
              {{ item.source }}
            </van-tag>
          </view>
        </van-cell>
      </van-cell-group>

      <!-- 搜索无结果 -->
      <van-empty
        wx:if="{{ filteredDefinitions.length === 0 && definitionSearchValue }}"
        description="未找到相关定义"
      />
    </view>

    <!-- 加载状态 -->
    <van-empty
      wx:if="{{ definitionGroups.length === 0 && !definitionSearchValue }}"
      description="加载中..."
    />
  </view>

  <!-- 机场页面 -->
  <view wx:if="{{ activeTab === 'airports' }}">
    <!-- 搜索框 -->
    <view class="search-section airports-search">
      <van-search
        value="{{ airportSearchValue }}"
        placeholder="搜索机场代码、名称或国家"
        bind:search="onAirportSearch"
        bind:change="onAirportSearchChange"
        bind:clear="onAirportSearchClear"
        use-action-slot
      >
        <view slot="action" bind:tap="onAirportSearch">
          <van-button type="primary" size="small" class="search-action-button">搜索</van-button>
        </view>
      </van-search>
    </view>

    <!-- 机场字母分组列表 -->
    <view wx:if="{{ showAirportGroups }}" class="letter-groups-section">
      <view class="section-title">按ICAO代码首字母浏览</view>
      <view 
        wx:for="{{ airportGroups }}" 
        wx:key="letter"
        class="custom-letter-item airport-letter-item"
        data-letter="{{ item.letter }}"
        bind:tap="onAirportLetterTap"
      >
        <view class="letter-icon-large">{{ item.letter }}</view>
        <view class="letter-content">
          <view class="letter-title">字母 {{ item.letter }}</view>
          <view class="letter-subtitle">以 {{ item.letter }} 开头的机场</view>
        </view>
        <view class="letter-count">{{ item.count }}个</view>
        <view class="letter-arrow">></view>
      </view>

      <!-- 统计信息 -->
      <view class="stats-section">
        <view class="stats-item">
          <text class="stats-number">{{ airportsList.length }}</text>
          <text class="stats-label">个机场</text>
        </view>
        <view class="stats-item">
          <text class="stats-number">{{ airportGroups.length }}</text>
          <text class="stats-label">个字母组</text>
        </view>
      </view>
    </view>

    <!-- 具体字母组的机场列表 - Context7高端UX设计 -->
    <view wx:if="{{ !showAirportGroups && selectedAirportLetter }}" class="letter-detail-section context7-secondary-page">
      <!-- Context7风格的返回导航栏 -->
      <view class="context7-nav-header">
        <view class="nav-back-button" bindtap="backToAirportGroups">
          <van-icon name="arrow-left" size="20px" />
          <text class="nav-back-text">返回</text>
        </view>
        <view class="nav-title">
          <text class="nav-title-main">字母 {{ selectedAirportLetter }}</text>
          <text class="nav-title-sub">{{ currentLetterAirports.length }}个机场</text>
        </view>
        <view class="nav-actions">
          <van-icon name="search" size="18px" class="nav-action-icon" />
        </view>
      </view>

      <!-- Context7风格的内容卡片 -->
      <view class="context7-content-container">
        <view class="context7-card-wrapper">
          <view 
            wx:for="{{ currentLetterAirports }}"
            wx:key="ICAOCode"
            class="context7-item-card airport-item-card"
            bind:click="showAirportDetail"
            data-item="{{ item }}"
          >
            <view class="item-card-header">
              <view class="item-primary">
                <text class="item-title">{{ item.ShortName }}</text>
                <view class="item-badges">
                  <view class="context7-badge country-badge">
                    <van-icon name="location" size="12px" />
                    <text>{{ item.CountryName }}</text>
                  </view>
                </view>
              </view>
              <van-icon name="arrow" size="16px" class="item-arrow" />
            </view>
            <view class="item-card-content">
              <text class="item-english">{{ item.EnglishName }}</text>
              <view class="airport-codes-grid">
                <view class="code-chip">
                  <text class="code-label">ICAO</text>
                  <text class="code-value">{{ item.ICAOCode }}</text>
                </view>
                <view class="code-chip">
                  <text class="code-label">IATA</text>
                  <text class="code-value">{{ item.IATACode }}</text>
                </view>
              </view>
            </view>
            <view class="item-card-footer">
              <view class="item-meta">
                <van-icon name="flight" size="12px" />
                <text class="meta-text">机场信息</text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- 搜索结果列表 -->
    <view wx:if="{{ !showAirportGroups && airportSearchValue }}" class="search-results-section">
      <van-cell-group wx:if="{{ filteredAirports.length > 0 }}" title="搜索结果 ({{ filteredAirports.length }}个机场)">
        <van-cell
          wx:for="{{ filteredAirports }}"
          wx:key="ICAOCode"
          title="{{ item.ShortName }}"
          label="{{ item.EnglishName }}"
          border="{{ false }}"
          class="airport-cell"
          bind:click="showAirportDetail"
          data-item="{{ item }}"
          is-link
        >
          <view slot="value" class="airport-codes">
            <view class="code-item">
              <text class="code-label">ICAO:</text>
              <text class="code-value">{{ item.ICAOCode }}</text>
            </view>
            <view class="code-item">
              <text class="code-label">IATA:</text>
              <text class="code-value">{{ item.IATACode }}</text>
            </view>
          </view>
          <view slot="right-icon">
            <van-tag 
              type="warning" 
              size="medium"
            >
              {{ item.CountryName }}
            </van-tag>
          </view>
        </van-cell>
      </van-cell-group>

      <!-- 搜索无结果 -->
      <van-empty
        wx:if="{{ filteredAirports.length === 0 && airportSearchValue }}"
        description="未找到相关机场"
      />
    </view>

    <!-- 加载状态 -->
    <van-empty
      wx:if="{{ airportGroups.length === 0 && !airportSearchValue }}"
      description="加载中..."
    />
  </view>

  <!-- 通信页面 -->
  <view wx:if="{{ activeTab === 'communications' }}">
    <!-- 搜索框 -->
    <view class="search-section communications-search">
      <van-search
        value="{{ communicationSearchValue }}"
        placeholder="搜索英语通信或中文含义"
        bind:search="onCommunicationSearch"
        bind:change="onCommunicationSearchChange"
        bind:clear="onCommunicationSearchClear"
        use-action-slot
      >
        <view slot="action" bind:tap="onCommunicationSearch">
          <van-button type="primary" size="small" class="search-action-button">搜索</van-button>
        </view>
      </van-search>
    </view>

    <!-- 字母分组列表 -->
    <view wx:if="{{ showCommunicationGroups }}" class="letter-groups-section">
      <view class="section-title">按章节浏览</view>
      <view 
        wx:for="{{ communicationGroups }}" 
        wx:key="letter"
        class="custom-letter-item communication-letter-item"
        data-letter="{{ item.letter }}"
        bind:tap="onCommunicationLetterTap"
      >
        <view class="letter-icon-large">{{ item.letter }}</view>
        <view class="letter-content">
          <view class="letter-title">{{ item.chapterTitle }}</view>
          <view class="letter-subtitle">{{ item.isEmergency ? '特情应急词汇' : 'ICAO英语900句' }}</view>
        </view>
        <view class="letter-count">{{ item.count }}句</view>
        <view class="letter-arrow">></view>
      </view>

      <!-- 统计信息 -->
      <view class="stats-section">
        <view class="stats-item">
          <text class="stats-number">{{ communicationsList.length }}</text>
          <text class="stats-label">项内容</text>
        </view>
        <view class="stats-item">
          <text class="stats-number">{{ communicationGroups.length }}</text>
          <text class="stats-label">个分类</text>
        </view>
      </view>
    </view>

    <!-- 具体字母组的通信列表 - Context7高端UX设计 -->
    <view wx:if="{{ !showCommunicationGroups && selectedCommunicationLetter }}" class="letter-detail-section context7-secondary-page">
      <!-- Context7风格的返回导航栏 -->
      <view class="context7-nav-header">
        <view class="nav-back-button" bindtap="backToCommunicationGroups">
          <van-icon name="arrow-left" size="20px" />
          <text class="nav-back-text">返回</text>
        </view>
        <view class="nav-title">
          <text class="nav-title-main">{{ selectedChapterName }}</text>
          <text class="nav-title-sub">{{ currentLetterCommunications.length }}句</text>
        </view>
        <view class="nav-actions">
          <van-icon name="search" size="18px" class="nav-action-icon" />
        </view>
      </view>

      <!-- Context7风格的内容卡片 -->
      <view class="context7-content-container">
        <view class="context7-card-wrapper">
          <view 
            wx:for="{{ currentLetterCommunications }}"
            wx:key="id"
            class="context7-item-card communication-item-card"
            bind:click="showCommunicationDetail"
            data-item="{{ item }}"
          >
            <view class="item-card-header">
              <view class="item-primary">
                <text class="item-title">{{ item.english }}</text>
                <view class="item-badges">
                  <view class="context7-badge {{ item.section === '特情常用词汇' ? 'emergency-badge' : 'icao-badge' }}">
                    <van-icon name="{{ item.section === '特情常用词汇' ? 'warning' : 'certificate' }}" size="12px" />
                    <text>{{ item.section === '特情常用词汇' ? '特情' : 'ICAO' }}</text>
                  </view>
                </view>
              </view>
              <van-icon name="arrow" size="16px" class="item-arrow" />
            </view>
            <view class="item-card-content">
              <text class="item-chinese">{{ item.chinese }}</text>
            </view>
            <view class="item-card-footer">
              <view class="item-meta">
                <van-icon name="voice" size="12px" />
                <text class="meta-text">标准用语</text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- 搜索结果列表 -->
    <view wx:if="{{ !showCommunicationGroups && communicationSearchValue }}" class="search-results-section">
      <van-cell-group wx:if="{{ filteredCommunications.length > 0 }}" title="搜索结果 ({{ filteredCommunications.length }}句)">
        <van-cell
          wx:for="{{ filteredCommunications }}"
          wx:key="id"
          title="{{ item.english }}"
          label="{{ item.chinese }}"
          border="{{ false }}"
          class="communication-cell"
          bind:click="showCommunicationDetail"
          data-item="{{ item }}"
          is-link
        >
          <view slot="right-icon">
            <van-tag 
              type="{{ item.section === '特情常用词汇' ? 'danger' : 'primary' }}" 
              size="medium"
            >
              {{ item.section === '特情常用词汇' ? '特情' : 'ICAO' }}
            </van-tag>
          </view>
        </van-cell>
      </van-cell-group>

      <!-- 搜索无结果 -->
      <van-empty
        wx:if="{{ filteredCommunications.length === 0 && communicationSearchValue }}"
        description="未找到相关通信用语"
      />
    </view>

    <!-- 加载状态 -->
    <view wx:if="{{ communicationsLoading }}" class="loading-section">
      <van-loading type="spinner" size="24px" text-size="14px">
        正在加载ICAO通信数据...
      </van-loading>
    </view>
    
    <van-empty
      wx:if="{{ communicationGroups.length === 0 && !communicationSearchValue && !communicationsLoading }}"
      description="加载中..."
    />
  </view>

  <!-- 规章页面 -->
  <view wx:if="{{ activeTab === 'normative' }}">
    <!-- 搜索框 -->
    <view class="search-section normative-search">
      <van-search
        value="{{ normativeSearchValue }}"
        placeholder="搜索规章制度或文档编号"
        bind:search="onNormativeSearch"
        bind:change="onNormativeSearchChange"
        bind:clear="onNormativeSearchClear"
        use-action-slot
      >
        <view slot="action" bind:tap="onNormativeSearch">
          <van-button type="primary" size="small" class="search-action-button">搜索</van-button>
        </view>
      </van-search>
    </view>

    <!-- 规章分类列表 -->
    <view wx:if="{{ showNormativeGroups }}" class="letter-groups-section">
      <view class="section-title">按类别浏览规章制度</view>
      <view 
        wx:for="{{ normativeGroups }}" 
        wx:key="normative_unique_key"
        class="custom-letter-item normative-letter-item"
        data-letter="{{ item.letter }}"
        bind:tap="onNormativeLetterTap"
      >
        <view class="letter-icon-large">{{ item.letter }}</view>
        <view class="letter-content">
          <view class="letter-title">{{ item.groupName }}</view>
          <view class="letter-subtitle">{{ item.description }}</view>
        </view>
        <view class="letter-count">{{ item.count }}项</view>
        <view class="letter-arrow">></view>
      </view>

      <!-- 统计信息 -->
      <view class="stats-section">
        <view class="stats-item">
          <text class="stats-number">{{ normativeDocuments.length }}</text>
          <text class="stats-label">项规章</text>
        </view>
        <view class="stats-item">
          <text class="stats-number">{{ normativeGroups.length }}</text>
          <text class="stats-label">个分类</text>
        </view>
      </view>
    </view>

    <!-- 子类别列表 - Context7分级导航设计 -->
    <view wx:if="{{ showNormativeCategoryDetail && !showNormativeDocumentList }}" class="subcategory-detail-section context7-secondary-page">
      <!-- Context7风格的返回导航栏 -->
      <view class="context7-nav-header">
        <view class="nav-back-button" bindtap="onBackToNormativeCategories">
          <van-icon name="arrow-left" size="20px" />
          <text class="nav-back-text">返回</text>
        </view>
        <view class="nav-title">
          <text class="nav-title-main">{{ selectedNormativeCategory }}</text>
          <text class="nav-title-sub">{{ normativeSubcategories.length }}个子类别</text>
        </view>
        <view class="nav-actions">
          <van-icon name="apps" size="18px" class="nav-action-icon" />
        </view>
      </view>

      <!-- Context7风格的子类别列表 -->
      <view class="context7-content-container">
        <view class="context7-card-wrapper">
          <view 
            wx:for="{{ normativeSubcategories }}"
            wx:key="unique_key"
            class="context7-item-card subcategory-item-card"
            bind:click="onNormativeSubcategoryTap"
            data-subcategory="{{ item.name }}"
          >
            <view class="item-card-header">
              <view class="item-primary">
                <text class="item-title">{{ item.name }}</text>
                <view class="item-badges">
                  <view class="context7-badge subcategory-badge">
                    <van-icon name="folder" size="12px" />
                    <text>{{ item.count }}个文档</text>
                  </view>
                  <view wx:if="{{ item.name.indexOf('CCAR') !== -1 }}" class="context7-badge ccar-badge">
                    <van-icon name="medal" size="12px" />
                    <text>民航规章</text>
                  </view>
                </view>
              </view>
              <van-icon name="arrow" size="16px" class="item-arrow" />
            </view>
            <view wx:if="{{ item.description }}" class="item-card-content">
              <text class="item-description">{{ item.description }}</text>
            </view>
            <view class="item-card-footer">
              <view class="item-meta">
                <van-icon name="bookmark" size="12px" />
                <text class="meta-text">{{ selectedNormativeCategory }}</text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- 文档列表 - Context7深度导航设计 -->
    <view wx:if="{{ showNormativeDocumentList }}" class="document-list-section context7-tertiary-page">
      <!-- Context7风格的返回导航栏 -->
      <view class="context7-nav-header">
        <view class="nav-back-button" bindtap="onBackToNormativeSubcategories">
          <van-icon name="arrow-left" size="20px" />
          <text class="nav-back-text">返回</text>
        </view>
        <view class="nav-title">
          <text class="nav-title-main">{{ selectedNormativeSubcategory }}</text>
          <text class="nav-title-sub">{{ normativeDocuments.length }}个文档</text>
        </view>
        <view class="nav-actions">
          <van-icon name="info" size="18px" class="nav-action-icon" />
        </view>
      </view>

      <!-- CCAR规章信息卡片 -->
      <view wx:if="{{ ccarRegulation }}" class="ccar-regulation-card">
        <view class="ccar-header">
          <van-icon name="medal" size="20px" class="ccar-icon" />
          <view class="ccar-title">{{ ccarRegulation.title }}</view>
        </view>
        <view class="ccar-content">
          <text class="ccar-description">{{ ccarRegulation.description }}</text>
          <van-button 
            type="primary" 
            size="small" 
            class="ccar-link-button"
            bind:click="onCCARRegulationTap"
            data-url="{{ ccarRegulation.url }}"
          >
            查看CCAR原文
          </van-button>
        </view>
      </view>

      <!-- Context7风格的文档列表 -->
      <view class="context7-content-container">
        <view class="context7-card-wrapper">
          <view 
            wx:for="{{ normativeDocuments }}"
            wx:key="id"
            class="context7-item-card document-item-card"
            bind:click="onNormativeDocumentTap"
            data-url="{{ item.url }}"
          >
            <view class="item-card-header">
              <view class="item-primary">
                <text class="item-title">{{ item.title }}</text>
                <view class="item-badges">
                  <view class="context7-badge document-badge">
                    <van-icon name="link" size="12px" />
                    <text>{{ item.doc_type || '文档' }}</text>
                  </view>
                  <view wx:if="{{ item.is_effective }}" class="context7-badge effective-badge">
                    <van-icon name="success" size="12px" />
                    <text>有效</text>
                  </view>
                </view>
              </view>
              <van-icon name="link" size="16px" class="item-arrow" />
            </view>
            <view class="item-card-content">
              <text class="item-doc-number">{{ item.doc_number }}</text>
              <view class="item-meta-info">
                <text class="item-office-unit">发文单位：{{ item.clean_office_unit || item.office_unit }}</text>
                <text wx:if="{{ item.publish_date }}" class="item-publish-date">发布日期：{{ item.publish_date }}</text>
                <text wx:if="{{ item.effective_date }}" class="item-effective-date">生效日期：{{ item.effective_date }}</text>
              </view>
            </view>
            <view class="item-card-footer">
              <view class="item-meta">
                <van-icon name="attachment" size="12px" />
                <text class="meta-text">规范性文件</text>
              </view>
              <view class="item-status">
                <text class="status-text {{ item.is_effective ? 'status-effective' : 'status-inactive' }}">
                  {{ item.is_effective ? '有效' : '已失效' }}
                </text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- 具体分类的规章列表 - Context7高端UX设计 -->
    <view wx:if="{{ !showNormativeGroups && selectedNormativeLetter }}" class="letter-detail-section context7-secondary-page">
      <!-- Context7风格的返回导航栏 -->
      <view class="context7-nav-header">
        <view class="nav-back-button" bindtap="backToNormativeGroups">
          <van-icon name="arrow-left" size="20px" />
          <text class="nav-back-text">返回</text>
        </view>
        <view class="nav-title">
          <text class="nav-title-main">{{ selectedNormativeCategoryName }}</text>
          <text class="nav-title-sub">{{ currentLetterNormatives.length }}项规章</text>
        </view>
        <view class="nav-actions">
          <van-icon name="search" size="18px" class="nav-action-icon" />
        </view>
      </view>

      <!-- Context7风格的内容卡片 -->
      <view class="context7-content-container">
        <view class="context7-card-wrapper">
          <view 
            wx:for="{{ currentLetterNormatives }}"
            wx:key="id"
            class="context7-item-card normative-item-card"
            bind:click="showNormativeDetail"
            data-item="{{ item }}"
          >
            <view class="item-card-header">
              <view class="item-primary">
                <text class="item-title">{{ item.docTitle }}</text>
                <view class="item-badges">
                  <view class="context7-badge normative-badge">
                    <van-icon name="certificate" size="12px" />
                    <text>{{ item.docType || '规章' }}</text>
                  </view>
                  <view wx:if="{{ item.isEffective }}" class="context7-badge effective-badge">
                    <van-icon name="success" size="12px" />
                    <text>有效</text>
                  </view>
                </view>
              </view>
              <van-icon name="arrow" size="16px" class="item-arrow" />
            </view>
            <view class="item-card-content">
              <text class="item-doc-number">{{ item.docNumber }}</text>
              <view class="item-meta-info">
                <text class="item-publish-date">发布日期：{{ item.publishDate }}</text>
                <text wx:if="{{ item.effectiveDate }}" class="item-effective-date">生效日期：{{ item.effectiveDate }}</text>
              </view>
              <text wx:if="{{ item.summary }}" class="item-summary">{{ item.summary }}</text>
            </view>
            <view class="item-card-footer">
              <view class="item-meta">
                <van-icon name="bookmark" size="12px" />
                <text class="meta-text">规章制度</text>
              </view>
              <view class="item-status">
                <text class="status-text {{ item.isEffective ? 'status-effective' : 'status-inactive' }}">
                  {{ item.isEffective ? '有效' : '已失效' }}
                </text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- 搜索结果列表 -->
    <view wx:if="{{ showNormativeSearch }}" class="search-results-section">
      <van-cell-group wx:if="{{ filteredNormativeDocuments.length > 0 }}" title="搜索结果 ({{ filteredNormativeDocuments.length }}项规章)">
        <van-cell
          wx:for="{{ filteredNormativeDocuments }}"
          wx:key="id"
          title="{{ item.title || item.doc_title || '无标题' }}"
          label="{{ item.doc_number || item.docNumber || '' }}"
          border="{{ false }}"
          class="normative-cell"
          bind:click="onNormativeDocumentTap"
          data-url="{{ item.url }}"
          is-link
        >
          <view slot="value">{{ item.publish_date || item.publishDate || '' }}</view>
          <view slot="right-icon">
            <van-tag 
              type="{{ item.is_effective ? 'success' : 'default' }}" 
              size="medium"
            >
              {{ item.is_effective ? '有效' : '已失效' }}
            </van-tag>
          </view>
        </van-cell>
      </van-cell-group>

      <!-- 搜索无结果 -->
      <van-empty
        wx:if="{{ filteredNormativeDocuments.length === 0 && normativeSearchValue }}"
        description="未找到相关规章制度"
      />
    </view>

    <!-- 加载状态 -->
    <van-empty
      wx:if="{{ normativeGroups.length === 0 && !normativeSearchValue }}"
      description="加载中..."
    />
  </view>

  <!-- 缩写详情弹窗 -->
  <van-popup
    show="{{ showAbbreviationPopup }}"
    position="bottom"
    round
    bind:close="closeAbbreviationDetail"
    custom-style="height: 60%"
  >
    <view class="popup-header">
      <view class="popup-title">简缩字详情</view>
      <van-icon name="cross" size="20px" bind:click="closeAbbreviationDetail" />
    </view>
    <view class="popup-content">
      <view class="detail-section">
        <view class="detail-label">简缩字</view>
        <view class="detail-value">{{ selectedAbbreviation.abbreviation }}</view>
      </view>
      <view class="detail-section english-content">
        <view class="detail-label">英文全称</view>
        <view class="detail-value">{{ selectedAbbreviation.english_full }}</view>
      </view>
      <view class="detail-section">
        <view class="detail-label">中文翻译</view>
        <view class="detail-value">{{ selectedAbbreviation.chinese_translation }}</view>
      </view>
      <view wx:if="{{ selectedAbbreviation.is_icao }}" class="detail-section icao-content">
        <view class="detail-tag">
          <van-tag type="primary">ICAO标准</van-tag>
        </view>
      </view>
    </view>
  </van-popup>

  <!-- 定义详情弹窗 -->
  <van-popup
    show="{{ showDefinitionPopup }}"
    position="bottom"
    round
    bind:close="closeDefinitionDetail"
    custom-style="height: 70%"
  >
    <view class="popup-header">
      <view class="popup-title">定义详情</view>
      <van-icon name="cross" size="20px" bind:click="closeDefinitionDetail" />
    </view>
    <view class="popup-content">
      <view class="detail-section">
        <view class="detail-label">中文名称</view>
        <view class="detail-value">{{ selectedDefinition.chinese_name }}</view>
      </view>
      <view class="detail-section english-content">
        <view class="detail-label">英文名称</view>
        <view class="detail-value">{{ selectedDefinition.english_name }}</view>
      </view>
      <view wx:if="{{ selectedDefinition.definition }}" class="detail-section definition-content">
        <view class="detail-label">定义</view>
        <view class="detail-value">{{ selectedDefinition.definition }}</view>
      </view>
      <view class="detail-section">
        <view class="detail-label">来源</view>
        <view class="detail-value">{{ selectedDefinition.source }}</view>
      </view>
    </view>
  </van-popup>

  <!-- 机场详情弹窗 -->
  <van-popup
    show="{{ showAirportPopup }}"
    position="bottom"
    round
    bind:close="closeAirportDetail"
    custom-style="height: 70%"
  >
    <view class="popup-header">
      <view class="popup-title">机场详情</view>
      <van-icon name="cross" size="20px" bind:click="closeAirportDetail" />
    </view>
    <view class="popup-content">
      <view class="detail-section">
        <view class="detail-label">机场名称</view>
        <view class="detail-value">{{ selectedAirport.ShortName }}</view>
      </view>
      <view class="detail-section english-content">
        <view class="detail-label">英文名称</view>
        <view class="detail-value">{{ selectedAirport.EnglishName }}</view>
      </view>
      <view class="detail-section icao-content">
        <view class="detail-label">ICAO代码</view>
        <view class="detail-value">{{ selectedAirport.ICAOCode }}</view>
      </view>
      <view class="detail-section iata-content">
        <view class="detail-label">IATA代码</view>
        <view class="detail-value">{{ selectedAirport.IATACode }}</view>
      </view>
      <view class="detail-section">
        <view class="detail-label">国家</view>
        <view class="detail-value">{{ selectedAirport.CountryName }}</view>
      </view>
    </view>
  </van-popup>

  <!-- 通信详情弹窗 -->
  <van-popup
    show="{{ showCommunicationPopup }}"
    position="bottom"
    round
    bind:close="closeCommunicationDetail"
    custom-style="height: 60%"
  >
    <view class="popup-header">
      <view class="popup-title">通信用语详情</view>
      <van-icon name="cross" size="20px" bind:click="closeCommunicationDetail" />
    </view>
    <view class="popup-content">
      <view class="detail-section english-content">
        <view class="detail-label">英语用语</view>
        <view class="detail-value">{{ selectedCommunication.english }}</view>
      </view>
      <view class="detail-section">
        <view class="detail-label">中文含义</view>
        <view class="detail-value">{{ selectedCommunication.chinese }}</view>
      </view>
      <view class="detail-section">
        <view class="detail-label">章节</view>
        <view class="detail-value">{{ selectedCommunication.section }}</view>
      </view>
      <view wx:if="{{ selectedCommunication.section === '特情常用词汇' }}" class="detail-section">
        <view class="detail-tag">
          <van-tag type="danger">特情用语</van-tag>
        </view>
      </view>
    </view>
  </van-popup>
</view> 