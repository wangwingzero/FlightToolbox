<view class="container page-content">
  <!-- åˆ†ç±»èœå• -->
  <view class="category-tabs-container">
    <scroll-view class="category-tabs-scroll" scroll-x scroll-with-animation enhanced>
      <view class="category-tabs-wrapper">
        <view 
          wx:for="{{ categoryList }}" 
          wx:key="name"
          class="category-tab-item {{ activeTab === item.name ? 'active' : '' }}"
          bind:tap="onTabChange"
          data-name="{{ item.name }}"
        >
          <view class="category-badge">{{ item.count }}</view>
          <view class="category-title">{{ item.title }}</view>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- æœç´¢æ¡† -->
  <view class="search-section medical-search">
    <van-search
      value="{{ searchKeyword }}"
      placeholder="{{ searchPlaceholder }}"
      bind:change="onSearchChange"
      bind:clear="onSearchClear"
      shape="round"
    />
  </view>

  <!-- ä½“æ£€æ ‡å‡†åˆ—è¡¨ -->
  <view class="standards-section">
    <view wx:if="{{ filteredStandards.length > 0 }}" class="context7-content-container">
      <view class="context7-card-wrapper">
        <view 
          wx:for="{{ filteredStandards }}"
          wx:key="id"
          wx:for-index="idx"
          class="context7-item-card medical-item-card"
          bind:tap="showStandardDetail"
          data-index="{{ idx }}"
        >
          <view class="item-card-header">
            <view class="item-primary">
              <text class="item-name-zh">{{ item.name_zh }}</text>
              <view class="item-badges">
                <view class="medical-category-badge" data-category="{{ item.category }}">
                  <text>{{ item.categoryShort }}</text>
                </view>
              </view>
            </view>
            <view class="item-secondary">
              <text class="item-name-en">{{ item.name_en }}</text>
            </view>
          </view>
          
          <view class="item-card-content">
            <view class="item-definition">
              {{ item.standard.assessment || (item.standard && item.standard.length > 0 ? item.standard[0].assessment : 'è¯¦è§å†…å®¹') }}
            </view>
            <view wx:if="{{ item.standard.conditions && item.standard.conditions.length > 0 }}" class="item-conditions">
              <view class="condition-label">è¯„å®šæ¡ä»¶:</view>
              <view wx:for="{{ item.standard.conditions }}" wx:key="index" class="condition-item">{{ item }}</view>
            </view>
          </view>
          
          <view class="item-card-footer">
            <view class="item-meta">
              <van-icon name="info-o" size="14px" />
              <text>ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…</text>
            </view>
            <view class="item-arrow">
              <van-icon name="arrow" size="16px" />
            </view>
          </view>
        </view>
      </view>
    </view>
    
    <!-- æ— æœç´¢ç»“æœ -->
    <view wx:else class="no-results">
      <view class="no-results-icon">ğŸ”</view>
      <view class="no-results-text">æœªæ‰¾åˆ°ç›¸å…³ä½“æ£€æ ‡å‡†</view>
      <view class="no-results-tip">è¯·å°è¯•å…¶ä»–å…³é”®è¯æˆ–åˆ‡æ¢åˆ†ç±»</view>
    </view>
  </view>

  <!-- ç»Ÿè®¡ä¿¡æ¯ -->
  <view wx:if="{{ activeTab === 'å…¨éƒ¨' && !searchKeyword }}" class="stats-section">
    <view class="stats-item">
      <text class="stats-number">{{ medicalStandards.length }}</text>
      <text class="stats-label">ä¸ªæ ‡å‡†</text>
    </view>
    <view class="stats-item">
      <text class="stats-number">6</text>
      <text class="stats-label">ä¸ªåˆ†ç±»</text>
    </view>
  </view>
</view>

<!-- è¯¦æƒ…å¼¹çª— -->
<van-popup
  show="{{ showDetailPopup }}"
  position="bottom"
  round
  closeable
  close-icon="close"
  bind:close="closeDetailPopup"
  custom-style="height: 80%; max-height: 80vh;"
>
  <view class="detail-popup" wx:if="{{ selectedStandard && selectedStandard.name_zh }}">
    <view class="popup-header">
      <view class="popup-header-content">
        <view class="popup-title">{{ selectedStandard.name_zh || 'æ ‡å‡†è¯¦æƒ…' }}</view>
        <view class="popup-subtitle">{{ selectedStandard.name_en || '' }}</view>
      </view>
      <view class="popup-close-btn" bind:tap="closeDetailPopup">
        <van-icon name="cross" size="20px" color="white" />
      </view>
    </view>
    
    <scroll-view class="popup-content" scroll-y enhanced enable-flex show-scrollbar="{{false}}" scroll-with-animation="{{false}}" enable-back-to-top="{{false}}" throttle="{{false}}" scroll-anchoring="{{false}}" refresher-enabled="{{false}}">
      <view class="detail-section">
        <view class="detail-label">åˆ†ç±»</view>
        <view class="detail-content">{{ selectedStandard.category }}</view>
      </view>
      
      <view class="detail-section">
        <view class="detail-label">è¯„å®šæ¡ä»¶</view>
        <view class="detail-content">
          <view wx:if="{{ selectedStandard.standard.conditions && selectedStandard.standard.conditions.length > 0 }}">
            <view wx:for="{{ selectedStandard.standard.conditions }}" wx:key="index" class="condition-detail">
              â€¢ {{ item }}
            </view>
          </view>
          <view wx:elif="{{ selectedStandard.standard.length > 0 }}">
            <view wx:for="{{ selectedStandard.standard }}" wx:key="assessment" class="assessment-item">
              <view wx:if="{{ item.conditions }}" class="assessment-conditions">
                <view wx:for="{{ item.conditions }}" wx:key="index" class="condition-detail">
                  â€¢ {{ item }}
                </view>
              </view>
            </view>
          </view>
          <view wx:else>
            æš‚æ— è¯„å®šæ¡ä»¶
          </view>
        </view>
      </view>
      
      <view class="detail-section">
        <view class="detail-label">è¯„å®šæ ‡å‡†</view>
        <view class="detail-content">
          <view wx:if="{{ selectedStandard.standard.assessment }}" class="assessment-item">
            {{ selectedStandard.standard.assessment }}
          </view>
          <view wx:if="{{ selectedStandard.standard.length > 0 }}" class="assessment-group">
            <view wx:for="{{ selectedStandard.standard }}" wx:key="assessment" class="assessment-item">
              <view class="assessment-type">{{ item.assessment }}</view>
              <view wx:if="{{ item.conditions }}" class="assessment-conditions">
                <view wx:for="{{ item.conditions }}" wx:key="*this" class="condition-detail">
                  â€¢ {{ item }}
                </view>
              </view>
            </view>
          </view>
        </view>
      </view>
      
      <view class="detail-section">
        <view class="detail-label">æ•°æ®æ¥æº</view>
        <view class="detail-content disclaimer-content">
          ã€Šæ°‘ç”¨èˆªç©ºä½“æ£€é‰´å®šåŒ»å­¦æ ‡å‡†å®æ–½ç»†åˆ™ã€‹(AC-67FS-001R2)
        </view>
      </view>
    </scroll-view>
  </view>
  
  <view wx:else class="detail-popup">
    <view class="popup-header">
      <view class="popup-title">åŠ è½½ä¸­...</view>
    </view>
    <view class="popup-content">
      <view class="detail-section">
        <view class="detail-content">æ­£åœ¨åŠ è½½æ ‡å‡†è¯¦æƒ…...</view>
      </view>
    </view>
  </view>
</van-popup>

<van-toast id="van-toast" />