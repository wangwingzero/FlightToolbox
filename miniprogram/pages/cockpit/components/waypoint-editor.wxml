<!--
  航点编辑器组件
  用于创建和编辑航点的弹窗界面
-->

<view class="waypoint-editor-overlay" wx:if="{{visible}}" catchtap="onOverlayTap">
  <view class="waypoint-editor-modal" catchtap="onModalTap">
    
    <!-- 标题栏 -->
    <view class="editor-header">
      <text class="editor-title">{{editMode ? '编辑航点' : '创建航点'}}</text>
      <view class="close-btn" catchtap="onClose">
        <text class="close-icon">×</text>
      </view>
    </view>
    
    <!-- 地形信息显示（如果有） -->
    <view class="terrain-info" wx:if="{{terrainInfo}}">
      <view class="terrain-item">
        <text class="terrain-label">地形高度:</text>
        <text class="terrain-value">{{terrainInfo.elevation}}米</text>
      </view>
      <view class="terrain-elevation-bar" style="background-color: {{terrainInfo.elevationColor}}"></view>
    </view>
    
    <!-- 航点设置表单 -->
    <scroll-view class="editor-content" scroll-y="true">
      
      <!-- 航点名称 -->
      <view class="form-group">
        <text class="form-label">航点名称</text>
        <input 
          class="form-input"
          placeholder="请输入航点名称"
          value="{{waypointData.name}}"
          bindinput="onNameInput"
          maxlength="20"
        />
      </view>
      
      <!-- 坐标输入 -->
      <view class="form-group">
        <text class="form-label">坐标信息</text>
        
        <!-- 纬度输入 -->
        <view class="coordinate-row">
          <text class="coordinate-label">纬度:</text>
          <view class="coordinate-inputs">
            <input 
              class="coord-input"
              type="number"
              placeholder="度"
              value="{{coordinateDisplay.latDeg}}"
              bindinput="onLatDegInput"
              maxlength="2"
            />
            <text class="coord-unit">°</text>
            <input 
              class="coord-input"
              type="number"
              placeholder="分"
              value="{{coordinateDisplay.latMin}}"
              bindinput="onLatMinInput"
              maxlength="2"
            />
            <text class="coord-unit">'</text>
            <input 
              class="coord-input coord-sec"
              type="digit"
              placeholder="秒"
              value="{{coordinateDisplay.latSec}}"
              bindinput="onLatSecInput"
              maxlength="6"
            />
            <text class="coord-unit">"</text>
            <picker 
              class="coord-picker"
              range="{{['N', 'S']}}"
              value="{{coordinateDisplay.latHem}}"
              bindchange="onLatHemChange"
            >
              <text class="picker-text">{{coordinateDisplay.latHem === 0 ? 'N' : 'S'}}</text>
            </picker>
          </view>
        </view>
        
        <!-- 经度输入 -->
        <view class="coordinate-row">
          <text class="coordinate-label">经度:</text>
          <view class="coordinate-inputs">
            <input 
              class="coord-input"
              type="number"
              placeholder="度"
              value="{{coordinateDisplay.lngDeg}}"
              bindinput="onLngDegInput"
              maxlength="3"
            />
            <text class="coord-unit">°</text>
            <input 
              class="coord-input"
              type="number"
              placeholder="分"
              value="{{coordinateDisplay.lngMin}}"
              bindinput="onLngMinInput"
              maxlength="2"
            />
            <text class="coord-unit">'</text>
            <input 
              class="coord-input coord-sec"
              type="digit"
              placeholder="秒"
              value="{{coordinateDisplay.lngSec}}"
              bindinput="onLngSecInput"
              maxlength="6"
            />
            <text class="coord-unit">"</text>
            <picker 
              class="coord-picker"
              range="{{['E', 'W']}}"
              value="{{coordinateDisplay.lngHem}}"
              bindchange="onLngHemChange"
            >
              <text class="picker-text">{{coordinateDisplay.lngHem === 0 ? 'E' : 'W'}}</text>
            </picker>
          </view>
        </view>
        
        <!-- 小数坐标显示 -->
        <view class="decimal-coords">
          <text class="decimal-label">小数坐标:</text>
          <text class="decimal-value">{{formatDecimalCoords(waypointData.lat, waypointData.lng)}}</text>
        </view>
        
        <!-- 快速定位按钮 -->
        <view class="quick-actions">
          <button class="quick-btn" size="mini" catchtap="onCurrentLocation">当前位置</button>
          <button class="quick-btn" size="mini" catchtap="onMapSelect">地图选择</button>
        </view>
      </view>
      
      <!-- 提醒设置 -->
      <view class="form-group">
        <text class="form-label">到达提醒</text>
        
        <!-- 提醒开关 -->
        <view class="switch-row">
          <text class="switch-label">启用提醒</text>
          <switch 
            class="form-switch"
            checked="{{waypointData.enabled}}"
            bindchange="onEnabledChange"
            color="#FF6600"
          />
        </view>
        
        <!-- 提醒半径 -->
        <view class="slider-row" wx:if="{{waypointData.enabled}}">
          <text class="slider-label">提醒距离: {{waypointData.alertRadius}}海里</text>
          <slider 
            class="form-slider"
            min="0.5"
            max="20"
            step="0.5"
            value="{{waypointData.alertRadius}}"
            bindchange="onAlertRadiusChange"
            activeColor="#FF6600"
            show-value="false"
          />
          <view class="slider-marks">
            <text class="mark-text">0.5</text>
            <text class="mark-text">5</text>
            <text class="mark-text">10</text>
            <text class="mark-text">20</text>
          </view>
        </view>
      </view>
      
      <!-- 航点类型 -->
      <view class="form-group">
        <text class="form-label">航点类型</text>
        <picker 
          class="form-picker"
          range="{{waypointTypes}}"
          range-key="name"
          value="{{waypointTypeIndex}}"
          bindchange="onTypeChange"
        >
          <view class="picker-display">
            <text class="picker-value">{{waypointTypes[waypointTypeIndex].name}}</text>
            <text class="picker-arrow">></text>
          </view>
        </picker>
      </view>
      
      <!-- 航点颜色 -->
      <view class="form-group">
        <text class="form-label">标记颜色</text>
        <view class="color-options">
          <view 
            class="color-option {{waypointData.color === item ? 'selected' : ''}}"
            wx:for="{{colorOptions}}"
            wx:key="*this"
            style="background-color: {{item}}"
            catchtap="onColorSelect"
            data-color="{{item}}"
          >
            <text class="color-check" wx:if="{{waypointData.color === item}}">✓</text>
          </view>
        </view>
      </view>
      
      <!-- 备注信息 -->
      <view class="form-group">
        <text class="form-label">备注信息</text>
        <textarea 
          class="form-textarea"
          placeholder="可选的备注信息..."
          value="{{waypointData.notes}}"
          bindinput="onNotesInput"
          maxlength="200"
          auto-height="true"
        />
        <text class="char-count">{{waypointData.notes.length}}/200</text>
      </view>
      
    </scroll-view>
    
    <!-- 操作按钮 -->
    <view class="editor-actions">
      <button 
        class="action-btn cancel-btn"
        catchtap="onCancel"
      >取消</button>
      
      <button 
        class="action-btn delete-btn"
        catchtap="onDelete"
        wx:if="{{editMode}}"
      >删除</button>
      
      <button 
        class="action-btn confirm-btn"
        catchtap="onConfirm"
        disabled="{{!isValid}}"
      >{{editMode ? '保存' : '创建'}}</button>
    </view>
    
  </view>
</view>