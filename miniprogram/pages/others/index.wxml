<view class="{{ containerClass || 'container' }}">
  <!-- 用户状态卡片 - 整合积分和个人信息 -->
  <view class="user-status-card">
    <view class="status-header">
      <view class="user-avatar" bind:tap="showProductPhilosophy">
        <text class="emoji-icon">👨‍✈️</text>
        <view class="avatar-ring"></view>
      </view>
      <view class="user-info">
        <view class="greeting">{{ greeting }}</view>
      </view>
      <view class="points-display">
        <view class="points-value">{{ userPoints }}</view>
        <view class="points-unit">积分</view>
        <view class="points-ring" bind:tap="showPointsDetail"></view>
      </view>
    </view>
    
    <!-- 快速操作区 -->
    <view class="quick-actions">
      <view class="action-item signin-button {{ canSignIn ? '' : 'checked' }}" bind:tap="dailySignIn" wx:if="{{ canSignIn }}">
        <view class="action-icon">
          <text class="emoji-icon">⭐</text>
        </view>
        <view class="action-content">
          <text class="action-text">每日签到</text>
        </view>
        <view class="action-ripple"></view>
      </view>
      <view class="action-item checked" wx:else>
        <view class="action-icon">
          <text class="emoji-icon">✅</text>
        </view>
        <view class="action-content">
          <text class="action-text">已签到</text>
        </view>
      </view>
      
      <view class="action-item watch-ad-button" bind:tap="watchAdForPoints" wx:if="{{ remainingAdToday > 0 }}">
        <view class="action-icon">
          <text class="emoji-icon">📺</text>
        </view>
        <view class="action-content">
          <text class="action-text">观看视频</text>
          <text class="action-badge">+{{ currentAdReward }}</text>
        </view>
        <view class="action-ripple"></view>
      </view>
      
      <view class="action-item points-rules-button" bind:tap="showPointsRules">
        <view class="action-icon">
          <text class="emoji-icon">❓</text>
        </view>
        <view class="action-content">
          <text class="action-text">积分规则</text>
        </view>
        <view class="action-ripple"></view>
      </view>
    </view>
    
    <!-- 连续签到提示 -->
    <view class="streak-display" wx:if="{{ signInStreak > 0 }}">
      <text class="emoji-icon">🔥</text>
      <text class="streak-text">连续签到 {{ signInStreak }} 天，继续保持！</text>
      <view class="streak-flame"></view>
    </view>
  </view>

  <!-- 资质提醒卡片 -->
  <!-- 有资质数据时显示 -->
  <view wx:if="{{ qualifications.length > 0 }}" class="qualification-alert-card">
    <view class="alert-header">
      <view class="alert-icon">
        <text class="emoji-icon">🛡️</text>
      </view>
      <view class="alert-content">
        <text class="alert-title">资质提醒</text>
        <text class="alert-subtitle" wx:if="{{ expiringSoonCount > 0 }}">{{ expiringSoonCount }}项即将到期</text>
        <text class="alert-subtitle all-valid" wx:else>全部有效</text>
      </view>
      <view class="alert-action" bind:tap="openQualificationManager">
        <text class="emoji-icon">→</text>
      </view>
    </view>
    
    <scroll-view class="qualification-scroll" scroll-x="{{ true }}" show-scrollbar="{{ false }}">
      <view class="qualification-items">
        <view 
          wx:for="{{ qualifications }}" 
          wx:key="id"
          class="qualification-item qualification-{{ item.status }}"
          bind:tap="openQualificationManager"
        >
          <view class="qual-status-dot"></view>
          <view class="qual-content">
            <view class="qual-name">{{ item.name }}</view>
            <view class="qual-status">
              <text wx:if="{{ item.daysRemaining > 0 }}">{{ item.daysRemaining }}天后到期</text>
              <text wx:elif="{{ item.daysRemaining === 0 }}">今日到期</text>
              <text wx:else>已过期</text>
            </view>
          </view>
          <view class="qual-icon">
            <text class="emoji-icon">
              {{ item.status === 'expired' ? '❌' : item.status === 'warning' ? '⚠️' : '✅' }}
            </text>
          </view>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- 新用户空状态：引导使用资质管理 -->
  <view wx:else class="qualification-empty-state">
    <view class="empty-state-content">
      <view class="empty-state-icon">
        <text class="emoji-icon">📜</text>
        <view class="icon-sparkle">✨</view>
      </view>
      <view class="empty-state-text">
        <text class="empty-title">开始管理您的飞行资质</text>
        <text class="empty-subtitle">证照到期提醒，让飞行更安心</text>
      </view>
      <view class="empty-state-action" bind:tap="openQualificationManager">
        <text class="action-text">添加第一个资质</text>
        <text class="emoji-icon">→</text>
      </view>
    </view>
  </view>

  <!-- TODO待办清单卡片 -->
  <view class="todo-alert-card">
    <view class="alert-header">
      <view class="alert-icon">
        <text class="emoji-icon">📋</text>
      </view>
      <view class="alert-content">
        <text class="alert-title">待办清单</text>
        <text class="alert-subtitle" wx:if="{{ todoStats.pending > 0 }}">{{ todoStats.pending }}项待完成</text>
        <text class="alert-subtitle all-complete" wx:else>暂无待办</text>
      </view>
      <view class="alert-action" bind:tap="openTodoManager">
        <text class="emoji-icon">→</text>
      </view>
    </view>
    
    <!-- 待办事项预览 -->
    <scroll-view class="todo-scroll" scroll-x="{{ true }}" show-scrollbar="{{ false }}" wx:if="{{ recentTodos.length > 0 }}">
      <view class="todo-items">
        <view 
          wx:for="{{ recentTodos }}" 
          wx:key="id"
          class="todo-item todo-{{ item.priority }}"
          bind:tap="openTodoManager"
        >
          <view class="todo-status-dot {{ item.completed ? 'completed' : '' }}"></view>
          <view class="todo-content">
            <view class="todo-title">{{ item.title }}</view>
            <view class="todo-meta">
              <text wx:if="{{ item.dueDate }}">{{ formatTodoDate(item.dueDate) }}</text>
              <text wx:if="{{ item.category }}" class="todo-category">{{ item.category }}</text>
            </view>
          </view>
          <view class="todo-priority-icon">
            <text class="emoji-icon">
              {{ item.priority === 'high' ? '🔴' : item.priority === 'medium' ? '🟡' : '🟢' }}
            </text>
          </view>
        </view>
      </view>
    </scroll-view>
    
    <!-- 空状态显示 -->
    <view class="todo-empty-state" wx:else>
      <view class="empty-todo-content">
        <view class="empty-todo-icon">
          <text class="emoji-icon">✨</text>
        </view>
        <view class="empty-todo-text">
          <text class="empty-todo-title">开始管理您的待办事项</text>
          <text class="empty-todo-subtitle">记录重要任务，提升工作效率</text>
        </view>
        <view class="empty-todo-action" bind:tap="openTodoManager">
          <text class="action-text">添加第一个待办</text>
          <text class="emoji-icon">→</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 工具分类区域 -->
  <view class="tools-categories feature-buttons">
    <!-- 飞行计算工具 -->
    <view class="category-section">
      <view class="category-header">
        <view class="category-icon">
          <text class="emoji-icon">🧮</text>
          <view class="icon-bg flight-calc-bg"></view>
        </view>
        <view class="category-info">
          <text class="category-title">飞行计算</text>
          <text class="category-desc">精确计算，安全飞行</text>
        </view>
        <view class="category-badge">3</view>
      </view>
      <van-row gutter="32">
        <van-col span="12">
          <view class="tool-card flight-calc" bind:tap="openTwinEngineGoAround">
            <view class="tool-icon">
              <text class="emoji-icon">🛫</text>
              <view class="tool-icon-bg"></view>
            </view>
            <view class="tool-content">
              <view class="tool-name">双发复飞梯度</view>
              <view class="tool-desc">梯度计算分析</view>
              <view class="tool-status">
                <van-tag type="warning" size="mini">3积分</van-tag>
              </view>
            </view>
          </view>
        </van-col>
        <van-col span="12">
          <view class="tool-card flight-calc" bind:tap="openSunriseOnly">
            <view class="tool-icon">
              <text class="emoji-icon">🌅</text>
              <view class="tool-icon-bg"></view>
            </view>
            <view class="tool-content">
              <view class="tool-name">日出日落</view>
              <view class="tool-desc">时间查询</view>
              <view class="tool-status">
                <van-tag type="warning" size="mini">1积分</van-tag>
              </view>
            </view>
          </view>
        </van-col>
      </van-row>
      <van-row gutter="32">
        <van-col span="12">
          <view class="tool-card flight-calc" bind:tap="openSunriseSunset">
            <view class="tool-icon">
              <text class="emoji-icon">🌙</text>
              <view class="tool-icon-bg"></view>
            </view>
            <view class="tool-content">
              <view class="tool-name">夜航时间</view>
              <view class="tool-desc">夜间计算</view>
              <view class="tool-status">
                <van-tag type="primary" size="mini">2积分</van-tag>
              </view>
            </view>
          </view>
        </van-col>
        <van-col span="12">
          <view class="tool-card flight-calc" bind:tap="openFlightCalculator">
            <view class="tool-icon">
              <text class="emoji-icon">🧮</text>
              <view class="tool-icon-bg"></view>
            </view>
            <view class="tool-content">
              <view class="tool-name">飞行计算工具</view>
              <view class="tool-desc">整合计算集合</view>
              <view class="tool-status">
                <van-tag type="warning" size="mini">2积分</van-tag>
              </view>
            </view>
          </view>
        </van-col>
      </van-row>
    </view>

    <!-- 飞行管理工具 -->
    <view class="category-section">
      <view class="category-header">
        <view class="category-icon">
          <text class="emoji-icon">📋</text>
          <view class="icon-bg management-bg"></view>
        </view>
        <view class="category-info">
          <text class="category-title">飞行管理</text>
          <text class="category-desc">规范管理，高效运行</text>
        </view>
        <view class="category-badge">6</view>
      </view>
      <van-row gutter="32">
        <van-col span="12">
          <view class="tool-card management" bind:tap="openEventReport">
            <view class="tool-icon">
              <text class="emoji-icon">📝</text>
              <view class="tool-icon-bg"></view>
            </view>
            <view class="tool-content">
              <view class="tool-name">事件报告</view>
              <view class="tool-desc">样例填写指导</view>
              <view class="tool-status">
                <van-tag type="warning" size="mini">3积分</van-tag>
              </view>
            </view>
          </view>
        </van-col>
        <van-col span="12">
          <view class="tool-card management" bind:tap="openFlightTimeShare">
            <view class="tool-icon">
              <text class="emoji-icon">⏰</text>
              <view class="tool-icon-bg"></view>
            </view>
            <view class="tool-content">
              <view class="tool-name">分飞行时间</view>
              <view class="tool-desc">计算分享</view>
              <view class="tool-status">
                <van-tag type="primary" size="mini">2积分</van-tag>
              </view>
            </view>
          </view>
        </van-col>
      </van-row>
      
      <!-- 第二行：个人检查单和资质管理 -->
      <van-row gutter="32">
        <van-col span="12">
          <view class="tool-card management" bind:tap="openPersonalChecklist">
            <view class="tool-icon">
              <text class="emoji-icon">✅</text>
              <view class="tool-icon-bg"></view>
            </view>
            <view class="tool-content">
              <view class="tool-name">个人检查单</view>
              <view class="tool-desc">自定义清单</view>
              <view class="tool-status">
                <van-tag type="success" size="mini">免费</van-tag>
              </view>
            </view>
          </view>
        </van-col>
        <van-col span="12">
          <view class="tool-card management" bind:tap="openQualificationManager">
            <view class="tool-icon">
              <text class="emoji-icon">📜</text>
              <view class="tool-icon-bg"></view>
            </view>
            <view class="tool-content">
              <view class="tool-name">资质管理</view>
              <view class="tool-desc">证照管理</view>
              <view class="tool-status">
                <van-tag type="success" size="mini">免费</van-tag>
              </view>
            </view>
          </view>
        </van-col>
      </van-row>

      <!-- 第三行：长航线换班 -->
      <van-row gutter="32">
        <van-col span="12">
          <view class="tool-card management" bind:tap="openLongFlightCrewRotation">
            <view class="tool-icon">
              <text class="emoji-icon">🔄</text>
              <view class="tool-icon-bg"></view>
            </view>
            <view class="tool-content">
              <view class="tool-name">长航线换班</view>
              <view class="tool-desc">机组换班计算</view>
              <view class="tool-status">
                <van-tag type="warning" size="mini">3积分</van-tag>
              </view>
            </view>
          </view>
        </van-col>
        <van-col span="12">
          <view class="tool-card management" bind:tap="openTodoManager">
            <view class="tool-icon">
              <text class="emoji-icon">📋</text>
              <view class="tool-icon-bg"></view>
            </view>
            <view class="tool-content">
              <view class="tool-name">待办清单</view>
              <view class="tool-desc">任务管理</view>
              <view class="tool-status">
                <van-tag type="success" size="mini">免费</van-tag>
              </view>
            </view>
          </view>
        </van-col>
      </van-row>
    </view>



    <!-- 特殊情况工具 -->
    <view class="category-section">
      <view class="category-header">
        <view class="category-icon">
          <text class="emoji-icon">⚠️</text>
          <view class="icon-bg special-bg"></view>
        </view>
        <view class="category-info">
          <text class="category-title">特殊情况</text>
          <text class="category-desc">应急处置，专业应对</text>
        </view>
        <view class="category-badge">2</view>
      </view>
      <van-row gutter="16" class="tools-grid">
        <van-col span="12">
          <view 
            class="tool-card special"
            bind:tap="openSnowtamDecoder"
          >
            <view class="tool-icon">
              <text class="emoji-icon">❄️</text>
              <view class="tool-icon-bg"></view>
            </view>
            <view class="tool-content">
              <view class="tool-name">雪情通告</view>
              <view class="tool-desc">SNOWTAM解读</view>
              <view class="tool-status">
                <van-tag type="warning" size="mini">3积分</van-tag>
              </view>
            </view>
          </view>
        </van-col>
        
        <van-col span="12">
          <view 
            class="tool-card special"
            bind:tap="openDangerousGoods"
          >
            <view class="tool-icon">
              <text class="emoji-icon">☢️</text>
              <view class="tool-icon-bg"></view>
            </view>
            <view class="tool-content">
              <view class="tool-name">危险品</view>
              <view class="tool-desc">规定查询助手</view>
              <view class="tool-status">
                <van-tag type="warning" size="mini">3积分</van-tag>
              </view>
            </view>
          </view>
        </van-col>
      </van-row>
    </view>
  </view>

  <!-- 广告区域已移除 -->

  <!-- 关注公众号区域 -->
  <view class="category-section wechat-section">
    <view class="category-header">
      <view class="category-icon">
        <text class="emoji-icon">💬</text>
        <view class="icon-bg wechat-bg"></view>
      </view>
              <view class="category-info">
          <text class="category-title">飞行播客</text>
          <text class="category-desc">让我们用一种新的方式来学飞行</text>
        </view>
      <view class="category-badge">NEW</view>
    </view>
    
          <view class="wechat-content">
        <!-- 直接跳转按钮（使用最新API） -->
        <view class="direct-jump-action">
          <van-button 
            type="primary" 
            size="normal"
            class="jump-button"
            bind:click="jumpToOfficialAccount">
            进入飞行播客
          </van-button>
        </view>
      
      <!-- 直接显示二维码图片 -->
      <view class="qr-display">
        <image 
          class="qr-code-image" 
          src="/images/OfficialAccount.png"
          mode="aspectFit"
          bind:tap="previewQRCode"
          show-menu-by-longpress="{{true}}"
        />
                  <text class="qr-hint">长按识别二维码关注"飞行播客"</text>
      </view>
    </view>
  </view>

  <!-- 应用信息卡片 -->
  <view class="app-info-card">
    <view class="info-header">
      <view class="info-icon">
        <text class="emoji-icon">ℹ️</text>
      </view>
      <text class="info-title">应用信息</text>
    </view>
    
    <van-cell-group class="info-group" border="{{ false }}">
      <van-cell 
        title="版本信息" 
        value="v1.1.9"
        icon="upgrade"
        class="info-cell"
        bind:click="onVersionTap"
      />

      <van-cell 
        title="意见反馈" 
        is-link 
        bind:click="feedback"
        icon="chat-o"
        class="info-cell"
      />
      <van-cell 
        title="关于作者" 
        is-link 
        bind:click="aboutUs"
        icon="contact"
        class="info-cell"
      />
    </van-cell-group>
  </view>

  <!-- 应用信息卡片 -->
  <view class="warning-notice">
    <view class="warning-icon">
      <text class="emoji-icon">⚠️</text>
    </view>
    <view class="warning-content">
      本小程序旨在帮助飞行员学习航空理论知识，包括性能计算、概念理解、规章条例等内容。但请注意：所有计算逻辑均基于作者个人理解编写，可能存在错误且未经官方验证。因此，本小程序所有数据仅供学习参考，严禁用于实际飞行操作！
    </view>
  </view>

  <!-- 积分详情弹窗 -->
  <van-popup
    show="{{ showPointsModal }}"
    position="bottom"
    bind:close="closePointsModal"
    round="{{ true }}"
    safe-area-inset-bottom="{{ true }}"
    class="points-popup"
    custom-style="height: 80vh;"
  >
    <view class="modal-container">
      <view class="modal-content">
        <view class="modal-header">
          <text class="modal-title">积分详情</text>
          <text class="emoji-icon close-icon" bind:tap="closePointsModal">✕</text>
        </view>
        
        <view class="current-points">
          <view class="points-circle">
            <text class="points-amount">{{ userPoints }}</text>
          </view>
          <text class="points-label">当前积分</text>
        </view>
        
        <view class="transactions-list">
          <text class="list-title">最近记录</text>
          <view wx:for="{{ pointsTransactions }}" wx:key="index" class="transaction-item">
            <view class="transaction-info">
              <view class="transaction-icon">
                <text class="emoji-icon">{{ item.amount > 0 ? '➕' : '➖' }}</text>
              </view>
              <view class="transaction-details">
                <text class="transaction-type">{{ formatTransactionType(item.type) }}</text>
                <text class="transaction-desc" wx:if="{{ item.description }}">{{ item.description }}</text>
                <text class="transaction-time">{{ formatTransactionTime(item.timestamp) }}</text>
              </view>
            </view>
            <text class="transaction-amount {{ item.amount > 0 ? 'positive' : 'negative' }}">
              {{ item.amount > 0 ? '+' : '' }}{{ item.amount }}
            </text>
          </view>
          
          <!-- 显示更多记录提示 -->
          <view wx:if="{{ pointsTransactions.length === 0 }}" class="no-transactions">
            <text class="emoji-icon large">📊</text>
            <text class="no-transactions-text">暂无积分记录</text>
          </view>
          
          <view wx:if="{{ pointsTransactions.length >= 100 }}" class="more-records-hint">
            <text class="hint-text">仅显示最近100条记录</text>
          </view>
        </view>
      </view>
      
      <view class="modal-footer safe-area-bottom">
        <van-button type="primary" block round bind:click="closePointsModal">
          关闭
        </van-button>
      </view>
    </view>
  </van-popup>

  <!-- 签到成功弹窗 -->
  <van-popup
    show="{{ showSignInModal }}"
    position="center"
    bind:close="closeSignInModal"
    round="{{ true }}"
    class="signin-popup"
    custom-style="min-width: 600rpx;"
  >
    <view class="modal-container">
      <view class="modal-content">
        <view class="signin-success">
          <view class="success-animation">
            <text class="emoji-icon extra-large">⭐</text>
            <view class="success-glow"></view>
          </view>
          <text class="success-title">签到成功!</text>
          <text class="success-subtitle">获得 {{ signInResult.pointsEarned }} 积分</text>
          
          <view class="signin-stats">
            <view class="stat-item">
              <text class="stat-value">{{ signInResult.consecutiveDays }}</text>
              <text class="stat-label">连续签到天数</text>
            </view>
            <view class="stat-divider"></view>
            <view class="stat-item">
              <text class="stat-value">{{ signInResult.nextSignInReward }}</text>
              <text class="stat-label">下次签到积分</text>
            </view>
          </view>
        </view>
      </view>
      
      <view class="modal-footer">
        <van-button type="primary" block round bind:click="closeSignInModal">
          太棒了
        </van-button>
      </view>
    </view>
  </van-popup>

  <!-- 积分规则弹窗 -->
  <van-popup
    show="{{ showPointsRulesModal }}"
    position="bottom"
    bind:close="closePointsRulesModal"
    round="{{ true }}"
    safe-area-inset-bottom="{{ true }}"
    class="points-rules-popup"
  >
    <view class="points-rules-modal">
      <!-- 弹窗头部 -->
      <view class="modal-header">
        <text class="modal-title">🎯 积分规则说明</text>
        <text class="emoji-icon close-icon" bind:tap="closePointsRulesModal">✕</text>
      </view>
      
      <view class="rules-content">
        <!-- 获取积分卡片 -->
        <view class="rule-card earn-card">
          <view class="card-header">
            <text class="emoji-icon">➕</text>
            <text class="card-title">如何获取积分</text>
          </view>
          <view class="card-content">
            <view class="earn-item">
              <view class="earn-icon">
                <text class="emoji-icon">📅</text>
              </view>
              <view class="earn-info">
                <text class="earn-title">每日签到</text>
                <text class="earn-desc">首次15积分，连续2天20积分，连续7天30积分，连续30天50积分</text>
              </view>
            </view>
            <view class="earn-item">
              <view class="earn-icon">
                <text class="emoji-icon">▶️</text>
              </view>
              <view class="earn-info">
                <text class="earn-title">观看广告</text>
                <text class="earn-desc">40积分/个，每天最多3个</text>
              </view>
            </view>

          </view>
        </view>

        <!-- 功能计费卡片 -->
        <view class="rule-card cost-card">
          <view class="card-header">
            <text class="emoji-icon">💎</text>
            <text class="card-title">功能计费标准</text>
          </view>
          <view class="card-content">
            <!-- 免费功能 -->
            <view class="cost-category">
              <view class="category-header">
                <text class="emoji-icon small">🔥</text>
                <text class="category-title">免费功能</text>
              </view>
              <text class="cost-item">• 个人检查单</text>
              <text class="cost-item">• 资质管理</text>
              <text class="cost-item">• 待办清单</text>
            </view>
            
            <!-- 基础功能 -->
            <view class="cost-category">
              <view class="category-header">
                <text class="emoji-icon small">🧮</text>
                <text class="category-title">基础功能 (1积分)</text>
              </view>
              <text class="cost-item">• 飞行速算</text>
              <text class="cost-item">• 常用换算</text>
              <text class="cost-item">• 日出日落时间</text>
            </view>
            
            <!-- 中级功能 -->
            <view class="cost-category">
              <view class="category-header">
                <text class="emoji-icon small">📱</text>
                <text class="category-title">中级功能 (2积分)</text>
              </view>
              <text class="cost-item">• 特殊计算</text>
              <text class="cost-item">• 万能查询</text>
              <text class="cost-item">• 夜航时间计算</text>
              <text class="cost-item">• 分飞行时间</text>
            </view>
            
            <!-- 高级功能 -->
            <view class="cost-category">
              <view class="category-header">
                <text class="emoji-icon small">✏️</text>
                <text class="category-title">高级功能 (3积分)</text>
              </view>
              <text class="cost-item">• 事件报告样例</text>
              <text class="cost-item">• 雪情通告解码</text>
              <text class="cost-item">• 危险品查询</text>
              <text class="cost-item">• 双发复飞梯度</text>
              <text class="cost-item">• 长航线换班</text>
            </view>
          </view>
        </view>

        <!-- 使用建议卡片 -->
        <view class="rule-card tips-card">
          <view class="card-header">
            <text class="emoji-icon">💡</text>
            <text class="card-title">使用建议</text>
          </view>
          <view class="card-content">
            <view class="tip-item">
              <text class="emoji-icon small">✅</text>
              <text class="tip-text">每日签到是最稳定的积分来源</text>
            </view>
            <view class="tip-item">
              <text class="emoji-icon small">✅</text>
              <text class="tip-text">观看3个广告可满足大部分需求</text>
            </view>
            <view class="tip-item">
              <text class="emoji-icon small">✅</text>
              <text class="tip-text">免费功能可无限制使用</text>
            </view>
            <view class="tip-item">
              <text class="emoji-icon small">✅</text>
              <text class="tip-text">积分在进入页面时扣除，页面内可重复使用</text>
            </view>
          </view>
        </view>

        <!-- 关于积分制度入口 -->
        <view class="rule-card philosophy-card">
          <view class="card-header">
            <text class="emoji-icon">❤️</text>
            <text class="card-title">关于积分制度</text>
          </view>
          <view class="card-content">
            <view class="philosophy-entry" bind:tap="showProductPhilosophy">
              <text class="philosophy-text">听听作者的话</text>
              <text class="emoji-icon small">→</text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </van-popup>

  <!-- 🎯 新增：产品理念说明弹窗 -->
  <van-popup
    show="{{ showProductPhilosophyModal }}"
    position="bottom"
    bind:close="closeProductPhilosophyModal"
    round="{{ true }}"
    safe-area-inset-bottom="{{ true }}"
    class="philosophy-popup"
  >
    <view class="philosophy-modal">
      <view class="modal-header">
        <text class="modal-title">💝 作者的话</text>
        <text class="emoji-icon close-icon" bind:tap="closeProductPhilosophyModal">✕</text>
      </view>
      
      <view class="philosophy-content">
        <!-- 产品理念说明 -->
        <view class="philosophy-text">
          <view class="paragraph">
            <text class="text-content">感谢您选择飞行工具箱！这段时间收到了许多飞行朋友的关心，有朋友建议我推出付费版本，认为这样可以更好地支持开发和维护。确实，维护和投入都需要成本。</text>
          </view>
          
          <view class="paragraph">
            <text class="text-content">但我的初衷就是想让大家都能不花一分钱使用这些工具。为了找到一个平衡点，最终想到了积分制，这样既能支持小程序的持续发展，又能让大家继续免费使用，保持纯粹的体验。</text>
          </view>
          
          <view class="paragraph">
            <text class="text-content">你每一次的签到和支持，都是对我最大的鼓励。</text>
          </view>
          
          <view class="paragraph highlight">
            <view class="highlight-content">
              <text class="emoji-icon">💖</text>
              <text class="highlight-text">感谢您的理解与陪伴，让我们一起创造更美好的飞行体验！</text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </van-popup>

  <!-- 事件报告详情弹窗 -->
  <van-popup
    show="{{ showReportDetailModal }}"
    position="bottom"
    bind:close="closeReportDetail"
    round="{{ true }}"
    safe-area-inset-bottom="{{ true }}"
    class="report-detail-popup"
  >
    <view class="report-detail-modal">
      <view class="modal-header">
        <text class="modal-title">事件报告详情</text>
        <text class="emoji-icon close-icon" bind:tap="closeReportDetail">✕</text>
      </view>
      
      <view class="detail-content">
        <text class="detail-text" user-select>{{selectedReport.generatedText}}</text>
      </view>
      <van-grid column-num="3" border="{{ false }}" gutter="{{ 10 }}">
        <van-grid-item use-slot>
          <van-button type="default" block bind:click="copySelectedReport">复制</van-button>
        </van-grid-item>
        <van-grid-item use-slot>
          <van-button type="danger" block bind:click="deleteSelectedReport">删除</van-button>
        </van-grid-item>
        <van-grid-item use-slot>
          <van-button type="info" block bind:click="closeReportDetail">关闭</van-button>
        </van-grid-item>
      </van-grid>
    </view>
  </van-popup>

  <!-- 公众号二维码弹窗 -->
  <van-popup
    show="{{ showQRCodeModal }}"
    position="center"
    bind:close="closeQRCodeModal"
    round="{{ true }}"
    class="qr-code-popup"
  >
    <view class="qr-modal">
      <view class="modal-header">
        <text class="modal-title">关注公众号</text>
        <text class="emoji-icon close-icon" bind:tap="closeQRCodeModal">✕</text>
      </view>
      
      <view class="qr-content">
        <view class="qr-placeholder">
          <text class="emoji-icon extra-large">💬</text>
          <text class="qr-title">飞行播客</text>
          <text class="qr-id">公众号：飞行播客</text>
          <text class="qr-desc">让我们用一种新的方式来学飞行</text>
        </view>
        
        <view class="qr-benefits">
          <text class="benefits-title">关注后您将获得：</text>
          <view class="benefit-list">
            <view class="benefit-row">
              <text class="emoji-icon small">🎵</text>
              <text>精品飞行音频节目</text>
            </view>
            <view class="benefit-row">
              <text class="emoji-icon small">🔊</text>
              <text>创新的飞行学习方式</text>
            </view>
            <view class="benefit-row">
              <text class="emoji-icon small">👥</text>
              <text>飞行知识互动交流</text>
            </view>
          </view>
        </view>
      </view>
      
      <view class="modal-footer">
        <van-button type="primary" block round bind:click="closeQRCodeModal">
          知道了
        </van-button>
      </view>
    </view>
  </van-popup>





    <!-- 🎯 基于Context7最佳实践：现代化主题设置区域 -->
    <van-cell-group title="主题设置">
      
      <!-- 三选一主题选择器 -->
      <view class="theme-selector-container">
        <view class="theme-options">
          <!-- 跟随系统选项 -->
          <view 
            class="theme-option {{ themeMode === 'auto' ? 'theme-option--active' : '' }}"
            bind:tap="selectThemeMode"
            data-mode="auto"
          >
            <view class="theme-option__icon">
              <text class="emoji-icon">⚙️</text>
            </view>
            <view class="theme-option__content">
              <text class="theme-option__title">跟随系统</text>
              <text class="theme-option__desc">自动切换</text>
            </view>
            <view class="theme-option__indicator">
              <text 
                wx:if="{{ themeMode === 'auto' }}"
                class="emoji-icon small"
              >✅</text>
            </view>
          </view>

          <!-- 强制白天选项 -->
          <view 
            class="theme-option {{ themeMode === 'light' ? 'theme-option--active' : '' }}"
            bind:tap="selectThemeMode"
            data-mode="light"
          >
            <view class="theme-option__icon">
              <text class="emoji-icon">☀️</text>
            </view>
            <view class="theme-option__content">
              <text class="theme-option__title">强制白天</text>
              <text class="theme-option__desc">浅色模式</text>
            </view>
            <view class="theme-option__indicator">
              <text 
                wx:if="{{ themeMode === 'light' }}"
                class="emoji-icon small"
              >✅</text>
            </view>
          </view>

          <!-- 强制夜航选项 -->
          <view 
            class="theme-option {{ themeMode === 'dark' ? 'theme-option--active' : '' }}"
            bind:tap="selectThemeMode"
            data-mode="dark"
          >
            <view class="theme-option__icon">
              <text class="emoji-icon">🌙</text>
            </view>
            <view class="theme-option__content">
              <text class="theme-option__title">强制夜航</text>
              <text class="theme-option__desc">深色模式</text>
            </view>
            <view class="theme-option__indicator">
              <text 
                wx:if="{{ themeMode === 'dark' }}"
                class="emoji-icon small"
              >✅</text>
            </view>
          </view>
        </view>


      </view>

    </van-cell-group>


  <!-- 新增：引导效果分析弹窗 -->
  <van-popup 
    show="{{ showAnalyticsModal }}" 
    bind:close="closeAnalyticsModal"
    position="bottom"
    round="{{ true }}"
    custom-style="height: 70%;"
  >
    <view class="analytics-modal">
      <!-- 标题栏 -->
      <view class="analytics-header">
        <view class="analytics-title">
          <van-icon name="chart-trending-o" size="20px" color="#1989fa" />
          <text class="title-text">引导效果分析</text>
        </view>
        <view class="analytics-close" bind:tap="closeAnalyticsModal">
          <van-icon name="cross" size="18px" />
        </view>
      </view>
      
      <!-- 分析内容 -->
      <scroll-view scroll-y class="analytics-content" wx:if="{{ guideAnalytics }}">
        <!-- 总体统计 -->
        <view class="analytics-section">
          <view class="section-title">📊 总体统计</view>
          <view class="stats-grid">
            <view class="stat-item">
              <view class="stat-number">{{ guideAnalytics.totalInteractions }}</view>
              <view class="stat-label">总交互次数</view>
            </view>
            <view class="stat-item">
              <view class="stat-number">{{ guideAnalytics.completionRate }}%</view>
              <view class="stat-label">完成率</view>
            </view>
            <view class="stat-item">
              <view class="stat-number">{{ guideAnalytics.skipRate }}%</view>
              <view class="stat-label">跳过率</view>
            </view>
            <view class="stat-item">
              <view class="stat-number">{{ guideAnalytics.averageGuideTime / 1000 }}s</view>
              <view class="stat-label">平均时长</view>
            </view>
          </view>
        </view>
        
        <!-- 引导类型分析 -->
        <view class="analytics-section">
          <view class="section-title">🎯 最常用引导</view>
          <view class="guide-type-info">
            <view class="type-badge type-{{ guideAnalytics.mostCommonGuideType }}">
              {{ guideAnalytics.mostCommonGuideType }}
            </view>
            <view class="type-description">用户最常触发的引导类型</view>
          </view>
        </view>
        
        <!-- 最后分析时间 -->
        <view class="analytics-section">
          <view class="section-title">🕒 分析时间</view>
          <view class="analysis-time">{{ guideAnalytics.lastAnalyzed }}</view>
        </view>
      </scroll-view>
      
      <!-- 操作按钮 -->
      <view class="analytics-actions">
        <van-button 
          type="default" 
          size="small" 
          bind:click="exportGuideData"
          custom-style="margin-right: 10px;"
        >
          📤 导出数据
        </van-button>
        <van-button 
          type="danger" 
          size="small" 
          bind:click="clearGuideAnalytics"
        >
          🗑️ 清除数据
        </van-button>
      </view>
    </view>
  </van-popup>
</view> 