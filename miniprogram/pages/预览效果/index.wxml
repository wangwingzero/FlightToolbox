<view class="preview-page">
  <view class="header">
    <text class="title">驾驶舱修复效果预览</text>
    <text class="subtitle">验证 hidden 替代 wx:if 及 safeSetData 更新稳定性</text>
  </view>

  <view class="controls">
    <view class="control-item">
      <text class="label">显示姿态仪</text>
      <switch checked="{{showPanel}}" bindchange="onTogglePanel" />
    </view>
    <view class="control-item">
      <button class="btn" type="primary" bindtap="startSim" disabled="{{simulating}}">开始模拟</button>
      <button class="btn danger" type="warn" bindtap="stopSim" disabled="{{!simulating}}">停止模拟</button>
    </view>
  </view>

  <!-- 预览姿态仪面板：使用 hidden 而非 wx:if，避免销毁重建导致 viewId 失效 -->
  <view id="attitudePreviewPanel" class="panel" hidden="{{!showPanel}}">
    <view class="instrument">
      <view class="horizon" style="transform: translateY({{pitch * -2}}rpx) rotate({{roll}}deg);"></view>
      <view class="overlay">
        <text class="metric">Pitch: {{pitch}}°</text>
        <text class="metric">Roll: {{roll}}°</text>
      </view>
    </view>
    <view class="tips">
      <text>说明：该区域用于模拟姿态变化，验证在高频更新下 safeSetData 的稳定性。</text>
    </view>
  </view>
</view>