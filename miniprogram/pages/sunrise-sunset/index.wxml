<view class="container" data-theme="{{ isDarkMode ? 'dark' : 'light' }}">
  <!-- å¤œèˆªæ—¶é—´è®¡ç®—çŠ¶æ€å¡ç‰‡ -->
  <view class="night-flight-status-card">
    <view class="status-header">
      <view class="flight-avatar">
        <text class="emoji-icon">ğŸŒ™</text>
        <view class="avatar-ring"></view>
      </view>
      <view class="flight-info">
        <view class="flight-title">å¤œèˆªæ—¶é—´è®¡ç®—</view>
        <view class="flight-subtitle">ç²¾ç¡®è®¡ç®—è·¨æ—¶åŒºå¤œé—´é£è¡Œæ—¶é—´</view>
      </view>
      <view class="timezone-switcher" bind:tap="toggleTimeZone">
        <view class="timezone-label">æ—¶åŒº</view>
        <view class="timezone-toggle {{ useBeijingTime ? 'beijing' : 'utc' }}">
          <view class="toggle-track">
            <view class="toggle-thumb"></view>
          </view>
          <view class="timezone-text">{{ useBeijingTime ? 'åŒ—äº¬æ—¶' : 'UTC' }}</view>
        </view>
        <view class="timezone-hint">ç‚¹å‡»åˆ‡æ¢</view>
      </view>
    </view>
    
    <!-- å¤œé—´å®šä¹‰è¯´æ˜ -->
    <view class="night-definition-card">
      <view class="definition-header">
        <text class="emoji-icon small">ğŸ“–</text>
        <text class="definition-title">å¤œé—´å®šä¹‰</text>
      </view>
      <view class="definition-content">
        <text class="definition-text">æŒ‰ç…§ä¸­å›½æ°‘èˆªå±€è§„å®šï¼Œå¤œé—´ä¸ºæ—¥è½å1å°æ—¶è‡³æ—¥å‡ºå‰1å°æ—¶ä¹‹é—´çš„æ—¶é—´æ®µ</text>
        <text class="definition-example">ä¾‹å¦‚ï¼šæ—¥è½18:30ï¼Œæ—¥å‡º06:30 â†’ å¤œé—´ä¸º19:30è‡³05:30</text>
      </view>
    </view>
  </view>

  <!-- å‡ºå‘åœ°ä¿¡æ¯å¡ç‰‡ -->
  <view class="airport-input-card">
    <view class="card-header">
      <text class="emoji-icon">ğŸ›«</text>
      <text class="card-title">å‡ºå‘åœ°ä¿¡æ¯</text>
    </view>
    <view class="input-section">
      <view class="input-wrapper">
        <input 
          class="airport-input"
          value="{{ departureIcaoCode }}"
          placeholder="è¾“å…¥ICAO/IATAä»£ç æˆ–ä¸­æ–‡å"
          bindinput="onDepartureIcaoInput"
          maxlength="20"
          type="text"
          confirm-type="done"
        />
        <view class="input-clear" wx:if="{{ departureIcaoCode }}" bind:tap="clearDepartureInput">
          <text class="emoji-icon small">âŒ</text>
        </view>
      </view>
      <view class="input-hint">æ”¯æŒICAO(ZBAA)ã€IATA(PEK)æˆ–ä¸­æ–‡(åŒ—äº¬)</view>
    </view>
    
    <!-- æ˜¾ç¤ºæŸ¥æ‰¾åˆ°çš„å‡ºå‘æœºåœºä¿¡æ¯ -->
    <view class="airport-info" wx:if="{{ departureAirportInfo }}">
      <view class="info-item">
        <text class="info-label">æœºåœºåç§°</text>
        <text class="info-value">{{ departureAirportInfo.name }}</text>
      </view>
      <view class="info-item">
        <text class="info-label">ICAO/IATA</text>
        <text class="info-value">{{ departureAirportInfo.icaoCode }}{{ departureAirportInfo.iataCode ? '/' + departureAirportInfo.iataCode : '' }}</text>
      </view>
      <view class="info-item">
        <text class="info-label">åœ°åŒº</text>
        <text class="info-value">{{ departureAirportInfo.countryName }}</text>
      </view>
    </view>
    
    <view class="time-selector" bind:tap="showDepartureTimePicker">
      <text class="time-label">å‡ºå‘æ—¶é—´</text>
      <text class="time-value">{{ departureTimeStr || 'ç‚¹å‡»é€‰æ‹©æ—¶é—´' }}</text>
      <text class="emoji-icon small">â°</text>
    </view>
  </view>

    <!-- ğŸ¯ åŸºäºContext7æœ€ä½³å®è·µï¼šå‡ºå‘åœ°å’Œåˆ°è¾¾åœ°ä¹‹é—´çš„å¹¿å‘Š - æ©™è‰²ä¸»é¢˜ -->
    <view class="ad-section departure-arrival-middle-ad" wx:if="{{ showAd }}">
      <text class="ad-label">å¹¿å‘Š</text>
      <ad-template 
        unit-id="{{ adUnitId }}"
        ad-type="custom"
        data-ad-type="DepartureArrivalMiddle"
        data-ad-unit-id="{{ adUnitId }}"
        bind:adload="onAdLoad"
        bind:aderror="onAdError"
      />
    </view>

  <!-- åˆ°è¾¾åœ°ä¿¡æ¯å¡ç‰‡ -->
  <view class="airport-input-card">
    <view class="card-header">
      <text class="emoji-icon">ğŸ›¬</text>
      <text class="card-title">åˆ°è¾¾åœ°ä¿¡æ¯</text>
    </view>
    <view class="input-section">
      <view class="input-wrapper">
        <input 
          class="airport-input"
          value="{{ arrivalIcaoCode }}"
          placeholder="è¾“å…¥ICAO/IATAä»£ç æˆ–ä¸­æ–‡å"
          bindinput="onArrivalIcaoInput"
          maxlength="20"
          type="text"
          confirm-type="done"
        />
        <view class="input-clear" wx:if="{{ arrivalIcaoCode }}" bind:tap="clearArrivalInput">
          <text class="emoji-icon small">âŒ</text>
        </view>
      </view>
      <view class="input-hint">æ”¯æŒICAO(ZSSS)ã€IATA(PVG)æˆ–ä¸­æ–‡(ä¸Šæµ·)</view>
    </view>
    
    <!-- æ˜¾ç¤ºæŸ¥æ‰¾åˆ°çš„åˆ°è¾¾æœºåœºä¿¡æ¯ -->
    <view class="airport-info" wx:if="{{ arrivalAirportInfo }}">
      <view class="info-item">
        <text class="info-label">æœºåœºåç§°</text>
        <text class="info-value">{{ arrivalAirportInfo.name }}</text>
      </view>
      <view class="info-item">
        <text class="info-label">ICAO/IATA</text>
        <text class="info-value">{{ arrivalAirportInfo.icaoCode }}{{ arrivalAirportInfo.iataCode ? '/' + arrivalAirportInfo.iataCode : '' }}</text>
      </view>
      <view class="info-item">
        <text class="info-label">åœ°åŒº</text>
        <text class="info-value">{{ arrivalAirportInfo.countryName }}</text>
      </view>
    </view>
    
    <view class="time-selector" bind:tap="showArrivalTimePicker">
      <text class="time-label">åˆ°è¾¾æ—¶é—´</text>
      <text class="time-value">{{ arrivalTimeStr || 'ç‚¹å‡»é€‰æ‹©æ—¶é—´' }}</text>
      <text class="emoji-icon small">â°</text>
    </view>
  </view>

  <!-- è®¡ç®—æŒ‰é’® -->
  <view class="calculate-section">
    <view class="calculate-button" bind:tap="calculateNightFlightTime">
      <text class="emoji-icon">ğŸ§®</text>
      <text class="button-text">è®¡ç®—å¤œèˆªæ—¶é—´</text>
      <view class="button-ripple"></view>
    </view>
  </view>

  <!-- å¤œèˆªè®¡ç®—ç»“æœå¡ç‰‡ -->
  <view class="results-card" wx:if="{{ nightFlightResults }}">
    <view class="results-header">
      <text class="emoji-icon">ğŸ“Š</text>
      <text class="results-title">å¤œèˆªæ—¶é—´è®¡ç®—ç»“æœ</text>
    </view>
    
    <view class="results-grid">
      <view class="result-item primary">
        <text class="result-label">æ€»é£è¡Œæ—¶é—´</text>
        <text class="result-value">{{ nightFlightResults.totalFlightTime }}</text>
      </view>
      <view class="result-item highlight">
        <text class="result-label">å¤œé—´é£è¡Œæ—¶é—´</text>
        <text class="result-value">{{ nightFlightResults.nightFlightTime }}</text>
      </view>
      <view class="result-item percentage">
        <text class="result-label">å¤œé—´é£è¡Œæ¯”ä¾‹</text>
        <text class="result-value">{{ nightFlightResults.nightFlightPercentage }}</text>
      </view>
      <view class="result-item">
        <text class="result-label">å¤œèˆªè¿›å…¥æ—¶é—´</text>
        <text class="result-value">{{ nightFlightResults.nightEntryTime }}</text>
      </view>
      <view class="result-item">
        <text class="result-label">å¤œèˆªé€€å‡ºæ—¶é—´</text>
        <text class="result-value">{{ nightFlightResults.nightExitTime }}</text>
      </view>
    </view>
    
    <!-- ä¸¤åœ°æ—¥å‡ºæ—¥è½æ—¶é—´ - å¤§å¡ç‰‡æ ·å¼ -->
    <view class="sun-times-section">
      <view class="sun-times-header">
        <text class="emoji-icon small">ğŸŒ…</text>
        <text class="sun-times-title">ä¸¤åœ°æ—¥å‡ºæ—¥è½æ—¶é—´</text>
      </view>
      
      <!-- å‡ºå‘åœ°æ—¥å‡ºæ—¥è½æ—¶é—´ -->
      <view class="location-sun-times">
        <view class="location-title">ğŸ“ å‡ºå‘åœ°</view>
        <view class="sun-times-main">
          <view class="sun-time-card sunrise">
            <view class="sun-icon">ğŸŒ…</view>
            <view class="sun-info">
              <text class="sun-title">æ—¥å‡ºæ—¶é—´</text>
              <text class="sun-time">{{ nightFlightResults.departureSunrise }}</text>
              <text class="sun-subtitle">å½“åœ°æ—¶é—´</text>
            </view>
          </view>
          <view class="sun-time-card sunset">
            <view class="sun-icon">ğŸŒ‡</view>
            <view class="sun-info">
              <text class="sun-title">æ—¥è½æ—¶é—´</text>
              <text class="sun-time">{{ nightFlightResults.departureSunset }}</text>
              <text class="sun-subtitle">å½“åœ°æ—¶é—´</text>
            </view>
          </view>
        </view>
      </view>
      
      <!-- åˆ°è¾¾åœ°æ—¥å‡ºæ—¥è½æ—¶é—´ -->
      <view class="location-sun-times">
        <view class="location-title">ğŸ“ åˆ°è¾¾åœ°</view>
        <view class="sun-times-main">
          <view class="sun-time-card sunrise">
            <view class="sun-icon">ğŸŒ…</view>
            <view class="sun-info">
              <text class="sun-title">æ—¥å‡ºæ—¶é—´</text>
              <text class="sun-time">{{ nightFlightResults.arrivalSunrise }}</text>
              <text class="sun-subtitle">å½“åœ°æ—¶é—´</text>
            </view>
          </view>
          <view class="sun-time-card sunset">
            <view class="sun-icon">ğŸŒ‡</view>
            <view class="sun-info">
              <text class="sun-title">æ—¥è½æ—¶é—´</text>
              <text class="sun-time">{{ nightFlightResults.arrivalSunset }}</text>
              <text class="sun-subtitle">å½“åœ°æ—¶é—´</text>
            </view>
          </view>
        </view>
      </view>
    </view>
    
    <!-- ğŸ¯ åŸºäºContext7æœ€ä½³å®è·µï¼šæ—¥å‡ºæ—¥è½æŸ¥è¯¢ç»“æœåº•éƒ¨å¹¿å‘Š - æ©™è‰²ä¸»é¢˜ -->
    <view class="ad-section sunrise-sunset-bottom-ad" wx:if="{{ showSunriseBottomAd }}">
      <text class="ad-label">å¹¿å‘Š</text>
      <ad-template 
        unit-id="{{ sunriseBottomAdUnitId }}"
        ad-type="custom"
        data-ad-type="SunriseBottom"
        data-ad-unit-id="{{ sunriseBottomAdUnitId }}"
        bind:adload="onSunriseBottomAdLoad"
        bind:aderror="onSunriseBottomAdError"
      />
    </view>
  </view>

  <!-- å¤œèˆªæ¨¡å¼çš„æ—¶é—´é€‰æ‹©å™¨ -->
  <van-popup
    show="{{ showDepartureTimePicker }}"
    bind:close="closeDepartureTimePicker"
    position="bottom"
    round="{{ true }}"
  >
    <van-datetime-picker
      type="datetime"
      value="{{ validDepartureTimestamp }}"
      min-date="{{ minDate }}"
      max-date="{{ maxDate }}"
      bind:confirm="selectDepartureTime"
      bind:cancel="closeDepartureTimePicker"
      title="é€‰æ‹©å‡ºå‘æ—¶é—´"
    />
  </van-popup>

  <van-popup
    show="{{ showArrivalTimePicker }}"
    bind:close="closeArrivalTimePicker"
    position="bottom"
    round="{{ true }}"
  >
    <van-datetime-picker
      type="datetime"
      value="{{ validArrivalTimestamp }}"
      min-date="{{ minDate }}"
      max-date="{{ maxDate }}"
      bind:confirm="selectArrivalTime"
      bind:cancel="closeArrivalTimePicker"
      title="é€‰æ‹©åˆ°è¾¾æ—¶é—´"
    />
  </van-popup>
</view> 