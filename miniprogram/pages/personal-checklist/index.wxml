<view class="container">
  <!-- æ£€æŸ¥å•åˆ—è¡¨ -->
  <van-cell-group title="æˆ‘çš„æ£€æŸ¥å•" wx:if="{{ checklists.length > 0 }}">
    <van-cell 
      wx:for="{{ checklists }}" 
      wx:key="id"
      title="{{ item.name }}"
      value="{{ getChecklistProgress(item) }}"
      is-link
      bind:click="openChecklist"
      data-id="{{ item.id }}"
    >
      <view slot="right-icon" class="checklist-actions">
        <van-icon 
          name="edit" 
          size="16px" 
          bind:click="editChecklist"
          data-id="{{ item.id }}"
          catch:tap="stopPropagation"
        />
        <van-icon 
          name="delete-o" 
          size="16px" 
          color="#ee0a24"
          bind:click="deleteChecklist"
          data-id="{{ item.id }}"
          catch:tap="stopPropagation"
        />
      </view>
    </van-cell>
  </van-cell-group>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{ checklists.length === 0 }}">
    <van-icon name="todo-list-o" size="60px" color="#dcdee0" />
    <view class="empty-text">è¿˜æ²¡æœ‰æ£€æŸ¥å•</view>
    <view class="empty-desc">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®åˆ›å»ºæ‚¨çš„ç¬¬ä¸€ä¸ªæ£€æŸ¥å•</view>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <van-cell-group title="æ“ä½œ">
    <van-cell>
      <van-button type="primary" block bind:click="createCustomChecklist">
        æ–°å»ºè‡ªå®šä¹‰æ£€æŸ¥å•
      </van-button>
    </van-cell>
  </van-cell-group>

  <!-- ğŸ¯ åŸºäºContext7æœ€ä½³å®è·µï¼šä¸ªäººæ£€æŸ¥å•é¡µé¢å¹¿å‘Š - è“ç»¿è‰²ä¸»é¢˜èåˆ -->
  <view class="ad-section personal-checklist-ad" wx:if="{{ showPersonalChecklistAd }}">
    <text class="ad-label">å¹¿å‘Š</text>
    <ad-template 
      unit-id="{{ personalChecklistAdUnitId }}"
      ad-type="custom"
      data-ad-type="PersonalChecklistAd"
      data-ad-unit-id="{{ personalChecklistAdUnitId }}"
      bind:adload="onPersonalChecklistAdLoad"
      bind:aderror="onPersonalChecklistAdError"
    />
  </view>

  <!-- æ£€æŸ¥å•è¯¦æƒ…å¼¹çª— -->
  <van-popup 
    show="{{ showChecklistDetail }}" 
    position="bottom" 
    round
    bind:close="closeChecklistDetail"
    custom-style="height: 80%"
  >
    <view class="checklist-detail">
      <view class="detail-header">
        <view class="detail-title">{{ currentChecklist.name }}</view>
        <view class="detail-progress">
          {{ getCompletedCount(currentChecklist) }}/{{ currentChecklist.items ? currentChecklist.items.length : 0 }} å·²å®Œæˆ
        </view>
      </view>

      <view class="detail-content">
        <van-checkbox-group value="{{ checkedItems }}" bind:change="onCheckboxChange">
          <van-cell 
            wx:for="{{ currentChecklist.items }}" 
            wx:key="id"
            clickable
            bind:click="toggleCheckbox"
            data-item-id="{{ item.id }}"
          >
            <view slot="title" class="checkbox-item">
              <van-checkbox 
                name="{{ item.id }}" 
                checked="{{ checkedItems.includes(item.id) }}"
                disabled="{{ false }}"
              />
              <view class="item-text {{ checkedItems.includes(item.id) ? 'completed' : '' }}">
                {{ item.text }}
              </view>
            </view>
          </van-cell>
        </van-checkbox-group>
      </view>

      <view class="detail-actions">
        <van-button 
          type="info" 
          block 
          bind:click="editCurrentChecklist"
        >
          ç¼–è¾‘æ£€æŸ¥å•
        </van-button>
        <van-button 
          type="warning" 
          block 
          bind:click="resetChecklist"
        >
          é‡ç½®æ£€æŸ¥å•
        </van-button>
        <van-button type="default" block bind:click="closeChecklistDetail">
          å…³é—­
        </van-button>
      </view>
    </view>
  </van-popup>

  <!-- æ–°å»º/ç¼–è¾‘æ£€æŸ¥å•å¼¹çª— -->
  <van-popup 
    show="{{ showEditDialog }}" 
    position="bottom" 
    round
    bind:close="closeEditDialog"
    custom-style="height: 70%"
  >
    <view class="edit-dialog">
      <view class="edit-header">
        <view class="edit-title">{{ editMode === 'create' ? 'æ–°å»ºæ£€æŸ¥å•' : 'ç¼–è¾‘æ£€æŸ¥å•' }}</view>
      </view>

      <view class="edit-content">
        <van-cell-group title="åŸºæœ¬ä¿¡æ¯">
          <van-field
            label="æ£€æŸ¥å•åç§°"
            placeholder="è¯·è¾“å…¥æ£€æŸ¥å•åç§°"
            value="{{ editingChecklist.name }}"
            bind:change="onNameChange"
          />
        </van-cell-group>

        <van-cell-group title="æ£€æŸ¥é¡¹ç›®">
          <van-cell 
            wx:for="{{ editingChecklist.items }}" 
            wx:key="index"
            clickable
            bind:click="editItemText"
            data-index="{{ index }}"
          >
            <view slot="title">
              <van-field
                wx:if="{{ editingItemIndex === index }}"
                value="{{ editingItemText }}"
                placeholder="è¯·è¾“å…¥é¡¹ç›®åç§°"
                bind:change="onEditingItemTextChange"
                bind:confirm="saveItemText"
                confirm-type="done"
                focus="{{ true }}"
              />
              <view wx:else>{{ item.text }}</view>
            </view>
            <view slot="right-icon" class="item-actions">
              <van-icon 
                name="arrow-up" 
                size="16px" 
                color="#1989fa"
                bind:click="moveItemUp"
                data-index="{{ index }}"
                catch:tap="stopPropagation"
                wx:if="{{ index > 0 }}"
              />
              <van-icon 
                name="arrow-down" 
                size="16px" 
                color="#1989fa"
                bind:click="moveItemDown"
                data-index="{{ index }}"
                catch:tap="stopPropagation"
                wx:if="{{ index < editingChecklist.items.length - 1 }}"
              />
              <van-icon 
                name="delete-o" 
                size="16px" 
                color="#ee0a24"
                bind:click="deleteEditItem"
                data-index="{{ index }}"
                catch:tap="stopPropagation"
              />
            </view>
          </van-cell>
          
          <van-cell>
            <van-field
              placeholder="è¾“å…¥æ–°çš„æ£€æŸ¥é¡¹ç›®"
              value="{{ newItemText }}"
              bind:change="onNewItemChange"
              bind:confirm="addNewItem"
              confirm-type="done"
            >
              <van-button 
                slot="button" 
                size="small" 
                type="primary"
                bind:click="addNewItem"
              >
                æ·»åŠ 
              </van-button>
            </van-field>
          </van-cell>
        </van-cell-group>
      </view>

      <view class="edit-actions">
        <van-button type="primary" block bind:click="saveChecklist">
          ä¿å­˜æ£€æŸ¥å•
        </van-button>
        <van-button type="default" block bind:click="closeEditDialog">
          å–æ¶ˆ
        </van-button>
      </view>
    </view>
  </van-popup>

  <!-- Toast ç»„ä»¶ -->
  <van-toast id="van-toast" />
  
  <!-- Dialog ç»„ä»¶ -->
  <van-dialog id="van-dialog" />
</view> 