<view class="container">
  <!-- Context7æ¢å¤ï¼šä½¿ç”¨åŸç”Ÿå¯¼èˆªæ ï¼Œæä¾›ç³»ç»Ÿè¿”å›æŒ‰é’® -->

  <!-- è­¦å‘Šå¼¹çª— -->
  <van-dialog
    show="{{ showWarningDialog }}"
    title="âš ï¸ é‡è¦è­¦å‘Š"
    message="ä»…ç”¨äºå­¦ä¹ äº†è§£é£æœºå¤§è‡´æ€§èƒ½ï¼Œç»ä¸å¯ä½œä¸ºè¿è¡Œä¾æ®ï¼ï¼ï¼"
    theme="round-button"
    confirm-button-text="æˆ‘å·²äº†è§£"
    confirm-button-color="#ff6b6b"
    bind:confirm="closeWarningDialog"
    close-on-click-overlay="{{ false }}"
    z-index="9999"
    class="warning-dialog"
    custom-style="text-align: center; justify-content: center; border-radius: 16rpx; overflow: hidden;"
    message-style="padding: 32rpx; font-size: 28rpx; color: #333; line-height: 1.6;"
    title-style="font-weight: bold; color: #ff6b6b; padding: 24rpx;"
  />

  <!-- Context7åˆ†çº§å¯¼èˆªï¼šç§»é™¤æœç´¢åŠŸèƒ½ï¼Œç®€åŒ–ç”¨æˆ·ä½“éªŒ -->

  <!-- Context7åˆ†çº§å¯¼èˆªï¼šé£æœºç³»åˆ—åˆ—è¡¨ -->
  <view wx:if="{{ showAircraftSeries }}" class="aircraft-series-section">
    <van-cell-group title="é€‰æ‹©é£æœºç³»åˆ—">
      <!-- åŠ¨æ€æ˜¾ç¤ºé£æœºç³»åˆ—ï¼Œæ”¯æŒA350å’ŒB737ç³»åˆ—ä¹‹é—´æ’å…¥å¹¿å‘Š -->
      <block wx:for="{{ aircraftSeries }}" wx:key="series">
        <!-- æ˜¾ç¤ºé£æœºç³»åˆ—å®¹å™¨ -->
        <van-cell 
          custom-class="aircraft-series-item"
          data-index="{{ index }}"
          bind:tap="onSeriesSelect"
        >
          <view slot="title" class="series-content">
            <view class="series-icon">{{ item.series && item.series.charAt(0) || '?' }}</view>
            <view class="series-info">
              <view class="series-title">{{ item.series }}</view>
              <view class="series-subtitle">{{ item.count }}ä¸ªæœºå‹å˜ä½“</view>
            </view>
          </view>
          <view slot="right-icon" class="series-count">{{ item.count }}</view>
        </van-cell>
        
        <!-- ğŸ¯ åŸºäºContext7æœ€ä½³å®è·µï¼šåœ¨A350ç³»åˆ—åæ’å…¥å¹¿å‘Šï¼ˆä¸B737ç³»åˆ—ä¹‹é—´ï¼‰ -->
        <view wx:if="{{ item.series === 'A350ç³»åˆ—' && showA350B737MiddleAd }}" class="ad-section a350-b737-middle-ad">
          <text class="ad-label">å¹¿å‘Š</text>
          <ad-template 
            unit-id="{{ a350B737MiddleAdUnitId }}"
            ad-type="custom"
            data-ad-type="A350B737Middle"
            data-ad-unit-id="{{ a350B737MiddleAdUnitId }}"
            bind:adload="onAdLoad"
            bind:aderror="onAdError"
          />
        </view>
      </block>
    </van-cell-group>

    <!-- ç»Ÿè®¡ä¿¡æ¯ -->
    <van-cell-group title="æ•°æ®ç»Ÿè®¡">
      <van-cell>
        <view slot="title" class="stats-section">
          <view class="stats-item">
            <text class="stats-number">{{ performanceData.length }}</text>
            <text class="stats-label">ä¸ªæœºå‹</text>
          </view>
          <view class="stats-item">
            <text class="stats-number">{{ aircraftSeries.length }}</text>
            <text class="stats-label">ä¸ªç³»åˆ—</text>
          </view>
        </view>
      </van-cell>
    </van-cell-group>
  </view>

  <!-- Context7åˆ†çº§å¯¼èˆªï¼šæœºå‹åˆ—è¡¨ -->
  <view wx:if="{{ showModelList }}" class="model-list-section">
    <!-- é¢åŒ…å±‘å¯¼èˆª -->
    <van-cell-group>
      <van-cell
        title="è¿”å›ç³»åˆ—åˆ—è¡¨"
        icon="arrow-left"
        bind:click="backToSeriesList"
        class="back-cell"
      />
    </van-cell-group>

    <!-- å½“å‰ç³»åˆ—çš„æœºå‹åˆ—è¡¨ -->
    <van-cell-group title="{{ selectedSeries.series }} ({{ currentSeriesModels.length }}ä¸ªæœºå‹)">
      <van-cell
        wx:for="{{ currentSeriesModels }}"
        wx:key="model"
        title="{{ item.model }}"
        label="æ¸©åº¦: {{ item.temp || 'DISA+25Â°C' }} | é…ç½®: {{ item.config || 'FULL' }}"
        is-link
        data-index="{{ index }}"
        bind:click="onModelSelect"
        custom-class="model-item"
      />
    </van-cell-group>
  </view>

  <!-- æŸ¥è¯¢ç»“æœæ˜¾ç¤º -->
  <view wx:if="{{ showResults }}" class="results-section">
    <!-- æœºå‹ä¿¡æ¯ -->
    <van-cell-group title="æœºå‹ä¿¡æ¯">
      <van-cell title="æœºå‹" value="{{ currentModelData.model }}" />
      <van-cell title="æ¸©åº¦æ¡ä»¶" value="{{ currentModelData.conditions.temperature }}" />
      <van-cell title="ç©ºè°ƒ" value="{{ currentModelData.conditions.air_con }}" />
      <van-cell title="é˜²å†°" value="{{ currentModelData.conditions.anti_ice }}" />
      <van-cell title="é…ç½®" value="{{ currentModelData.conditions.config }}" />
    </van-cell-group>

    <!-- æŸ¥è¯¢å‚æ•° -->
    <van-cell-group title="æŸ¥è¯¢å‚æ•°">
      <!-- é‡é‡é€‰æ‹© -->
      <view wx:if="{{ currentModelData.data }}" class="parameter-section">
        <van-cell title="é‡é‡é€‰æ‹© ({{ currentModelData.data.length }}ä¸ªé€‰é¡¹)" size="large" />
        <van-cell
          title="é‡é‡"
          value="{{ selectedWeight ? selectedWeight + 'kg' : 'ç‚¹å‡»é€‰æ‹©é‡é‡' }}"
          is-link
          bind:click="showWeightPicker"
          custom-class="picker-trigger-cell"
        />
      </view>
        
      <!-- é‡é‡Picker -->
      <van-popup
        show="{{ showWeightPicker }}"
        bind:close="closeWeightPicker"
        position="bottom"
        round="{{ true }}"
      >
        <van-picker
          columns="{{ weightColumns }}"
          bind:confirm="onWeightConfirm"
          bind:cancel="closeWeightPicker"
          title="é€‰æ‹©é‡é‡"
          value="{{ selectedWeightIndex }}"
          bind:change="onWeightPickerChange"
          show-toolbar="{{ true }}"
          confirm-button-text="ç¡®è®¤"
          cancel-button-text="å–æ¶ˆ"
        />
      </van-popup>

      <!-- é«˜åº¦é€‰æ‹© -->
      <view wx:if="{{ currentModelData.data && selectedWeight }}" class="parameter-section">
        <van-cell title="é«˜åº¦é€‰æ‹© ({{ availableAltitudesForCurrentWeight.length }}ä¸ªé€‰é¡¹)" size="large" />
        <van-cell
          title="é«˜åº¦"
          value="{{ selectedAltitude ? selectedAltitude + 'ft' : 'ç‚¹å‡»é€‰æ‹©é«˜åº¦' }}"
          is-link
          bind:click="showAltitudePicker"
          disabled="{{ !selectedWeight }}"
          custom-class="picker-trigger-cell"
        />
      </view>
        
      <!-- é«˜åº¦Picker -->
      <van-popup
        show="{{ showAltitudePicker }}"
        bind:close="closeAltitudePicker"
        position="bottom"
        round="{{ true }}"
      >
        <van-picker
          columns="{{ altitudeColumns }}"
          bind:confirm="onAltitudeConfirm"
          bind:cancel="closeAltitudePicker"
          title="é€‰æ‹©é«˜åº¦"
          value="{{ selectedAltitudeIndex }}"
          bind:change="onAltitudePickerChange"
          show-toolbar="{{ true }}"
          confirm-button-text="ç¡®è®¤"
          cancel-button-text="å–æ¶ˆ"
        />
      </van-popup>
      
      <!-- é«˜åº¦é€‰æ‹©æç¤º -->
      <block wx:if="{{ currentModelData.data && !selectedWeight }}">
        <van-cell custom-class="hint-cell">
          <view slot="title" class="no-weight-hint">
            <van-icon name="info-o" color="#999" size="16px" />
            <text class="hint-text">è¯·å…ˆé€‰æ‹©é‡é‡ä»¥æŸ¥çœ‹å¯ç”¨é«˜åº¦</text>
          </view>
        </van-cell>
      </block>
    </van-cell-group>

    <!-- ç»“æœå¡ç‰‡ -->
    <view wx:if="{{ gradient }}" class="result-card" id="result-card">
      <van-cell-group title="è®¡ç®—ç»“æœ">
        <!-- ç»“æœæ ‡é¢˜æ  -->
        <van-cell custom-class="result-header-cell">
          <view slot="title" class="result-header">
            <view class="header-left">
              <text class="result-title">å¤é£æ¢¯åº¦</text>
              <text class="result-subtitle">{{ currentModelData.model }}</text>
            </view>
            <van-icon 
              name="replay" 
              class="refresh-icon" 
              bind:tap="queryGradient"
            />
          </view>
        </van-cell>

        <!-- æ¢¯åº¦å€¼æ˜¾ç¤º -->
        <van-cell custom-class="gradient-value-cell">
          <view slot="title" class="gradient-value">
            <text class="value">{{ gradient }}</text>
            <text class="unit">%</text>
          </view>
        </van-cell>

        <!-- å‚æ•°æ‘˜è¦ -->
        <van-cell custom-class="params-summary-cell">
          <view slot="title" class="params-summary">
            <view class="param-item">
              <text class="param-label">é‡é‡</text>
              <text class="param-value">{{ selectedWeight }}kg</text>
            </view>
            <view class="param-item">
              <text class="param-label">é«˜åº¦</text>
              <text class="param-value">{{ selectedAltitude }}ft</text>
            </view>
          </view>
        </van-cell>

        <!-- å®‰å…¨æç¤º -->
        <van-cell custom-class="safety-notice-cell">
          <view slot="title" class="safety-notice">
            <van-icon name="info-o" />
            <text>æ­¤æ•°æ®ä»…ä¾›å‚è€ƒï¼Œä¸å¯ä½œä¸ºå®é™…è¿è¡Œä¾æ®</text>
          </view>
        </van-cell>
      </van-cell-group>
    </view>

    <!-- æ— æ•°æ®æç¤º -->
    <van-empty
      wx:if="{{ !gradient && selectedWeight && selectedAltitude }}"
      description="æ— æ³•è®¡ç®—æ¢¯åº¦ï¼Œè¯·å°è¯•å…¶ä»–å‚æ•°ç»„åˆ"
      image="error"
    />

    <!-- ğŸ¯ åŸºäºContext7æœ€ä½³å®è·µï¼šå¹¿å‘ŠåŒºåŸŸ - æ©™è‰²ä¸»é¢˜ -->
    <view class="ad-section" wx:if="{{ showAd }}">
      <text class="ad-label">å¹¿å‘Š</text>
      <ad-template 
        unit-id="{{ adUnitId }}"
        ad-type="custom"
        bind:adload="onAdLoad"
        bind:aderror="onAdError"
      />
    </view>

    <!-- è¿”å›æŒ‰é’® -->
    <van-cell-group>
      <van-cell>
        <van-button type="default" block bind:click="backToModelList" custom-class="back-button">
          è¿”å›æœºå‹åˆ—è¡¨
        </van-button>
      </van-cell>
    </van-cell-group>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <van-empty
    wx:if="{{ !showAircraftSeries && !showModelList && !showResults && !showWarningDialog }}"
    description="åŠ è½½ä¸­..."
  />
</view> 