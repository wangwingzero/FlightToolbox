<view class="container page-content">
  <!-- ä¸»é¡µé¢ - æ‰€æœ‰åŠŸèƒ½æ¨¡å—ä¸€çº§å±•ç¤º -->
  <view wx:if="{{ !selectedModule }}" class="main-page">
    <view class="page-header">
      <view class="header-title">ğŸ§® è®¡ç®—å·¥å…·</view>
      <view class="header-subtitle">ä¸“ä¸šé£è¡Œè®¡ç®—å·¥å…·ï¼Œç²¾ç¡®é«˜æ•ˆè§£å†³æ–¹æ¡ˆ</view>
    </view>

    <!-- é£è¡Œè®¡ç®—å·¥å…·å¡ç‰‡ç½‘æ ¼ - æŒ‰ä½¿ç”¨é¢‘ç‡è‡ªåŠ¨æ’åº -->
    <view class="modules-grid">
        <view
          wx:for="{{ displayModules }}"
          wx:key="id"
          class="module-card"
          bind:tap="selectModule"
          data-module="{{ item.id }}"
        >
          <view class="module-icon">{{ item.icon }}</view>
          <view class="module-title">{{ item.title }}</view>
          <view class="module-desc">{{ item.description }}</view>
          <view class="module-count">
            <van-tag type="{{ item.tagType || 'primary' }}" size="medium">{{ item.category }}</van-tag>
          </view>
        </view>
    </view>

  </view>

  <!-- å…·ä½“è®¡ç®—é¡µé¢ - æ’é™¤å·²æ”¹ä¸ºç‹¬ç«‹é¡µé¢çš„æ¨¡å— -->
  <view wx:if="{{ selectedModule && selectedModule !== 'descent' && selectedModule !== 'crosswind' && selectedModule !== 'turn' && selectedModule !== 'glideslope' && selectedModule !== 'detour' && selectedModule !== 'gradient' && selectedModule !== 'distance' && selectedModule !== 'speed' && selectedModule !== 'temperature' && selectedModule !== 'weight' && selectedModule !== 'pressure' && selectedModule !== 'isa' }}" class="calculation-page">
    <view class="module-header">
      <view class="back-btn" bind:tap="backToModules">â† è¿”å›</view>
      <view class="module-title">{{ moduleTitle }}</view>
    </view>

    <!-- ä¸‹é™ç‡è®¡ç®—æ¨¡å— -->
    <view wx:if="{{ selectedModule === 'descent' }}" class="calculation-module">
      <view class="input-section">
        <view class="input-group">
          <view class="input-label">ğŸ“ å½“å‰é«˜åº¦</view>
          <van-field
            value="{{ flightCalcData.descent.currentAltitude }}"
            placeholder="è¯·è¾“å…¥å½“å‰é«˜åº¦"
            type="digit"
            bind:change="onCurrentAltitudeChange"
          >
            <view slot="right-icon" class="unit-label">è‹±å°º</view>
          </van-field>
        </view>

        <view class="input-group">
          <view class="input-label">ğŸ¯ ç›®æ ‡é«˜åº¦</view>
          <van-field
            value="{{ flightCalcData.descent.targetAltitude }}"
            placeholder="è¯·è¾“å…¥ç›®æ ‡é«˜åº¦"
            type="digit"
            bind:change="onTargetAltitudeChange"
          >
            <view slot="right-icon" class="unit-label">è‹±å°º</view>
          </van-field>
        </view>

        <view class="input-group">
          <view class="input-label">ğŸ“ ç›¸è·è·ç¦»</view>
          <van-field
            value="{{ flightCalcData.descent.distanceNM }}"
            placeholder="è¯·è¾“å…¥è·ç¦»"
            type="digit"
            bind:change="onDistanceNMChange"
          >
            <view slot="right-icon" class="unit-label">æµ·é‡Œ</view>
          </van-field>
        </view>

        <view class="input-group">
          <view class="input-label">âš¡ å½“å‰åœ°é€Ÿ</view>
          <van-field
            value="{{ flightCalcData.descent.currentGroundSpeed }}"
            placeholder="è¯·è¾“å…¥åœ°é€Ÿ"
            type="digit"
            bind:change="onCurrentGroundSpeedChange"
          >
            <view slot="right-icon" class="unit-label">èŠ‚</view>
          </van-field>
        </view>
      </view>

      <view class="action-buttons">
        <van-button type="primary" bind:click="calculateDescentRate" block>
          ğŸš€ è®¡ç®—ä¸‹é™ç‡
        </van-button>
        <van-button type="default" bind:click="clearDescentRate" block>
          ğŸ—‘ï¸ æ¸…ç©ºæ•°æ®
        </van-button>
      </view>

      <view wx:if="{{ flightCalcData.descent.descentRate }}" class="result-section">
        <view class="result-title">ğŸ“Š è®¡ç®—ç»“æœ</view>
        <view class="result-grid">
          <view class="result-item">
            <view class="result-label">æ‰€éœ€ä¸‹é™ç‡</view>
            <view class="result-value">{{ flightCalcData.descent.descentRate }} è‹±å°º/åˆ†é’Ÿ</view>
          </view>
          <view class="result-item">
            <view class="result-label">ä¸‹é™è§’åº¦</view>
            <view class="result-value">{{ flightCalcData.descent.descentAngle }}Â°</view>
          </view>
          <view class="result-item">
            <view class="result-label">ä¸‹é™æ—¶é—´</view>
            <view class="result-value">{{ flightCalcData.descent.timeToDescend }} åˆ†é’Ÿ</view>
          </view>
          <view class="result-item">
            <view class="result-label">ä¸‹é™æ¢¯åº¦</view>
            <view class="result-value">{{ flightCalcData.descent.descentGradient }}%</view>
          </view>
        </view>
      </view>
    </view>

    <!-- ä¾§é£åˆ†é‡è®¡ç®—æ¨¡å— -->
    <view wx:if="{{ selectedModule === 'crosswind' }}" class="calculation-module">
      <view class="input-section">
        <view class="input-group">
          <view class="input-label">âœˆï¸ çœŸç©ºé€Ÿ (TAS)</view>
          <van-field
            value="{{ flightCalcData.crosswind.crosswindTrueAirspeed }}"
            placeholder="è¯·è¾“å…¥çœŸç©ºé€Ÿ"
            type="digit"
            bind:change="onCrosswindTrueAirspeedChange"
          >
            <view slot="right-icon" class="unit-label">èŠ‚</view>
          </van-field>
        </view>

        <view class="input-group">
          <view class="input-label">ğŸ§­ èˆªå‘</view>
          <van-field
            value="{{ flightCalcData.crosswind.crosswindHeading }}"
            placeholder="è¯·è¾“å…¥èˆªå‘"
            type="digit"
            bind:change="onCrosswindHeadingChange"
          >
            <view slot="right-icon" class="unit-label">åº¦</view>
          </van-field>
        </view>

        <view class="input-group">
          <view class="input-label">ğŸŒªï¸ é£å‘</view>
          <van-field
            value="{{ flightCalcData.crosswind.crosswindDirection }}"
            placeholder="è¯·è¾“å…¥é£å‘"
            type="digit"
            bind:change="onCrosswindDirectionChange"
          >
            <view slot="right-icon" class="unit-label">åº¦</view>
          </van-field>
        </view>

        <view class="input-group">
          <view class="input-label">ğŸ’¨ é£é€Ÿ</view>
          <van-field
            value="{{ flightCalcData.crosswind.crosswindSpeed }}"
            placeholder="è¯·è¾“å…¥é£é€Ÿ"
            type="digit"
            bind:change="onCrosswindSpeedChange"
          >
            <view slot="right-icon" class="unit-label">èŠ‚</view>
          </van-field>
        </view>
      </view>

      <view class="action-buttons">
        <van-button type="primary" bind:click="calculateCrosswind" block>
          ğŸš€ è®¡ç®—ä¾§é£åˆ†é‡
        </van-button>
        <van-button type="default" bind:click="clearCrosswind" block>
          ğŸ—‘ï¸ æ¸…ç©ºæ•°æ®
        </van-button>
      </view>

      <view wx:if="{{ flightCalcData.crosswind.crosswindComponent }}" class="result-section">
        <view class="result-title">ğŸ“Š è®¡ç®—ç»“æœ</view>
        <view class="result-grid">
          <view class="result-item">
            <view class="result-label">ä¾§é£åˆ†é‡</view>
            <view class="result-value">{{ flightCalcData.crosswind.crosswindDisplayText }}</view>
          </view>
          <view class="result-item">
            <view class="result-label">é¡¶é£åˆ†é‡</view>
            <view class="result-value">{{ flightCalcData.crosswind.headwindDisplayText }}</view>
          </view>
          <view class="result-item">
            <view class="result-label">åæµè§’</view>
            <view class="result-value">{{ flightCalcData.crosswind.driftAngle }}Â°</view>
          </view>
          <view class="result-item">
            <view class="result-label">åœ°é€Ÿ</view>
            <view class="result-value">{{ flightCalcData.crosswind.groundSpeed }} èŠ‚</view>
          </view>
          <view class="result-item">
            <view class="result-label">èˆªè¿¹</view>
            <view class="result-value">{{ flightCalcData.crosswind.track }}Â°</view>
          </view>
        </view>

        <!-- é£å‘ç½—ç›˜ -->
        <view class="compass-section">
          <view class="compass-title">ğŸ§­ é£å‘ç½—ç›˜</view>
          <view class="compass-container">
            <view class="compass-needle wind-needle" style="transform: rotate({{ flightCalcData.crosswind.windAngle }}deg);"></view>
            <view class="compass-needle heading-needle" style="transform: rotate({{ flightCalcData.crosswind.headingAngle }}deg);"></view>
            <view class="compass-needle track-needle" style="transform: rotate({{ flightCalcData.crosswind.trackAngle }}deg);"></view>
            <view class="compass-degrees north">{{ flightCalcData.crosswind.compassNorth }}</view>
            <view class="compass-degrees east">{{ flightCalcData.crosswind.compassEast }}</view>
            <view class="compass-degrees south">{{ flightCalcData.crosswind.compassSouth }}</view>
            <view class="compass-degrees west">{{ flightCalcData.crosswind.compassWest }}</view>
            <view class="compass-center"></view>
          </view>
          <view class="compass-legend">
            <view class="legend-item">
              <view class="legend-color wind-color"></view>
              <text>é£å‘</text>
            </view>
            <view class="legend-item">
              <view class="legend-color heading-color"></view>
              <text>èˆªå‘</text>
            </view>
            <view class="legend-item">
              <view class="legend-color track-color"></view>
              <text>èˆªè¿¹</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- è½¬å¼¯åŠå¾„è®¡ç®—æ¨¡å— -->
    <view wx:if="{{ selectedModule === 'turn' }}" class="calculation-module">
      <view class="input-section">
        <view class="input-group">
          <view class="input-label">ğŸ“ å¡åº¦è§’</view>
          <van-field
            value="{{ flightCalcData.turn.turnBankAngle }}"
            placeholder="è¯·è¾“å…¥å¡åº¦è§’"
            type="digit"
            bind:change="onTurnBankAngleChange"
          >
            <view slot="right-icon" class="unit-label">åº¦</view>
          </van-field>
        </view>

        <view class="input-group">
          <view class="input-label">âš¡ åœ°é€Ÿ</view>
          <van-field
            value="{{ flightCalcData.turn.turnGroundSpeed }}"
            placeholder="è¯·è¾“å…¥åœ°é€Ÿ"
            type="digit"
            bind:change="onTurnGroundSpeedChange"
          >
            <view slot="right-icon" class="unit-label">èŠ‚</view>
          </van-field>
        </view>
      </view>

      <view class="action-buttons">
        <van-button type="primary" bind:click="calculateTurnRadius" block>
          ğŸš€ è®¡ç®—è½¬å¼¯åŠå¾„
        </van-button>
        <van-button type="default" bind:click="clearTurn" block>
          ğŸ—‘ï¸ æ¸…ç©ºæ•°æ®
        </van-button>
      </view>

      <view wx:if="{{ flightCalcData.turn.turnRadiusMeters }}" class="result-section">
        <view class="result-title">ğŸ“Š è®¡ç®—ç»“æœ</view>
        <view class="result-grid">
          <view class="result-item">
            <view class="result-label">è½¬å¼¯åŠå¾„(ç±³)</view>
            <view class="result-value">{{ flightCalcData.turn.turnRadiusMeters }} ç±³</view>
          </view>
          <view class="result-item">
            <view class="result-label">è½¬å¼¯åŠå¾„(è‹±å°º)</view>
            <view class="result-value">{{ flightCalcData.turn.turnRadiusFeet }} è‹±å°º</view>
          </view>
          <view class="result-item">
            <view class="result-label">è½¬å¼¯åŠå¾„(æµ·é‡Œ)</view>
            <view class="result-value">{{ flightCalcData.turn.turnRadiusNauticalMiles }} æµ·é‡Œ</view>
          </view>
          <view class="result-item">
            <view class="result-label">è½¬å¼¯ç‡</view>
            <view class="result-value">{{ flightCalcData.turn.turnRate }} åº¦/ç§’</view>
          </view>
          <view class="result-item">
            <view class="result-label">360Â°è½¬å¼¯æ—¶é—´</view>
            <view class="result-value">{{ flightCalcData.turn.turnTime360 }} ç§’</view>
          </view>
        </view>
      </view>
    </view>

    <!-- äº”è¾¹é«˜åº¦è®¡ç®—æ¨¡å— -->
    <view wx:if="{{ selectedModule === 'glideslope' }}" class="calculation-module">
      <view class="input-section">
        <view class="input-group">
          <view class="input-label">ğŸ“ ä¸‹æ»‘è§’</view>
          <van-field
            value="{{ flightCalcData.glideslope.glideslopeAngle }}"
            placeholder="è¯·è¾“å…¥ä¸‹æ»‘è§’"
            type="digit"
            bind:change="onGlideslopeAngleChange"
          >
            <view slot="right-icon" class="unit-label">åº¦</view>
          </van-field>
        </view>

        <view class="input-group">
          <view class="input-label">ğŸ“ è·ç¦»è·‘é“å¤´</view>
          <van-field
            value="{{ flightCalcData.glideslope.distanceFromThreshold }}"
            placeholder="è¯·è¾“å…¥è·ç¦»"
            type="digit"
            bind:change="onDistanceFromThresholdChange"
          >
            <view slot="right-icon" class="unit-label">æµ·é‡Œ</view>
          </van-field>
        </view>

        <view class="input-group">
          <view class="input-label">ğŸ”ï¸ æœºåœºæ ‡é«˜</view>
          <van-field
            value="{{ flightCalcData.glideslope.airportElevation }}"
            placeholder="è¯·è¾“å…¥æœºåœºæ ‡é«˜"
            type="digit"
            bind:change="onAirportElevationChange"
          >
            <view slot="right-icon" class="unit-label">è‹±å°º</view>
          </van-field>
        </view>
      </view>

      <view class="action-buttons">
        <van-button type="primary" bind:click="calculateGlideslope" block>
          ğŸš€ è®¡ç®—ä¸‹æ»‘çº¿é«˜åº¦
        </van-button>
        <van-button type="default" bind:click="clearGlideslope" block>
          ğŸ—‘ï¸ æ¸…ç©ºæ•°æ®
        </van-button>
      </view>

      <view wx:if="{{ flightCalcData.glideslope.glideslopeAltitude }}" class="result-section">
        <view class="result-title">ğŸ“Š è®¡ç®—ç»“æœ</view>
        <view class="result-grid">
          <view class="result-item">
            <view class="result-label">AGLé«˜åº¦</view>
            <view class="result-value">{{ flightCalcData.glideslope.glideslopeAltitude }} è‹±å°º</view>
          </view>
          <view class="result-item">
            <view class="result-label">QNHé«˜åº¦</view>
            <view class="result-value">{{ flightCalcData.glideslope.glideslopeAbsoluteAltitude }} è‹±å°º</view>
          </view>
        </view>
      </view>
    </view>

    <!-- ç»•é£è€—æ²¹è®¡ç®—æ¨¡å— -->
    <view wx:if="{{ selectedModule === 'detour' }}" class="calculation-module">
      <view class="input-section">
        <view class="input-group">
          <view class="input-label">ğŸ“ ç”³è¯·åç¦»è·ç¦»</view>
          <van-field
            value="{{ flightCalcData.detour.detourDistance }}"
            placeholder="è¯·è¾“å…¥åç¦»è·ç¦»"
            type="digit"
            bind:change="onDetourDistanceChange"
          >
            <view slot="right-icon" class="unit-label">æµ·é‡Œ</view>
          </van-field>
        </view>

        <view class="input-group">
          <view class="input-label">âš¡ åœ°é€Ÿ</view>
          <van-field
            value="{{ flightCalcData.detour.detourGroundSpeed }}"
            placeholder="è¯·è¾“å…¥åœ°é€Ÿ"
            type="digit"
            bind:change="onDetourGroundSpeedChange"
          >
            <view slot="right-icon" class="unit-label">èŠ‚</view>
          </van-field>
        </view>

        <view class="input-group">
          <view class="input-label">â›½ æ²¹è€—</view>
          <van-field
            value="{{ flightCalcData.detour.detourFuelConsumption }}"
            placeholder="è¯·è¾“å…¥æ²¹è€—"
            type="digit"
            bind:change="onDetourFuelConsumptionChange"
          >
            <view slot="right-icon" class="unit-label">KG/H</view>
          </van-field>
        </view>

        <view class="input-group">
          <view class="input-label">ğŸ“ åèˆªè§’åº¦</view>
          <van-field
            value="{{ flightCalcData.detour.detourDepartureAngle }}"
            placeholder="è¯·è¾“å…¥åèˆªè§’åº¦"
            type="digit"
            bind:change="onDetourDepartureAngleChange"
          >
            <view slot="right-icon" class="unit-label">åº¦</view>
          </van-field>
        </view>

        <view class="input-group">
          <view class="input-label">ğŸ“ è¿”å›è§’åº¦</view>
          <van-field
            value="{{ flightCalcData.detour.detourReturnAngle }}"
            placeholder="è¯·è¾“å…¥è¿”å›è§’åº¦"
            type="digit"
            bind:change="onDetourReturnAngleChange"
          >
            <view slot="right-icon" class="unit-label">åº¦</view>
          </van-field>
        </view>
      </view>

      <view class="action-buttons">
        <van-button type="primary" bind:click="calculateDetourFuel" block>
          ğŸš€ è®¡ç®—ç»•é£è€—æ²¹
        </van-button>
        <van-button type="default" bind:click="clearDetourFuel" block>
          ğŸ—‘ï¸ æ¸…ç©ºæ•°æ®
        </van-button>
      </view>

      <view wx:if="{{ flightCalcData.detour.detourFuelResult }}" class="result-section">
        <view class="result-title">ğŸ“Š è®¡ç®—ç»“æœ</view>
        <view class="result-grid">
          <view class="result-item">
            <view class="result-label">é¢å¤–ç‡ƒæ²¹æ¶ˆè€—</view>
            <view class="result-value">{{ flightCalcData.detour.detourFuelResult }}</view>
          </view>
          <view class="result-item">
            <view class="result-label">é¢å¤–é£è¡Œæ—¶é—´</view>
            <view class="result-value">{{ flightCalcData.detour.detourTimeResult }}</view>
          </view>
          <view class="result-item">
            <view class="result-label">å®é™…å¤šé£è·ç¦»</view>
            <view class="result-value">{{ flightCalcData.detour.detourActualDistance }} æµ·é‡Œ</view>
          </view>
          <view class="result-item">
            <view class="result-label">åèˆªæ®µè·ç¦»</view>
            <view class="result-value">{{ flightCalcData.detour.detourDepartureSegment }} æµ·é‡Œ</view>
          </view>
          <view class="result-item">
            <view class="result-label">è¿”å›æ®µè·ç¦»</view>
            <view class="result-value">{{ flightCalcData.detour.detourReturnSegment }} æµ·é‡Œ</view>
          </view>
          <view class="result-item">
            <view class="result-label">åŸç›´çº¿è·ç¦»</view>
            <view class="result-value">{{ flightCalcData.detour.detourDirectDistance }} æµ·é‡Œ</view>
          </view>
        </view>

        <view wx:if="{{ flightCalcData.detour.detourCalculationDetails }}" class="calculation-details">
          <view class="details-title">ğŸ“‹ è®¡ç®—è¯¦æƒ…</view>
          <view class="details-content">{{ flightCalcData.detour.detourCalculationDetails }}</view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç‰¹æ®Šè®¡ç®—é¡µé¢ -->
  <view wx:if="{{ selectedModule && (selectedModule === 'coldTemp' || selectedModule === 'pitch' || selectedModule === 'gpws') }}" class="calculation-page">
    <view class="module-header">
      <view class="back-btn" bind:tap="backToModules">â† è¿”å›</view>
      <view class="module-title">{{ moduleTitle }}</view>
    </view>

    <!-- æ¸©åº¦ä¿®æ­£è®¡ç®—æ¨¡å— -->
    <view wx:if="{{ selectedModule === 'coldTemp' }}" class="calculation-module">
      <view class="input-section">
        <view class="section-title">åŸºç¡€å‚æ•°</view>
        
        <view class="input-group">
          <view class="input-label">ğŸ”ï¸ æœºåœºæ ‡é«˜</view>
          <van-field
            value="{{ aviationCalcData.coldTemp.airportElevation }}"
            placeholder="ä¾‹å¦‚: 500"
            type="digit"
            bind:change="onColdTempAirportElevationChange"
            input-align="right"
          >
            <view slot="right-icon" class="unit-label">è‹±å°º</view>
          </van-field>
        </view>

        <view class="input-group">
          <view class="input-label">ğŸŒ¡ï¸ æœºåœºæ¸©åº¦</view>
          <van-field
            value="{{ aviationCalcData.coldTemp.airportTemperature }}"
            placeholder="æ”¯æŒè´Ÿæ•°ï¼Œå¦‚: -20 æˆ– 15.5"
            type="text"
            bind:change="onColdTempAirportTemperatureChange"
            input-align="right"
          >
            <view slot="right-icon" class="unit-label">Â°C</view>
          </van-field>
        </view>

        <view class="input-group">
          <view class="input-label">ğŸ“ IFé«˜åº¦</view>
          <van-field
            value="{{ aviationCalcData.coldTemp.ifAltitude }}"
            placeholder="å¯ä»¥ä¸è¾“å…¥"
            type="digit"
            bind:change="onColdTempIfAltitudeChange"
            input-align="right"
          >
            <view slot="right-icon" class="unit-label">è‹±å°º</view>
          </van-field>
        </view>

        <view class="input-group">
          <view class="input-label">ğŸ¯ FAFé«˜åº¦</view>
          <van-field
            value="{{ aviationCalcData.coldTemp.fafAltitude }}"
            placeholder="å¯ä»¥ä¸è¾“å…¥"
            type="digit"
            bind:change="onColdTempFafAltitudeChange"
            input-align="right"
          >
            <view slot="right-icon" class="unit-label">è‹±å°º</view>
          </van-field>
        </view>

        <view class="input-group">
          <view class="input-label">ğŸ›¬ DAé«˜åº¦</view>
          <van-field
            value="{{ aviationCalcData.coldTemp.daAltitude }}"
            placeholder="å¯ä»¥ä¸è¾“å…¥"
            type="digit"
            bind:change="onColdTempDaAltitudeChange"
            input-align="right"
          >
            <view slot="right-icon" class="unit-label">è‹±å°º</view>
          </van-field>
        </view>

        <view class="input-group">
          <view class="input-label">ğŸ”„ å¤é£é«˜åº¦</view>
          <van-field
            value="{{ aviationCalcData.coldTemp.missedAltitude }}"
            placeholder="å¯ä»¥ä¸è¾“å…¥"
            type="digit"
            bind:change="onColdTempMissedAltitudeChange"
            input-align="right"
          >
            <view slot="right-icon" class="unit-label">è‹±å°º</view>
          </van-field>
        </view>

        <view class="input-group">
          <view class="input-label">ğŸ“ å…¶ä»–é«˜åº¦</view>
          <van-field
            value="{{ aviationCalcData.coldTemp.otherAltitude }}"
            placeholder="å¯ä»¥ä¸è¾“å…¥"
            type="digit"
            bind:change="onColdTempOtherAltitudeChange"
            input-align="right"
          >
            <view slot="right-icon" class="unit-label">è‹±å°º</view>
          </van-field>
        </view>
      </view>

      <view class="input-section">
        <view class="section-title">FPAå½±å“åˆ†æ (å¯é€‰)</view>
        
        <view class="switch-group">
          <view class="switch-label">è®¡ç®—FPAå½±å“ (é’ˆå¯¹FAF)</view>
          <van-switch 
            checked="{{ aviationCalcData.coldTemp.isFafPoint }}" 
            bind:change="toggleColdTempFafPoint"
          />
        </view>

        <view wx:if="{{ aviationCalcData.coldTemp.isFafPoint }}" class="input-group">
          <view class="input-label">ğŸ“ FAFåˆ°è·‘é“å¤´è·ç¦»</view>
          <van-field
            value="{{ aviationCalcData.coldTemp.fafDistance }}"
            placeholder="ä¾‹å¦‚: 8.0"
            type="digit"
            bind:change="onColdTempFafDistanceChange"
            input-align="right"
          >
            <view slot="right-icon" class="unit-label">æµ·é‡Œ</view>
          </van-field>
        </view>
      </view>

      <view class="action-buttons">
        <van-button type="primary" bind:click="calculateColdTemp" block>
          ğŸš€ è®¡ç®—æ¸©åº¦ä¿®æ­£
        </van-button>
      </view>

      <!-- è®¡ç®—ç»“æœ -->
      <view wx:if="{{ aviationCalcData.coldTemp.result && aviationCalcData.coldTemp.result.results }}" class="result-section">
        <view class="result-title">ğŸ“Š è®¡ç®—ç»“æœ</view>
        <view class="result-list">
          <view wx:for="{{ aviationCalcData.coldTemp.result.results }}" wx:key="name" class="result-item">
            <view class="result-name">{{ item.name }}</view>
            <view class="result-detail">
              <view class="result-original">åŸé«˜åº¦: {{ item.originalAltitude }} è‹±å°º</view>
              <view class="result-correction">ä¿®æ­£å€¼: {{ item.correctionFeet >= 0 ? '+' : '' }}{{ item.correctionFeet }} è‹±å°º</view>
              <view class="result-final">ä¿®æ­£å: {{ item.correctedAltitudeFeet }} è‹±å°º</view>
            </view>
            
            <view wx:if="{{ item.vpaInfo }}" class="result-warning">
              <view class="warning-title">FPAåˆ†æ</view>
              <view class="warning-message">{{ item.vpaInfo.warningMessage }}</view>
            </view>
          </view>
        </view>
      </view>

      <!-- é”™è¯¯ä¿¡æ¯ -->
      <view wx:if="{{ aviationCalcData.coldTemp.error }}" class="error-section">
        <view class="error-title">âš ï¸ é”™è¯¯ä¿¡æ¯</view>
        <view class="error-message">{{ aviationCalcData.coldTemp.error }}</view>
      </view>
    </view>

    <!-- æ¢¯åº¦è®¡ç®—æ¨¡å— -->
    <view wx:if="{{ selectedModule === 'gradient' }}" class="calculation-module">
      <view class="input-section">
        <view class="section-title">è¾“å…¥å‚æ•°</view>
        
        <view class="input-group">
          <view class="input-label">ğŸ“ æ¢¯åº¦</view>
          <van-field
            value="{{ aviationCalcData.gradient.gradientInput }}"
            placeholder="è¯·è¾“å…¥æ¢¯åº¦"
            type="digit"
            bind:change="onGradientInputChange"
            input-align="right"
          >
            <view slot="right-icon" class="unit-label">%</view>
          </van-field>
        </view>

        <view class="input-group">
          <view class="input-label">ğŸŒ¬ï¸ åœ°é€Ÿ</view>
          <van-field
            value="{{ aviationCalcData.gradient.groundSpeedInput }}"
            placeholder="è¯·è¾“å…¥åœ°é€Ÿ"
            type="digit"
            bind:change="onGroundSpeedInputChange"
            input-align="right"
          >
            <view slot="right-icon" class="unit-label">èŠ‚</view>
          </van-field>
        </view>

        <view class="input-group">
          <view class="input-label">â¬†ï¸ å‡é™ç‡</view>
          <van-field
            value="{{ aviationCalcData.gradient.verticalSpeedInput }}"
            placeholder="è¯·è¾“å…¥å‡é™ç‡"
            type="digit"
            bind:change="onVerticalSpeedInputChange"
            input-align="right"
          >
            <view slot="right-icon" class="unit-label">ft/min</view>
          </van-field>
        </view>

        <view class="input-group">
          <view class="input-label">ğŸ“ è§’åº¦</view>
          <van-field
            value="{{ aviationCalcData.gradient.angleInput }}"
            placeholder="è¯·è¾“å…¥è§’åº¦"
            type="digit"
            bind:change="onAngleInputChange"
            input-align="right"
          >
            <view slot="right-icon" class="unit-label">åº¦</view>
          </van-field>
        </view>
      </view>

      <view class="action-buttons">
        <van-button type="primary" bind:click="convertGradient" block>
          ğŸš€ å¼€å§‹æ¢ç®—
        </van-button>
        <van-button type="default" bind:click="clearGradient" block>
          ğŸ—‘ï¸ æ¸…ç©ºæ•°æ®
        </van-button>
      </view>

      <!-- è®¡ç®—ç»“æœ -->
      <view wx:if="{{ aviationCalcData.gradient.gradientResult || aviationCalcData.gradient.verticalSpeedResult || aviationCalcData.gradient.angleResult }}" class="result-section">
        <view class="result-title">ğŸ“Š è®¡ç®—ç»“æœ</view>
        <view class="result-grid">
          <view wx:if="{{ aviationCalcData.gradient.gradientResult }}" class="result-item">
            <view class="result-label">æ¢¯åº¦</view>
            <view class="result-value">{{ aviationCalcData.gradient.gradientResult }}%</view>
          </view>
          <view wx:if="{{ aviationCalcData.gradient.verticalSpeedResult }}" class="result-item">
            <view class="result-label">å‡é™ç‡</view>
            <view class="result-value">{{ aviationCalcData.gradient.verticalSpeedResult }} ft/min</view>
          </view>
          <view wx:if="{{ aviationCalcData.gradient.angleResult }}" class="result-item">
            <view class="result-label">è§’åº¦</view>
            <view class="result-value">{{ aviationCalcData.gradient.angleResult }}Â°</view>
          </view>
        </view>
      </view>
    </view>

    <!-- PITCHè­¦å‘Šè®¡ç®—æ¨¡å— -->
    <view wx:if="{{ selectedModule === 'pitch' }}" class="calculation-module">
      <view class="input-section">
        <view class="section-title">é£æœºå‹å·é€‰æ‹©</view>
        
        <view class="picker-group">
          <view class="picker-label">é£æœºå‹å·</view>
          <view class="picker-value" bind:tap="showAircraftPicker">
            {{ aviationCalcData.pitch.aircraftModelDisplay }}
          </view>
        </view>
      </view>

      <view class="input-section">
        <view class="section-title">é£è¡Œå‚æ•°</view>
        
        <view class="input-group">
          <view class="input-label">ğŸ“¡ æ— çº¿ç”µé«˜åº¦ (RA)</view>
          <van-field
            value="{{ aviationCalcData.pitch.radioHeight }}"
            placeholder="ä¾‹å¦‚: 15"
            type="digit"
            bind:change="onPitchRadioHeightChange"
            input-align="right"
          >
            <view slot="right-icon" class="unit-label">è‹±å°º</view>
          </van-field>
        </view>

        <view class="input-group">
          <view class="input-label">âœˆï¸ å½“å‰é£æœºå§¿æ€</view>
          <van-field
            value="{{ aviationCalcData.pitch.currentAttitude }}"
            placeholder="ä¾‹å¦‚: 8.0"
            type="digit"
            bind:change="onPitchCurrentAttitudeChange"
            input-align="right"
          >
            <view slot="right-icon" class="unit-label">åº¦</view>
          </van-field>
        </view>

        <view class="input-group">
          <view class="input-label">ğŸ“ˆ é£æœºå§¿æ€å˜åŒ–ç‡</view>
          <van-field
            value="{{ aviationCalcData.pitch.attitudeChangeRate }}"
            placeholder="ä¾‹å¦‚: 1.5"
            type="digit"
            bind:change="onPitchAttitudeChangeRateChange"
            input-align="right"
          >
            <view slot="right-icon" class="unit-label">åº¦/ç§’</view>
          </van-field>
        </view>
      </view>

      <view class="action-buttons">
        <van-button type="primary" bind:click="calculatePitchPitch" block>
          ğŸš€ è®¡ç®— PITCH PITCH è­¦å‘Š
        </van-button>
      </view>

      <!-- è®¡ç®—ç»“æœ -->
      <view wx:if="{{ aviationCalcData.pitch.result }}" class="result-section">
        <view class="result-title">ğŸ“Š è®¡ç®—ç»“æœ</view>
        <view class="result-grid">
          <view class="result-item">
            <view class="result-label">é¢„æµ‹é£æœºå§¿æ€</view>
            <view class="result-value">{{ aviationCalcData.pitch.predictiveAttitude }}Â°</view>
          </view>
          <view class="result-item">
            <view class="result-label">è§¦å‘é˜ˆå€¼</view>
            <view class="result-value">{{ aviationCalcData.pitch.threshold }}Â°</view>
          </view>
          <view class="result-item {{ aviationCalcData.pitch.shouldTrigger ? 'warning-item' : 'normal-item' }}">
            <view class="result-label">è­¦å‘ŠçŠ¶æ€</view>
            <view class="result-value">{{ aviationCalcData.pitch.warningStatus }}</view>
          </view>
        </view>
      </view>

      <!-- é»˜è®¤å‰ææ¡ä»¶ -->
      <view wx:if="{{ aviationCalcData.pitch.result }}" class="info-section">
        <view class="info-title">â„¹ï¸ é»˜è®¤å‰ææ¡ä»¶</view>
        <view class="info-list">
          <view class="info-item">é£è¡Œé˜¶æ®µ: ç€é™†é˜¶æ®µ</view>
          <view class="info-item">è‡ªåŠ¨é©¾é©¶ä»ª: æœªæ¥é€š</view>
          <view class="info-item">æ— çº¿ç”µé«˜åº¦: æœ‰æ•ˆ</view>
          <view wx:if="{{ aviationCalcData.pitch.aircraftModel !== 'A330-200' && aviationCalcData.pitch.aircraftModel !== 'A330-300' }}" class="info-item">æ“¦å°¾ä¿æŠ¤å¼•è„š: å·²æ¿€æ´»</view>
          <view wx:if="{{ aviationCalcData.pitch.aircraftModel !== 'A330-200' && aviationCalcData.pitch.aircraftModel !== 'A330-300' }}" class="info-item">æ¨åŠ›æ‰‹æŸ„ä½ç½®: éèµ·é£ä½</view>
          <view wx:if="{{ aviationCalcData.pitch.aircraftModel !== 'A330-200' && aviationCalcData.pitch.aircraftModel !== 'A330-300' }}" class="info-item">ä½é«˜åº¦æ¡ä»¶: RA &lt; 20è‹±å°º</view>
          <view wx:if="{{ aviationCalcData.pitch.aircraftModel === 'A330-200' || aviationCalcData.pitch.aircraftModel === 'A330-300' }}" class="info-item">ä½é«˜åº¦æ¡ä»¶: RA &lt; 25è‹±å°º</view>
        </view>
      </view>
    </view>

    <!-- GPWSè­¦å‘Šè§¦å‘è®¡ç®—æ¨¡å— -->
    <view wx:if="{{ selectedModule === 'gpws' }}" class="calculation-module gpws-module">
      <!-- GPWSæ¨¡å¼é€‰æ‹© -->
      <view class="gpws-mode-selector">
        <view class="section-title">ğŸš¨ GPWSæ¨¡å¼é€‰æ‹©</view>
        <view class="mode-tabs">
          <view class="mode-tab {{ aviationCalcData.gpws.activeMode === 'mode1' ? 'active' : '' }}" 
                bind:tap="selectGPWSMode" data-mode="mode1">
            Mode 1
          </view>
          <view class="mode-tab {{ aviationCalcData.gpws.activeMode === 'mode2' ? 'active' : '' }}" 
                bind:tap="selectGPWSMode" data-mode="mode2">
            Mode 2
          </view>
          <view class="mode-tab {{ aviationCalcData.gpws.activeMode === 'mode3' ? 'active' : '' }}" 
                bind:tap="selectGPWSMode" data-mode="mode3">
            Mode 3
          </view>
          <view class="mode-tab {{ aviationCalcData.gpws.activeMode === 'mode4' ? 'active' : '' }}" 
                bind:tap="selectGPWSMode" data-mode="mode4">
            Mode 4
          </view>
          <view class="mode-tab {{ aviationCalcData.gpws.activeMode === 'mode5' ? 'active' : '' }}" 
                bind:tap="selectGPWSMode" data-mode="mode5">
            Mode 5
          </view>
        </view>
      </view>

      <!-- Mode 1 - ä¸‹é™ç‡è¿‡å¤§ -->
      <view wx:if="{{ aviationCalcData.gpws.activeMode === 'mode1' }}" class="gpws-mode-content">
        <view class="mode-header">
          <view class="mode-title">Mode 1 - ä¸‹é™ç‡è¿‡å¤§</view>
          <view class="mode-desc">ç›‘æ§è¿‡åº¦ä¸‹é™ç‡ï¼Œé˜²æ­¢æ’åœ°</view>
        </view>

        <view class="input-section">
          <view class="input-group">
            <view class="input-label">ğŸ“¡ æ— çº¿ç”µé«˜åº¦ (RA)</view>
            <van-field
              value="{{ aviationCalcData.gpws.mode1.ra }}"
              placeholder="è¯·è¾“å…¥æ— çº¿ç”µé«˜åº¦"
              type="digit"
              bind:change="onGPWSMode1RAChange"
              input-align="right"
            >
              <view slot="right-icon" class="unit-label">è‹±å°º</view>
            </van-field>
          </view>

          <view class="input-group">
            <view class="input-label">ğŸ“‰ ä¸‹é™ç‡</view>
            <van-field
              value="{{ aviationCalcData.gpws.mode1.descentRate }}"
              placeholder="è¯·è¾“å…¥ä¸‹é™ç‡"
              type="digit"
              bind:change="onGPWSMode1DescentRateChange"
              input-align="right"
            >
              <view slot="right-icon" class="unit-label">ft/min</view>
            </van-field>
          </view>
        </view>

        <view class="action-buttons">
          <van-button type="primary" bind:click="calculateGPWSMode1" block>
            ğŸš€ åˆ†æ Mode 1
          </van-button>
        </view>

        <!-- Mode 1 ç»“æœ -->
        <view wx:if="{{ aviationCalcData.gpws.mode1.thresholdResult }}" class="result-section">
          <view wx:if="{{ aviationCalcData.gpws.mode1.thresholdResult.valid }}" class="gpws-result">
            <view class="result-title">ğŸ“Š Mode 1 åˆ†æç»“æœ</view>
            <view class="gpws-status {{ aviationCalcData.gpws.mode1.thresholdResult.type }}">
              <view class="status-text">{{ aviationCalcData.gpws.mode1.thresholdResult.status }}</view>
              <view class="status-message">{{ aviationCalcData.gpws.mode1.thresholdResult.message }}</view>
            </view>
            
            <view class="result-grid">
              <view class="result-item">
                <view class="result-label">SINK RATEé—¨é™</view>
                <view class="result-value">{{ aviationCalcData.gpws.mode1.thresholdResult.sinkRateThreshold }} ft/min</view>
              </view>
              <view class="result-item">
                <view class="result-label">PULL UPé—¨é™</view>
                <view class="result-value">{{ aviationCalcData.gpws.mode1.thresholdResult.pullUpThreshold }} ft/min</view>
              </view>
              <view wx:if="{{ aviationCalcData.gpws.mode1.thresholdResult.warningLevel }}" class="result-item">
                <view class="result-label">è­¦å‘Šçº§åˆ«</view>
                <view class="result-value">{{ aviationCalcData.gpws.mode1.thresholdResult.warningLevel }}</view>
              </view>
            </view>
          </view>
          
          <view wx:else class="error-section">
            <view class="error-title">âš ï¸ è¾“å…¥é”™è¯¯</view>
            <view class="error-message">{{ aviationCalcData.gpws.mode1.thresholdResult.message }}</view>
          </view>
        </view>
      </view>

      <!-- Mode 2 - åœ°å½¢æ¥è¿‘ç‡è¿‡å¤§ -->
      <view wx:if="{{ aviationCalcData.gpws.activeMode === 'mode2' }}" class="gpws-mode-content">
        <view class="mode-header">
          <view class="mode-title">Mode 2 - åœ°å½¢æ¥è¿‘ç‡è¿‡å¤§</view>
          <view class="mode-desc">ç›‘æ§è¿‡åº¦åœ°å½¢æ¥è¿‘ç‡</view>
        </view>

        <view class="input-section">
          <view class="input-group">
            <view class="input-label">ğŸ“¡ æ— çº¿ç”µé«˜åº¦ (RA)</view>
            <van-field
              value="{{ aviationCalcData.gpws.mode2.ra }}"
              placeholder="è¯·è¾“å…¥æ— çº¿ç”µé«˜åº¦"
              type="digit"
              bind:change="onGPWSMode2RAChange"
              input-align="right"
            >
              <view slot="right-icon" class="unit-label">è‹±å°º</view>
            </van-field>
          </view>

          <view class="input-group">
            <view class="input-label">â¬‡ï¸ åœ°å½¢æ¥è¿‘ç‡ (TCR)</view>
            <van-field
              value="{{ aviationCalcData.gpws.mode2.tcr }}"
              placeholder="è¯·è¾“å…¥åœ°å½¢æ¥è¿‘ç‡"
              type="digit"
              bind:change="onGPWSMode2TCRChange"
              input-align="right"
            >
              <view slot="right-icon" class="unit-label">ft/min</view>
            </van-field>
          </view>

          <view class="input-group">
            <view class="input-label">ğŸŒ¬ï¸ ç©ºé€Ÿ</view>
            <van-field
              value="{{ aviationCalcData.gpws.mode2.airspeed }}"
              placeholder="è¯·è¾“å…¥ç©ºé€Ÿï¼ˆå¯é€‰ï¼‰"
              type="digit"
              bind:change="onGPWSMode2AirspeedChange"
              input-align="right"
            >
              <view slot="right-icon" class="unit-label">èŠ‚</view>
            </van-field>
          </view>
        </view>

        <!-- é…ç½®çŠ¶æ€ -->
        <view class="input-section">
          <view class="section-title">ğŸ”§ é£æœºé…ç½®</view>
          <view class="switch-group">
            <view class="switch-item">
              <view class="switch-label">è¥Ÿç¿¼åœ¨ç€é™†æ„å‹</view>
              <van-switch 
                checked="{{ aviationCalcData.gpws.mode2.flapsInLanding }}"
                bind:change="onGPWSMode2FlapsChange"
              />
            </view>
            <view class="switch-item">
              <view class="switch-label">èµ·è½æ¶æ”¾ä¸‹</view>
              <van-switch 
                checked="{{ aviationCalcData.gpws.mode2.gearDown }}"
                bind:change="onGPWSMode2GearChange"
              />
            </view>
            <view class="switch-item">
              <view class="switch-label">ILSè¿›è¿‘æ¨¡å¼</view>
              <van-switch 
                checked="{{ aviationCalcData.gpws.mode2.ilsMode }}"
                bind:change="onGPWSMode2ILSChange"
              />
            </view>
            <view class="switch-item">
              <view class="switch-label">TADæ¿€æ´»</view>
              <van-switch 
                checked="{{ aviationCalcData.gpws.mode2.tadActive }}"
                bind:change="onGPWSMode2TADChange"
              />
            </view>
          </view>
        </view>

        <view class="action-buttons">
          <van-button type="primary" bind:click="calculateGPWSMode2" block>
            ğŸš€ åˆ†æ Mode 2
          </van-button>
        </view>

        <!-- Mode 2 ç»“æœ -->
        <view wx:if="{{ aviationCalcData.gpws.mode2.result }}" class="result-section">
          <view class="gpws-result">
            <view class="result-title">ğŸ“Š Mode 2 åˆ†æç»“æœ</view>
            <view class="gpws-status {{ aviationCalcData.gpws.mode2.result.type }}">
              <view class="status-text">{{ aviationCalcData.gpws.mode2.result.status }}</view>
              <view class="status-message">{{ aviationCalcData.gpws.mode2.result.message }}</view>
            </view>
            
            <view wx:if="{{ aviationCalcData.gpws.mode2.result.thresholdInfo }}" class="result-detail">
              <view class="detail-title">ğŸ“‹ è¯¦ç»†ä¿¡æ¯</view>
              <view class="detail-text">{{ aviationCalcData.gpws.mode2.result.thresholdInfo }}</view>
              <view wx:if="{{ aviationCalcData.gpws.mode2.result.envelopeInfo }}" class="detail-text">{{ aviationCalcData.gpws.mode2.result.envelopeInfo }}</view>
            </view>
          </view>
        </view>
      </view>

      <!-- Mode 3 - å¤é£æ—¶é«˜åº¦æŸå¤± -->
      <view wx:if="{{ aviationCalcData.gpws.activeMode === 'mode3' }}" class="gpws-mode-content">
        <view class="mode-header">
          <view class="mode-title">Mode 3 - å¤é£æ—¶é«˜åº¦æŸå¤±</view>
          <view class="mode-desc">æ£€æµ‹å¤é£åçš„å¼‚å¸¸é«˜åº¦æŸå¤±</view>
        </view>

        <view class="input-section">
          <view class="input-group">
            <view class="input-label">ğŸ“¡ æ— çº¿ç”µé«˜åº¦ (RA)</view>
            <van-field
              value="{{ aviationCalcData.gpws.mode3.ra }}"
              placeholder="è¯·è¾“å…¥æ— çº¿ç”µé«˜åº¦"
              type="digit"
              bind:change="onGPWSMode3RAChange"
              input-align="right"
            >
              <view slot="right-icon" class="unit-label">è‹±å°º</view>
            </van-field>
          </view>

          <view class="input-group">
            <view class="input-label">ğŸ“‰ å®é™…é«˜åº¦æŸå¤±</view>
            <van-field
              value="{{ aviationCalcData.gpws.mode3.altitudeLoss }}"
              placeholder="è¯·è¾“å…¥é«˜åº¦æŸå¤±"
              type="digit"
              bind:change="onGPWSMode3AltitudeLossChange"
              input-align="right"
            >
              <view slot="right-icon" class="unit-label">è‹±å°º</view>
            </van-field>
          </view>
        </view>

        <view class="action-buttons">
          <van-button type="primary" bind:click="calculateGPWSMode3" block>
            ğŸš€ åˆ†æ Mode 3
          </van-button>
          <van-button type="default" bind:click="resetGPWSMode3" block>
            ğŸ—‘ï¸ é‡ç½®
          </van-button>
        </view>

        <!-- Mode 3 ç»“æœ -->
        <view wx:if="{{ aviationCalcData.gpws.mode3.result }}" class="result-section">
          <view class="gpws-result">
            <view class="result-title">ğŸ“Š Mode 3 åˆ†æç»“æœ</view>
            <view class="gpws-status {{ aviationCalcData.gpws.mode3.result.type }}">
              <view class="status-text">{{ aviationCalcData.gpws.mode3.result.status }}</view>
              <view class="status-message">{{ aviationCalcData.gpws.mode3.result.message }}</view>
            </view>
            
            <view wx:if="{{ aviationCalcData.gpws.mode3.result.thresholdInfo }}" class="result-detail">
              <view class="detail-title">ğŸ“‹ è¯¦ç»†ä¿¡æ¯</view>
              <view class="detail-text">{{ aviationCalcData.gpws.mode3.result.thresholdInfo }}</view>
              <view wx:if="{{ aviationCalcData.gpws.mode3.result.detailedInfo }}" class="detail-text">{{ aviationCalcData.gpws.mode3.result.detailedInfo }}</view>
            </view>
          </view>
        </view>
      </view>

      <!-- Mode 4 - ä¸å®‰å…¨åœ°å½¢ç©¿è¶Š -->
      <view wx:if="{{ aviationCalcData.gpws.activeMode === 'mode4' }}" class="gpws-mode-content">
        <view class="mode-header">
          <view class="mode-title">Mode 4 - ä¸å®‰å…¨åœ°å½¢ç©¿è¶Š</view>
          <view class="mode-desc">æ£€æµ‹é£è¡Œè¿‡ç¨‹ä¸­çš„åœ°å½¢ç©¿è¶Šé£é™©</view>
        </view>

        <!-- Mode 4 å­æ¨¡å¼é€‰æ‹© -->
        <view class="input-section">
          <view class="picker-group">
            <view class="picker-label">å­æ¨¡å¼</view>
            <view class="picker-value" bind:tap="showGPWSMode4SubModePicker">
              {{ aviationCalcData.gpws.mode4.subModeDisplayName }}
            </view>
          </view>
        </view>

        <view class="input-section">
          <view class="input-group">
            <view class="input-label">ğŸ“¡ æ— çº¿ç”µé«˜åº¦ (RA)</view>
            <van-field
              value="{{ aviationCalcData.gpws.mode4.ra }}"
              placeholder="è¯·è¾“å…¥æ— çº¿ç”µé«˜åº¦"
              type="digit"
              bind:change="onGPWSMode4RAChange"
              input-align="right"
            >
              <view slot="right-icon" class="unit-label">è‹±å°º</view>
            </van-field>
          </view>

          <view class="input-group">
            <view class="input-label">ğŸŒ¬ï¸ ç©ºé€Ÿ</view>
            <van-field
              value="{{ aviationCalcData.gpws.mode4.airspeed }}"
              placeholder="è¯·è¾“å…¥ç©ºé€Ÿ"
              type="digit"
              bind:change="onGPWSMode4AirspeedChange"
              input-align="right"
            >
              <view slot="right-icon" class="unit-label">èŠ‚</view>
            </van-field>
          </view>

          <view wx:if="{{ aviationCalcData.gpws.mode4.subMode === '4C' }}" class="input-group">
            <view class="input-label">ğŸ“ˆ èµ·é£æœ€å¤§RA</view>
            <van-field
              value="{{ aviationCalcData.gpws.mode4.maxRA }}"
              placeholder="è¯·è¾“å…¥èµ·é£æœ€å¤§RA"
              type="digit"
              bind:change="onGPWSMode4MaxRAChange"
              input-align="right"
            >
              <view slot="right-icon" class="unit-label">è‹±å°º</view>
            </van-field>
          </view>
        </view>

        <!-- Mode 4A é…ç½® -->
        <view wx:if="{{ aviationCalcData.gpws.mode4.subMode === '4A' }}" class="input-section">
          <view class="section-title">ğŸ”§ Mode 4A é…ç½®</view>
          <view class="switch-group">
            <view class="switch-item">
              <view class="switch-label">TADé«˜å®Œæ•´æ€§</view>
              <van-switch 
                checked="{{ aviationCalcData.gpws.mode4.mode4A_TADHighIntegrity }}"
                bind:change="onGPWSMode4A_TADHighIntegrityChange"
              />
            </view>
            <view class="switch-item">
              <view class="switch-label">TCFå¯ç”¨</view>
              <van-switch 
                checked="{{ aviationCalcData.gpws.mode4.mode4A_TCFEnabled }}"
                bind:change="onGPWSMode4A_TCFEnabledChange"
              />
            </view>
            <view class="switch-item">
              <view class="switch-label">é£è¶Šæ£€æµ‹</view>
              <van-switch 
                checked="{{ aviationCalcData.gpws.mode4.mode4A_OverflightDetected }}"
                bind:change="onGPWSMode4A_OverflightDetectedChange"
              />
            </view>
          </view>
        </view>

        <!-- Mode 4B é…ç½® -->
        <view wx:if="{{ aviationCalcData.gpws.mode4.subMode === '4B' }}" class="input-section">
          <view class="section-title">ğŸ”§ Mode 4B é…ç½®</view>
          <view class="switch-group">
            <view class="switch-item">
              <view class="switch-label">èµ·è½æ¶æ”¾ä¸‹</view>
              <van-switch 
                checked="{{ aviationCalcData.gpws.mode4.mode4B_GearDown }}"
                bind:change="onGPWSMode4B_GearDownChange"
              />
            </view>
            <view class="switch-item">
              <view class="switch-label">è¥Ÿç¿¼åœ¨ç€é™†æ„å‹</view>
              <van-switch 
                checked="{{ aviationCalcData.gpws.mode4.mode4B_FlapsInLanding }}"
                bind:change="onGPWSMode4B_FlapsInLandingChange"
              />
            </view>
            <view class="switch-item">
              <view class="switch-label">TADé«˜å®Œæ•´æ€§</view>
              <van-switch 
                checked="{{ aviationCalcData.gpws.mode4.mode4B_TADHighIntegrity }}"
                bind:change="onGPWSMode4B_TADHighIntegrityChange"
              />
            </view>
            <view class="switch-item">
              <view class="switch-label">TCFå¯ç”¨</view>
              <van-switch 
                checked="{{ aviationCalcData.gpws.mode4.mode4B_TCFEnabled }}"
                bind:change="onGPWSMode4B_TCFEnabledChange"
              />
            </view>
            <view class="switch-item">
              <view class="switch-label">é£è¶Šæ£€æµ‹</view>
              <van-switch 
                checked="{{ aviationCalcData.gpws.mode4.mode4B_OverflightDetected }}"
                bind:change="onGPWSMode4B_OverflightDetectedChange"
              />
            </view>
          </view>
        </view>

        <!-- Mode 4C é…ç½® -->
        <view wx:if="{{ aviationCalcData.gpws.mode4.subMode === '4C' }}" class="input-section">
          <view class="section-title">ğŸ”§ Mode 4C é…ç½®</view>
          <view class="switch-group">
            <view class="switch-item">
              <view class="switch-label">èµ·è½æ¶æˆ–è¥Ÿç¿¼æ”¾ä¸‹</view>
              <van-switch 
                checked="{{ aviationCalcData.gpws.mode4.mode4C_GearOrFlapsDown }}"
                bind:change="onGPWSMode4C_GearOrFlapsDownChange"
              />
            </view>
          </view>
        </view>

        <view class="action-buttons">
          <van-button type="primary" bind:click="calculateGPWSMode4" block>
            ğŸš€ åˆ†æ Mode 4
          </van-button>
        </view>

        <!-- Mode 4 ç»“æœ -->
        <view wx:if="{{ aviationCalcData.gpws.mode4.result }}" class="result-section">
          <view class="gpws-result">
            <view class="result-title">ğŸ“Š Mode 4 åˆ†æç»“æœ</view>
            <view class="mode-info">{{ aviationCalcData.gpws.mode4.result.subModeInfo }}</view>
            <view class="gpws-status {{ aviationCalcData.gpws.mode4.result.type }}">
              <view class="status-text">{{ aviationCalcData.gpws.mode4.result.status }}</view>
              <view class="status-message">{{ aviationCalcData.gpws.mode4.result.message }}</view>
            </view>
            
            <view wx:if="{{ aviationCalcData.gpws.mode4.result.thresholdInfo }}" class="result-detail">
              <view class="detail-title">ğŸ“‹ è¯¦ç»†ä¿¡æ¯</view>
              <view class="detail-text">{{ aviationCalcData.gpws.mode4.result.thresholdInfo }}</view>
              <view wx:if="{{ aviationCalcData.gpws.mode4.result.envelopeInfo }}" class="detail-text">{{ aviationCalcData.gpws.mode4.result.envelopeInfo }}</view>
            </view>
          </view>
        </view>
      </view>

      <!-- Mode 5 - è¿‡åº¦ä¸‹æ»‘é“åç¦» -->
      <view wx:if="{{ aviationCalcData.gpws.activeMode === 'mode5' }}" class="gpws-mode-content">
        <view class="mode-header">
          <view class="mode-title">Mode 5 - è¿‡åº¦ä¸‹æ»‘é“åç¦»</view>
          <view class="mode-desc">ç›‘æ§ILSè¿›è¿‘æ—¶çš„ä¸‹æ»‘é“åç¦»</view>
        </view>

        <view class="input-section">
          <view class="input-group">
            <view class="input-label">ğŸ“¡ æ— çº¿ç”µé«˜åº¦ (RA)</view>
            <van-field
              value="{{ aviationCalcData.gpws.mode5.ra }}"
              placeholder="è¯·è¾“å…¥æ— çº¿ç”µé«˜åº¦"
              type="digit"
              bind:change="onGPWSMode5RAChange"
              input-align="right"
            >
              <view slot="right-icon" class="unit-label">è‹±å°º</view>
            </van-field>
          </view>

          <view class="input-group">
            <view class="input-label">ğŸ“ ä¸‹æ»‘é“åç¦»åº¦</view>
            <van-field
              value="{{ aviationCalcData.gpws.mode5.gsDeviation }}"
              placeholder="è¯·è¾“å…¥åç¦»åº¦"
              type="digit"
              bind:change="onGPWSMode5GSDeviationChange"
              input-align="right"
            >
              <view slot="right-icon" class="unit-label">dots</view>
            </van-field>
          </view>
        </view>

        <view class="action-buttons">
          <van-button type="primary" bind:click="calculateGPWSMode5" block>
            ğŸš€ åˆ†æ Mode 5
          </van-button>
        </view>

        <!-- Mode 5 ç»“æœ -->
        <view wx:if="{{ aviationCalcData.gpws.mode5.result }}" class="result-section">
          <view class="gpws-result">
            <view class="result-title">ğŸ“Š Mode 5 åˆ†æç»“æœ</view>
            <view class="gpws-status {{ aviationCalcData.gpws.mode5.result.type }}">
              <view class="status-text">{{ aviationCalcData.gpws.mode5.result.status }}</view>
              <view class="status-message">{{ aviationCalcData.gpws.mode5.result.message }}</view>
            </view>
            
            <view wx:if="{{ aviationCalcData.gpws.mode5.result.thresholdInfo }}" class="result-detail">
              <view class="detail-title">ğŸ“‹ è¯¦ç»†ä¿¡æ¯</view>
              <view class="detail-text">{{ aviationCalcData.gpws.mode5.result.thresholdInfo }}</view>
              <view wx:if="{{ aviationCalcData.gpws.mode5.result.envelopeInfo }}" class="detail-text">{{ aviationCalcData.gpws.mode5.result.envelopeInfo }}</view>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- å¸¸ç”¨æ¢ç®—é¡µé¢ - å·²æ”¹ä¸ºç‹¬ç«‹é¡µé¢ï¼Œæ­¤æ¡ä»¶ä¸å†éœ€è¦ -->
  <view wx:if="{{ false }}" class="calculation-page">
    <view class="module-header">
      <view class="back-btn" bind:tap="backToModules">â† è¿”å›</view>
      <view class="module-title">{{ moduleTitle }}</view>
    </view>

    <!-- è·ç¦»æ¢ç®—æ¨¡å— -->
    <view wx:if="{{ selectedModule === 'distance' }}" class="calculation-module">
      <view class="input-section">
        <view class="input-group">
          <view class="input-label">ğŸ“ ç±³ (m)</view>
          <van-field
            value="{{ unitConverterData.distanceValues.meter }}"
            placeholder="è¯·è¾“å…¥æ•°å€¼"
            type="digit"
            bind:change="onDistanceInput"
            data-unit="meter"
            input-align="right"
          />
        </view>

        <view class="input-group">
          <view class="input-label">ğŸ›£ï¸ åƒç±³ (km)</view>
          <van-field
            value="{{ unitConverterData.distanceValues.kilometer }}"
            placeholder="è¯·è¾“å…¥æ•°å€¼"
            type="digit"
            bind:change="onDistanceInput"
            data-unit="kilometer"
            input-align="right"
          />
        </view>

        <view class="input-group">
          <view class="input-label">ğŸŒŠ æµ·é‡Œ (nm)</view>
          <van-field
            value="{{ unitConverterData.distanceValues.nauticalMile }}"
            placeholder="è¯·è¾“å…¥æ•°å€¼"
            type="digit"
            bind:change="onDistanceInput"
            data-unit="nauticalMile"
            input-align="right"
          />
        </view>

        <view class="input-group">
          <view class="input-label">ğŸƒ è‹±é‡Œ (mile)</view>
          <van-field
            value="{{ unitConverterData.distanceValues.mile }}"
            placeholder="è¯·è¾“å…¥æ•°å€¼"
            type="digit"
            bind:change="onDistanceInput"
            data-unit="mile"
            input-align="right"
          />
        </view>

        <view class="input-group">
          <view class="input-label">ğŸ‘£ è‹±å°º (ft)</view>
          <van-field
            value="{{ unitConverterData.distanceValues.foot }}"
            placeholder="è¯·è¾“å…¥æ•°å€¼"
            type="digit"
            bind:change="onDistanceInput"
            data-unit="foot"
            input-align="right"
          />
        </view>

        <view class="input-group">
          <view class="input-label">ğŸ“ è‹±å¯¸ (in)</view>
          <van-field
            value="{{ unitConverterData.distanceValues.inch }}"
            placeholder="è¯·è¾“å…¥æ•°å€¼"
            type="digit"
            bind:change="onDistanceInput"
            data-unit="inch"
            input-align="right"
          />
        </view>
      </view>

      <view class="action-buttons">
        <van-button type="primary" bind:click="convertDistance" block>
          ğŸš€ å¼€å§‹æ¢ç®—
        </van-button>
        <van-button type="default" bind:click="clearDistance" block>
          ğŸ—‘ï¸ æ¸…ç©ºæ•°æ®
        </van-button>
      </view>
    </view>

    <!-- é€Ÿåº¦æ¢ç®—æ¨¡å— -->
    <view wx:if="{{ selectedModule === 'speed' }}" class="calculation-module">
      <view class="input-section">
        <view class="input-group">
          <view class="input-label">ğŸ“ ç±³/ç§’ (m/s)</view>
          <van-field
            value="{{ unitConverterData.speedValues.meterPerSecond }}"
            placeholder="è¯·è¾“å…¥æ•°å€¼"
            type="digit"
            bind:change="onSpeedInput"
            data-unit="meterPerSecond"
            input-align="right"
          />
        </view>

        <view class="input-group">
          <view class="input-label">ğŸš— åƒç±³/æ—¶ (km/h)</view>
          <van-field
            value="{{ unitConverterData.speedValues.kilometerPerHour }}"
            placeholder="è¯·è¾“å…¥æ•°å€¼"
            type="digit"
            bind:change="onSpeedInput"
            data-unit="kilometerPerHour"
            input-align="right"
          />
        </view>

        <view class="input-group">
          <view class="input-label">â›µ èŠ‚ (knot)</view>
          <van-field
            value="{{ unitConverterData.speedValues.knot }}"
            placeholder="è¯·è¾“å…¥æ•°å€¼"
            type="digit"
            bind:change="onSpeedInput"
            data-unit="knot"
            input-align="right"
          />
        </view>
      </view>

      <view class="action-buttons">
        <van-button type="primary" bind:click="convertSpeed" block>
          ğŸš€ å¼€å§‹æ¢ç®—
        </van-button>
        <van-button type="default" bind:click="clearSpeed" block>
          ğŸ—‘ï¸ æ¸…ç©ºæ•°æ®
        </van-button>
      </view>
    </view>

    <!-- æ¸©åº¦æ¢ç®—æ¨¡å— -->
    <view wx:if="{{ selectedModule === 'temperature' }}" class="calculation-module">
      <view class="input-section">
        <view class="input-group">
          <view class="input-label">ğŸŒ¡ï¸ æ‘„æ°åº¦ (Â°C)</view>
          <van-field
            value="{{ unitConverterData.temperatureValues.celsius }}"
            placeholder="è¯·è¾“å…¥æ•°å€¼"
            type="text"
            confirm-type="done"
            bind:input="onTemperatureNumberInput"
            bind:change="onTemperatureInput"
            data-unit="celsius"
            input-align="right"
          />
        </view>

        <view class="input-group">
          <view class="input-label">ğŸŒ¡ï¸ åæ°åº¦ (Â°F)</view>
          <van-field
            value="{{ unitConverterData.temperatureValues.fahrenheit }}"
            placeholder="è¯·è¾“å…¥æ•°å€¼"
            type="text"
            confirm-type="done"
            bind:input="onTemperatureNumberInput"
            bind:change="onTemperatureInput"
            data-unit="fahrenheit"
            input-align="right"
          />
        </view>

        <view class="input-group">
          <view class="input-label">ğŸŒ¡ï¸ å¼€å°”æ–‡ (K)</view>
          <van-field
            value="{{ unitConverterData.temperatureValues.kelvin }}"
            placeholder="è¯·è¾“å…¥æ•°å€¼"
            type="digit"
            bind:change="onTemperatureInput"
            data-unit="kelvin"
            input-align="right"
          />
        </view>
      </view>

      <view class="action-buttons">
        <van-button type="primary" bind:click="convertTemperature" block>
          ğŸš€ å¼€å§‹æ¢ç®—
        </van-button>
        <van-button type="default" bind:click="clearTemperature" block>
          ğŸ—‘ï¸ æ¸…ç©ºæ•°æ®
        </van-button>
      </view>
    </view>

    <!-- é‡é‡æ¢ç®—æ¨¡å— -->
    <view wx:if="{{ selectedModule === 'weight' }}" class="calculation-module">
      <view class="input-section">
        <view class="input-group">
          <view class="input-label">ğŸ“ å…‹ (g)</view>
          <van-field
            value="{{ unitConverterData.weightValues.gram }}"
            placeholder="è¯·è¾“å…¥æ•°å€¼"
            type="digit"
            bind:change="onWeightInput"
            data-unit="gram"
            input-align="right"
          />
        </view>

        <view class="input-group">
          <view class="input-label">âš–ï¸ åƒå…‹ (kg)</view>
          <van-field
            value="{{ unitConverterData.weightValues.kilogram }}"
            placeholder="è¯·è¾“å…¥æ•°å€¼"
            type="digit"
            bind:change="onWeightInput"
            data-unit="kilogram"
            input-align="right"
          />
        </view>

        <view class="input-group">
          <view class="input-label">ğŸ’ª ç£… (lb)</view>
          <van-field
            value="{{ unitConverterData.weightValues.pound }}"
            placeholder="è¯·è¾“å…¥æ•°å€¼"
            type="digit"
            bind:change="onWeightInput"
            data-unit="pound"
            input-align="right"
          />
        </view>
      </view>

      <view class="action-buttons">
        <van-button type="primary" bind:click="convertWeight" block>
          ğŸš€ å¼€å§‹æ¢ç®—
        </van-button>
        <van-button type="default" bind:click="clearWeight" block>
          ğŸ—‘ï¸ æ¸…ç©ºæ•°æ®
        </van-button>
      </view>
    </view>

    <!-- æ°”å‹æ¢ç®—æ¨¡å— -->
    <view wx:if="{{ selectedModule === 'pressure' }}" class="calculation-module">
      <view class="input-section">
        <view class="input-group">
          <view class="input-label">ğŸ”ï¸ æœºåœºæ ‡é«˜</view>
          <van-field
            value="{{ unitConverterData.elevationInput }}"
            placeholder="è¯·è¾“å…¥æœºåœºæ ‡é«˜"
            type="digit"
            bind:change="onElevationInputChange"
          >
            <view slot="right-icon" class="unit-label">è‹±å°º</view>
          </van-field>
        </view>

        <view class="input-group">
          <view class="input-label">ğŸŒªï¸ QNHæ°”å‹</view>
          <van-field
            value="{{ unitConverterData.qnhInput }}"
            placeholder="è¯·è¾“å…¥QNH"
            type="digit"
            bind:change="onQNHInputChange"
          >
            <view slot="right-icon" class="unit-label">hPa</view>
          </van-field>
        </view>

        <view class="input-group">
          <view class="input-label">ğŸ“ QFEæ°”å‹</view>
          <van-field
            value="{{ unitConverterData.qfeInput }}"
            placeholder="è¯·è¾“å…¥QFE"
            type="digit"
            bind:change="onQFEInputChange"
          >
            <view slot="right-icon" class="unit-label">hPa</view>
          </van-field>
        </view>
      </view>

      <view class="action-buttons">
        <van-button type="primary" bind:click="convertPressure" block>
          ğŸš€ å¼€å§‹æ¢ç®—
        </van-button>
        <van-button type="default" bind:click="clearPressure" block>
          ğŸ—‘ï¸ æ¸…ç©ºæ•°æ®
        </van-button>
      </view>

      <view wx:if="{{ unitConverterData.qnhResult || unitConverterData.qfeResult }}" class="result-section">
        <view class="result-title">ğŸ“Š æ¢ç®—ç»“æœ</view>
        <view class="result-grid">
          <view wx:if="{{ unitConverterData.qnhResult }}" class="result-item">
            <view class="result-label">QNHæ°”å‹</view>
            <view class="result-value">{{ unitConverterData.qnhResult }} hPa</view>
          </view>
          <view wx:if="{{ unitConverterData.qfeResult }}" class="result-item">
            <view class="result-label">QFEæ°”å‹</view>
            <view class="result-value">{{ unitConverterData.qfeResult }} hPa</view>
          </view>
        </view>
      </view>
    </view>

    <!-- ISAæ¸©åº¦è®¡ç®—æ¨¡å— -->
    <view wx:if="{{ selectedModule === 'isa' }}" class="calculation-module">
      <view class="input-section">
        <view class="input-group">
          <view class="input-label">ğŸ“ é«˜åº¦</view>
          <van-field
            value="{{ unitConverterData.isaAltitude }}"
            placeholder="è¯·è¾“å…¥é«˜åº¦"
            type="digit"
            bind:change="onISAAltitudeChange"
          >
            <view slot="right-icon" class="unit-label">è‹±å°º</view>
          </van-field>
        </view>

        <view class="input-group">
          <view class="input-label">ğŸŒ¡ï¸ å¤–ç•Œæ¸©åº¦ (OAT)</view>
          <van-field
            value="{{ unitConverterData.isaOAT }}"
            placeholder="è¯·è¾“å…¥å¤–ç•Œæ¸©åº¦"
            type="digit"
            bind:change="onISAOATChange"
          >
            <view slot="right-icon" class="unit-label">Â°C</view>
          </van-field>
        </view>
      </view>

      <view class="action-buttons">
        <van-button type="primary" bind:click="calculateISA" block>
          ğŸš€ è®¡ç®—ISA
        </van-button>
        <van-button type="default" bind:click="clearISA" block>
          ğŸ—‘ï¸ æ¸…ç©ºæ•°æ®
        </van-button>
      </view>

      <view wx:if="{{ unitConverterData.isaStandardTemp }}" class="result-section">
        <view class="result-title">ğŸ“Š è®¡ç®—ç»“æœ</view>
        <view class="result-grid">
          <view class="result-item">
            <view class="result-label">ISAæ ‡å‡†æ¸©åº¦</view>
            <view class="result-value">{{ unitConverterData.isaStandardTemp }}Â°C</view>
          </view>
          <view class="result-item">
            <view class="result-label">æ¸©åº¦åå·®</view>
            <view class="result-value">{{ unitConverterData.isaDeviation }}Â°C</view>
          </view>
        </view>
      </view>
    </view>
  </view>

<!-- é£æœºå‹å·é€‰æ‹©å™¨ -->
<van-action-sheet
  show="{{ showAircraftModelPicker }}"
  title="é€‰æ‹©é£æœºå‹å·"
  bind:close="onAircraftPickerClose"
  bind:select="onAircraftModelSelect"
  actions="{{ aircraftModelActions }}"
/>

<!-- GPWS Mode 4 Sub-Mode Selector -->
<van-action-sheet
  show="{{ showGPWSMode4SubModePicker }}"
  title="é€‰æ‹©Mode 4å­æ¨¡å¼"
  bind:close="onGPWSMode4SubModePickerClose"
  bind:select="onGPWSMode4SubModeSelect"
  actions="{{ gpwsMode4SubModeActions }}"
/>

<!-- PITCH Aircraft Model Selector -->
<van-action-sheet
  show="{{ showPitchAircraftModelPicker }}"
  title="é€‰æ‹©é£æœºå‹å·"
  bind:close="onPitchAircraftModelPickerClose"
  bind:select="onPitchAircraftModelSelect"
  actions="{{ pitchAircraftModelActions }}"
/>

  <!-- æ¨ªå¹…å¹¿å‘Š -->
  <view class="ad-banner-container">
    <ad unit-id="adunit-3b2e78fbdab16389" ad-type="banner" ad-intervals="30"></ad>
  </view>
</view>

<van-toast id="van-toast" />