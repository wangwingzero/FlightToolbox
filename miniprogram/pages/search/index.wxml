<view class="container page-content">
  <!-- 分类菜单 -->
  <view class="category-tabs-container">
    <scroll-view class="category-tabs-scroll" scroll-x scroll-with-animation enhanced>
      <view class="category-tabs-wrapper">
        <view 
          wx:for="{{ categoryList }}" 
          wx:key="name"
          class="category-tab-item {{ activeTab === item.name ? 'active' : '' }}"
          bind:tap="onTabChange"
          data-name="{{ item.name }}"
        >
          <view class="category-badge">{{ item.count }}</view>
          <view class="category-title">{{ item.title }}</view>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- 缩写页面 -->
  <view wx:if="{{ activeTab === 'abbreviations' }}">
    <!-- 搜索框 -->
    <view class="search-section abbreviations-search">
      <van-search
        value="{{ searchValue }}"
        placeholder="搜索简缩字或中英文含义"
        bind:search="onSearch"
        bind:change="onSearchChange"
        bind:clear="onSearchClear"
        use-action-slot
      >
        <view slot="action" bind:tap="onSearch">
          <van-button type="primary" size="small" class="search-action-button">搜索</van-button>
        </view>
      </van-search>
    </view>

    <!-- 广告已移除 -->

    <!-- 第一级：字母分组列表 -->
    <view wx:if="{{ showAbbreviationGroups }}" class="letter-groups-section">
      <view class="section-title">
        <van-icon name="apps" size="16px" />
        按首字母浏览
      </view>
      
      <!-- 动态显示字母分组，支持S和T之间插入广告 -->
      <block wx:for="{{ abbreviationGroups }}" wx:key="letter">
        <!-- 显示字母容器 -->
        <view 
          class="custom-letter-item abbreviation-letter-item"
          data-letter="{{ item.letter }}"
          bind:tap="onAbbreviationLetterTap"
        >
          <view class="letter-icon-large">{{ item.letter }}</view>
          <view class="letter-content">
            <view class="letter-title">字母 {{ item.letter }}</view>
            <view class="letter-subtitle">{{ item.count }}条缩写</view>
          </view>
          <view class="letter-count">{{ item.count }}条</view>
          <view class="letter-arrow">
            <van-icon name="arrow" size="16px" />
          </view>
        </view>

        <!-- 广告已移除 -->

        <!-- 广告已移除 -->
      </block>

      <!-- 统计信息 -->
      <view class="stats-section">
        <view class="stats-item">
          <text class="stats-number">{{ abbreviationsList.length }}</text>
          <text class="stats-label">条缩写</text>
        </view>
        <view class="stats-item">
          <text class="stats-number">{{ abbreviationGroups.length }}</text>
          <text class="stats-label">个字母组</text>
        </view>
      </view>

      <!-- 广告已移除 -->
    </view>

    <!-- 第二级：具体条目列表 -->
    <view wx:if="{{ showAbbreviationItems }}" class="items-section context7-secondary-page">
      <!-- Context7风格的导航栏 -->
      <view class="context7-nav-header">
        <view class="nav-back-button" bindtap="backToAbbreviationGroups">
          <van-icon name="arrow-left" size="20px" />
          <text class="nav-back-text">返回</text>
        </view>
        <view class="nav-title">
          <text class="nav-title-main">字母 {{ selectedAbbreviationLetter }}</text>
                          <text class="nav-title-sub">{{ currentLetterAbbreviations.length }}条缩写</text>
        </view>
        <view class="nav-actions">
          <van-icon name="search" size="18px" class="nav-action-icon" />
        </view>
      </view>



      <!-- 条目列表 -->
      <view class="context7-content-container">
        <view class="context7-card-wrapper">
          <view 
            wx:for="{{ currentLetterAbbreviations }}"
            wx:key="id"
            class="context7-item-card abbreviation-item-card"
            bind:click="showAbbreviationDetail"
            data-item="{{ item }}"
          >
            <!-- 广告已移除 -->
            <view class="item-card-header">
              <view class="item-primary">
                <text class="item-abbreviation">{{ item.abbreviation }}</text>
                <view class="item-badges">
                  <view class="context7-badge icao-content" wx:if="{{ item.icao_code }}">
                    <van-icon name="bookmark" size="12px" />
                    <text>ICAO</text>
                  </view>
                  <view class="context7-badge iata-content" wx:if="{{ item.iata_code }}">
                    <van-icon name="certificate" size="12px" />
                    <text>IATA</text>
                  </view>
                </view>
              </view>
              <van-icon name="arrow" size="16px" class="item-arrow" />
            </view>
            <view class="item-card-content">
              <text class="item-english">{{ item.english_full }}</text>
              <text class="item-chinese">{{ item.chinese_translation }}</text>
            </view>
            <view class="item-card-footer">
              <view class="item-meta">
                <van-icon name="notes" size="12px" />
                <text class="meta-text">{{ item.is_icao ? '来源：ICAO' : '来源：机型手册' }}</text>
              </view>
            </view>
          </view>
        </view>


      </view>
    </view>

    <!-- 搜索结果列表 -->
    <view wx:if="{{ !showAbbreviationGroups && !showAbbreviationItems && searchValue }}" class="search-results-section">
      <van-cell-group wx:if="{{ filteredList.length > 0 }}" title="搜索结果 ({{ filteredList.length }}条简缩字)">
        <van-cell
          wx:for="{{ filteredList }}"
          wx:key="id"
          title="{{ item.abbreviation }}"
          label="{{ item.english_full }} - {{ item.chinese_translation }}"
          border="{{ false }}"
          class="abbreviation-cell"
          bind:click="showAbbreviationDetail"
          data-item="{{ item }}"
          is-link
        >
          <view slot="right-icon">
            <van-tag 
              wx:if="{{ item.icao_code }}"
              type="primary" 
              size="medium"
            >
              ICAO
            </van-tag>
            <van-tag 
              wx:if="{{ item.iata_code }}"
              type="success" 
              size="medium"
            >
              IATA
            </van-tag>
          </view>
        </van-cell>
      </van-cell-group>



      <!-- 搜索无结果 -->
      <van-empty
        wx:if="{{ filteredList.length === 0 && searchValue }}"
        description="未找到相关简缩字"
      />
    </view>

    <!-- 加载状态 -->
    <van-empty
      wx:if="{{ abbreviationGroups.length === 0 && !searchValue }}"
      description="加载中..."
    />
  </view>

  <!-- 定义页面 -->
  <view wx:if="{{ activeTab === 'definitions' }}">
    <!-- 搜索框 -->
    <view class="search-section definitions-search">
      <van-search
        value="{{ definitionSearchValue }}"
        placeholder="搜索定义或术语"
        bind:search="onDefinitionSearch"
        bind:change="onDefinitionSearchChange"
        bind:clear="onDefinitionSearchClear"
        use-action-slot
      >
        <view slot="action" bind:tap="onDefinitionSearch">
          <van-button type="primary" size="small" class="search-action-button">搜索</van-button>
        </view>
      </van-search>
    </view>

    <!-- 广告已移除 -->

    <!-- 字母分组列表 -->
    <view wx:if="{{ showDefinitionGroups }}" class="letter-groups-section">
      <view class="section-title">按拼音首字母浏览</view>
      
      <!-- 动态显示字母分组，支持I和J之间插入广告 -->
      <block wx:for="{{ definitionGroups }}" wx:key="letter">
        <!-- 显示字母容器 -->
        <view 
          class="custom-letter-item definition-letter-item"
          data-letter="{{ item.letter }}"
          bind:tap="onDefinitionLetterTap"
        >
          <view class="letter-icon-large">{{ item.letter }}</view>
          <view class="letter-content">
            <view class="letter-title">字母 {{ item.letter }}</view>
            <view class="letter-subtitle">以 {{ item.letter }} 开头的定义</view>
          </view>
          <view class="letter-count">{{ item.count }}条</view>
          <view class="letter-arrow">></view>
        </view>

        <!-- 广告已移除 -->
      </block>

      <!-- 统计信息 -->
      <view class="stats-section">
        <view class="stats-item">
          <text class="stats-number">{{ definitionsList.length }}</text>
          <text class="stats-label">个定义</text>
        </view>
        <view class="stats-item">
          <text class="stats-number">{{ definitionGroups.length }}</text>
          <text class="stats-label">个字母组</text>
        </view>
      </view>

      <!-- 广告已移除 -->
    </view>

    <!-- 具体字母组的定义列表 - Context7高端UX设计 -->
    <view wx:if="{{ !showDefinitionGroups && selectedDefinitionLetter }}" class="letter-detail-section context7-secondary-page">
      <!-- Context7风格的返回导航栏 -->
      <view class="context7-nav-header">
        <view class="nav-back-button" bindtap="backToDefinitionGroups">
          <van-icon name="arrow-left" size="20px" />
          <text class="nav-back-text">返回</text>
        </view>
        <view class="nav-title">
          <text class="nav-title-main">字母 {{ selectedDefinitionLetter }}</text>
          <text class="nav-title-sub">{{ currentLetterDefinitions.length }}个定义</text>
        </view>
        <view class="nav-actions">
          <van-icon name="search" size="18px" class="nav-action-icon" />
        </view>
      </view>

      <!-- Context7风格的内容卡片 -->
      <view class="context7-content-container">
        <view class="context7-card-wrapper">
          <view 
            wx:for="{{ currentLetterDefinitions }}"
            wx:key="id"
            class="context7-item-card definition-item-card"
            bind:click="showDefinitionDetail"
            data-item="{{ item }}"
          >
            <view class="item-card-header">
              <view class="item-primary">
                <!-- Context7标签优化 - 来源信息更清晰 -->
                <view class="item-badges">
                  <view class="item-source-tag">
                    <van-icon name="bookmark" size="12px" class="tag-icon" />
                    <text>{{ item.source }}</text>
                  </view>
                </view>
              </view>
              <van-icon name="arrow" size="16px" class="item-arrow" />
            </view>
            <view class="item-card-content">
              <!-- Context7中文优先设计 - 中文定义作为主要内容 -->
              <text class="item-chinese-main">{{ item.chinese_name }}</text>
              <!-- 英文作为次要对照信息 -->
              <text class="item-english-secondary">{{ item.english_name }}</text>
              <!-- 详细定义用黄色高亮突出显示 -->
              <text class="item-definition-highlight" wx:if="{{ item.definition }}">{{ item.definition }}</text>
            </view>
            <view class="item-card-footer">
              <view class="item-meta">
                <van-icon name="notes" size="12px" />
                <text class="meta-text">《民航术语定义（试行）》（民航函〔2025〕340号）</text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- 搜索结果列表 -->
    <view wx:if="{{ !showDefinitionGroups && definitionSearchValue }}" class="search-results-section">
      <van-cell-group wx:if="{{ filteredDefinitions.length > 0 }}" title="搜索结果 ({{ filteredDefinitions.length }}个定义)">
        <van-cell
          wx:for="{{ filteredDefinitions }}"
          wx:key="id"
          border="{{ false }}"
          class="definition-cell"
          bind:click="showDefinitionDetail"
          data-item="{{ item }}"
          is-link
        >
          <!-- Context7中文优先标题 -->
          <view slot="title" class="definition-cell-title">
            <text class="chinese-title-main">{{ item.chinese_name }}</text>
          </view>
          <!-- 英文作为标签显示 -->
          <view slot="label" class="definition-cell-label">
            <text class="english-subtitle">{{ item.english_name }}</text>
          </view>
          <view slot="right-icon">
            <van-tag 
              type="success" 
              size="medium"
            >
              {{ item.source }}
            </van-tag>
          </view>
        </van-cell>
      </van-cell-group>

      <!-- 搜索无结果 -->
      <van-empty
        wx:if="{{ filteredDefinitions.length === 0 && definitionSearchValue }}"
        description="未找到相关定义"
      />
    </view>

    <!-- 加载状态 -->
    <van-empty
      wx:if="{{ definitionGroups.length === 0 && !definitionSearchValue }}"
      description="加载中..."
    />
  </view>

  <!-- 机场页面 -->
  <view wx:if="{{ activeTab === 'airports' }}">
    <!-- 搜索框 -->
    <view class="search-section airports-search">
      <van-search
        value="{{ airportSearchValue }}"
        placeholder="搜索机场代码、名称或国家"
        bind:search="onAirportSearch"
        bind:change="onAirportSearchChange"
        bind:clear="onAirportSearchClear"
        use-action-slot
      >
        <view slot="action" bind:tap="onAirportSearch">
          <van-button type="primary" size="small" class="search-action-button">搜索</van-button>
        </view>
      </van-search>
    </view>

    <!-- 广告已移除 -->

    <!-- 机场字母分组列表 -->
    <view wx:if="{{ showAirportGroups }}" class="letter-groups-section">
      <view class="section-title">按ICAO代码首字母浏览</view>
      
      <!-- 动态显示字母分组，支持M和N之间插入广告 -->
      <block wx:for="{{ airportGroups }}" wx:key="letter">
        <!-- 显示字母容器 -->
        <view 
          class="custom-letter-item airport-letter-item"
          data-letter="{{ item.letter }}"
          bind:tap="onAirportLetterTap"
        >
          <view class="letter-icon-large">{{ item.letter }}</view>
          <view class="letter-content">
            <view class="letter-title">字母 {{ item.letter }}</view>
            <view class="letter-subtitle">以 {{ item.letter }} 开头的机场</view>
          </view>
          <view class="letter-count">{{ item.count }}个</view>
          <view class="letter-arrow">></view>
        </view>

        <!-- 广告已移除 -->
      </block>

      <!-- 统计信息 -->
      <view class="stats-section">
        <view class="stats-item">
          <text class="stats-number">{{ airportsList.length }}</text>
          <text class="stats-label">个机场</text>
        </view>
        <view class="stats-item">
          <text class="stats-number">{{ airportGroups.length }}</text>
          <text class="stats-label">个字母组</text>
        </view>
      </view>

      <!-- 广告已移除 -->
    </view>

    <!-- 具体字母组的机场列表 - Context7高端UX设计 -->
    <view wx:if="{{ !showAirportGroups && selectedAirportLetter }}" class="letter-detail-section context7-secondary-page">
      <!-- Context7风格的返回导航栏 -->
      <view class="context7-nav-header">
        <view class="nav-back-button" bindtap="backToAirportGroups">
          <van-icon name="arrow-left" size="20px" />
          <text class="nav-back-text">返回</text>
        </view>
        <view class="nav-title">
          <text class="nav-title-main">字母 {{ selectedAirportLetter }}</text>
          <text class="nav-title-sub">{{ currentLetterAirports.length }}个机场</text>
        </view>
        <view class="nav-actions">
          <van-icon name="search" size="18px" class="nav-action-icon" />
        </view>
      </view>

      <!-- Context7风格的内容卡片 -->
      <view class="context7-content-container">
        <view class="context7-card-wrapper">
          <view 
            wx:for="{{ currentLetterAirports }}"
            wx:key="ICAOCode"
            class="context7-item-card airport-item-card"
            bind:click="showAirportDetail"
            data-item="{{ item }}"
          >
            <view class="item-card-header">
              <view class="item-primary">
                <text class="item-title">{{ item.ShortName }}</text>
                <view class="item-badges">
                  <view class="context7-badge country-badge">
                    <van-icon name="location" size="12px" />
                    <text>{{ item.CountryName }}</text>
                  </view>
                </view>
              </view>
              <van-icon name="arrow" size="16px" class="item-arrow" />
            </view>
            <view class="item-card-content">
              <text class="item-english">{{ item.EnglishName }}</text>
              <view class="airport-codes-grid">
                <view class="code-chip">
                  <text class="code-label">ICAO</text>
                  <text class="code-value">{{ item.ICAOCode }}</text>
                </view>
                <view class="code-chip">
                  <text class="code-label">IATA</text>
                  <text class="code-value">{{ item.IATACode }}</text>
                </view>
              </view>
            </view>
            <view class="item-card-footer">
              <view class="item-meta">
                <van-icon name="flight" size="12px" />
                <text class="meta-text">机场信息</text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- 搜索结果列表 -->
    <view wx:if="{{ !showAirportGroups && airportSearchValue }}" class="search-results-section">
      <van-cell-group wx:if="{{ filteredAirports.length > 0 }}" title="搜索结果 ({{ filteredAirports.length }}个机场)">
        <van-cell
          wx:for="{{ filteredAirports }}"
          wx:key="ICAOCode"
          title="{{ item.ShortName }}"
          label="{{ item.EnglishName }}"
          border="{{ false }}"
          class="airport-cell"
          bind:click="showAirportDetail"
          data-item="{{ item }}"
          is-link
        >
          <view slot="value" class="airport-codes">
            <view class="code-item">
              <text class="code-label">ICAO:</text>
              <text class="code-value">{{ item.ICAOCode }}</text>
            </view>
            <view class="code-item">
              <text class="code-label">IATA:</text>
              <text class="code-value">{{ item.IATACode }}</text>
            </view>
          </view>
          <view slot="right-icon">
            <van-tag 
              type="warning" 
              size="medium"
            >
              {{ item.CountryName }}
            </van-tag>
          </view>
        </van-cell>
      </van-cell-group>

      <!-- 搜索无结果 -->
      <van-empty
        wx:if="{{ filteredAirports.length === 0 && airportSearchValue }}"
        description="未找到相关机场"
      />
    </view>

    <!-- 加载状态 -->
    <van-empty
      wx:if="{{ airportGroups.length === 0 && !airportSearchValue }}"
      description="加载中..."
    />
  </view>

  <!-- 通信页面 -->
  <view wx:if="{{ activeTab === 'communications' }}">
    <!-- 搜索框 -->
    <view class="search-section communications-search">
      <van-search
        value="{{ communicationSearchValue }}"
        placeholder="搜索英语通信或中文含义"
        bind:search="onCommunicationSearch"
        bind:change="onCommunicationSearchChange"
        bind:clear="onCommunicationSearchClear"
        use-action-slot
      >
        <view slot="action" bind:tap="onCommunicationSearch">
          <van-button type="primary" size="small" class="search-action-button">搜索</van-button>
        </view>
      </van-search>
    </view>

    <!-- 广告已移除 -->

    <!-- 字母分组列表 -->
    <view wx:if="{{ showCommunicationGroups }}" class="letter-groups-section">
      <view class="section-title">按章节浏览</view>
      
      <!-- 动态显示章节分组，支持"其他术语"和"爆炸物威胁"之间插入广告 -->
      <block wx:for="{{ communicationGroups }}" wx:key="letter">
        <!-- 显示章节容器 -->
        <view 
          class="custom-letter-item communication-letter-item"
          data-letter="{{ item.letter }}"
          bind:tap="onCommunicationLetterTap"
        >
          <view class="letter-icon-large">{{ item.letter }}</view>
          <view class="letter-content">
            <view class="letter-title">{{ item.chapterTitle }}</view>
            <view class="letter-subtitle">{{ item.isEmergency ? '特情应急词汇' : 'ICAO英语900句' }}</view>
          </view>
          <view class="letter-count">{{ item.count }}句</view>
          <view class="letter-arrow">></view>
        </view>
        
        <!-- 广告已移除 -->
      </block>

      <!-- 统计信息 -->
      <view class="stats-section">
        <view class="stats-item">
          <text class="stats-number">{{ communicationsList.length }}</text>
          <text class="stats-label">项内容</text>
        </view>
        <view class="stats-item">
          <text class="stats-number">{{ communicationGroups.length }}</text>
          <text class="stats-label">个分类</text>
        </view>
      </view>
      
      <!-- 广告已移除 -->
    </view>

    <!-- 具体字母组的通信列表 - Context7高端UX设计 -->
    <view wx:if="{{ !showCommunicationGroups && selectedCommunicationLetter }}" class="letter-detail-section context7-secondary-page">
      <!-- Context7风格的返回导航栏 -->
      <view class="context7-nav-header">
        <view class="nav-back-button" bindtap="backToCommunicationGroups">
          <van-icon name="arrow-left" size="20px" />
          <text class="nav-back-text">返回</text>
        </view>
        <view class="nav-title">
          <text class="nav-title-main">{{ selectedChapterName }}</text>
          <text class="nav-title-sub">{{ currentLetterCommunications.length }}句</text>
        </view>
        <view class="nav-actions">
          <van-icon name="search" size="18px" class="nav-action-icon" />
        </view>
      </view>

      <!-- Context7风格的内容卡片 -->
      <view class="context7-content-container">
        <view class="context7-card-wrapper">
          <view 
            wx:for="{{ currentLetterCommunications }}"
            wx:key="id"
            class="context7-item-card communication-item-card"
            bind:click="showCommunicationDetail"
            data-item="{{ item }}"
          >
            <view class="item-card-header">
              <view class="item-primary">
                <text class="item-title">{{ item.english }}</text>
                <view class="item-badges">
                  <view class="context7-badge {{ item.section === '特情常用词汇' ? 'emergency-badge' : 'icao-badge' }}">
                    <van-icon name="{{ item.section === '特情常用词汇' ? 'warning' : 'certificate' }}" size="12px" />
                    <text>{{ item.section === '特情常用词汇' ? '特情' : 'ICAO' }}</text>
                  </view>
                </view>
              </view>
              <van-icon name="arrow" size="16px" class="item-arrow" />
            </view>
            <view class="item-card-content">
              <text class="item-chinese">{{ item.chinese }}</text>
            </view>
            <view class="item-card-footer">
              <view class="item-meta">
                <van-icon name="voice" size="12px" />
                <text class="meta-text">标准用语</text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- 搜索结果列表 -->
    <view wx:if="{{ !showCommunicationGroups && communicationSearchValue }}" class="search-results-section">
      <van-cell-group wx:if="{{ filteredCommunications.length > 0 }}" title="搜索结果 ({{ filteredCommunications.length }}句)">
        <van-cell
          wx:for="{{ filteredCommunications }}"
          wx:key="id"
          title="{{ item.english }}"
          label="{{ item.chinese }}"
          border="{{ false }}"
          class="communication-cell"
          bind:click="showCommunicationDetail"
          data-item="{{ item }}"
          is-link
        >
          <view slot="right-icon">
            <van-tag 
              type="{{ item.section === '特情常用词汇' ? 'danger' : 'primary' }}" 
              size="medium"
            >
              {{ item.section === '特情常用词汇' ? '特情' : 'ICAO' }}
            </van-tag>
          </view>
        </van-cell>
      </van-cell-group>

      <!-- 搜索无结果 -->
      <van-empty
        wx:if="{{ filteredCommunications.length === 0 && communicationSearchValue }}"
        description="未找到相关通信用语"
      />
    </view>

    <!-- 加载状态 -->
    <view wx:if="{{ communicationsLoading }}" class="loading-section">
      <van-loading type="spinner" size="24px" text-size="14px">
        正在加载ICAO通信数据...
      </van-loading>
    </view>
    
    <van-empty
      wx:if="{{ communicationGroups.length === 0 && !communicationSearchValue && !communicationsLoading }}"
      description="加载中..."
    />
  </view>

  <!-- 规章页面 -->
  <view wx:if="{{ activeTab === 'normative' }}">
    <!-- 搜索框 -->
    <view class="search-section normative-search">
      <van-search
        value="{{ normativeSearchValue }}"
        placeholder="搜索规章制度或文档编号"
        bind:search="onNormativeSearch"
        bind:change="onNormativeSearchChange"
        bind:clear="onNormativeSearchClear"
        use-action-slot
      >
        <view slot="action" bind:tap="onNormativeSearch">
          <van-button type="primary" size="small" class="search-action-button">搜索</van-button>
        </view>
      </van-search>

      <!-- Framework7官方推荐的Segmented Strong筛选按钮 -->
      <view class="validity-filter-section">
        <view class="segmented segmented-strong">
          <button 
            class="button button-small-md {{ validityFilter === 'all' ? 'button-active' : '' }}" 
            data-filter="all" 
            bindtap="onValidityFilterChange">
            全部
          </button>
          <button 
            class="button button-small-md {{ validityFilter === 'valid' ? 'button-active' : '' }}" 
            data-filter="valid" 
            bindtap="onValidityFilterChange">
            有效
          </button>
          <button 
            class="button button-small-md {{ validityFilter === 'invalid' ? 'button-active' : '' }}" 
            data-filter="invalid" 
            bindtap="onValidityFilterChange">
            失效
          </button>
          <span class="segmented-highlight"></span>
        </view>
        <view class="filter-stats" wx:if="{{ normativeSearchValue }}">
          筛选结果: {{ filteredNormativeDocuments.length }}条 
          <text class="filter-type">({{ validityFilter === 'all' ? '全部' : (validityFilter === 'valid' ? '有效' : '失效') }})</text>
        </view>
      </view>
    </view>

    <!-- 广告已移除 -->

    <!-- 规章分类列表 -->
    <view wx:if="{{ showNormativeGroups }}" class="letter-groups-section">
      <view class="section-title">按类别浏览规章</view>
      <view 
        wx:for="{{ normativeGroups }}" 
        wx:key="normative_unique_key"
        class="custom-letter-item normative-letter-item"
        data-letter="{{ item.letter }}"
        bind:tap="onNormativeLetterTap"
      >
        <view class="letter-icon-large">{{ item.letter }}</view>
        <view class="letter-content">
          <view class="letter-title">{{ item.groupName }}</view>
          <view class="letter-subtitle">{{ item.description }}</view>
        </view>
        <view class="letter-right-info">
          <view class="letter-count">{{ item.count }}项</view>
          <view class="letter-arrow">></view>
        </view>
      </view>

      <!-- 广告已移除 -->
    </view>

    <!-- 子类别列表 - 现代化重构版 -->
    <view wx:if="{{ showNormativeCategoryDetail && !showNormativeDocumentList }}" class="normative-subcategories-section">
      <!-- 页面头部 -->
      <view class="normative-page-header">
        <view class="normative-breadcrumb">
          <view class="normative-breadcrumb-item" bindtap="onBackToNormativeCategories">
            <van-icon name="arrow-left" size="20px" />
            <text>返回分类</text>
          </view>
          <text class="normative-breadcrumb-current">{{ selectedNormativeCategory }}</text>
        </view>
        <view class="normative-page-info">
          <text class="normative-page-title">选择CCAR部号</text>
          <text class="normative-page-subtitle">点击查看具体规范性文件并复制链接</text>
        </view>
        <view class="normative-copy-hint">
          <van-icon name="info-o" size="14px" />
          <text>共{{ normativeSubcategories.length }}个部号，点击即可查看文件</text>
        </view>
      </view>
      
      <!-- 子类别网格 -->
      <view class="normative-subcategories-grid">
        <view 
          class="normative-subcategory-card"
          wx:for="{{ normativeSubcategories }}"
          wx:key="unique_key"
          data-subcategory="{{ item.name }}"
          bind:tap="onNormativeSubcategoryTap"
        >
          <view class="normative-subcategory-header">
            <view class="normative-ccar-badge">
              <van-icon name="bookmark-o" size="16px" />
              <text>CCAR</text>
            </view>
            <view class="normative-file-count">
              <text>{{ item.count }}个文件</text>
            </view>
          </view>
          
          <view class="normative-subcategory-body">
            <text class="normative-subcategory-name">{{ item.displayName || item.name }}</text>
            <view class="normative-subcategory-description">
              <text>点击查看该部号下的所有规范性文件</text>
            </view>
          </view>
          
          <view class="normative-subcategory-footer">
            <view class="normative-action-indicator">
              <van-icon name="arrow" size="14px" />
              <text>查看文件</text>
            </view>
          </view>
        </view>
      </view>
      
      <view class="normative-section-tip">
        <van-icon name="info-o" size="16px" />
        <text>CCAR是中国民用航空规章的简称，每个部号对应不同的管理领域</text>
      </view>
    </view>

    <!-- 文档列表 - 现代化重构版，突出复制链接功能 -->
    <view wx:if="{{ showNormativeDocumentList }}" class="normative-documents-section">
      <!-- 页面头部 -->
      <view class="normative-page-header">
        <view class="normative-breadcrumb">
          <view class="normative-breadcrumb-item" bindtap="onBackToNormativeSubcategories">
            <van-icon name="arrow-left" size="20px" />
            <text>返回子类别</text>
          </view>
          <text class="normative-breadcrumb-current">{{ selectedNormativeSubcategory }}</text>
        </view>
        <view class="normative-page-info">
          <text class="normative-page-title">规范性文件列表</text>
          <text class="normative-page-subtitle">点击任意文件复制链接到剪贴板</text>
        </view>
        <view class="normative-copy-all-hint">
          <van-icon name="info-o" size="14px" />
          <text>共{{ normativeDocuments.length }}个文件，点击即可复制链接</text>
        </view>
      </view>

      <!-- CCAR规章信息卡片 - 突出复制功能 -->
      <view 
        wx:if="{{ ccarRegulation }}" 
        class="normative-ccar-regulation-card clickable"
        bind:tap="onCopyRegulationLink"
        data-url="{{ ccarRegulation.url }}"
        data-title="{{ ccarRegulation.title }}"
        data-doc-number="{{ selectedNormativeSubcategory }}"
      >
        <view class="normative-ccar-header">
          <view class="normative-ccar-left">
            <van-icon name="medal" size="24px" class="normative-ccar-icon" />
            <view class="normative-ccar-title">{{ ccarRegulation.title }}</view>
          </view>
          <view class="normative-ccar-copy-badge">
            <van-icon name="link" size="18px" />
            <text>复制链接</text>
          </view>
        </view>
        <view class="normative-ccar-content">
          <text class="normative-ccar-description">{{ ccarRegulation.description }}</text>
          <view class="normative-ccar-hint">
            <van-icon name="guide-o" size="14px" />
            <text>点击卡片任意位置即可复制CCAR规章链接</text>
          </view>
        </view>
      </view>
      
      <!-- 文档列表 -->
      <view class="normative-documents-list">
        <view 
          class="normative-document-card enhanced"
          wx:for="{{ normativeDocuments }}"
          wx:key="id"
          data-url="{{ item.url }}"
          bind:tap="onCopyRegulationLink"
          data-title="{{ item.title || (item.doc_number + ' - 未知标题') }}"
          data-doc-number="{{ item.doc_number }}"
        >
          <view class="normative-document-header">
            <view class="normative-document-type-badge">
              <van-icon name="description" size="14px" />
              <text>规范性文件</text>
            </view>
            <view class="normative-status-badge {{ item.is_effective ? 'status-valid' : 'status-invalid' }}">
              <van-icon name="{{ item.is_effective ? 'success' : 'cross' }}" size="12px" />
              <text>{{ item.is_effective ? '有效' : '失效' }}</text>
            </view>
            <view class="normative-copy-indicator prominent">
              <van-icon name="link" size="18px" />
              <text>复制链接</text>
            </view>
          </view>
          
          <view class="normative-document-body">
            <text class="normative-document-title">{{ item.title || (item.doc_number + ' - 未知标题') }}</text>
            <view class="normative-document-info">
              <view class="normative-info-row" wx:if="{{ item.doc_number }}">
                <text class="normative-info-label">文号:</text>
                <text class="normative-info-value doc-number">{{ item.doc_number }}</text>
              </view>
              <view class="normative-info-row" wx:if="{{ item.publish_date }}">
                <text class="normative-info-label">发布日期:</text>
                <text class="normative-info-value">{{ item.publish_date }}</text>
              </view>
              <view class="normative-info-row">
                <text class="normative-info-label">分类:</text>
                <text class="normative-info-value">{{ selectedNormativeCategory }} → {{ selectedNormativeSubcategory }}</text>
              </view>
              <view class="normative-info-row" wx:if="{{ item.clean_office_unit }}">
                <text class="normative-info-label">办文单位:</text>
                <text class="normative-info-value">{{ item.clean_office_unit }}</text>
              </view>
            </view>
          </view>
          
          <view class="normative-document-footer">
            <view class="normative-action-hint prominent">
              <van-icon name="guide-o" size="14px" />
              <text>点击复制文档链接，可在浏览器中打开查看</text>
            </view>
          </view>
        </view>
      </view>
      
      <view class="normative-documents-footer">
        <view class="normative-footer-stats">
          <van-icon name="chart-trending-o" size="16px" />
          <text>已显示{{ normativeDocuments.length }}个{{ selectedNormativeSubcategory }}相关文件</text>
        </view>
        <view class="normative-footer-tip">
          <van-icon name="bulb-o" size="16px" />
          <text>提示：复制的链接可以分享给同事或保存到收藏夹</text>
        </view>
      </view>
    </view>

    <!-- 具体分类的规章列表 - Context7高端UX设计 -->
    <view wx:if="{{ !showNormativeGroups && selectedNormativeLetter }}" class="letter-detail-section context7-secondary-page">
      <!-- Context7风格的返回导航栏 -->
      <view class="context7-nav-header">
        <view class="nav-back-button" bindtap="backToNormativeGroups">
          <van-icon name="arrow-left" size="20px" />
          <text class="nav-back-text">返回</text>
        </view>
        <view class="nav-title">
          <text class="nav-title-main">{{ selectedNormativeCategoryName }}</text>
          <text class="nav-title-sub">{{ currentLetterNormatives.length }}项规章</text>
        </view>
        <view class="nav-actions">
          <van-icon name="search" size="18px" class="nav-action-icon" />
        </view>
      </view>

      <!-- Context7风格的内容卡片 -->
      <view class="context7-content-container">
        <view class="context7-card-wrapper">
          <view 
            wx:for="{{ currentLetterNormatives }}"
            wx:key="id"
            class="context7-item-card normative-item-card"
            bind:click="showNormativeDetail"
            data-item="{{ item }}"
          >
            <view class="item-card-header">
              <view class="item-primary">
                <text class="item-title">{{ item.docNumber }} {{ item.docTitle }}</text>
                <view class="item-badges">
                  <view class="context7-badge normative-badge">
                    <van-icon name="certificate" size="12px" />
                    <text>{{ item.docType || '规章' }}</text>
                  </view>
                  <view wx:if="{{ item.isEffective }}" class="context7-badge effective-badge">
                    <van-icon name="success" size="12px" />
                    <text>有效</text>
                  </view>
                </view>
              </view>
              <van-icon name="arrow" size="16px" class="item-arrow" />
            </view>
            <view class="item-card-content">
              <text class="item-doc-number">{{ item.docNumber }}</text>
              <view class="item-meta-info">
                <text class="item-publish-date">发布日期：{{ item.publishDate }}</text>
                <text wx:if="{{ item.effectiveDate }}" class="item-effective-date">生效日期：{{ item.effectiveDate }}</text>
              </view>
              <text wx:if="{{ item.summary }}" class="item-summary">{{ item.summary }}</text>
            </view>
            <view class="item-card-footer">
              <view class="item-meta">
                <van-icon name="bookmark" size="12px" />
                <text class="meta-text">规章制度</text>
              </view>
              <view class="item-status">
                <text class="status-text {{ item.isEffective ? 'status-effective' : 'status-inactive' }}">
                  {{ item.isEffective ? '有效' : '已失效' }}
                </text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- 搜索结果列表 - 现代化重构版，突出复制链接功能 -->
    <view wx:if="{{ showNormativeSearch }}" class="normative-search-results">
      <!-- 搜索结果头部 -->
      <view class="normative-search-header">
        <view class="normative-search-info">
          <text class="normative-search-title">搜索结果</text>
          <text class="normative-search-count">{{ filteredNormativeDocuments.length }}条文档</text>
        </view>
        <view class="normative-search-tip">
          <van-icon name="info-o" size="14px" />
          <text>点击复制链接</text>
        </view>
      </view>
      
      <!-- 搜索结果列表 -->
      <view class="normative-search-list" wx:if="{{ filteredNormativeDocuments.length > 0 }}">
        <view 
          class="normative-document-card enhanced"
          wx:for="{{ filteredNormativeDocuments }}"
          wx:key="id"
          data-url="{{ item.url }}"
          bind:tap="onCopyRegulationLink"
          data-title="{{ item.title || (item.doc_number + ' - 未知标题') }}"
          data-doc-number="{{ item.doc_number }}"
        >
          <!-- CCAR规章卡片样式 -->
          <view 
            wx:if="{{ item.type === 'ccar' }}" 
            class="normative-ccar-regulation-card clickable"
            bind:tap="onCopyRegulationLink"
            data-url="{{ item.url }}"
            data-title="{{ item.title }}"
            data-doc-number="{{ item.doc_number }}"
          >
            <view class="normative-ccar-header">
              <view class="normative-ccar-left">
                <van-icon name="medal" size="24px" class="normative-ccar-icon" />
                <view class="normative-ccar-title">{{ item.title || item.doc_number }}</view>
              </view>
              <view class="normative-status-badge {{ item.is_effective !== false ? 'status-valid' : 'status-invalid' }}">
                <van-icon name="{{ item.is_effective !== false ? 'success' : 'cross' }}" size="12px" />
                <text>{{ item.is_effective !== false ? '有效' : '失效' }}</text>
              </view>
              <view class="normative-ccar-copy-badge">
                <van-icon name="link" size="18px" />
                <text>复制链接</text>
              </view>
            </view>
            <view class="normative-ccar-content">
              <text class="normative-ccar-description">中国民用航空规章第{{ item.doc_number.split('-')[1] }}部</text>
              <view class="normative-ccar-hint">
                <van-icon name="guide-o" size="14px" />
                <text>点击卡片任意位置即可复制CCAR规章链接</text>
              </view>
            </view>
          </view>

          <!-- 规范性文件卡片样式 -->
          <view wx:if="{{ item.type !== 'ccar' }}">
            <view class="normative-document-header">
              <view class="normative-document-type-badge">
                <van-icon name="description" size="14px" />
                <text>规范性文件</text>
              </view>
              <view class="normative-status-badge {{ item.is_effective ? 'status-valid' : 'status-invalid' }}">
                <van-icon name="{{ item.is_effective ? 'success' : 'cross' }}" size="12px" />
                <text>{{ item.is_effective ? '有效' : '失效' }}</text>
              </view>
              <view class="normative-copy-indicator prominent">
                <van-icon name="link" size="18px" />
                <text>复制链接</text>
              </view>
            </view>
            
            <view class="normative-document-body">
              <text class="normative-document-title">{{ item.title || (item.doc_number + ' - 未知标题') }}</text>
              <view class="normative-document-info">
                <view class="normative-info-row" wx:if="{{ item.doc_number }}">
                  <text class="normative-info-label">文号:</text>
                  <text class="normative-info-value doc-number">{{ item.doc_number }}</text>
                </view>
                <view class="normative-info-row" wx:if="{{ item.publish_date }}">
                  <text class="normative-info-label">发布日期:</text>
                  <text class="normative-info-value">{{ item.publish_date }}</text>
                </view>
                <view class="normative-info-row" wx:if="{{ item.category }}">
                  <text class="normative-info-label">分类:</text>
                  <text class="normative-info-value">{{ item.category }} → {{ item.subcategory }}</text>
                </view>
                <view class="normative-info-row" wx:if="{{ item.clean_office_unit }}">
                  <text class="normative-info-label">办文单位:</text>
                  <text class="normative-info-value">{{ item.clean_office_unit }}</text>
                </view>
              </view>
            </view>
            
            <view class="normative-document-footer">
              <view class="normative-action-hint prominent">
                <van-icon name="guide-o" size="14px" />
                <text>点击复制文档链接，可在浏览器中打开查看</text>
              </view>
            </view>
          </view>
        </view>
      </view>
      
      <!-- 搜索无结果 -->
      <view class="normative-empty-state" wx:if="{{ filteredNormativeDocuments.length === 0 }}">
        <van-empty 
          description="未找到相关规章制度" 
          image="search"
        >
          <view slot="description" class="normative-empty-tips">
            <text>未找到相关规章制度</text>
            <text class="normative-empty-suggestion">• 尝试使用更简短的关键词</text>
            <text class="normative-empty-suggestion">• 使用CCAR查询功能</text>
            <text class="normative-empty-suggestion">• 检查关键词拼写</text>
          </view>
        </van-empty>
      </view>
    </view>

    <!-- 加载状态 -->
    <van-empty
      wx:if="{{ normativeGroups.length === 0 && !normativeSearchValue }}"
      description="加载中..."
    />
  </view>

</view>