<view class="{{ containerClass || 'container' }} page-content">
  
  <view class="user-status-card">
    <view class="status-header">
      <view class="user-avatar">
        <text class="emoji-icon">{{ pilotLevelIcon || '✈️' }}</text>
      </view>
      <view class="user-info">
        <view class="greeting">{{ greeting || '欢迎回来' }}</view>
        <view class="status-subtitle">
          {{ pilotLevelName }}
        </view>
      </view>
      <view class="points-display">
        <view class="points-ring"></view>
        <text class="points-value">{{ pilotTotalXp }}</text>
        <text class="points-unit">经验</text>
      </view>
    </view>

    <view class="quick-actions">
      <view class="action-item">
        <view class="action-content">
          <view class="action-icon">
            <text class="emoji-icon small">📍</text>
          </view>
          <text class="action-text">
            已打卡 {{ (pilotStats && pilotStats.airportCount) || 0 }} 个机场
          </text>
          <view class="action-badge">
            新机场奖励更高
          </view>
        </view>
      </view>

      <view class="action-item">
        <view class="action-content">
          <view class="action-icon">
            <text class="emoji-icon small">🔥</text>
          </view>
          <text class="action-text">
            累计活跃 {{ (pilotStats && pilotStats.activeDays) || 0 }} 天
          </text>
          <view class="action-badge">
            每天打开都有经验
          </view>
        </view>
      </view>
    </view>
    <view class="level-progress-bar">
      <view class="level-progress-track">
        <view class="level-progress-fill" style="width: {{ pilotProgress }}%;"></view>
      </view>
      <view class="level-progress-text">
        <text class="segment-label">
          {{ pilotSegmentName || '理论课学员' }}
        </text>
        <text class="xp-text">
          {{ pilotTotalXp }}/{{ pilotNextLevelXp }} 经验
        </text>
      </view>
    </view>

    <view class="streak-display">
<view class="streak-text">升到下一等级还差 <text class="streak-strong">{{ pilotNextLevelXp > pilotTotalXp ? (pilotNextLevelXp - pilotTotalXp) : 0 }}</text> 经验</view>
    </view>
  </view>

  <!-- 横版广告 - 用户状态卡片下方 -->
  <view wx:if="{{ !isAdFree && nativeAdEnabled }}" class="ad-horizontal-container">
    <ad unit-id="adunit-3a1bf3800fa937a2" ad-type="banner" ad-intervals="30"></ad>
  </view>

  <!-- 资质提醒卡片 -->
  <!-- 有资质数据时显示 -->
  <view wx:if="{{ qualifications.length > 0 }}" class="qualification-alert-card">
    <view class="alert-header">
      <view class="alert-icon">
        <text class="emoji-icon">🛡️</text>
      </view>
      <view class="alert-content">
        <text class="alert-title">资质提醒</text>
        <text class="alert-subtitle {{ expiringSoonCount > 0 ? '' : 'all-valid' }}">{{ expiringSoonCount > 0 ? expiringSoonCount + '项即将到期' : '全部有效' }}</text>
      </view>
      <view class="alert-action" bind:tap="openQualificationManager">
        <text class="emoji-icon">→</text>
      </view>
    </view>
    
    <view class="qualification-items">
      <view
        wx:for="{{ qualifications }}"
        wx:key="id"
        class="qualification-item qualification-{{ item.status }}"
        bind:tap="openQualificationManager"
      >
        <view class="qual-status-dot"></view>
        <view class="qual-content">
          <view class="qual-name">{{ item.name }}</view>
          <view class="qual-status">
            <text>{{ item.statusText }}</text>
          </view>
        </view>
        <view class="qual-icon">
          <text class="emoji-icon">{{ item.iconEmoji }}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 新用户空状态：引导使用资质管理 -->
  <view wx:else class="qualification-empty-state">
    <view class="empty-state-content">
      <view class="empty-state-icon">
        <text class="emoji-icon">📜</text>
        <view class="icon-sparkle">✨</view>
      </view>
      <view class="empty-state-text">
        <text class="empty-title">开始管理您的飞行资质</text>
        <text class="empty-subtitle">证照到期提醒，让飞行更安心</text>
      </view>
      <view class="empty-state-action" bind:tap="openQualificationManager">
        <text class="action-text">添加第一个资质</text>
        <text class="emoji-icon">→</text>
      </view>
    </view>
  </view>

  <!-- 工具卡片网格区域 -->
  <view class="tools-grid">
        <!-- 新增：执勤期计算器卡片（第一个位置） -->
        <view class="category-card flight-calc" bind:tap="openDutyCalculator">
          <view class="card-icon">⏱️</view>
          <view class="card-title">执勤期计算器</view>
          <view class="card-desc">值班多久合法，秒查不求人</view>
          <view class="card-badge">
            <van-tag type="warning" size="medium">法规查询</van-tag>
          </view>
        </view>

        <view class="category-card management" bind:tap="openPersonalChecklist">
          <view class="card-icon">✅</view>
          <view class="card-title">个人检查单</view>
          <view class="card-desc">私人定制检查单，不遗漏不心慌</view>
          <view class="card-badge">
            <van-tag type="purple" size="medium">个性定制</van-tag>
          </view>
        </view>

        <view class="category-card flight-calc" bind:tap="openLongFlightCrewRotation">
          <view class="card-icon">🔄</view>
          <view class="card-title">长航线换班</view>
          <view class="card-desc">长途飞行不熬夜，轮班算得明明白白</view>
          <view class="card-badge">
            <van-tag type="warning" size="medium">轮班计算</van-tag>
          </view>
        </view>

        <view class="category-card flight-calc" bind:tap="openFlightTimeShare">
          <view class="card-icon">⏰</view>
          <view class="card-title">分飞行时间</view>
          <view class="card-desc">公平分时间，谁也不吃亏</view>
          <view class="card-badge">
            <van-tag type="warning" size="medium">智能分配</van-tag>
          </view>
        </view>
        <view class="category-card management" bind:tap="openQualificationManager">
          <view class="card-icon">📜</view>
          <view class="card-title">资质管理</view>
          <view class="card-desc">证照到期早提醒，心里有数不慌张</view>
          <view class="card-badge">
            <van-tag type="purple" size="medium">到期提醒</van-tag>
          </view>
        </view>

        <!-- 竖版广告 - 第6个位置 -->
        <view wx:if="{{ !isAdFree && nativeAdEnabled }}" class="category-card ad-card-vertical">
          <ad unit-id="adunit-d7a3b71f5ce0afca" ad-type="banner" ad-intervals="30"></ad>
        </view>

        <view class="category-card safety" bind:tap="openEventReport">
          <view class="card-icon">📝</view>
          <view class="card-title">事件报告</view>
          <view class="card-desc">事件报告不会写？这里有范本</view>
          <view class="card-badge">
            <van-tag type="success" size="medium">规范操作</van-tag>
          </view>
        </view>


        <view class="category-card podcast" bind:tap="jumpToOfficialAccountFromCard">
          <view class="card-icon">🎵</view>
          <view class="card-title">飞行播客</view>
          <view class="card-desc">边听边学，飞行知识装进耳朵</view>
          <view class="card-badge">
            <van-tag type="primary" size="medium">🔊 创新学习</van-tag>
          </view>
        </view>

  </view>

  <!-- 离线模式横幅 - 醒目入口 -->
  <view class="offline-banner" bind:tap="openOfflineCenter">
    <view class="offline-banner-icon">
      <text class="emoji-icon">📥</text>
    </view>
    <view class="offline-banner-content">
      <text class="offline-banner-title">离线模式</text>
      <text class="offline-banner-desc">绕机图片 + 航线录音，一键下载</text>
    </view>
    <view class="offline-banner-arrow">
      <text class="emoji-icon small">→</text>
    </view>
  </view>

  <!-- 关注公众号区域 - 已整合到卡片中，隐藏原区域 -->
  <!--
  <view class="category-section wechat-section">
    <view class="wechat-content">
      <view class="direct-jump-action">
        <van-button 
          type="primary" 
          size="normal"
          class="jump-button"
          bind:click="jumpToOfficialAccount">
          进入飞行播客
        </van-button>
      </view>
    
      <view class="qr-display">
        <image 
          class="qr-code-image" 
          src="/images/OfficialAccount.png"
          mode="aspectFit"
          bind:tap="previewQRCode"
          show-menu-by-longpress="{{true}}"
        />
        <text class="qr-hint">长按识别二维码关注"飞行播客"</text>
      </view>
    </view>
  </view>
  -->

  <!-- 应用信息卡片 -->
  <view class="app-info-card">
    <view class="info-header">
      <view class="info-icon">
        <text class="emoji-icon">ℹ️</text>
      </view>
      <text class="info-title">应用信息</text>
    </view>
    
    <van-cell-group class="info-group" border="{{ false }}">
      <van-cell
        title="版本信息"
        value="v2.15.3"
        icon="upgrade"
        class="info-cell"
        border="{{ false }}"
        bind:click="onVersionTap"
      />

      <van-cell
        title="意见反馈"
        is-link
        bind:click="feedback"
        icon="chat-o"
        class="info-cell"
        border="{{ false }}"
      />
      <van-cell
        title="关于作者"
        is-link
        bind:click="aboutUs"
        icon="contact"
        class="info-cell"
        border="{{ false }}"
      />

    </van-cell-group>
  </view>

  <!-- 应用信息卡片 -->
  <view class="warning-notice">
    <view class="warning-icon">
      <text class="emoji-icon">⚠️</text>
    </view>
    <view class="warning-content">
      本小程序旨在帮助飞行员学习航空理论知识，包括性能计算、概念理解、规章条例等内容。但请注意：所有计算逻辑均基于作者个人理解编写，可能存在错误且未经官方验证。因此，本小程序所有数据仅供学习参考，严禁用于实际飞行操作！
    </view>
  </view>

  <!-- 公众号二维码弹窗 - 简化版本 -->
  <van-popup
    show="{{ showQRCodeModal }}"
    bind:close="closeQRCodeModal"
    closeable="{{ true }}"
    close-icon-position="top-right"
    round="{{ true }}"
    custom-style="padding: 40rpx; background: #ffffff;"
  >
    <view class="qr-modal-content">
      <text class="modal-title">关注公众号</text>
      <view class="qr-container">
        <image 
          class="qr-modal-image" 
          src="/images/OfficialAccount.png"
          mode="aspectFit"
          bind:tap="previewQRCode"
        />
        <text class="qr-title">飞行播客</text>
        <text class="qr-modal-hint">长按识别二维码关注</text>
      </view>
    </view>
  </van-popup>

</view>