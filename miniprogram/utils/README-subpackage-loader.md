# æ™ºèƒ½åˆ†åŒ…åŠ è½½å™¨ä½¿ç”¨è¯´æ˜

## ğŸ“‹ æ¦‚è¿°

æ™ºèƒ½åˆ†åŒ…åŠ è½½å™¨ï¼ˆ`subpackage-loader.js`ï¼‰æ˜¯ä¸“é—¨ä¸ºè§£å†³å¾®ä¿¡å°ç¨‹åºå¼€å‘ç¯å¢ƒå’ŒçœŸæœºç¯å¢ƒåˆ†åŒ…åŠ è½½å·®å¼‚è€Œè®¾è®¡çš„å·¥å…·ã€‚

## ğŸ”„ å·¥ä½œåŸç†

### å¼€å‘ç¯å¢ƒè¡Œä¸º
- **æ£€æµ‹æ–¹å¼**: é€šè¿‡ `wx.getDeviceInfo()` æ£€æµ‹ `platform === 'devtools'`
- **åŠ è½½ç­–ç•¥**: ç›´æ¥ä½¿ç”¨å…œåº•æ•°æ®ï¼ˆfallback dataï¼‰
- **åŸå› **: å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸æ”¯æŒè·¨åˆ†åŒ…çš„ `require()` è°ƒç”¨
- **è¡¨ç°**: æ§åˆ¶å°ä¼šæ˜¾ç¤º "å¼€å‘ç¯å¢ƒæ£€æµ‹åˆ°è·¨åˆ†åŒ…requireé™åˆ¶ï¼Œç›´æ¥ä½¿ç”¨å…œåº•æ•°æ®"

### çœŸæœºç¯å¢ƒè¡Œä¸º  
- **æ£€æµ‹æ–¹å¼**: `platform !== 'devtools'`
- **åŠ è½½ç­–ç•¥**: 
  1. é¦–å…ˆæ‰§è¡Œ `wx.loadSubpackage()` é¢„åŠ è½½åˆ†åŒ…
  2. ç„¶åä½¿ç”¨ `require()` åŠ è½½åˆ†åŒ…å†…çš„æ•°æ®æ–‡ä»¶
  3. å¤±è´¥æ—¶é™çº§åˆ°å…œåº•æ•°æ®
- **è¡¨ç°**: èƒ½å¤ŸåŠ è½½å®Œæ•´çš„åˆ†åŒ…æ•°æ®

## ğŸ“¦ åˆ†åŒ…æ˜ å°„é…ç½®

```javascript
packageMapping = {
  'packageA': { name: 'icaoPackage', dataFile: 'icao900.js' },      // ICAOé€šä¿¡æ•°æ®
  'packageB': { name: 'abbreviationsPackage', dataFile: 'abbreviations.js' }, // ç¼©å†™æ•°æ®
  'packageC': { name: 'airportPackage', dataFile: 'airportdata.js' },         // æœºåœºæ•°æ®  
  'packageD': { name: 'definitionsPackage', dataFile: 'definitions.js' },     // å®šä¹‰æ•°æ®
  'packageCCAR': { name: 'caacPackage', dataFile: 'regulation.js' }           // CCARè§„ç« æ•°æ®
}
```

## ğŸ› ï¸ å…œåº•æ•°æ®ç³»ç»Ÿ

### æ•°æ®æ¥æº
- æ–‡ä»¶ä½ç½®: `miniprogram/data/fallback-data.js`
- ç”¨é€”: å½“åˆ†åŒ…åŠ è½½å¤±è´¥æ—¶æä¾›åŸºæœ¬åŠŸèƒ½

### æ•°æ®åˆ†ç±»
- **abbreviations**: 15æ¡å¸¸ç”¨èˆªç©ºç¼©å†™
- **definitions**: 10æ¡åŸºæœ¬æœ¯è¯­å®šä¹‰  
- **airports**: 10ä¸ªä¸»è¦å›½é™…æœºåœº
- **communications**: 10æ¡åŸºæœ¬é€šä¿¡æœ¯è¯­
- **normatives**: 6æ¡é‡è¦æ³•è§„æ–‡ä»¶

### æ•°æ®æ ¼å¼
å…œåº•æ•°æ®ä½¿ç”¨ä¸çœŸå®åˆ†åŒ…æ•°æ®å®Œå…¨ä¸€è‡´çš„å­—æ®µæ ¼å¼ï¼Œç¡®ä¿UIç»„ä»¶æ­£å¸¸æ˜¾ç¤ºã€‚

## ğŸ” ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬è°ƒç”¨
```javascript
var subpackageLoader = require('../../utils/subpackage-loader.js');

// åŠ è½½ç¼©å†™æ•°æ®
subpackageLoader.loadSubpackageData('packageB', [])
  .then(function(data) {
    console.log('æ•°æ®åŠ è½½æˆåŠŸ:', data.length);
  })
  .catch(function(error) {
    console.error('æ•°æ®åŠ è½½å¤±è´¥:', error);
  });
```

### ç¼“å­˜ç®¡ç†
```javascript
// è·å–ç¼“å­˜çŠ¶æ€
var cacheStatus = subpackageLoader.getCacheStatus();

// æ¸…é™¤ç¼“å­˜
subpackageLoader.clearCache();
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### å¼€å‘æ—¶çš„è­¦å‘Šä¿¡æ¯
åœ¨å¼€å‘è€…å·¥å…·ä¸­ä¼šçœ‹åˆ°ä»¥ä¸‹è­¦å‘Šï¼Œè¿™æ˜¯**æ­£å¸¸ç°è±¡**ï¼š
```
Requires "../packageB/abbreviations.js" from "utils/subpackage-loader.js" 
without a callback may fail in production, since they are in different subPackages
```

### ä¸ºä»€ä¹ˆä¼šæœ‰è¿™äº›è­¦å‘Šï¼Ÿ
1. **å¼€å‘è€…å·¥å…·é™åˆ¶**: å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸å…è®¸ä¸»åŒ…ç›´æ¥ `require` åˆ†åŒ…æ–‡ä»¶
2. **çœŸæœºæ­£å¸¸**: çœŸæœºç¯å¢ƒæ”¯æŒåˆ†åŒ…é¢„åŠ è½½åçš„è·¨åˆ†åŒ…è°ƒç”¨
3. **è®¾è®¡é¢„æœŸ**: è¿™æ˜¯å¾®ä¿¡å°ç¨‹åºçš„è®¾è®¡é™åˆ¶ï¼Œä¸æ˜¯ä»£ç é”™è¯¯

### å¦‚ä½•éªŒè¯åŠŸèƒ½æ­£å¸¸ï¼Ÿ
1. **å¼€å‘ç¯å¢ƒ**: ä½¿ç”¨å…œåº•æ•°æ®ï¼ŒåŠŸèƒ½åŸºæœ¬æ­£å¸¸
2. **çœŸæœºé¢„è§ˆ**: ä½¿ç”¨å®Œæ•´åˆ†åŒ…æ•°æ®ï¼ŒåŠŸèƒ½å®Œå…¨æ­£å¸¸
3. **å‘å¸ƒå**: ä½¿ç”¨å®Œæ•´åˆ†åŒ…æ•°æ®ï¼ŒåŠŸèƒ½å®Œå…¨æ­£å¸¸

## ğŸ§ª è°ƒè¯•å’Œæµ‹è¯•

### æµ‹è¯•è„šæœ¬
ä½¿ç”¨ `test-subpackage-loader.js` è¿›è¡Œå®Œæ•´æµ‹è¯•ï¼š
```javascript
var testLoader = require('./test-subpackage-loader.js');
testLoader.runFullTest();
```

### è°ƒè¯•æ–¹æ³•
åœ¨èµ„æ–™æŸ¥è¯¢é¡µé¢å¯ä»¥è°ƒç”¨è°ƒè¯•æ–¹æ³•ï¼š
```javascript
// åœ¨é¡µé¢ä¸­è°ƒç”¨
this.debugTestSubpackageLoading();
```

## ğŸ“Š æ€§èƒ½ç‰¹æ€§

### ç¼“å­˜æœºåˆ¶
- æ™ºèƒ½ç¼“å­˜é¿å…é‡å¤åŠ è½½
- åŸºäº `Map` çš„é«˜æ€§èƒ½ç¼“å­˜å­˜å‚¨
- è‡ªåŠ¨æ¸…ç†è¿‡æœŸç¼“å­˜

### ç¯å¢ƒè‡ªé€‚åº”
- è‡ªåŠ¨æ£€æµ‹è¿è¡Œç¯å¢ƒ
- æ ¹æ®ç¯å¢ƒé€‰æ‹©æœ€ä¼˜åŠ è½½ç­–ç•¥
- é€æ˜çš„é™çº§æœºåˆ¶

### é”™è¯¯æ¢å¤
- å¤šå±‚æ¬¡çš„é”™è¯¯å¤„ç†
- è‡ªåŠ¨é™çº§åˆ°å…œåº•æ•°æ®
- è¯¦ç»†çš„æ—¥å¿—è¾“å‡ºä¾¿äºè°ƒè¯•

## ğŸš€ æœ€ä½³å®è·µ

1. **ä¸ç”¨æ‹…å¿ƒå¼€å‘ç¯å¢ƒçš„è­¦å‘Š**: è¿™æ˜¯æ­£å¸¸ç°è±¡ï¼ŒçœŸæœºè¿è¡Œæ­£å¸¸
2. **å……åˆ†æµ‹è¯•çœŸæœºé¢„è§ˆ**: ç¡®ä¿åˆ†åŒ…é¢„åŠ è½½åŠŸèƒ½æ­£å¸¸
3. **ç›‘æ§ç¼“å­˜ä½¿ç”¨**: å®šæœŸæ£€æŸ¥ç¼“å­˜çŠ¶æ€é¿å…å†…å­˜æ³„æ¼
4. **æ›´æ–°å…œåº•æ•°æ®**: æ ¹æ®éœ€è¦æ›´æ–°å…œåº•æ•°æ®ç¡®ä¿åŸºæœ¬åŠŸèƒ½

## ğŸ“± çœŸæœºæµ‹è¯•å»ºè®®

1. **é¢„åŠ è½½éªŒè¯**: ç¡®è®¤åº”ç”¨å¯åŠ¨æ—¶åˆ†åŒ…é¢„åŠ è½½æˆåŠŸ
2. **æ•°æ®å®Œæ•´æ€§**: æ£€æŸ¥çœŸæœºä¸Šæ•°æ®é‡æ˜¯å¦ç¬¦åˆé¢„æœŸ
3. **æœç´¢åŠŸèƒ½**: æµ‹è¯•èµ„æ–™æŸ¥è¯¢çš„å„ä¸ªåˆ†ç±»æœç´¢
4. **ç¦»çº¿åŠŸèƒ½**: åœ¨é£è¡Œæ¨¡å¼ä¸‹æµ‹è¯•åŸºæœ¬åŠŸèƒ½
5. **æ€§èƒ½è¡¨ç°**: æ£€æŸ¥æ•°æ®åŠ è½½é€Ÿåº¦å’Œæœç´¢å“åº”æ—¶é—´