# 规范性文件自动分类系统

## 概述

本系统为微信小程序FlightToolbox的分包E，专门用于对民航规范性文件（如咨询通告AC、管理文件MD等）进行自动化分类管理。系统实现了三级文件夹结构的自动归类，有效解决了"部分文件没有明确规章部号"的问题。

## 系统架构

### 文件结构
```
packageE/
├── classifier.js          # 核心分类器
├── classified-data.js     # 分类数据管理器
├── test-classifier.js     # 测试脚本
├── demo.js               # 演示脚本
├── normative.js          # 规范性文件数据
├── regulation.js         # CCAR规章数据
├── index.js              # 小程序页面逻辑
├── index.wxml            # 小程序页面模板
├── index.wxss            # 小程序页面样式
├── index.json            # 小程序页面配置
└── README.md             # 说明文档
```

### 三级文件夹结构
```
📂 规章类别 (如：运行、机场、人员)
  📂 CCAR规章部号 (如：CCAR-91, CCAR-139, CCAR-61)
    📄 规范性文件 (如：AC-91-FS-001R2.pdf)
```

## 分类规则

### 三步分类法（优先级从高到低）

#### 1. 精确匹配（最高优先级）
- **原理**: 通过解析规范性文件`doc_number`字段中的数字，与CCAR规章部号对应
- **示例**: 
  - `AC-121-FS-139` → 提取部号`121` → `运行/CCAR-121/`
  - `AP-91-FS-2025-02R1` → 提取部号`91` → `运行/CCAR-91/`
  - `AC-396-10R1` → 提取部号`396` → `安全、安保与事故调查/CCAR-396/`

#### 2. 模糊匹配（中等优先级）
- **原理**: 当文号为空或无法提取有效数字时，通过负责司局和标题关键词进行分类
- **规则**:
  1. 优先根据`office_unit`（负责司局）匹配
  2. 结合`title`（标题）中的关键词进一步筛选
- **示例**:
  - 司局：`飞行标准司` + 标题：`驾驶员执照` → `航空人员类`
  - 司局：`机场司` + 标题：`机场建设` → `机场类`

#### 3. 手动分类（兜底方案）
- **适用**: 极少数通过前两步仍无法明确分类的文件
- **特征**: 标题非常宽泛，且无明确的负责司局

## 分类类别

### 8大主要类别

1. **行政管理类** - 企业管理、统计、服务、航权等
2. **航空人员类** - 执照、培训、体检、资格等
3. **航空器制造与适航类** - 审定、适航、型号合格证等
4. **维修类** - 维修单位、培训、航材等
5. **运行类** - 飞行规则、运行合格审定等
6. **机场类** - 机场建设、运行、专用设备等
7. **空中交通管理类** - 空管、通信、导航、气象等
8. **安全、安保与事故调查类** - 安全管理、事故调查、危险品等

### CCAR部号映射

系统内置了完整的CCAR部号与类别映射表，涵盖所有现行有效的民航规章：

```javascript
// 示例映射
'121': { category: '运行', subcategory: 'CCAR-121', name: '大型飞机公共航空运输承运人运行合格审定' }
'61': { category: '航空人员', subcategory: 'CCAR-61', name: '驾驶员执照' }
'139': { category: '机场', subcategory: 'CCAR-139', name: '运输机场使用许可' }
```

## 核心功能

### 分类器 (classifier.js)
- `extractCCARNumber()` - 从文档编号提取CCAR部号
- `fuzzyMatchByOfficeAndTitle()` - 模糊匹配分类
- `classifyDocument()` - 单文档分类
- `classifyNormativeDocuments()` - 批量分类
- `generateClassificationReport()` - 生成分类报告

### 数据管理器 (classified-data.js)
- `getCategories()` - 获取所有类别
- `getSubcategories()` - 获取子类别
- `getDocuments()` - 获取文档列表
- `searchDocuments()` - 搜索文档
- `getDocumentsByCCAR()` - 按CCAR部号查询
- `getStatistics()` - 获取统计信息

### 小程序界面功能
- 📊 分类统计展示
- 📂 三级目录浏览
- 🔍 全文搜索功能
- 🎯 CCAR部号精确查询
- 📋 分类报告导出
- 🔗 文档链接复制

## 使用方法

### 1. 在小程序中使用

```javascript
// 引入分类数据管理器
const classifiedData = require('./packageE/classified-data.js');

// 获取所有类别
const categories = classifiedData.getCategories();

// 搜索文档
const results = classifiedData.searchDocuments('驾驶员');

// 按CCAR部号查询
const ccarDocs = classifiedData.getDocumentsByCCAR('121');
```

### 2. 运行测试和演示

```bash
# 运行分类测试
node miniprogram/packageE/test-classifier.js

# 运行演示脚本
node miniprogram/packageE/demo.js
```

## 分类效果

### 预期指标
- ✅ **自动化分类成功率**: >95%
- 🎯 **精确匹配率**: >80%
- 🔍 **模糊匹配率**: 10-15%
- ✋ **需要手动处理**: <5%

### 实际效果（基于838个有效文件）
- 总文档数: 838个
- 分类数: 8个主要类别
- 子类别数: 约50+个CCAR部号分类
- 自动化分类成功率: 预计>95%

## 技术特点

### 1. 智能部号提取
支持多种文号格式的自动识别：
- `AC-121-FS-139` 
- `AP-91-FS-2025-02R1`
- `AC-67FS-001R2`
- `IB-FS-OPC-006`

### 2. 多层兜底机制
- 精确匹配失败 → 模糊匹配
- 模糊匹配失败 → 手动分类标记
- 确保所有文件都有归属

### 3. 缓存优化
- 24小时缓存机制
- 避免重复分类计算
- 提升查询性能

### 4. 完整统计
- 分类方法统计
- 置信度评估
- 详细分类报告

## 扩展性

### 1. 新增CCAR规章
在`CCAR_CATEGORY_MAP`中添加新的部号映射：

```javascript
'新部号': { category: '类别', subcategory: 'CCAR-新部号', name: '规章名称' }
```

### 2. 优化关键词匹配
在`TITLE_KEYWORD_MAP`中添加新的关键词：

```javascript
'类别名': ['关键词1', '关键词2', ...]
```

### 3. 新增司局映射
在`OFFICE_CATEGORY_MAP`中添加新的司局：

```javascript
'新司局': ['可能的类别1', '可能的类别2']
```

## 维护说明

### 1. 数据更新
- 定期更新`normative.js`中的规范性文件数据
- 确保数据格式与分类器兼容

### 2. 分类规则调优
- 根据实际分类效果调整关键词
- 优化模糊匹配逻辑
- 处理新出现的文号格式

### 3. 性能监控
- 监控分类成功率
- 跟踪需要手动处理的文件
- 定期生成分类报告

## 注意事项

1. **数据依赖**: 系统依赖`normative.js`和`regulation.js`中的数据质量
2. **格式兼容**: 新的文号格式可能需要更新提取规则
3. **分类准确性**: 模糊匹配的准确性依赖关键词库的完整性
4. **性能考虑**: 大量数据时建议使用缓存机制

## 未来优化

1. **机器学习**: 引入文本分类算法提升模糊匹配准确性
2. **用户反馈**: 添加用户纠错机制，持续优化分类规则
3. **可视化**: 增强分类结果的可视化展示
4. **导出功能**: 支持多种格式的分类结果导出

---

## 界面重构 (v2.0.0)

### 🎨 现代化设计
- **卡片式布局**: 采用现代化的卡片设计，提升视觉层次
- **渐变色彩**: 使用精美的渐变色彩，增强视觉吸引力
- **统一图标**: 使用一致的图标语言，提升界面专业度
- **响应式动画**: 增加交互反馈动画，提升用户体验

### 📊 数据可视化
- **统计卡片**: 将统计信息以卡片形式展示，更加直观
- **分类图标**: 为不同分类添加专属图标和色彩
- **进度指示**: 优化加载状态和空状态展示
- **面包屑导航**: 改善导航体验，用户不会迷失

### 🚀 功能优化
- **搜索增强**: 重新设计搜索区域，支持更好的交互
- **分类导航**: 优化分类浏览体验，层次更清晰
- **操作反馈**: 增加触摸反馈和状态提示
- **性能提升**: 优化CSS结构，减少组件依赖

### 🔧 技术改进
- **组件精简**: 移除过时的van-cell组件，使用更轻量的方案
- **样式重构**: 完全重写CSS，采用现代化布局技术
- **向后兼容**: 保持数据结构和API兼容性
- **测试完善**: 增加界面重构专项测试

### 📱 界面对比

#### 重构前
- 单调的列表式布局
- 缺乏视觉层次
- 统计信息不够直观
- 交互反馈不足

#### 重构后
- 现代化卡片式设计
- 清晰的视觉层次
- 数据可视化展示
- 丰富的交互反馈

### 🧪 测试验证
运行界面重构测试：
```javascript
const testUI = require('./test-ui-refactor.js')
testUI.runAllTests()
testUI.generateRefactorReport()
```

---

**开发团队**: FlightToolbox小程序开发组  
**最后更新**: 2024年12月  
**版本**: v2.0.0 (界面重构版) 