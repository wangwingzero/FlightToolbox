<view class="audio-player-page">
  <!-- æ²‰æµ¸å¼å¤´éƒ¨ -->
  <view class="page-header">
    <view class="header-region">{{ regionName }}</view>
    <view class="header-category">{{ categoryName }}</view>
    <view class="header-badge">
      <text class="badge-text">{{ clipIndex + 1 }} / {{ allClips.length }}</text>
    </view>
  </view>

  <!-- ä¸»æ’­æ”¾å™¨åŒºåŸŸ -->
  <view class="player-section">
    <!-- å”±ç‰‡å°é¢é£æ ¼ -->
    <view class="disc-area">
      <view class="disc {{ isPlaying ? 'spinning' : '' }}">
        <view class="disc-inner">
          <text class="disc-number">{{ clipIndex + 1 }}</text>
        </view>
      </view>
      <view class="disc-label">{{ currentClip.label }}</view>
    </view>

    <!-- å½•éŸ³æ–‡æœ¬ -->
    <view class="transcript-area" bind:tap="toggleTranscript" hover-class="none">
      <view wx:if="{{ !showTranscript }}" class="transcript-collapsed">
        <text class="transcript-toggle-icon">ğŸ“</text>
        <text class="transcript-toggle-text">ç‚¹å‡»æŸ¥çœ‹å½•éŸ³æ–‡æœ¬</text>
      </view>
      <view wx:else class="transcript-expanded">
        {{ currentClip.full_transcript }}
      </view>
    </view>

    <!-- è¿›åº¦æ¡ -->
    <view class="progress-area">
      <view class="progress-track">
        <view class="progress-filled" style="width: {{ audioProgress }}%">
          <view class="progress-thumb"></view>
        </view>
      </view>
      <view class="progress-time">
        <text class="time-current">{{ currentTimeText }}</text>
        <text class="time-total">{{ totalTimeText }}</text>
      </view>
    </view>

    <!-- æ’­æ”¾æ§åˆ¶ -->
    <view class="controls-area">
      <view class="ctrl-btn" bind:tap="previousClip" hover-class="none">
        <text class="ctrl-icon">â®</text>
      </view>
      <view class="ctrl-btn play-btn {{ isPlaying ? 'playing' : '' }}" bind:tap="togglePlayPause" hover-class="none">
        <text class="ctrl-icon">{{ isPlaying ? 'â¸' : 'â–¶ï¸' }}</text>
      </view>
      <view class="ctrl-btn" bind:tap="nextClip" hover-class="none">
        <text class="ctrl-icon">â­</text>
      </view>
    </view>

    <!-- éŸ³é‡æ»‘å— -->
    <view class="volume-area">
      <text class="volume-icon-small">ğŸ”ˆ</text>
      <slider
        class="volume-slider"
        value="{{ volume }}"
        min="0"
        max="100"
        block-size="20"
        bind:change="onVolumeChange"
        activeColor="#5856D6"
        backgroundColor="rgba(88,86,214,0.15)"
      />
      <text class="volume-icon-large">ğŸ”Š</text>
    </view>
  </view>

  <!-- å¿«æ·æ“ä½œæ  -->
  <view class="action-bar">
    <!-- å­¦ä¹ çŠ¶æ€ -->
    <view class="action-item {{ currentClip.isLearned ? 'learned' : '' }}" bind:tap="toggleCurrentClipLearned" hover-class="none">
      <view class="action-icon-wrap {{ currentClip.isLearned ? 'learned' : 'unlearned' }}">
        <text class="action-icon">{{ currentClip.isLearned ? 'âœ“' : 'â—‹' }}</text>
      </view>
      <text class="action-label">{{ currentClip.isLearned ? 'å·²å­¦ä¼š' : 'å¾…å­¦ä¹ ' }}</text>
    </view>

    <!-- å¾ªç¯æ’­æ”¾ -->
    <view class="action-item {{ isLooping ? 'active' : '' }}" bind:tap="toggleLoop" hover-class="none">
      <view class="action-icon-wrap {{ isLooping ? 'active' : '' }}">
        <text class="action-icon">ğŸ”</text>
      </view>
      <text class="action-label">{{ isLooping ? 'å¾ªç¯ä¸­' : 'å•æ¬¡' }}</text>
    </view>

    <!-- ä¸‹è½½è½¬å‘éŸ³é¢‘ -->
    <view class="action-item" bind:tap="shareCurrentAudio" hover-class="none">
      <view class="action-icon-wrap {{ isPreparing ? 'downloading' : '' }}">
        <text class="action-icon">â¬†</text>
      </view>
      <text class="action-label">{{ isPreparing ? 'å‡†å¤‡ä¸­' : 'ä¸‹è½½è½¬å‘' }}</text>
    </view>
  </view>

  <!-- å½•éŸ³åˆ—è¡¨ -->
  <view class="playlist-section">
    <view class="playlist-header">
      <text class="playlist-title">å…¨éƒ¨å½•éŸ³</text>
      <view class="playlist-badge">{{ allClips.length }}</view>
    </view>
    <scroll-view class="playlist-scroll" scroll-y enhanced show-scrollbar="{{false}}">
      <view wx:for="{{ allClips }}" wx:key="index"
            class="playlist-row {{ clipIndex === index ? 'current' : '' }} {{ item.isLearned ? 'learned' : '' }}"
            bind:tap="selectClip"
            data-index="{{ index }}"
            hover-class="none">
        <view class="row-index {{ clipIndex === index ? 'current' : '' }}">
          <text wx:if="{{ clipIndex === index }}" class="row-playing-icon">â–¶</text>
          <text wx:else>{{ index + 1 }}</text>
        </view>
        <view class="row-content">
          <text class="row-label">{{ item.label }}</text>
          <text class="row-preview">{{ item.isLearned ? item.full_transcript : 'ç‚¹å‡»å­¦ä¹ ' }}</text>
        </view>
        <view wx:if="{{ item.isLearned }}" class="row-badge learned">âœ“</view>
      </view>
    </scroll-view>
  </view>

  <!-- æ¨ªå¹…å¹¿å‘Š -->
  <view wx:if="{{ !isAdFree && nativeAdEnabled }}" class="ad-section">
    <ad unit-id="adunit-3a1bf3800fa937a2" ad-type="banner" ad-intervals="30"></ad>
  </view>

  <!-- åº•éƒ¨å®‰å…¨åŒºåŸŸ -->
  <view class="safe-area-bottom"></view>
</view>

<van-toast id="van-toast" />
