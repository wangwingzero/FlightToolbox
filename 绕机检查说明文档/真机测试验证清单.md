# 绕机检查图片加载 - 真机测试验证清单

**测试日期**: _________
**测试设备**: _________
**微信版本**: _________
**基础库版本**: _________

---

## ✅ 测试前准备

- [ ] 清除小程序缓存（删除小程序后重新打开）
- [ ] 确认已更新到最新代码版本
- [ ] 准备测试飞行模式（完全断网）

---

## 📝 测试步骤

### 第一阶段：首次完整流程测试（联网）

**1. 触发图片分包预加载**
- [ ] 打开小程序
- [ ] 访问"日出日落"页面（触发区域5-8图片分包预加载）
- [ ] 等待3-5秒，确保预加载完成
- [ ] **预期结果**: 无任何错误提示

**2. 访问绕机检查 - 已预加载区域**
- [ ] 返回首页
- [ ] 访问"绕机检查"功能
- [ ] 点击**区域5**（左发动机外侧）
- [ ] **预期结果**:
  - ✅ 图片正常显示（9张缩略图）
  - ✅ 无黑屏或加载失败
  - ✅ 控制台出现"✅ 已缓存图片到本地"日志
  - ✅ 大图预览功能正常（点击缩略图）

**3. 访问绕机检查 - 未预加载区域**
- [ ] 点击**区域10**（垂直安定面）
- [ ] **预期结果**:
  - ⚠️ 弹出预加载引导弹窗
  - 弹窗文字："要查看区域 10 (垂直安定面) 的检查图片，首次需要先访问指定页面自动加载图片资源..."
  - 提供"立即前往"和"稍后再说"按钮
- [ ] 点击"立即前往"按钮
- [ ] **预期结果**:
  - ✅ 自动跳转到"个人检查单"页面
  - ✅ 控制台出现"✅ 已标记区域范围 9-12 为预加载完成"日志
- [ ] 返回绕机检查，再次点击区域10
- [ ] **预期结果**:
  - ✅ 图片正常显示，无需再次引导
  - ✅ 控制台出现"✅ 区域 10 已预加载"日志

---

### 第二阶段：飞行模式重启测试（离线）

**4. 完全断网测试**
- [ ] 关闭小程序
- [ ] **开启飞行模式**（完全断网）
- [ ] 重新打开小程序
- [ ] **预期结果**: 小程序正常启动，无网络错误提示

**5. 验证已预加载区域（离线）**
- [ ] 访问"绕机检查"功能
- [ ] 点击**区域5**（已预加载）
- [ ] **预期结果**:
  - ✅ 图片正常显示（9张缩略图）
  - ✅ 无需重新预加载
  - ✅ 无黑屏或404错误
  - ✅ 大图预览功能正常
  - ✅ 控制台出现"✅ 从本地缓存加载"日志

**6. 验证未预加载区域（离线）**
- [ ] 点击**区域15**（未预加载）
- [ ] **预期结果**:
  - ⚠️ 弹出预加载引导弹窗
  - ⚠️ 提示"当前无网络连接，无法加载图片资源"
  - 提供"稍后再说"按钮（无法跳转）

---

### 第三阶段：大图预览性能测试

**7. 大图预览测试**
- [ ] 关闭飞行模式（恢复网络）
- [ ] 重新打开小程序
- [ ] 访问"绕机检查" → 区域1
- [ ] 点击任意缩略图
- [ ] **预期结果**:
  - ✅ 大图即时显示（无明显延迟）
  - ✅ 可左右滑动切换9张图片
  - ✅ 图片清晰，无模糊
  - ✅ 加载速度快（预期<100ms）

**8. 多次切换区域测试**
- [ ] 连续点击区域1、5、10、15
- [ ] **预期结果**:
  - ✅ 已预加载区域：秒开，无延迟
  - ⚠️ 未预加载区域：显示引导弹窗
  - ✅ 无重复弹窗（同一分包范围只引导一次）

---

### 第四阶段：极端情况测试

**9. 缓存损坏模拟**
- [ ] 使用微信开发者工具 → Storage → Files
- [ ] 删除 `walkaround-images` 目录
- [ ] 保持飞行模式，重新进入绕机检查
- [ ] 点击之前已预加载的区域5
- [ ] **预期结果**:
  - ⚠️ 显示"图片加载失败"提示
  - ⚠️ 引导重新预加载
  - ✅ 控制台出现"❌ 图片重试次数已达上限"日志
  - ✅ 控制台出现"🧹 清除分包 5-8 的持久化标记"日志

**10. 缓存自动恢复测试**
- [ ] 关闭飞行模式（恢复网络）
- [ ] 重新访问"日出日落"页面
- [ ] 返回绕机检查 → 区域5
- [ ] **预期结果**:
  - ✅ 图片正常加载
  - ✅ 控制台出现"✅ 已缓存图片到本地"日志
  - ✅ 再次开启飞行模式，图片仍可访问

---

## 🔍 控制台关键日志验证

### ✅ 正常流程日志（应该看到）

```
🎯 用户点击区域 5，主动确保图片分包已加载
🔄 主动加载分包: walkaroundImages2Package (区域 5)
✅ 分包主动加载成功: walkaroundImages2Package
✅ 已标记 5-8 为预加载完成
✅ 延迟后显示详情，确保分包完全就绪
✅ 图片缓存系统初始化完成
✅ 从本地缓存加载: area5_xxx.png
✅ 已缓存图片到本地: wxfile://usr/walkaround-images/area5_xxx.png
```

### ❌ 异常流程日志（不应该看到）

```
❌ 图片加载失败: GET packageWalkaroundImages1/images1/xxx.png 404
❌ 分包主动加载失败
❌ 缓存初始化失败
🚨 区域 X 的图片分包未预加载
```

**注意**: 如果在真机上看到404错误，说明分包加载失败，需要进一步排查。

---

## 📊 测试结果记录

### 测试通过标准

- ✅ 已预加载区域：图片100%正常显示（联网+离线）
- ✅ 未预加载区域：显示引导弹窗，引导后正常显示
- ✅ 飞行模式下：已预加载区域100%可访问
- ✅ 大图预览：加载速度快，无卡顿
- ✅ 缓存自动恢复：损坏后重新预加载可恢复

### 测试失败情况

如果测试失败，请记录：
- [ ] 失败步骤编号: _________
- [ ] 错误提示: _________
- [ ] 控制台日志: _________
- [ ] 截图: _________

---

## 🎯 完成标志

- [ ] 所有10个测试步骤全部通过
- [ ] 控制台日志符合预期
- [ ] 无404错误（真机环境）
- [ ] 离线模式下图片稳定可用

**测试结论**: ☐ 通过  ☐ 失败

**备注**: _________________________________________
